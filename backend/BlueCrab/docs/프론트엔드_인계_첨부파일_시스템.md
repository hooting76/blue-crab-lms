# 첨부파일 시스템 프론트엔드 인계 문서

## 📋 개요

게시글 첨부파일 시스템의 **업로드** 및 **조회** 기능이 완료되어 프론트엔드 팀에 인계합니다.
**다운로드 기능**은 프론트엔드 요구사항 협의 후 추가 구현 예정입니다.

---

## ✅ 완료된 기능

### 1. 첨부파일 업로드 시스템 (3단계 워크플로우)
### 2. 첨부파일 조회 시스템 (게시글 상세 조회 시 포함)

---

## 🚀 사용 가능한 API

### **Step 1: 게시글 생성**
```http
POST /api/boards/create
Content-Type: application/json

{
  "boardCode": 0,
  "boardTitle": "제목",
  "boardContent": "내용",
  "boardWriter": "작성자명"
}
```

**응답:**
```json
{
  "success": true,
  "message": "게시글이 성공적으로 생성되었습니다.",
  "data": {
    "boardIdx": 123
  }
}
```

### **Step 2: 파일 업로드**
```http
POST /api/board-attachments/upload/{boardIdx}
Content-Type: multipart/form-data
Authorization: Bearer {JWT_TOKEN}

FormData:
- files: File[] (최대 5개)
```

**응답:**
```json
{
  "success": true,
  "message": "파일 업로드가 완료되었습니다.",
  "data": [
    {
      "attachmentIdx": 1,
      "originalFileName": "문서.pdf",
      "filePath": "20241002/20241002-143021-001.pdf",
      "fileSize": 1024000,
      "mimeType": "application/pdf"
    },
    {
      "attachmentIdx": 2,
      "originalFileName": "이미지.jpg",
      "filePath": "20241002/20241002-143025-002.jpg",
      "fileSize": 2048000,
      "mimeType": "image/jpeg"
    }
  ]
}
```

### **Step 3: 첨부파일 연결**
```http
POST /api/boards/link-attachments/{boardIdx}
Content-Type: application/json
Authorization: Bearer {JWT_TOKEN}

{
  "attachmentIdx": [1, 2]
}
```

**응답:**
```json
{
  "success": true,
  "message": "첨부파일이 게시글에 성공적으로 연결되었습니다."
}
```

### **Step 4: 게시글 상세 조회 (첨부파일 포함)**
```http
POST /api/boards/detail
Content-Type: application/json

{
  "boardIdx": 123
}
```

**응답:**
```json
{
  "boardIdx": 123,
  "boardTitle": "제목",
  "boardContent": "내용",
  "boardWriter": "작성자명",
  "boardFile": "1,2",
  "boardView": 1,
  "boardReg": "2024-10-02 14:30:00",
  "attachmentDetails": [
    {
      "attachmentIdx": 1,
      "originalFileName": "문서.pdf",
      "filePath": "20241002/20241002-143021-001.pdf",
      "fileSize": 1024000,
      "mimeType": "application/pdf",
      "uploadDate": "2024-10-02 14:30:21",
      "isActive": 1
    },
    {
      "attachmentIdx": 2,
      "originalFileName": "이미지.jpg",
      "filePath": "20241002/20241002-143025-002.jpg",
      "fileSize": 2048000,
      "mimeType": "image/jpeg",
      "uploadDate": "2024-10-02 14:30:25",
      "isActive": 1
    }
  ]
}
```

---

## 💻 프론트엔드 구현 예시

### **React/JavaScript 구현 예시**

#### **1. 게시글 작성 + 파일 업로드**

```javascript
const createPostWithFiles = async (postData, files) => {
  try {
    // Step 1: 게시글 생성
    const createResponse = await fetch('/api/boards/create', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(postData)
    });
    
    const createResult = await createResponse.json();
    const boardIdx = createResult.data.boardIdx;
    
    // Step 2: 파일 업로드 (있는 경우)
    let attachmentIds = [];
    if (files && files.length > 0) {
      const formData = new FormData();
      files.forEach(file => formData.append('files', file));
      
      const uploadResponse = await fetch(`/api/board-attachments/upload/${boardIdx}`, {
        method: 'POST',
        headers: { 'Authorization': `Bearer ${getJWTToken()}` },
        body: formData
      });
      
      const uploadResult = await uploadResponse.json();
      attachmentIds = uploadResult.data.map(file => file.attachmentIdx);
      
      // Step 3: 첨부파일 연결
      await fetch(`/api/boards/link-attachments/${boardIdx}`, {
        method: 'POST',
        headers: { 
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${getJWTToken()}`
        },
        body: JSON.stringify({ attachmentIdx: attachmentIds })
      });
    }
    
    return { success: true, boardIdx };
    
  } catch (error) {
    console.error('게시글 생성 실패:', error);
    return { success: false, error };
  }
};
```

#### **2. 게시글 상세 조회 + 첨부파일 표시**

```javascript
const BoardDetail = ({ boardIdx }) => {
  const [board, setBoard] = useState(null);
  
  useEffect(() => {
    const fetchBoardDetail = async () => {
      try {
        const response = await fetch('/api/boards/detail', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ boardIdx })
        });
        
        const boardData = await response.json();
        setBoard(boardData);
      } catch (error) {
        console.error('게시글 조회 실패:', error);
      }
    };
    
    fetchBoardDetail();
  }, [boardIdx]);
  
  if (!board) return <div>로딩 중...</div>;
  
  return (
    <div>
      <h1>{board.boardTitle}</h1>
      <div>{board.boardContent}</div>
      
      {/* 첨부파일 목록 */}
      {board.attachmentDetails && board.attachmentDetails.length > 0 && (
        <div className="attachments">
          <h3>첨부파일</h3>
          {board.attachmentDetails.map(file => (
            <div key={file.attachmentIdx} className="attachment-item">
              <span>{file.originalFileName}</span>
              <span>({(file.fileSize / 1024).toFixed(1)} KB)</span>
              {/* 다운로드 버튼은 다운로드 API 구현 후 추가 */}
            </div>
          ))}
        </div>
      )}
    </div>
  );
};
```

#### **3. 파일 업로드 컴포넌트**

```javascript
const FileUpload = ({ onFilesSelected }) => {
  const handleFileChange = (e) => {
    const files = Array.from(e.target.files);
    
    // 파일 검증
    if (files.length > 5) {
      alert('최대 5개 파일까지 업로드 가능합니다.');
      return;
    }
    
    const validFiles = files.filter(file => {
      const allowedTypes = ['pdf', 'doc', 'docx', 'jpg', 'jpeg', 'png', 'gif'];
      const extension = file.name.split('.').pop().toLowerCase();
      return allowedTypes.includes(extension);
    });
    
    if (validFiles.length !== files.length) {
      alert('허용되지 않는 파일 형식이 포함되어 있습니다.');
      return;
    }
    
    onFilesSelected(validFiles);
  };
  
  return (
    <div>
      <input 
        type="file" 
        multiple 
        onChange={handleFileChange}
        accept=".pdf,.doc,.docx,.jpg,.jpeg,.png,.gif"
      />
    </div>
  );
};
```

---

## 🔧 파일 제한사항

### **업로드 제한**
- **최대 파일 수**: 게시글당 5개
- **파일 크기**: 개별 파일당 10MB
- **허용 확장자**: pdf, doc, docx, xls, xlsx, ppt, pptx, txt, jpg, jpeg, png, gif

### **파일 저장 방식**
- **저장소**: MinIO (board-attached 버킷)
- **경로 구조**: `YYYYMMDD/YYYYMMDD-HHMMSS-XXX.확장자`
- **파일명 변환**: 보안을 위해 원본 파일명이 변경됨
- **만료 정책**: 업로드 후 30일 (설정값으로 변경 가능)

---

## ⚠️ 주의사항

### **인증 필요 API**
- `POST /api/board-attachments/upload/{boardIdx}` - JWT 토큰 필요
- `POST /api/boards/link-attachments/{boardIdx}` - JWT 토큰 필요

### **에러 처리**
```javascript
// 에러 응답 예시
{
  "success": false,
  "message": "파일 업로드 실패: 허용되지 않는 파일 형식입니다.",
  "error": "INVALID_FILE_TYPE"
}
```

### **워크플로우 순서 중요**
1. **반드시** 게시글 생성 → 파일 업로드 → 첨부파일 연결 순서로 진행
2. 파일 업로드 실패 시 재시도 로직 구현 권장
3. 중간 단계 실패 시 롤백 처리 고려

---

## 🚧 향후 구현 예정

### **다운로드 API (협의 후 구현)**
```http
GET /api/board-attachments/download/{attachmentIdx}
```

**프론트엔드 팀과 협의 필요한 사항:**
1. **다운로드 방식**: 직접 링크 vs JavaScript fetch
2. **인증 방법**: Header vs Query Parameter
3. **UI/UX 요구사항**: 진행 상태, 에러 처리 등

---

## 🧪 테스트 가이드

### **테스트 시나리오**
1. **정상 플로우**: 게시글 생성 → 파일 업로드 → 연결 → 조회
2. **파일 없는 게시글**: 첨부파일 없이 게시글만 생성/조회
3. **파일 업로드 실패**: 잘못된 파일 형식, 크기 초과 등
4. **권한 없음**: JWT 토큰 없이 파일 업로드 시도

### **테스트용 데이터**
```javascript
// 테스트용 게시글 데이터
const testPostData = {
  boardCode: 0,
  boardTitle: "테스트 게시글",
  boardContent: "첨부파일 테스트용 게시글입니다.",
  boardWriter: "테스터"
};
```

---

## 📞 문의사항

첨부파일 시스템 관련 문의사항이나 추가 요구사항이 있으면 백엔드 팀에 연락주세요.

**특히 다운로드 기능 구현 시 협의 필요한 사항들을 미리 정리해주시면 더 효율적으로 진행할 수 있습니다!** 🚀
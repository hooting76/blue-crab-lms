# ê²Œì‹œê¸€ ì²¨ë¶€íŒŒì¼ ê¸°ëŠ¥ í†µí•© ê°€ì´ë“œ

## ğŸ“‹ ê°œìš”
ê¸°ì¡´ ê²Œì‹œê¸€ ì‘ì„±/ìˆ˜ì • ê¸°ëŠ¥ì— ì²¨ë¶€íŒŒì¼ ì—…ë¡œë“œ ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ê¸° ìœ„í•œ API í”Œë¡œìš° ê°€ì´ë“œì…ë‹ˆë‹¤.

---

## ğŸ”„ ì „ì²´ API í”Œë¡œìš°

### **ê²Œì‹œê¸€ ì‘ì„± (ì²¨ë¶€íŒŒì¼ í¬í•¨)**
```
1ë‹¨ê³„: ê²Œì‹œê¸€ ìƒì„±
   â†“
2ë‹¨ê³„: ì²¨ë¶€íŒŒì¼ ì—…ë¡œë“œ (ì„ íƒì‚¬í•­)
   â†“
3ë‹¨ê³„: ì²¨ë¶€íŒŒì¼ ì—°ê²° (2ë‹¨ê³„ ì‹¤í–‰ ì‹œì—ë§Œ)
```

### **ê²Œì‹œê¸€ ìˆ˜ì • (ì²¨ë¶€íŒŒì¼ ì¶”ê°€/ë³€ê²½)**
```
1ë‹¨ê³„: ê¸°ì¡´ ê²Œì‹œê¸€ ì¡°íšŒ
   â†“
2ë‹¨ê³„: ìƒˆë¡œìš´ ì²¨ë¶€íŒŒì¼ ì—…ë¡œë“œ (í•„ìš”ì‹œ)
   â†“  
3ë‹¨ê³„: ì²¨ë¶€íŒŒì¼ ëª©ë¡ ì—…ë°ì´íŠ¸
```

---

## ğŸ› ï¸ API ìƒì„¸ ëª…ì„¸

### **1ë‹¨ê³„: ê²Œì‹œê¸€ ìƒì„±** (ê¸°ì¡´ API)
**ì—”ë“œí¬ì¸íŠ¸**: `POST /api/boards/create`
**í—¤ë”**: 
```
Authorization: Bearer {JWT_TOKEN}
Content-Type: application/json
```
**ìš”ì²­ Body**:
```json
{
  "boardCode": 0,
  "boardTitle": "ê³µì§€ì‚¬í•­ ì œëª©",
  "boardContent": "ê³µì§€ì‚¬í•­ ë‚´ìš©",
  "boardWriterIdx": 1,
  "boardWriterType": 1
}
```
**ì‘ë‹µ**:
```json
{
  "success": true,
  "boardIdx": 123,  // â† ì´ ê°’ì„ ì €ì¥í•´ì•¼ í•¨!
  "message": "ê²Œì‹œê¸€ì´ ì„±ê³µì ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤."
}
```

---

### **2ë‹¨ê³„: ì²¨ë¶€íŒŒì¼ ì—…ë¡œë“œ** (ê¸°ì¡´ API)
**ì—”ë“œí¬ì¸íŠ¸**: `POST /api/board-attachments/upload/{boardIdx}`
**í—¤ë”**: 
```
Authorization: Bearer {JWT_TOKEN}
Content-Type: multipart/form-data
```
**ìš”ì²­ Body**:
```
files: [File1, File2, File3]  // FormDataë¡œ ì „ì†¡
```
> **ğŸ“ í”„ë¡ íŠ¸ì—”ë“œ íŒ€ ì°¸ê³ ì‚¬í•­**: 
> - íŒŒì¼ ì—…ë¡œë“œëŠ” ë°˜ë“œì‹œ `FormData` ê°ì²´ë¥¼ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤
> - JSONìœ¼ë¡œëŠ” íŒŒì¼ ì „ì†¡ì´ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤ (ì›¹ í‘œì¤€ ì œì•½)
> - `<input type="file">` íƒœê·¸ì—ì„œ ì„ íƒí•œ File ê°ì²´ë“¤ì„ FormDataì— appendí•˜ì—¬ ì „ì†¡
**ì‘ë‹µ**:
```json
{
  "success": true,
  "message": "ì²¨ë¶€íŒŒì¼ ì—…ë¡œë“œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.",
  "boardIdx": 123,
  "fileCount": 3,
  "attachments": [
    {
      "attachmentIdx": 45,  // â† ì´ ê°’ë“¤ì„ ì €ì¥í•´ì•¼ í•¨!
      "fileName": "íŒŒì¼1.pdf",
      "fileSize": 1024000   // íŒŒì¼ í¬ê¸° (ë‹¨ìœ„: bytes, 1024000 = ì•½ 1MB)
    },
    {
      "attachmentIdx": 46,
      "fileName": "íŒŒì¼2.jpg", 
      "fileSize": 512000    // íŒŒì¼ í¬ê¸° (ë‹¨ìœ„: bytes, 512000 = ì•½ 500KB)
    },
    {
      "attachmentIdx": 47,
      "fileName": "íŒŒì¼3.docx",
      "fileSize": 256000    // íŒŒì¼ í¬ê¸° (ë‹¨ìœ„: bytes, 256000 = ì•½ 250KB)
    }
  ]
}
```

---

### **3ë‹¨ê³„: ì²¨ë¶€íŒŒì¼ ì—°ê²°** (ì‹ ê·œ API)
**ì—”ë“œí¬ì¸íŠ¸**: `POST /api/boards/link-attachments/{boardIdx}`
**í—¤ë”**:
```
Authorization: Bearer {JWT_TOKEN}
Content-Type: application/json
```
**ìš”ì²­ Body**:
```json
{
  "attachmentIdx": [45, 46, 47]  // 2ë‹¨ê³„ì—ì„œ ë°›ì€ attachmentIdxë“¤
}
```
**ì‘ë‹µ**:
```json
{
  "success": true,
  "message": "ì²¨ë¶€íŒŒì¼ì´ ì„±ê³µì ìœ¼ë¡œ ì—°ê²°ë˜ì—ˆìŠµë‹ˆë‹¤.",
  "boardIdx": 123,
  "attachmentCount": 3,
  "attachmentIdx": [45, 46, 47]
}
```

---

## ğŸ’» í”„ë¡ íŠ¸ì—”ë“œ êµ¬í˜„ ì˜ˆì‹œ

### **ê²Œì‹œê¸€ ì‘ì„± (ì²¨ë¶€íŒŒì¼ í¬í•¨)**

```javascript
async function createBoardWithAttachments(boardData, files) {
    try {
        // 1ë‹¨ê³„: ê²Œì‹œê¸€ ìƒì„±
        console.log('1ë‹¨ê³„: ê²Œì‹œê¸€ ìƒì„± ì‹œì‘');
        const boardResponse = await fetch('/api/boards/create', {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${getJwtToken()}`,
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(boardData)
        });
        
        const boardResult = await boardResponse.json();
        
        if (!boardResult.success) {
            throw new Error(boardResult.message || 'ê²Œì‹œê¸€ ìƒì„± ì‹¤íŒ¨');
        }
        
        const boardIdx = boardResult.boardIdx;
        console.log('1ë‹¨ê³„ ì™„ë£Œ: ê²Œì‹œê¸€ ìƒì„±ë¨ (boardIdx:', boardIdx, ')');
        
        // ì²¨ë¶€íŒŒì¼ì´ ìˆëŠ” ê²½ìš°ì—ë§Œ 2~3ë‹¨ê³„ ì‹¤í–‰
        if (files && files.length > 0) {
            
            // 2ë‹¨ê³„: ì²¨ë¶€íŒŒì¼ ì—…ë¡œë“œ
            console.log('2ë‹¨ê³„: ì²¨ë¶€íŒŒì¼ ì—…ë¡œë“œ ì‹œì‘');
            
            // ğŸ’¡ ì¤‘ìš”: íŒŒì¼ ì—…ë¡œë“œëŠ” FormData ê°ì²´ë¥¼ ì‚¬ìš©í•´ì•¼ í•¨
            // JSONìœ¼ë¡œëŠ” íŒŒì¼ ì „ì†¡ ë¶ˆê°€ëŠ¥ (ì›¹ í‘œì¤€ ì œì•½)
            const formData = new FormData();
            files.forEach(file => formData.append('files', file));
            // â†‘ File ê°ì²´ë¥¼ 'files' í‚¤ë¡œ FormDataì— ì¶”ê°€
            
            const uploadResponse = await fetch(`/api/board-attachments/upload/${boardIdx}`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${getJwtToken()}`
                },
                body: formData
            });
            
            const uploadResult = await uploadResponse.json();
            
            if (!uploadResult.success) {
                throw new Error(uploadResult.message || 'ì²¨ë¶€íŒŒì¼ ì—…ë¡œë“œ ì‹¤íŒ¨');
            }
            
            console.log('2ë‹¨ê³„ ì™„ë£Œ: ì²¨ë¶€íŒŒì¼ ì—…ë¡œë“œë¨');
            
            // 3ë‹¨ê³„: ì²¨ë¶€íŒŒì¼ ì—°ê²°
            console.log('3ë‹¨ê³„: ì²¨ë¶€íŒŒì¼ ì—°ê²° ì‹œì‘');
            const attachmentIds = uploadResult.attachments.map(att => att.attachmentIdx);
            
            const linkResponse = await fetch(`/api/boards/link-attachments/${boardIdx}`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${getJwtToken()}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    attachmentIdx: attachmentIds
                })
            });
            
            const linkResult = await linkResponse.json();
            
            if (!linkResult.success) {
                throw new Error(linkResult.message || 'ì²¨ë¶€íŒŒì¼ ì—°ê²° ì‹¤íŒ¨');
            }
            
            console.log('3ë‹¨ê³„ ì™„ë£Œ: ì²¨ë¶€íŒŒì¼ ì—°ê²°ë¨');
        }
        
        return {
            success: true,
            boardIdx: boardIdx,
            message: 'ê²Œì‹œê¸€ì´ ì„±ê³µì ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.'
        };
        
    } catch (error) {
        console.error('ê²Œì‹œê¸€ ì‘ì„± ì‹¤íŒ¨:', error);
        return {
            success: false,
            error: error.message
        };
    }
}

// JWT í† í° ê°€ì ¸ì˜¤ê¸° (ê¸°ì¡´ êµ¬í˜„ì— ë§ê²Œ ìˆ˜ì • í•„ìš”)
function getJwtToken() {
    return localStorage.getItem('jwtToken') || sessionStorage.getItem('jwtToken');
}
```

---

## ğŸ”§ ê¸°ì¡´ í”„ë¡ íŠ¸ì—”ë“œ ìˆ˜ì • ê°€ì´ë“œ

### **1. HTML í¼ ìˆ˜ì •**
```html
<!-- ê¸°ì¡´ ê²Œì‹œê¸€ ì‘ì„± í¼ì— íŒŒì¼ ì…ë ¥ ì¶”ê°€ -->
<form id="boardForm">
    <!-- ê¸°ì¡´ í•„ë“œë“¤ -->
    <input type="text" id="boardTitle" name="boardTitle" required>
    <textarea id="boardContent" name="boardContent" required></textarea>
    
    <!-- ìƒˆë¡œ ì¶”ê°€í•  ì²¨ë¶€íŒŒì¼ í•„ë“œ -->
    <div class="file-upload-section">
        <label for="attachments">ì²¨ë¶€íŒŒì¼ (ìµœëŒ€ 5ê°œ)</label>
        <input type="file" id="attachments" name="attachments" multiple accept="*/*" max="5">
        <div id="fileList" class="file-list"></div>
    </div>
    
    <button type="submit">ê²Œì‹œê¸€ ì‘ì„±</button>
</form>
```

### **2. JavaScript ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ìˆ˜ì •**
```javascript
// ê¸°ì¡´ í¼ ì œì¶œ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ìˆ˜ì •
document.getElementById('boardForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    // ê¸°ì¡´ ê²Œì‹œê¸€ ë°ì´í„° ìˆ˜ì§‘
    const boardData = {
        boardCode: parseInt(document.getElementById('boardCode').value),
        boardTitle: document.getElementById('boardTitle').value,
        boardContent: document.getElementById('boardContent').value,
        boardWriterIdx: getCurrentUserIdx(),  // ê¸°ì¡´ êµ¬í˜„ì— ë§ê²Œ ìˆ˜ì •
        boardWriterType: getCurrentUserType() // ê¸°ì¡´ êµ¬í˜„ì— ë§ê²Œ ìˆ˜ì •
    };
    
    // ì²¨ë¶€íŒŒì¼ ìˆ˜ì§‘
    const fileInput = document.getElementById('attachments');
    const files = Array.from(fileInput.files);
    
    // íŒŒì¼ ê°œìˆ˜ ê²€ì¦
    if (files.length > 5) {
        alert('ì²¨ë¶€íŒŒì¼ì€ ìµœëŒ€ 5ê°œê¹Œì§€ë§Œ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
        return;
    }
    
    // ë¡œë”© ìƒíƒœ í‘œì‹œ
    showLoading('ê²Œì‹œê¸€ì„ ì‘ì„± ì¤‘ì…ë‹ˆë‹¤...');
    
    try {
        // ìƒˆë¡œìš´ í†µí•© í•¨ìˆ˜ í˜¸ì¶œ
        const result = await createBoardWithAttachments(boardData, files);
        
        if (result.success) {
            alert('ê²Œì‹œê¸€ì´ ì„±ê³µì ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.');
            // ê²Œì‹œê¸€ ëª©ë¡ í˜ì´ì§€ë¡œ ì´ë™ ë˜ëŠ” ìƒˆë¡œê³ ì¹¨
            window.location.href = '/boards';
        } else {
            alert('ê²Œì‹œê¸€ ì‘ì„± ì‹¤íŒ¨: ' + result.error);
        }
    } catch (error) {
        alert('ê²Œì‹œê¸€ ì‘ì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
    } finally {
        hideLoading();
    }
});
```

### **3. íŒŒì¼ ì„ íƒ ë¯¸ë¦¬ë³´ê¸° ê¸°ëŠ¥**
```javascript
// íŒŒì¼ ì„ íƒ ì‹œ ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ
document.getElementById('attachments').addEventListener('change', function(e) {
    const files = Array.from(e.target.files);
    const fileListDiv = document.getElementById('fileList');
    
    // íŒŒì¼ ê°œìˆ˜ ê²€ì¦
    if (files.length > 5) {
        alert('ì²¨ë¶€íŒŒì¼ì€ ìµœëŒ€ 5ê°œê¹Œì§€ë§Œ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
        e.target.value = '';
        return;
    }
    
    // íŒŒì¼ ëª©ë¡ í‘œì‹œ
    fileListDiv.innerHTML = '';
    files.forEach((file, index) => {
        const fileItem = document.createElement('div');
        fileItem.className = 'file-item';
        fileItem.innerHTML = `
            <span class="file-name">${file.name}</span>
            <span class="file-size">(${formatFileSize(file.size)})</span>
            <button type="button" onclick="removeFile(${index})">ì‚­ì œ</button>
        `;
        fileListDiv.appendChild(fileItem);
    });
});

// íŒŒì¼ í¬ê¸° í¬ë§·íŒ… (bytesë¥¼ ì‚¬ëŒì´ ì½ê¸° ì‰¬ìš´ ë‹¨ìœ„ë¡œ ë³€í™˜)
function formatFileSize(bytes) {
    if (bytes === 0) return '0 Bytes';
    const k = 1024;  // 1KB = 1024 bytes
    const sizes = ['Bytes', 'KB', 'MB', 'GB'];  // ë‹¨ìœ„ ë°°ì—´
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    // ì˜ˆì‹œ: 1024000 bytes â†’ 1000.00 KB â†’ "1000.00 KB"
    //      1048576 bytes â†’ 1.00 MB â†’ "1.00 MB"
}
```

---

## âš ï¸ ì£¼ì˜ì‚¬í•­

### **1. íŒŒì¼ ì „ì†¡ ë°©ì‹ (ì¤‘ìš”!)**
- **2ë‹¨ê³„ íŒŒì¼ ì—…ë¡œë“œ**: ë°˜ë“œì‹œ `FormData` ì‚¬ìš© (JSON ë¶ˆê°€)
- **1, 3ë‹¨ê³„**: JSON ë°©ì‹ìœ¼ë¡œ ì „ì†¡
- **ì´ìœ **: íŒŒì¼(ë°”ì´ë„ˆë¦¬ ë°ì´í„°)ì€ ì›¹ í‘œì¤€ìƒ FormDataë¡œë§Œ ì „ì†¡ ê°€ëŠ¥

### **2. ì—ëŸ¬ ì²˜ë¦¬**
- ê° ë‹¨ê³„ë³„ë¡œ ì‹¤íŒ¨ ì‹œ ì‚¬ìš©ìì—ê²Œ ëª…í™•í•œ ë©”ì‹œì§€ í‘œì‹œ
- ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜, ì¸ì¦ ì˜¤ë¥˜, ì„œë²„ ì˜¤ë¥˜ êµ¬ë¶„í•˜ì—¬ ì²˜ë¦¬

### **2. ì²¨ë¶€íŒŒì¼ ì œí•œ**
- ìµœëŒ€ 5ê°œ íŒŒì¼
- íŒŒì¼ í¬ê¸° ì œí•œ (ì„œë²„ ì„¤ì •ì— ë”°ë¼)
- íŒŒì¼ í˜•ì‹ ì œí•œ (í•„ìš”ì‹œ)

### **3. ì‚¬ìš©ì ê²½í—˜**
- ë¡œë”© ìƒíƒœ í‘œì‹œ
- ì§„í–‰ë¥  í‘œì‹œ (ëŒ€ìš©ëŸ‰ íŒŒì¼ ì—…ë¡œë“œ ì‹œ)
- ì·¨ì†Œ ê¸°ëŠ¥ ì œê³µ

### **4. íŠ¸ëœì­ì…˜ ì²˜ë¦¬**
- 1ë‹¨ê³„ ì„±ê³µ í›„ 2~3ë‹¨ê³„ ì‹¤íŒ¨ ì‹œì—ë„ ê²Œì‹œê¸€ì€ ìƒì„±ë¨
- í•„ìš”ì‹œ ë¡¤ë°± ë¡œì§ êµ¬í˜„ ê³ ë ¤

---

## ğŸ” í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

### **ì •ìƒ ì¼€ì´ìŠ¤**
1. ì²¨ë¶€íŒŒì¼ ì—†ëŠ” ê²Œì‹œê¸€ ì‘ì„±
2. ì²¨ë¶€íŒŒì¼ 1ê°œ í¬í•¨ ê²Œì‹œê¸€ ì‘ì„±  
3. ì²¨ë¶€íŒŒì¼ 5ê°œ í¬í•¨ ê²Œì‹œê¸€ ì‘ì„±

### **ì—ëŸ¬ ì¼€ì´ìŠ¤**
1. JWT í† í° ë§Œë£Œ
2. ì²¨ë¶€íŒŒì¼ ê°œìˆ˜ ì´ˆê³¼ (6ê°œ ì´ìƒ)
3. ë„¤íŠ¸ì›Œí¬ ì—°ê²° ì˜¤ë¥˜
4. ì„œë²„ ì˜¤ë¥˜

---

## ğŸ“ ë¬¸ì˜ì‚¬í•­
ë°±ì—”ë“œ API ê´€ë ¨ ë¬¸ì˜ì‚¬í•­ì´ ìˆìœ¼ì‹œë©´ ì–¸ì œë“ ì§€ ë§ì”€í•´ ì£¼ì„¸ìš”!
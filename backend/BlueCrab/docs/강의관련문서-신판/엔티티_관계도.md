# ì—”í‹°í‹° ê´€ê³„ë„ ë¬¸ì„œ

## ğŸ“‹ ê°œìš”

JPA ì—”í‹°í‹° ê°„ì˜ ê´€ê³„ ë° ì°¸ì¡° êµ¬ì¡°ë¥¼ ì •ë¦¬í•œ ë¬¸ì„œì…ë‹ˆë‹¤.

**íŒ¨í‚¤ì§€**: `BlueCrab.com.example.entity.Lecture`

---

## ğŸ—ï¸ ì—”í‹°í‹° ëª©ë¡

### 1. LecTbl (ê°•ì˜ ì—”í‹°í‹°)

**íŒŒì¼**: `LecTbl.java`  
**í…Œì´ë¸”**: `LEC_TBL`

**ì£¼ìš” í•„ë“œ**:
```java
@Entity
@Table(name = "LEC_TBL")
public class LecTbl {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column(name = "LEC_IDX")
    private Integer lecIdx;
    
    @Column(name = "LEC_SERIAL", unique = true)
    private String lecSerial;
    
    @Column(name = "LEC_TIT")
    private String lecTit;
    
    @Column(name = "LEC_PROF")
    private Integer lecProf;
    
    @Column(name = "LEC_POINT")
    private Integer lecPoint;
    
    @Column(name = "LEC_MANY")
    private Integer lecMany;
    
    @Column(name = "LEC_CURRENT")
    private Integer lecCurrent;
    
    @Column(name = "LEC_OPEN")
    private Integer lecOpen;
    
    @Column(name = "LEC_YEAR")
    private Integer lecYear;
    
    @Column(name = "LEC_SEMESTER")
    private Integer lecSemester;
}
```

**ê´€ê³„**:
- `lecProf` â†’ `USER_TBL.USER_IDX` (êµìˆ˜)
- `lecMcode` â†’ `FACULTY.faculty_code` (í•™ë¶€)
- `lecMcodeDep` â†’ `DEPARTMENT.dept_code` (í•™ê³¼)

---

### 2. EnrollmentExtendedTbl (ìˆ˜ê°•ì‹ ì²­ ì—”í‹°í‹°)

**íŒŒì¼**: `EnrollmentExtendedTbl.java`  
**í…Œì´ë¸”**: `ENROLLMENT_EXTENDED_TBL`

**ì£¼ìš” í•„ë“œ**:
```java
@Entity
@Table(name = "ENROLLMENT_EXTENDED_TBL")
public class EnrollmentExtendedTbl {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column(name = "ENROLLMENT_IDX")
    private Integer enrollmentIdx;
    
    @Column(name = "LEC_IDX")
    private Integer lecIdx;
    
    @Column(name = "STUDENT_IDX")
    private Integer studentIdx;
    
    @Column(name = "ENROLLMENT_DATA", columnDefinition = "TEXT")
    private String enrollmentData;
}
```

**ê´€ê³„**:
- `lecIdx` â†’ `LEC_TBL.LEC_IDX` (ê°•ì˜)
- `studentIdx` â†’ `USER_TBL.USER_IDX` (í•™ìƒ)

**JSON ë°ì´í„° êµ¬ì¡°**:
```json
{
  "attendance": "1ì¶œ2ì¶œ3ê²°4ì§€",
  "attendanceRate": "2/4",
  "midterm": 85,
  "final": 90,
  "assignment": 95,
  "totalGrade": 92.5,
  "letterGrade": "A+"
}
```

---

### 3. AssignmentExtendedTbl (ê³¼ì œ ì—”í‹°í‹°)

**íŒŒì¼**: `AssignmentExtendedTbl.java`  
**í…Œì´ë¸”**: `ASSIGNMENT_EXTENDED_TBL`

**ì£¼ìš” í•„ë“œ**:
```java
@Entity
@Table(name = "ASSIGNMENT_EXTENDED_TBL")
public class AssignmentExtendedTbl {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column(name = "ASSIGN_IDX")
    private Integer assignIdx;
    
    @Column(name = "LEC_IDX")
    private Integer lecIdx;
    
    @Column(name = "ASSIGN_TITLE")
    private String assignTitle;
    
    @Column(name = "ASSIGN_CONTENT", columnDefinition = "TEXT")
    private String assignContent;
    
    @Column(name = "ASSIGN_DUE_DATE")
    private LocalDateTime assignDueDate;
    
    @Column(name = "ASSIGN_MAX_SCORE")
    private Integer assignMaxScore;
    
    @Column(name = "ASSIGN_FILES", columnDefinition = "TEXT")
    private String assignFiles;
}
```

**ê´€ê³„**:
- `lecIdx` â†’ `LEC_TBL.LEC_IDX` (ê°•ì˜)

---

### 4. AttendanceRequestTbl (ì¶œì„ ìš”ì²­ ì—”í‹°í‹°)

**íŒŒì¼**: `AttendanceRequestTbl.java`  
**í…Œì´ë¸”**: `ATTENDANCE_REQUEST_TBL`

**ì£¼ìš” í•„ë“œ**:
```java
@Entity
@Table(name = "ATTENDANCE_REQUEST_TBL")
public class AttendanceRequestTbl {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column(name = "request_idx")
    private Integer requestIdx;
    
    @Column(name = "lec_idx")
    private Integer lecIdx;
    
    @Column(name = "student_idx")
    private Integer studentIdx;
    
    @Column(name = "session_number")
    private Integer sessionNumber;
    
    @Column(name = "request_reason", columnDefinition = "TEXT")
    private String requestReason;
    
    @Column(name = "status")
    private String status; // PENDING, APPROVED, REJECTED
    
    @Column(name = "rejection_reason", columnDefinition = "TEXT")
    private String rejectionReason;
    
    @Column(name = "requested_at")
    private LocalDateTime requestedAt;
    
    @Column(name = "processed_at")
    private LocalDateTime processedAt;
}
```

**ê´€ê³„**:
- `lecIdx` â†’ `LEC_TBL.LEC_IDX` (ê°•ì˜)
- `studentIdx` â†’ `USER_TBL.USER_IDX` (í•™ìƒ)

---

### 5. CourseApplyNotice (ìˆ˜ê°•ì‹ ì²­ ì•ˆë‚´ë¬¸ ì—”í‹°í‹°)

**íŒŒì¼**: `CourseApplyNotice.java`  
**í…Œì´ë¸”**: `COURSE_APPLY_NOTICE`

**ì£¼ìš” í•„ë“œ**:
```java
@Entity
@Table(name = "COURSE_APPLY_NOTICE")
public class CourseApplyNotice {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column(name = "notice_idx")
    private Integer noticeIdx;
    
    @Column(name = "message", columnDefinition = "TEXT")
    private String message;
    
    @Column(name = "updated_at")
    private LocalDateTime updatedAt;
    
    @Column(name = "updated_by")
    private String updatedBy;
    
    @Column(name = "created_at")
    private LocalDateTime createdAt;
}
```

**ê´€ê³„**: ì—†ìŒ (ë…ë¦½ í…Œì´ë¸”)

---

### 6. Faculty (í•™ë¶€ ì—”í‹°í‹°)

**íŒŒì¼**: `Faculty.java`  
**í…Œì´ë¸”**: `FACULTY`

**ì£¼ìš” í•„ë“œ**:
```java
@Entity
@Table(name = "FACULTY")
public class Faculty {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column(name = "faculty_id")
    private Integer facultyId;
    
    @Column(name = "faculty_code")
    private String facultyCode;
    
    @Column(name = "faculty_name")
    private String facultyName;
    
    @Column(name = "established_at")
    private String establishedAt;
    
    @Column(name = "capacity")
    private Integer capacity;
    
    @OneToMany(mappedBy = "faculty")
    private List<Department> departments;
}
```

**ê´€ê³„**:
- `departments` â† `DEPARTMENT.faculty_id` (1:N)

---

### 7. Department (í•™ê³¼ ì—”í‹°í‹°)

**íŒŒì¼**: `Department.java`  
**í…Œì´ë¸”**: `DEPARTMENT`

**ì£¼ìš” í•„ë“œ**:
```java
@Entity
@Table(name = "DEPARTMENT")
public class Department {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column(name = "dept_id")
    private Integer deptId;
    
    @Column(name = "dept_code")
    private String deptCode;
    
    @Column(name = "dept_name")
    private String deptName;
    
    @ManyToOne
    @JoinColumn(name = "faculty_id")
    private Faculty faculty;
    
    @Column(name = "established_at")
    private String establishedAt;
    
    @Column(name = "capacity")
    private Integer capacity;
}
```

**ê´€ê³„**:
- `faculty` â†’ `FACULTY.faculty_id` (N:1)

---

## ğŸ”— ì—”í‹°í‹° ê´€ê³„ë„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Faculty   â”‚
â”‚   (í•™ë¶€)     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 1
       â”‚ OneToMany
       â”‚ N
â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
â”‚ Department  â”‚
â”‚   (í•™ê³¼)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   LecTbl    â”‚       êµìˆ˜ ì •ë³´ëŠ” ë³„ë„ JOIN í•„ìš”
â”‚   (ê°•ì˜)     â”‚       (lecProf â†’ USER_TBL.USER_IDX)
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 1
       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ N            â”‚ N            â”‚ N
â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
â”‚ Enrollment  â”‚ â”‚Assignmentâ”‚ â”‚ Attendance â”‚
â”‚  Extended   â”‚ â”‚ Extended â”‚ â”‚  Request   â”‚
â”‚  (ìˆ˜ê°•ì‹ ì²­)  â”‚ â”‚  (ê³¼ì œ)   â”‚ â”‚ (ì¶œì„ìš”ì²­) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ enrollmentData (JSON)
       â”‚ - attendance
       â”‚ - attendanceRate
       â”‚ - midterm/final
       â”‚ - totalGrade
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CourseApplyNotice   â”‚   (ë…ë¦½ í…Œì´ë¸”)
â”‚  (ìˆ˜ê°•ì‹ ì²­ ì•ˆë‚´ë¬¸)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š JPA ì–´ë…¸í…Œì´ì…˜ ì‚¬ìš© íŒ¨í„´

### ê¸°ë³¸ ë§¤í•‘
```java
@Entity
@Table(name = "í…Œì´ë¸”ëª…")
public class EntityName {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column(name = "ì»¬ëŸ¼ëª…")
    private Integer id;
}
```

### OneToMany ê´€ê³„
```java
// Faculty.java
@OneToMany(mappedBy = "faculty")
private List<Department> departments;

// Department.java
@ManyToOne
@JoinColumn(name = "faculty_id")
private Faculty faculty;
```

### JSON ë°ì´í„° ì»¬ëŸ¼
```java
@Column(name = "ENROLLMENT_DATA", columnDefinition = "TEXT")
private String enrollmentData;
```

### LocalDateTime ë§¤í•‘
```java
@Column(name = "created_at")
private LocalDateTime createdAt;
```

---

## ğŸ”„ Repository íŒ¨í„´

### ê¸°ë³¸ Repository
```java
public interface LecTblRepository extends JpaRepository<LecTbl, Integer> {
    Optional<LecTbl> findByLecSerial(String lecSerial);
    List<LecTbl> findByLecProf(Integer lecProf);
    Page<LecTbl> findByLecYear(Integer year, Pageable pageable);
}
```

### ì»¤ìŠ¤í…€ ì¿¼ë¦¬
```java
@Query("SELECT l FROM LecTbl l WHERE l.lecTit LIKE %:title%")
List<LecTbl> searchByTitle(@Param("title") String title);
```

---

## ğŸ’¡ ë°ì´í„° ì²˜ë¦¬ íŒ¨í„´

### JSON ë°ì´í„° íŒŒì‹± (enrollmentData)
```java
ObjectMapper mapper = new ObjectMapper();

// ì½ê¸°
JsonNode data = mapper.readTree(enrollment.getEnrollmentData());
String attendance = data.get("attendance").asText();
int midterm = data.get("midterm").asInt();

// ì“°ê¸°
ObjectNode newData = mapper.createObjectNode();
newData.put("attendance", "1ì¶œ2ì¶œ3ê²°");
newData.put("midterm", 85);
enrollment.setEnrollmentData(mapper.writeValueAsString(newData));
```

### ì¶œì„ ë¬¸ìì—´ íŒŒì‹±
```java
String attendanceStr = "1ì¶œ2ì¶œ3ê²°4ì§€5ì¶œ";
Pattern pattern = Pattern.compile("(\\d+)([ì¶œê²°ì§€ì¡°])");
Matcher matcher = pattern.matcher(attendanceStr);

Map<Integer, String> attendanceMap = new HashMap<>();
while (matcher.find()) {
    int session = Integer.parseInt(matcher.group(1));
    String status = matcher.group(2);
    attendanceMap.put(session, status);
}
```

---

## âš ï¸ ì£¼ì˜ì‚¬í•­

### 1. N+1 ë¬¸ì œ ë°©ì§€
```java
// Bad: N+1 ë°œìƒ
List<LecTbl> lectures = lecRepository.findAll();
for (LecTbl lec : lectures) {
    String profName = userRepository.findById(lec.getLecProf()).getName(); // Në²ˆ ì¿¼ë¦¬
}

// Good: JOIN FETCH ì‚¬ìš©
@Query("SELECT l FROM LecTbl l JOIN FETCH l.professor")
List<LecTbl> findAllWithProfessor();
```

### 2. JSON í•„ë“œ ë™ì‹œì„±
```java
// enrollmentData ì—…ë°ì´íŠ¸ ì‹œ íŠ¸ëœì­ì…˜ í•„ìˆ˜
@Transactional
public void updateAttendance(Integer enrollmentIdx, String newAttendance) {
    EnrollmentExtendedTbl enrollment = repository.findById(enrollmentIdx).orElseThrow();
    
    // JSON ë°ì´í„° ì½ê¸°
    JsonNode data = mapper.readTree(enrollment.getEnrollmentData());
    
    // ìˆ˜ì •
    ((ObjectNode) data).put("attendance", newAttendance);
    
    // ì €ì¥
    enrollment.setEnrollmentData(mapper.writeValueAsString(data));
    repository.save(enrollment);
}
```

### 3. ì–‘ë°©í–¥ ê´€ê³„ ì£¼ì˜
```java
// Faculty â†” Department ì–‘ë°©í–¥ ê´€ê³„ ì‹œ
faculty.getDepartments().add(department);
department.setFaculty(faculty);  // ì–‘ìª½ ëª¨ë‘ ì„¤ì • í•„ìš”
```

---

## ğŸ“ˆ ì„±ëŠ¥ ìµœì í™” íŒ

1. **ì¸ë±ìŠ¤ í™œìš©**: `lecSerial`, `lecProf`, `status` ë“±ì— ì¸ë±ìŠ¤ ìƒì„±
2. **í˜ì´ì§• ì‚¬ìš©**: ëŒ€ëŸ‰ ì¡°íšŒ ì‹œ `Pageable` ì‚¬ìš©
3. **Projection í™œìš©**: í•„ìš”í•œ ì»¬ëŸ¼ë§Œ ì¡°íšŒ
4. **ìºì‹±**: ìì£¼ ì¡°íšŒë˜ëŠ” ë°ì´í„° (Faculty, Department) ìºì‹±

---

Â© 2025 BlueCrab LMS Development Team

# ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§

ì„±ì í™•ì¸ì„œ APIì˜ ì„±ì  ê³„ì‚° ë° í†µê³„ ë¡œì§

---

## ğŸ¯ ì„±ì  ìƒíƒœ íŒì •

### ìƒíƒœ ê²°ì • ë¡œì§

```java
private String determineStatus(JsonNode gradeNode, double percentage) {
    // 1. finalized í”Œë˜ê·¸ í™•ì¸
    boolean finalized = gradeNode.path("finalized").asBoolean(false);
    
    if (finalized) {
        // ì„±ì  í™•ì •ë¨
        String letterGrade = gradeNode.path("letterGrade").asText("N/A");
        return letterGrade.equals("F") ? "FAILED" : "COMPLETED";
    }
    
    // 2. ì„±ì  ë¯¸í™•ì • - percentageë¡œ ì„ì‹œ íŒë‹¨
    if (percentage >= 60.0) {
        return "IN_PROGRESS";    // 60% ì´ìƒ - ì§„í–‰ì¤‘
    } else {
        return "NOT_GRADED";     // 60% ë¯¸ë§Œ - ë¯¸í™•ì •
    }
}
```

### ìƒíƒœë³„ ì¡°ê±´

| ìƒíƒœ | ì¡°ê±´ | letterGrade | ì„¤ëª… |
|------|------|-------------|------|
| COMPLETED | finalized=true, gradeâ‰ F | A/B/C/D | ìˆ˜ë£Œ (í•™ì  ì·¨ë“) |
| FAILED | finalized=true, grade=F | F | ë‚™ì œ (ì¬ìˆ˜ê°• í•„ìš”) |
| IN_PROGRESS | finalized=false, â‰¥60% | "ì§„í–‰ì¤‘" | ìˆ˜ê°• ì¤‘ (í•©ê²© ê°€ëŠ¥) |
| NOT_GRADED | finalized=false, <60% | "ë¯¸í™•ì •" | ìˆ˜ê°• ì¤‘ (ë¶ˆí•©ê²© ê°€ëŠ¥) |
| DROPPED | ë³„ë„ í”Œë˜ê·¸ | - | ì¤‘ë„í¬ê¸° (ë¯¸êµ¬í˜„) |

---

## ğŸ“Š GPA ê³„ì‚°

### í•™ì  â†’ GPA ë³€í™˜

```java
private double convertToGpa(String letterGrade) {
    if (letterGrade == null) return 0.0;
    
    switch (letterGrade) {
        case "A": return 4.0;
        case "B": return 3.0;
        case "C": return 2.0;
        case "D": return 1.0;
        case "F": return 0.0;
        default: return 0.0;  // "ì§„í–‰ì¤‘", "ë¯¸í™•ì •" ë“±
    }
}
```

### ê°€ì¤‘ í‰ê·  GPA (í•™ì  ë°˜ì˜)

```java
private double calculateWeightedGpa(List<CourseDto> courses) {
    double totalWeighted = 0.0;
    int totalCredits = 0;
    
    for (CourseDto course : courses) {
        // COMPLETED ìƒíƒœë§Œ GPA ê³„ì‚°ì— í¬í•¨
        if ("COMPLETED".equals(course.getStatus())) {
            int credits = course.getCredits() != null ? course.getCredits() : 0;
            double gpa = course.getGpa() != null ? course.getGpa() : 0.0;
            
            totalWeighted += gpa * credits;
            totalCredits += credits;
        }
    }
    
    if (totalCredits == 0) return 0.0;
    
    // ì†Œìˆ˜ì  ë‘˜ì§¸ ìë¦¬ê¹Œì§€ ë°˜ì˜¬ë¦¼
    return Math.round((totalWeighted / totalCredits) * 100.0) / 100.0;
}
```

### ê³„ì‚° ì˜ˆì‹œ

**ê³¼ëª© ëª©ë¡**:
- ìë£Œêµ¬ì¡° (3í•™ì , A, GPA 4.0) - COMPLETED
- ì„ í˜•ëŒ€ìˆ˜í•™ (3í•™ì , F, GPA 0.0) - FAILED
- ì˜ì–´íšŒí™” (2í•™ì , ì§„í–‰ì¤‘, GPA 0.0) - IN_PROGRESS

**GPA ê³„ì‚°**:
```
totalWeighted = (3 Ã— 4.0) = 12.0
totalCredits = 3
cumulativeGpa = 12.0 / 3 = 4.00
```

**âš ï¸ ì£¼ì˜**: F ë“±ê¸‰(FAILED)ê³¼ ì§„í–‰ì¤‘(IN_PROGRESS)ì€ GPA ê³„ì‚°ì—ì„œ ì œì™¸ë¨

---

## ğŸ“… í•™ê¸°ë³„ í†µê³„ ê³„ì‚°

### í•™ê¸° ê·¸ë£¹í•‘

```java
private Map<String, SemesterSummary> calculateSemesterSummaries(List<CourseDto> courses) {
    // 1. í•™ê¸°ë³„ë¡œ ê·¸ë£¹í™” (key: "YYYY-S")
    Map<String, List<CourseDto>> grouped = courses.stream()
        .filter(c -> c.getYear() != null && c.getSemester() != null)
        .collect(Collectors.groupingBy(c -> c.getYear() + "-" + c.getSemester()));
    
    Map<String, SemesterSummary> summaries = new LinkedHashMap<>();
    
    // 2. ê° í•™ê¸°ë³„ í†µê³„ ê³„ì‚°
    for (Map.Entry<String, List<CourseDto>> entry : grouped.entrySet()) {
        String semesterKey = entry.getKey();
        List<CourseDto> semesterCourses = entry.getValue();
        
        // ì·¨ë“ í•™ì  (COMPLETEDë§Œ)
        int earnedCredits = semesterCourses.stream()
            .filter(c -> "COMPLETED".equals(c.getStatus()))
            .mapToInt(c -> c.getCredits() != null ? c.getCredits() : 0)
            .sum();
        
        // ì‹ ì²­ í•™ì  (ì „ì²´)
        int attemptedCredits = semesterCourses.stream()
            .mapToInt(c -> c.getCredits() != null ? c.getCredits() : 0)
            .sum();
        
        // í•™ê¸° GPA
        double semesterGpa = calculateWeightedGpa(semesterCourses);
        
        // í‰ê·  ë°±ë¶„ìœ¨
        double averagePercentage = semesterCourses.stream()
            .mapToDouble(c -> c.getPercentage() != null ? c.getPercentage() : 0.0)
            .average()
            .orElse(0.0);
        
        // í•™ì  ë¶„í¬
        int gradeACount = countByGrade(semesterCourses, "A");
        int gradeBCount = countByGrade(semesterCourses, "B");
        int gradeCCount = countByGrade(semesterCourses, "C");
        int gradeDCount = countByGrade(semesterCourses, "D");
        int gradeFCount = countByGrade(semesterCourses, "F");
        
        summaries.put(semesterKey, SemesterSummary.builder()
            .semesterKey(semesterKey)
            .year(Integer.parseInt(semesterKey.split("-")[0]))
            .semester(Integer.parseInt(semesterKey.split("-")[1]))
            .courseCount(semesterCourses.size())
            .earnedCredits(earnedCredits)
            .attemptedCredits(attemptedCredits)
            .semesterGpa(round(semesterGpa))
            .averagePercentage(round(averagePercentage))
            .gradeACount(gradeACount)
            .gradeBCount(gradeBCount)
            .gradeCCount(gradeCCount)
            .gradeDCount(gradeDCount)
            .gradeFCount(gradeFCount)
            .build());
    }
    
    return summaries;
}
```

### í•™ê¸°ë³„ í†µê³„ ì˜ˆì‹œ

**2025-1í•™ê¸°**:
- ê³¼ëª©: ìë£Œêµ¬ì¡°(A), ì„ í˜•ëŒ€ìˆ˜í•™(F), ì˜ì–´íšŒí™”(ì§„í–‰ì¤‘)
- ì·¨ë“/ì‹ ì²­ í•™ì : 3 / 8 (ì˜ì–´íšŒí™” 2í•™ì  ë¯¸ì·¨ë“)
- í•™ê¸° GPA: 4.00 (ìë£Œêµ¬ì¡°ë§Œ ê³„ì‚°)
- í‰ê·  ë°±ë¶„ìœ¨: 73.21% (3ê³¼ëª© í‰ê· )
- í•™ì  ë¶„í¬: A(1), B(0), C(0), D(0), F(1)

---

## ğŸ“ ì „ì²´ í†µê³„ ê³„ì‚°

### OverallSummary ìƒì„±

```java
private OverallSummary calculateOverallSummary(List<CourseDto> courses) {
    // ì´ ì·¨ë“ í•™ì  (COMPLETEDë§Œ)
    int totalEarnedCredits = courses.stream()
        .filter(c -> "COMPLETED".equals(c.getStatus()))
        .mapToInt(c -> c.getCredits() != null ? c.getCredits() : 0)
        .sum();
    
    // ì´ ì‹ ì²­ í•™ì 
    int totalAttemptedCredits = courses.stream()
        .mapToInt(c -> c.getCredits() != null ? c.getCredits() : 0)
        .sum();
    
    // ëˆ„ì  GPA
    double cumulativeGpa = calculateWeightedGpa(courses);
    
    // í‰ê·  ë°±ë¶„ìœ¨
    double averagePercentage = courses.stream()
        .mapToDouble(c -> c.getPercentage() != null ? c.getPercentage() : 0.0)
        .average()
        .orElse(0.0);
    
    // í•™ì  ì·¨ë“ë¥ 
    double completionRate = totalAttemptedCredits > 0 
        ? (double) totalEarnedCredits / totalAttemptedCredits * 100.0 
        : 0.0;
    
    return OverallSummary.builder()
        .totalCourses(courses.size())
        .totalEarnedCredits(totalEarnedCredits)
        .totalAttemptedCredits(totalAttemptedCredits)
        .cumulativeGpa(round(cumulativeGpa))
        .averagePercentage(round(averagePercentage))
        .completionRate(round(completionRate))
        .totalGradeACount(countByGrade(courses, "A"))
        .totalGradeBCount(countByGrade(courses, "B"))
        .totalGradeCCount(countByGrade(courses, "C"))
        .totalGradeDCount(countByGrade(courses, "D"))
        .totalGradeFCount(countByGrade(courses, "F"))
        .build();
}
```

### ì „ì²´ í†µê³„ ì˜ˆì‹œ

- **ì´ ê³¼ëª©**: 3ê°œ
- **ì·¨ë“/ì‹ ì²­ í•™ì **: 3 / 8 (37.5%)
- **ëˆ„ì  GPA**: 4.00 (ìë£Œêµ¬ì¡°ë§Œ)
- **í‰ê·  ë°±ë¶„ìœ¨**: 73.21%
- **í•™ì  ì·¨ë“ë¥ **: 37.5%
- **í•™ì  ë¶„í¬**: A(1), B(0), C(0), D(0), F(1)

---

## ğŸ”¢ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜

### íŠ¹ì • ë“±ê¸‰ ì¹´ìš´íŠ¸

```java
private int countByGrade(List<CourseDto> courses, String grade) {
    return (int) courses.stream()
        .filter(c -> grade.equals(c.getLetterGrade()))
        .count();
}
```

### ì†Œìˆ˜ì  ë°˜ì˜¬ë¦¼

```java
private double round(double value) {
    return Math.round(value * 100.0) / 100.0;
}
```

### í•™ìƒ ì •ë³´ ìƒì„±

```java
private StudentInfo createStudentInfo(UserTbl student) {
    // í•™ë²ˆì—ì„œ ì…í•™ë…„ë„ ì¶”ì¶œ (ì˜ˆ: 202500106114 â†’ 2025)
    Integer admissionYear = null;
    if (student.getUserCode() != null && student.getUserCode().length() >= 4) {
        try {
            admissionYear = Integer.parseInt(student.getUserCode().substring(0, 4));
        } catch (NumberFormatException e) {
            log.warn("ì…í•™ë…„ë„ íŒŒì‹± ì‹¤íŒ¨: {}", student.getUserCode());
        }
    }
    
    // í˜„ì¬ í•™ë…„ ê³„ì‚°
    Integer currentGrade = null;
    if (admissionYear != null) {
        int currentYear = LocalDateTime.now().getYear();
        currentGrade = currentYear - admissionYear + 1;
        currentGrade = Math.max(1, Math.min(4, currentGrade)); // 1~4í•™ë…„ ì œí•œ
    }
    
    return StudentInfo.builder()
        .studentIdx(student.getUserIdx())
        .studentCode(student.getUserCode())
        .name(student.getUserName())
        .admissionYear(admissionYear)
        .currentGrade(currentGrade)
        .build();
}
```

### ë°œê¸‰ë²ˆí˜¸ ìƒì„±

```java
private String generateCertificateNumber(UserTbl student) {
    String studentCode = student.getUserCode() != null 
        ? student.getUserCode() 
        : String.valueOf(student.getUserIdx());
    
    String timestamp = LocalDateTime.now()
        .format(DateTimeFormatter.ofPattern("yyyyMMddHHmmss"));
    
    return String.format("TR-%s-%s", studentCode, timestamp);
}
```

---

## âš ï¸ ì£¼ì˜ì‚¬í•­

### 1. F ë“±ê¸‰ ì²˜ë¦¬

- **GPA ê³„ì‚° ì œì™¸**: F ë“±ê¸‰ì€ `FAILED` ìƒíƒœì´ë¯€ë¡œ GPA ê³„ì‚°ì—ì„œ ì œì™¸
- **í•™ì  ë¯¸ì·¨ë“**: ì·¨ë“ í•™ì (earnedCredits)ì— í¬í•¨ ì•ˆ ë¨
- **ì‹ ì²­ í•™ì  í¬í•¨**: ì‹ ì²­ í•™ì (attemptedCredits)ì—ëŠ” í¬í•¨

### 2. ì§„í–‰ì¤‘ ê³¼ëª© ì²˜ë¦¬

- **GPA ê³„ì‚° ì œì™¸**: `IN_PROGRESS`ì™€ `NOT_GRADED`ëŠ” GPA ê³„ì‚° ì œì™¸
- **í•™ì  ë¯¸ì·¨ë“**: ì•„ì§ ì„±ì  ë¯¸í™•ì •ì´ë¯€ë¡œ ì·¨ë“ í•™ì  ì œì™¸
- **í†µê³„ í¬í•¨**: ê³¼ëª© ìˆ˜, í‰ê·  ë°±ë¶„ìœ¨ì—ëŠ” í¬í•¨

### 3. Null ì•ˆì „

```java
// Null ì²´í¬ ì˜ˆì‹œ
int credits = course.getCredits() != null ? course.getCredits() : 0;
double gpa = course.getGpa() != null ? course.getGpa() : 0.0;
String grade = course.getLetterGrade() != null ? course.getLetterGrade() : "N/A";
```

### 4. ì†Œìˆ˜ì  ì²˜ë¦¬

- ëª¨ë“  ë°±ë¶„ìœ¨, GPAëŠ” **ì†Œìˆ˜ì  ë‘˜ì§¸ ìë¦¬ê¹Œì§€ ë°˜ì˜¬ë¦¼**
- `Math.round(value * 100.0) / 100.0` ì‚¬ìš©

### 5. ì •ë ¬ ìˆœì„œ

- ê³¼ëª© ëª©ë¡: **ë…„ë„ â†’ í•™ê¸°** ìˆœìœ¼ë¡œ ì •ë ¬
- í•™ê¸°ë³„ ìš”ì•½: LinkedHashMapìœ¼ë¡œ ìˆœì„œ ìœ ì§€

# ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ

ì„±ì í™•ì¸ì„œ APIì—ì„œ ì‚¬ìš©í•˜ëŠ” ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì¡° ë° JSON í˜•ì‹

---

## ğŸ“Š í…Œì´ë¸” êµ¬ì¡°

### USER_TBL (ì‚¬ìš©ì)

| ì»¬ëŸ¼ | íƒ€ì… | ì„¤ëª… |
|------|------|------|
| USER_IDX | Integer | í•™ìƒ ê³ ìœ  ID (PK) |
| USER_CODE | String | í•™ë²ˆ |
| USER_NAME | String | ì´ë¦„ |
| USER_EMAIL | String | ì´ë©”ì¼ |
| USER_STUDENT | Integer | ê¶Œí•œ (0=í•™ìƒ, 1=êµìˆ˜, 2=ê´€ë¦¬ì) |

### LEC_TBL (ê°•ì˜)

| ì»¬ëŸ¼ | íƒ€ì… | ì„¤ëª… |
|------|------|------|
| LEC_IDX | Integer | ê°•ì˜ ê³ ìœ  ID (PK) |
| LEC_SERIAL | String | ê°•ì˜ ì½”ë“œ |
| LEC_TIT | String | ê°•ì˜ëª… |
| LEC_POINT | Integer | ì´ìˆ˜í•™ì  |
| LEC_YEAR | Integer | ê°œì„¤ ë…„ë„ |
| LEC_SEMESTER | Integer | í•™ê¸° (1=1í•™ê¸°, 2=2í•™ê¸°) |
| LEC_PROF | String | êµìˆ˜ IDX |

### ENROLLMENT_EXTENDED_TBL (ìˆ˜ê°• ì‹ ì²­)

| ì»¬ëŸ¼ | íƒ€ì… | ì„¤ëª… |
|------|------|------|
| ENROLLMENT_IDX | Integer | ìˆ˜ê°• ì‹ ì²­ ê³ ìœ  ID (PK) |
| LEC_IDX | Integer | ê°•ì˜ IDX (FK) |
| STUDENT_IDX | Integer | í•™ìƒ IDX (FK) |
| ENROLLMENT_DATA | TEXT | JSON ì„±ì  ë°ì´í„° |

---

## ğŸ“„ ENROLLMENT_DATA JSON êµ¬ì¡°

### ì „ì²´ êµ¬ì¡°

```json
{
  "gradeConfig": {
    "totalMaxScore": 294,
    "attendanceMaxScore": 67,
    "assignmentTotalScore": 227,
    "latePenaltyPerSession": 0.4,
    "gradeDistribution": {
      "A": 30,
      "B": 40,
      "C": 20,
      "D": 10
    }
  },
  "grade": {
    "letterGrade": "A",
    "finalized": true,
    "finalizedDate": "2025-10-29 15:30:00",
    "rank": 3,
    "totalStudents": 25,
    "passingStudents": 22,
    "total": {
      "score": 281.76,
      "maxScore": 294.0,
      "percentage": 95.84
    },
    "attendanceScore": {
      "currentScore": 65.76,
      "maxScore": 67.0,
      "percentage": 98.15,
      "presentCount": 78,
      "lateCount": 1,
      "absentCount": 1,
      "attendanceRate": 79
    },
    "assignments": [
      {
        "name": "ê³¼ì œ1",
        "score": 45.0,
        "maxScore": 50.0,
        "percentage": 90.0,
        "submitted": true,
        "submittedDate": "2025-10-15 14:30:00"
      },
      {
        "name": "ê³¼ì œ2",
        "score": 48.0,
        "maxScore": 50.0,
        "percentage": 96.0,
        "submitted": true,
        "submittedDate": "2025-10-22 10:15:00"
      }
    ]
  }
}
```

---

## ğŸ”‘ ì£¼ìš” í•„ë“œ ì„¤ëª…

### gradeConfig (ì„±ì  ì„¤ì •)

| í•„ë“œ | íƒ€ì… | ì„¤ëª… |
|------|------|------|
| totalMaxScore | Double | ì´ì  ë§Œì  |
| attendanceMaxScore | Double | ì¶œì„ ë§Œì  |
| assignmentTotalScore | Double | ê³¼ì œ ì´ì  |
| latePenaltyPerSession | Double | ì§€ê° ê°ì  |
| gradeDistribution | Object | ì„±ì  ë¶„í¬ (A: 30%, B: 40%, C: 20%, D: 10%) |

### grade (ì„±ì  ì •ë³´)

| í•„ë“œ | íƒ€ì… | ì„¤ëª… |
|------|------|------|
| letterGrade | String | ìµœì¢… í•™ì  (A/B/C/D/F) |
| finalized | Boolean | ì„±ì  í™•ì • ì—¬ë¶€ â­ |
| finalizedDate | String | ì„±ì  í™•ì • ì¼ì‹œ |
| rank | Integer | ì„ì°¨ |
| totalStudents | Integer | ì „ì²´ í•™ìƒ ìˆ˜ |
| passingStudents | Integer | í•©ê²© í•™ìƒ ìˆ˜ (60% ì´ìƒ) |

### grade.total (ì´ì  ì •ë³´)

| í•„ë“œ | íƒ€ì… | ì„¤ëª… |
|------|------|------|
| score | Double | íšë“ ì ìˆ˜ |
| maxScore | Double | ë§Œì  |
| percentage | Double | ë°±ë¶„ìœ¨ |

### grade.attendanceScore (ì¶œì„ ì •ë³´)

| í•„ë“œ | íƒ€ì… | ì„¤ëª… |
|------|------|------|
| currentScore | Double | ì¶œì„ ì ìˆ˜ |
| maxScore | Double | ì¶œì„ ë§Œì  |
| percentage | Double | ì¶œì„ ë°±ë¶„ìœ¨ |
| presentCount | Integer | ì¶œì„ íšŸìˆ˜ |
| lateCount | Integer | ì§€ê° íšŸìˆ˜ |
| absentCount | Integer | ê²°ì„ íšŸìˆ˜ |
| attendanceRate | Integer | ì¶œì„ë¥  (%) |

### grade.assignments[] (ê³¼ì œ ëª©ë¡)

| í•„ë“œ | íƒ€ì… | ì„¤ëª… |
|------|------|------|
| name | String | ê³¼ì œëª… |
| score | Double | íšë“ ì ìˆ˜ |
| maxScore | Double | ë§Œì  |
| percentage | Double | ë°±ë¶„ìœ¨ |
| submitted | Boolean | ì œì¶œ ì—¬ë¶€ |
| submittedDate | String | ì œì¶œ ì¼ì‹œ |

---

## âš ï¸ ì¤‘ìš” ì‚¬í•­

### finalized í”Œë˜ê·¸

**ì„±ì  í™•ì • ì—¬ë¶€ë¥¼ íŒë‹¨í•˜ëŠ” ê°€ì¥ ì¤‘ìš”í•œ í•„ë“œ**

- `true`: ì„±ì ì´ ìµœì¢… í™•ì •ë¨
  - `letterGrade`, `rank`, `totalStudents` ê°’ ì‹ ë¢° ê°€ëŠ¥
  - ìƒíƒœ: COMPLETED (A~D) ë˜ëŠ” FAILED (F)

- `false`: ì„±ì  ë¯¸í™•ì • (ì§„í–‰ì¤‘)
  - `letterGrade` ê°’ ë¬´ì‹œ
  - `percentage`ë¡œ ì„ì‹œ ìƒíƒœ íŒë‹¨
  - ìƒíƒœ: IN_PROGRESS ë˜ëŠ” NOT_GRADED

### ì„±ì  ê³„ì‚° ìˆœì„œ

1. **ENROLLMENT_DATA.grade.finalized** í™•ì¸
2. **finalized = true** â†’ `letterGrade` ì‚¬ìš©
3. **finalized = false** â†’ `percentage`ë¡œ ì„ì‹œ íŒë‹¨
4. **letterGrade â†’ GPA ë³€í™˜** (A=4.0, B=3.0, C=2.0, D=1.0, F=0.0)

### Null ì²˜ë¦¬

JSON íŒŒì‹± ì‹œ ë‹¤ìŒ í•„ë“œë“¤ì€ nullì¼ ìˆ˜ ìˆìŒ:

- `letterGrade` (finalized=falseì¼ ë•Œ)
- `rank` (finalized=falseì¼ ë•Œ)
- `totalStudents` (finalized=falseì¼ ë•Œ)
- `finalizedDate` (finalized=falseì¼ ë•Œ)
- `assignments[]` (ê³¼ì œ ì—†ëŠ” ê²½ìš° ë¹ˆ ë°°ì—´)

---

## ğŸ“ ë°ì´í„° ì¡°íšŒ ì˜ˆì‹œ

### SQL ì¿¼ë¦¬

```sql
-- í•™ìƒì˜ ì „ì²´ ìˆ˜ê°• ì´ë ¥ ì¡°íšŒ
SELECT 
    e.ENROLLMENT_IDX,
    e.STUDENT_IDX,
    e.LEC_IDX,
    e.ENROLLMENT_DATA,
    l.LEC_SERIAL,
    l.LEC_TIT,
    l.LEC_POINT,
    l.LEC_YEAR,
    l.LEC_SEMESTER,
    l.LEC_PROF,
    u.USER_CODE,
    u.USER_NAME
FROM 
    ENROLLMENT_EXTENDED_TBL e
    JOIN LEC_TBL l ON e.LEC_IDX = l.LEC_IDX
    JOIN USER_TBL u ON e.STUDENT_IDX = u.USER_IDX
WHERE 
    e.STUDENT_IDX = ?
ORDER BY 
    l.LEC_YEAR ASC, 
    l.LEC_SEMESTER ASC;
```

### JSON íŒŒì‹± (Java)

```java
ObjectMapper mapper = new ObjectMapper();
JsonNode root = mapper.readTree(enrollmentData);

// finalized í™•ì¸
boolean finalized = root.path("grade").path("finalized").asBoolean(false);

// ì„±ì  ì •ë³´ ì¶”ì¶œ
if (finalized) {
    String letterGrade = root.path("grade").path("letterGrade").asText();
    int rank = root.path("grade").path("rank").asInt();
    int totalStudents = root.path("grade").path("totalStudents").asInt();
}

// ì´ì  ì •ë³´
double totalScore = root.path("grade").path("total").path("score").asDouble();
double percentage = root.path("grade").path("total").path("percentage").asDouble();

// ì¶œì„ ì •ë³´
double attendanceScore = root.path("grade").path("attendanceScore").path("currentScore").asDouble();
int attendanceRate = root.path("grade").path("attendanceScore").path("attendanceRate").asInt();

// ê³¼ì œ ì§‘ê³„
double assignmentScore = 0.0;
JsonNode assignments = root.path("grade").path("assignments");
for (JsonNode assignment : assignments) {
    assignmentScore += assignment.path("score").asDouble();
}
```

<mxfile host="app.diagrams.net" agent="Mozilla/5.0" version="28.2.8">
  <diagram name="출석 관리 시퀀스" id="attendance-sequence">
    <mxGraphModel dx="1920" dy="1080" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1920" pageHeight="1080" background="#FFFFFF" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <!-- 제목 -->
        <mxCell id="title" value="출석 관리 - 서버 시퀀스" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=32;fontStyle=1;fontColor=#1A1A1A;" parent="1" vertex="1">
          <mxGeometry x="640" y="40" width="640" height="60" as="geometry" />
        </mxCell>

        <!-- 배경 영역 -->
        <mxCell id="swimlaneStudent" value="학생 클라이언트" style="swimlane;swimlaneFillColor=#FFF3E0;fontStyle=1;fontSize=20;fontColor=#E65100;horizontal=0;rounded=1;strokeColor=#FB8C00;strokeWidth=3;" parent="1" vertex="1">
          <mxGeometry x="120" y="140" width="320" height="800" as="geometry" />
        </mxCell>
        <mxCell id="swimlaneApi" value="AttendanceController" style="swimlane;swimlaneFillColor=#E3F2FD;fontStyle=1;fontSize=20;fontColor=#1E88E5;horizontal=0;rounded=1;strokeColor=#1E88E5;strokeWidth=3;" parent="1" vertex="1">
          <mxGeometry x="520" y="140" width="320" height="800" as="geometry" />
        </mxCell>
        <mxCell id="swimlaneService" value="AttendanceService" style="swimlane;swimlaneFillColor=#E8F5E9;fontStyle=1;fontSize=20;fontColor=#2E7D32;horizontal=0;rounded=1;strokeColor=#2E7D32;strokeWidth=3;" parent="1" vertex="1">
          <mxGeometry x="920" y="140" width="320" height="800" as="geometry" />
        </mxCell>
        <mxCell id="swimlaneRepository" value="AttendanceRepository" style="swimlane;swimlaneFillColor=#F3E5F5;fontStyle=1;fontSize=20;fontColor=#8E24AA;horizontal=0;rounded=1;strokeColor=#8E24AA;strokeWidth=3;" parent="1" vertex="1">
          <mxGeometry x="1320" y="140" width="320" height="800" as="geometry" />
        </mxCell>
        <mxCell id="swimlaneJson" value="ENROLLMENT_DATA JSON" style="swimlane;swimlaneFillColor=#ECEFF1;fontStyle=1;fontSize=20;fontColor=#455A64;horizontal=0;rounded=1;strokeColor=#455A64;strokeWidth=3;" parent="1" vertex="1">
          <mxGeometry x="1720" y="140" width="320" height="800" as="geometry" />
        </mxCell>

        <!-- 수직 생명선 -->
        <mxCell id="lifeStudent" value="" style="shape=line;strokeColor=#FB8C00;strokeWidth=5;verticalLabelPosition=bottom;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="280" y="200" width="0" height="680" as="geometry" />
        </mxCell>
        <mxCell id="lifeApi" value="" style="shape=line;strokeColor=#1E88E5;strokeWidth=5;verticalLabelPosition=bottom;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="680" y="200" width="0" height="680" as="geometry" />
        </mxCell>
        <mxCell id="lifeService" value="" style="shape=line;strokeColor=#2E7D32;strokeWidth=5;verticalLabelPosition=bottom;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="1080" y="200" width="0" height="680" as="geometry" />
        </mxCell>
        <mxCell id="lifeRepository" value="" style="shape=line;strokeColor=#8E24AA;strokeWidth=5;verticalLabelPosition=bottom;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="1480" y="200" width="0" height="680" as="geometry" />
        </mxCell>
        <mxCell id="lifeJson" value="" style="shape=line;strokeColor=#455A64;strokeWidth=5;verticalLabelPosition=bottom;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="1880" y="200" width="0" height="680" as="geometry" />
        </mxCell>

        <!-- Step 1 -->
        <mxCell id="step1" value="1. PUT /attendance/request\n   (sessionNo, status, reason)" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#FB8C00;strokeWidth=3;fillColor=#FFF3E0;fontSize=18;fontColor=#E65100;" parent="1" vertex="1">
          <mxGeometry x="190" y="240" width="220" height="110" as="geometry" />
        </mxCell>
        <mxCell id="edge1" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeWidth=3;strokeColor=#FB8C00;endArrow=block;endFill=1;" parent="1" source="step1" target="lifeApi" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="410" y="295" as="exitPoint" />
            <mxPoint x="680" y="295" as="entryPoint" />
          </mxGeometry>
        </mxCell>

        <!-- Step 2 -->
        <mxCell id="step2" value="2. validateRequest()
- ENROLLMENT 존재 여부 확인
- sessionNo 범위 체크" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#1E88E5;strokeWidth=3;fillColor=#E3F2FD;fontSize=18;fontColor=#1565C0;" parent="1" vertex="1">
          <mxGeometry x="560" y="330" width="240" height="140" as="geometry" />
        </mxCell>
        <mxCell id="edge2" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeWidth=3;strokeColor=#1E88E5;endArrow=block;endFill=1;" parent="1" source="step2" target="lifeService" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="800" y="400" as="exitPoint" />
            <mxPoint x="1080" y="400" as="entryPoint" />
          </mxGeometry>
        </mxCell>

        <!-- Step 3 -->
        <mxCell id="step3" value="3. AttendanceRepository.save()
- 기존 요청 조회
- 상태/사유 업데이트" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#2E7D32;strokeWidth=3;fillColor=#E8F5E9;fontSize=18;fontColor=#2E7D32;" parent="1" vertex="1">
          <mxGeometry x="960" y="440" width="240" height="140" as="geometry" />
        </mxCell>
        <mxCell id="edge3" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeWidth=3;strokeColor=#2E7D32;endArrow=block;endFill=1;" parent="1" source="step3" target="lifeRepository" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1200" y="510" as="exitPoint" />
            <mxPoint x="1480" y="510" as="entryPoint" />
          </mxGeometry>
        </mxCell>

        <!-- Step 4 -->
        <mxCell id="step4" value="4. 승인/거부 결과 반영
ENROLLMENT_DATA.attendance.sessions 갱신" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#8E24AA;strokeWidth=3;fillColor=#F3E5F5;fontSize=18;fontColor=#6A1B9A;" parent="1" vertex="1">
          <mxGeometry x="1360" y="580" width="240" height="140" as="geometry" />
        </mxCell>
        <mxCell id="edge4" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeWidth=3;strokeColor=#8E24AA;endArrow=block;endFill=1;" parent="1" source="step4" target="lifeJson" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1600" y="650" as="exitPoint" />
            <mxPoint x="1880" y="650" as="entryPoint" />
          </mxGeometry>
        </mxCell>

        <!-- Step 5 -->
        <mxCell id="step5" value="5. GradeUpdateEvent 발행
(출석 비중 반영)" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#455A64;strokeWidth=3;fillColor=#ECEFF1;fontSize=18;fontColor=#37474F;" parent="1" vertex="1">
          <mxGeometry x="1360" y="740" width="240" height="120" as="geometry" />
        </mxCell>
        <mxCell id="edge5" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeWidth=3;strokeColor=#455A64;endArrow=block;endFill=1;" parent="1" source="lifeService" target="step5" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1080" y="780" as="exitPoint" />
            <mxPoint x="1360" y="780" as="entryPoint" />
          </mxGeometry>
        </mxCell>

        <!-- Step 6 -->
        <mxCell id="step6" value="6. ENROLLMENT_DATA.grade.totalScore 재계산" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#006064;strokeWidth=3;fillColor=#E0F7FA;fontSize=18;fontColor=#004D40;" parent="1" vertex="1">
          <mxGeometry x="1740" y="780" width="240" height="120" as="geometry" />
        </mxCell>

        <!-- 응답 -->
        <mxCell id="stepResponse" value="7. API Response
{ status: \"승인\", updatedSessions: [...] }" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#1E88E5;strokeWidth=3;fillColor=#FFFFFF;fontSize=18;fontColor=#1E88E5;" parent="1" vertex="1">
          <mxGeometry x="560" y="860" width="240" height="120" as="geometry" />
        </mxCell>
        <mxCell id="edgeResponse" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeWidth=3;strokeColor=#1E88E5;endArrow=block;endFill=1;" parent="1" source="stepResponse" target="lifeStudent" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="560" y="920" as="exitPoint" />
            <mxPoint x="280" y="920" as="entryPoint" />
          </mxGeometry>
        </mxCell>

        <!-- Legend -->
        <mxCell id="legend" value="Legend\n주황: 클라이언트 요청\n파랑: Controller 검증\n초록: Service 트랜잭션\n보라: Repository 저장\n회색: JSON/이벤트 반영" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#9E9E9E;strokeWidth=2;fillColor=#FAFAFA;fontSize=18;fontColor=#424242;" parent="1" vertex="1">
          <mxGeometry x="120" y="980" width="520" height="120" as="geometry" />
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>

# 출석 API 응답 구조 변경사항

**날짜**: 2025-10-28  
**변경 이유**: 프론트엔드 호환성 개선 (출석 횟수 표시 오류 수정)

---

## 📋 변경 요약

출석 조회 API 응답에 **프론트엔드 호환 필드 2개 추가**:
- `attendanceRate`: 출석 횟수를 "n/80" 형식의 문자열로 제공
- `attendanceStr`: 출석 상태를 나열한 문자열 (예: "출지결출...")

---

## 🔧 영향받는 API

### 1. 학생 출석 조회
**Endpoint**: `POST /api/attendance/student/view`

**Request**:
```json
{
  "lecSerial": "ETH201"
}
```

**Response** (변경 전):
```json
{
  "success": true,
  "message": "출석 조회 성공",
  "data": {
    "summary": {
      "attended": 1,
      "late": 0,
      "absent": 0,
      "totalSessions": 80,
      "attendanceRate": 1.25,
      "updatedAt": "2025-10-28 10:30:00"
    },
    "sessions": [
      {
        "sessionNumber": 1,
        "status": "출",
        "requestDate": "2025-10-20 14:00:00",
        "approvedDate": "2025-10-20 15:30:00",
        "approvedBy": 1001,
        "tempApproved": false
      }
    ],
    "pendingRequests": []
  }
}
```

**Response** (변경 후) ✨:
```json
{
  "success": true,
  "message": "출석 조회 성공",
  "data": {
    "summary": {
      "attended": 1,
      "late": 0,
      "absent": 0,
      "totalSessions": 80,
      "attendanceRate": 1.25,
      "updatedAt": "2025-10-28 10:30:00"
    },
    "sessions": [
      {
        "sessionNumber": 1,
        "status": "출",
        "requestDate": "2025-10-20 14:00:00",
        "approvedDate": "2025-10-20 15:30:00",
        "approvedBy": 1001,
        "tempApproved": false
      }
    ],
    "pendingRequests": [],
    "attendanceRate": "1/80",    // ✨ 신규 필드
    "attendanceStr": "출"         // ✨ 신규 필드
  }
}
```

---

### 2. 교수 출석 조회 (전체 학생)
**Endpoint**: `POST /api/attendance/professor/view`

**Request**:
```json
{
  "lecSerial": "ETH201"
}
```

**Response** (변경 전):
```json
{
  "success": true,
  "message": "출석 현황 조회 성공",
  "data": [
    {
      "studentIdx": 2001,
      "studentCode": "S2024001",
      "studentName": "홍길동",
      "attendanceData": {
        "summary": {
          "attended": 3,
          "late": 1,
          "absent": 0,
          "totalSessions": 80,
          "attendanceRate": 3.9
        },
        "sessions": [
          { "sessionNumber": 1, "status": "출" },
          { "sessionNumber": 2, "status": "출" },
          { "sessionNumber": 3, "status": "지" },
          { "sessionNumber": 4, "status": "출" }
        ],
        "pendingRequests": []
      }
    }
  ]
}
```

**Response** (변경 후) ✨:
```json
{
  "success": true,
  "message": "출석 현황 조회 성공",
  "data": [
    {
      "studentIdx": 2001,
      "studentCode": "S2024001",
      "studentName": "홍길동",
      "attendanceData": {
        "summary": {
          "attended": 3,
          "late": 1,
          "absent": 0,
          "totalSessions": 80,
          "attendanceRate": 3.9
        },
        "sessions": [
          { "sessionNumber": 1, "status": "출" },
          { "sessionNumber": 2, "status": "출" },
          { "sessionNumber": 3, "status": "지" },
          { "sessionNumber": 4, "status": "출" }
        ],
        "pendingRequests": [],
        "attendanceRate": "3/80",    // ✨ 신규 필드
        "attendanceStr": "출출지출"   // ✨ 신규 필드
      }
    }
  ]
}
```

---

## 📊 신규 필드 상세 설명

### 1. `attendanceRate` (String)
**타입**: `String`  
**형식**: `"출석횟수/총회차"`  
**예시**:
- 출석 안 함: `"0/80"`
- 1회 출석: `"1/80"`
- 15회 출석: `"15/80"`

**계산 로직**:
```javascript
attendanceRate = summary.attended + "/" + summary.totalSessions
```

**용도**: 
- UI에서 "n/80" 형태로 바로 표시 가능
- 기존 `summary.attended`, `summary.totalSessions` 사용 불필요

---

### 2. `attendanceStr` (String)
**타입**: `String`  
**형식**: 회차 순서대로 출석 상태를 나열한 문자열  
**예시**:
- 출석 없음: `""` (빈 문자열)
- 1회차만 출석: `"출"`
- 4회차 출석 (출/출/지/결): `"출출지결"`
- 10회차 출석: `"출출지출결출출지출출"`

**계산 로직**:
```javascript
// sessions 배열을 회차(sessionNumber) 순으로 정렬 후
// 각 status의 첫 글자만 추출하여 연결
attendanceStr = sessions
  .sort((a, b) => a.sessionNumber - b.sessionNumber)
  .map(s => s.status.charAt(0))
  .join('')
```

**용도**:
- 출석 패턴 시각화 (예: 그리드 뷰)
- 출석 상태 한눈에 파악

---

## 🔄 기존 필드 유지

### `summary` 객체 (변경 없음)
```json
{
  "attended": 1,           // 출석 횟수 (숫자)
  "late": 0,               // 지각 횟수
  "absent": 0,             // 결석 횟수
  "totalSessions": 80,     // 총 회차 (고정값 80)
  "attendanceRate": 1.25,  // 출석률 퍼센트 (소수점)
  "updatedAt": "2025-10-28 10:30:00"
}
```

**주의**: 
- `summary.attendanceRate`는 **퍼센트 값** (Double): `1.25` = 1.25%
- 신규 `attendanceRate`는 **문자열**: `"1/80"`
- 두 필드는 **이름은 같지만 타입과 의미가 다름**

---

## 🎯 프론트엔드 수정 가이드

### 변경 전 (기존 코드)
```javascript
// summary에서 직접 계산
const attendanceCount = data.summary.attended;
const totalSessions = data.summary.totalSessions;
const displayText = `${attendanceCount}/${totalSessions}`;  // "1/80"
```

### 변경 후 (권장 코드) ✅
```javascript
// 신규 필드 직접 사용
const displayText = data.attendanceRate;  // "1/80" (바로 사용 가능)
```

### 출석 상태 문자열 활용 예시
```javascript
// 출석 패턴 표시
const attendancePattern = data.attendanceStr;  // "출출지결출"

// 문자열을 배열로 변환하여 렌더링
const statusArray = attendancePattern.split('');
statusArray.forEach((status, index) => {
  console.log(`${index + 1}회차: ${status}`);
  // 1회차: 출
  // 2회차: 출
  // 3회차: 지
  // 4회차: 결
  // 5회차: 출
});
```

---

## 🧪 테스트 시나리오

### 1. 출석 없는 경우
```json
{
  "summary": { "attended": 0, "totalSessions": 80 },
  "sessions": [],
  "attendanceRate": "0/80",
  "attendanceStr": ""
}
```

### 2. 일부 출석한 경우
```json
{
  "summary": { "attended": 5, "late": 2, "totalSessions": 80 },
  "sessions": [
    { "sessionNumber": 1, "status": "출" },
    { "sessionNumber": 2, "status": "지" },
    { "sessionNumber": 3, "status": "출" },
    { "sessionNumber": 5, "status": "출" },
    { "sessionNumber": 7, "status": "출" },
    { "sessionNumber": 8, "status": "지" },
    { "sessionNumber": 10, "status": "출" }
  ],
  "attendanceRate": "5/80",
  "attendanceStr": "출지출출지출"
}
```

### 3. 대기 중인 요청이 있는 경우
```json
{
  "summary": { "attended": 1, "totalSessions": 80 },
  "sessions": [
    { "sessionNumber": 1, "status": "출" }
  ],
  "pendingRequests": [
    {
      "sessionNumber": 2,
      "requestDate": "2025-10-28 09:00:00",
      "status": "PENDING"
    }
  ],
  "attendanceRate": "1/80",
  "attendanceStr": "출"
}
```

**주의**: `pendingRequests`는 `attendanceStr`에 포함되지 않음 (승인된 출석만 포함)

---

## 🚨 하위 호환성

### Breaking Change 없음 ✅
- 기존 필드 모두 유지
- 신규 필드만 추가
- 기존 프론트엔드 코드 그대로 작동

### 권장 마이그레이션
```javascript
// 기존 코드 (계속 작동함)
const count = data.summary.attended;  // ✅ OK

// 신규 코드 (더 간단함)
const rateText = data.attendanceRate;  // ✅ 권장
```

---

## 📝 요청사항 체크리스트

프론트엔드 개발자분들께:

- [ ] `attendanceRate` 필드를 사용하여 "n/80" 표시 구현
- [ ] `attendanceStr` 필드 활용 여부 검토 (선택사항)
- [ ] 기존 `summary.attended` 기반 코드가 있다면 `attendanceRate`로 교체 고려
- [ ] 콘솔 로그에서 `"0/80"` 대신 `"1/80"` 등 정상 출력 확인
- [ ] 교수 출석 조회 화면에서도 동일하게 적용 확인

---

## 🔗 관련 API 문서

- **학생 출석 조회**: `POST /api/attendance/student/view`
- **출석 인정 요청**: `POST /api/attendance/request`
- **교수 출석 조회**: `POST /api/attendance/professor/view`
- **출석 승인/입력**: `POST /api/attendance/approve`

---

## 📞 문의사항

백엔드 변경사항 관련 문의는 백엔드팀으로 연락 주세요.

**배포 예정일**: 2025-10-28 (오늘)  
**테스트 서버**: https://bluecrab.chickenkiller.com/BlueCrab-1.0.0

---

## 🎉 기대 효과

1. ✅ **출석 횟수 정상 표시**: "0/80" → "1/80" 등 실제 출석 반영
2. ✅ **코드 간소화**: 직접 제공되는 문자열 사용으로 프론트 계산 로직 불필요
3. ✅ **데이터 일관성**: 백엔드에서 계산하여 전달하므로 프론트/백 불일치 방지
4. ✅ **확장성**: `attendanceStr`로 다양한 시각화 가능



---

# 📘 출석 API 요청 명세서 (프론트엔드용) - 수정판

## 🔐 공통 사항

### **인증 헤더**
```javascript
headers: {
  'Content-Type': 'application/json',
  'Authorization': 'Bearer {JWT_ACCESS_TOKEN}'
}
```

---

## 1️⃣ 학생: 내 출석 현황 조회

### **Endpoint**
```
POST /api/attendance/student/view
```

### **요청 예시**
```javascript
{
  "lecSerial": "ETH201"
}
```

### **응답 예시**
```javascript
{
  "success": true,
  "message": "출석 현황 조회 성공",
  "data": {
    "summary": {
      "attended": 1,           // 출석 횟수
      "late": 1,              // 지각 횟수
      "absent": 0,            // 결석 횟수
      "totalSessions": 80,    // 전체 강의 회차 (고정)
      "attendanceRate": 2.0,  // 출석률 (%) - 지각 패널티 반영
      "updatedAt": "2025-10-28T15:30:00"
    },
    "sessions": [
      {
        "sessionNumber": 1,
        "status": "출",
        "requestDate": "2025-10-28T14:58:16",
        "approvedDate": "2025-10-28T15:15:26",
        "approvedBy": 25,
        "tempApproved": false
      },
      {
        "sessionNumber": 2,
        "status": "지",
        "requestDate": null,
        "approvedDate": "2025-10-28T15:20:00",
        "approvedBy": 25,
        "tempApproved": false
      }
    ],
    "pendingRequests": [
      {
        "sessionNumber": 3,
        "requestDate": "2025-10-28T15:07:15",
        "requestReason": "교통체증으로 지각",
        "expiresAt": "2025-11-04T00:00:00",
        "tempApproved": true
      }
    ]
  }
}
```

---

## 2️⃣ 학생: 출석 인정 요청

### **Endpoint**
```
POST /api/attendance/request
```

### **요청 예시**
```javascript
{
  "lecSerial": "ETH201",
  "sessionNumber": 5,
  "requestReason": "교통체증으로 지각"
}
```

### **필드 설명**
| 필드 | 타입 | 필수 | 설명 |
|------|------|------|------|
| lecSerial | String | ✅ | 강의 코드 (예: ETH201) |
| sessionNumber | Integer | ✅ | 회차 번호 (1~80) |
| requestReason | String | ⚠️ | 요청 사유 (선택, 200자 이내) |

### **응답 예시**
```javascript
{
  "success": true,
  "message": "출석 인정 요청이 제출되었습니다.",
  "data": {
    "summary": {
      "attended": 1,
      "late": 1,
      "absent": 0,
      "totalSessions": 80,
      "attendanceRate": 2.0,
      "updatedAt": "2025-10-28T15:30:00"
    },
    "sessions": [ /* ... */ ],
    "pendingRequests": [
      {
        "sessionNumber": 5,
        "requestDate": "2025-10-28T15:30:00",
        "requestReason": "교통체증으로 지각",
        "expiresAt": "2025-11-04T00:00:00",
        "tempApproved": true
      }
    ]
  }
}
```

---

## 3️⃣ 교수: 전체 학생 출석 현황 조회

### **Endpoint**
```
POST /api/attendance/professor/view
```

### **요청 예시**
```javascript
{
  "lecSerial": "ETH201"
}
```

### **응답 예시**
```javascript
{
  "success": true,
  "message": "출석 현황 조회 성공",
  "data": [
    {
      "studentIdx": 6,
      "studentName": "테스터",
      "studentCode": "0",
      "attendanceData": {
        "summary": {
          "attended": 1,
          "late": 1,
          "absent": 0,
          "totalSessions": 80,
          "attendanceRate": 2.0,
          "updatedAt": "2025-10-28T15:30:00"
        },
        "sessions": [ /* ... */ ],
        "pendingRequests": [ /* ... */ ]
      }
    },
    {
      "studentIdx": 33,
      "studentName": "김민준",
      "studentCode": "202500106114",
      "attendanceData": {
        "summary": {
          "attended": 0,
          "late": 0,
          "absent": 0,
          "totalSessions": 80,
          "attendanceRate": 0.0,
          "updatedAt": "2025-10-28T15:30:00"
        },
        "sessions": [],
        "pendingRequests": []
      }
    }
    // ... 25명 전체
  ]
}
```

---

## 4️⃣ 교수: 출석 승인/입력

### **Endpoint**
```
POST /api/attendance/approve
```

### **요청 예시 (단일 학생)**
```javascript
{
  "lecSerial": "ETH201",
  "sessionNumber": 5,
  "attendanceRecords": [
    {
      "studentIdx": 6,
      "status": "출"
    }
  ]
}
```

### **요청 예시 (여러 학생 동시 처리)**
```javascript
{
  "lecSerial": "ETH201",
  "sessionNumber": 5,
  "attendanceRecords": [
    {
      "studentIdx": 6,
      "status": "출"
    },
    {
      "studentIdx": 33,
      "status": "지"
    },
    {
      "studentIdx": 34,
      "status": "결"
    }
  ]
}
```

### **필드 설명**
| 필드 | 타입 | 필수 | 설명 |
|------|------|------|------|
| lecSerial | String | ✅ | 강의 코드 |
| sessionNumber | Integer | ✅ | 회차 번호 (1~80) |
| attendanceRecords | Array | ✅ | 출석 기록 배열 (1개 이상) |
| attendanceRecords[].studentIdx | Integer | ✅ | 학생 USER_IDX |
| attendanceRecords[].status | String | ✅ | 출석 상태: **"출"** / **"지"** / **"결"** |

### **출석 상태 값**
- `"출"` - 출석 (1.0회 출석)
- `"지"` - 지각 (0.6회 출석, 0.4 패널티 적용)
- `"결"` - 결석 (0.0회 출석)

### **응답 예시**
```javascript
{
  "success": true,
  "message": "출석 승인이 완료되었습니다. (3/3)",
  "data": null
}
```

---

## 📊 출석률 계산 로직

### **공식**
```javascript
// 1. 실제 출석 횟수 계산 (지각 패널티 반영)
const effectiveAttendance = attended + (late × (1 - latePenalty));

// 예시: latePenalty = 0.4
// attended = 1, late = 1
// effectiveAttendance = 1 + (1 × 0.6) = 1.6

// 2. 출석률 계산
const attendanceRate = (effectiveAttendance / 80) × 100;

// 예시: (1.6 / 80) × 100 = 2.0%
```

### **예시 계산표**

| 출석 | 지각 | 결석 | 실제 출석 | 출석률 |
|------|------|------|-----------|--------|
| 0 | 0 | 0 | 0.0 | **0.0%** |
| 1 | 0 | 0 | 1.0 | **1.25%** |
| 1 | 1 | 0 | 1.6 | **2.0%** |
| 2 | 1 | 0 | 2.6 | **3.25%** |
| 10 | 5 | 0 | 13.0 | **16.25%** |
| 40 | 0 | 0 | 40.0 | **50.0%** |
| 80 | 0 | 0 | 80.0 | **100.0%** |

---

## ❌ 에러 응답

### **공통 에러 형식**
```javascript
{
  "success": false,
  "message": "에러 메시지",
  "data": null
}
```

### **주요 에러 케이스**

| 상황 | HTTP | message |
|------|------|---------|
| 인증 토큰 없음 | 401 | "인증이 필요합니다." |
| 교수 권한 없음 | 403 | "교수 권한이 필요합니다." |
| 강의 코드 누락 | 400 | "강의 코드(lecSerial)는 필수입니다." |
| 수강신청 없음 | 400 | "수강신청 정보를 찾을 수 없습니다." |
| 중복 요청 | 400 | "이미 해당 회차의 출석 기록이 존재합니다." |
| 잘못된 회차 | 400 | "유효하지 않은 회차 번호입니다. (1~80)" |
| 잘못된 상태 | 400 | "유효하지 않은 출석 상태입니다. (출/지/결)" |

---

## 🎯 프론트엔드 구현 가이드

### **JavaScript 예시**
```javascript
// 출석 승인 API 호출 (교수용)
async function approveAttendance(lecSerial, sessionNumber, studentIdx, status) {
  const response = await fetch('https://bluecrab.chickenkiller.com/BlueCrab-1.0.0/api/attendance/approve', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${window.authToken}`
    },
    body: JSON.stringify({
      lecSerial: lecSerial,
      sessionNumber: sessionNumber,
      attendanceRecords: [
        {
          studentIdx: studentIdx,
          status: status  // "출", "지", "결"
        }
      ]
    })
  });
  
  const result = await response.json();
  
  if (result.success) {
    console.log('✅ 출석 승인 성공!');
  } else {
    console.error('❌ 출석 승인 실패:', result.message);
  }
  
  return result;
}

// 사용 예시
await approveAttendance('ETH201', 5, 6, '출');
```

---

**주요 변경사항:**
- ❌ "조"(조퇴) 제거
- ✅ "출", "지", "결" 3가지 상태만 사용

이 문서를 프론트엔드 팀에게 전달하시면 됩니다! 📧
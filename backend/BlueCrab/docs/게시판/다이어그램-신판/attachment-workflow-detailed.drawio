<mxfile host="app.diagrams.net" agent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36" version="28.2.8">
  <diagram name="Attachment Workflow" id="attachment-workflow">
    <mxGraphModel dx="1426" dy="777" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1169" pageHeight="827" background="light-dark(#FFFFFF,#FFFFFF)" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="title" value="첨부파일 3단계 워크플로우 (상세)" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=24;fontStyle=1;fontColor=light-dark(#000000,#000000);" parent="1" vertex="1">
          <mxGeometry x="300" y="30" width="569" height="40" as="geometry" />
        </mxCell>
        <mxCell id="step1-header" value="1️⃣ 게시글 생성 단계" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#c8e6c9;strokeColor=#4caf50;fontSize=18;fontStyle=1;fontColor=#1a1a1a;" parent="1" vertex="1">
          <mxGeometry x="50" y="80" width="1070" height="50" as="geometry" />
        </mxCell>
        <mxCell id="client1" value="클라이언트" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#0050ef;strokeColor=#001DBC;fontSize=14;fontColor=#ffffff;" parent="1" vertex="1">
          <mxGeometry x="80" y="160" width="100" height="60" as="geometry" />
        </mxCell>
        <mxCell id="create-request" value="POST /api/boards/create&#xa;{&#xa;  boardTitle: &quot;제목&quot;,&#xa;  boardContent: &quot;내용&quot;,&#xa;  boardCode: 0-3&#xa;}" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#6d8764;strokeColor=#3A5431;fontSize=11;align=left;fontColor=#ffffff;" parent="1" vertex="1">
          <mxGeometry x="220" y="150" width="180" height="80" as="geometry" />
        </mxCell>
        <mxCell id="board-controller" value="BoardCreateController" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#6a00ff;strokeColor=#3700CC;fontSize=12;fontColor=#ffffff;" parent="1" vertex="1">
          <mxGeometry x="440" y="160" width="140" height="60" as="geometry" />
        </mxCell>
        <mxCell id="board-service" value="BoardService&#xa;게시글 저장" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#6a00ff;strokeColor=#3700CC;fontSize=12;fontColor=#ffffff;" parent="1" vertex="1">
          <mxGeometry x="620" y="160" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="database1" value="Database&#xa;BoardTbl 저장" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#60a917;strokeColor=#2D7600;fontSize=12;fontColor=#ffffff;" parent="1" vertex="1">
          <mxGeometry x="780" y="160" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="board-response" value="Response:&#xa;{&#xa;  success: true,&#xa;  boardIdx: 123,&#xa;  boardTitle: &quot;제목&quot;&#xa;}" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#0050ef;strokeColor=#001DBC;fontSize=11;align=left;fontColor=#ffffff;" parent="1" vertex="1">
          <mxGeometry x="940" y="150" width="160" height="80" as="geometry" />
        </mxCell>
        <mxCell id="step2-header" value="2️⃣ 파일 업로드 단계" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffcdd2;strokeColor=#e57373;fontSize=18;fontStyle=1;fontColor=#1a1a1a;" parent="1" vertex="1">
          <mxGeometry x="50" y="260" width="1070" height="50" as="geometry" />
        </mxCell>
        <mxCell id="client2" value="클라이언트" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#0050ef;strokeColor=#001DBC;fontSize=14;fontColor=#ffffff;" parent="1" vertex="1">
          <mxGeometry x="80" y="360" width="100" height="60" as="geometry" />
        </mxCell>
        <mxCell id="upload-request" value="POST /api/board-attachments/upload/123&#xa;FormData:&#xa;- files: [file1.pdf, file2.jpg]&#xa;Content-Type: multipart/form-data" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#6d8764;strokeColor=#3A5431;fontSize=10;align=left;fontColor=#ffffff;" parent="1" vertex="1">
          <mxGeometry x="200" y="350" width="220" height="80" as="geometry" />
        </mxCell>
        <mxCell id="attachment-controller" value="BoardAttachmentController" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#6a00ff;strokeColor=#3700CC;fontSize=12;fontColor=#ffffff;" parent="1" vertex="1">
          <mxGeometry x="450" y="360" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="attachment-service" value="BoardAttachmentService&#xa;파일 저장 + 메타데이터 생성" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#6a00ff;strokeColor=#3700CC;fontSize=11;fontColor=#ffffff;" parent="1" vertex="1">
          <mxGeometry x="640" y="350" width="160" height="80" as="geometry" />
        </mxCell>
        <mxCell id="file-storage" value="파일 시스템&#xa;실제 파일 저장" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#60a917;strokeColor=#2D7600;fontSize=12;fontColor=#ffffff;" parent="1" vertex="1">
          <mxGeometry x="640" y="470" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="database2" value="Database&#xa;BoardAttachmentTbl&#xa;메타데이터 저장" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#60a917;strokeColor=#2D7600;fontSize=11;fontColor=#ffffff;" parent="1" vertex="1">
          <mxGeometry x="780" y="470" width="140" height="60" as="geometry" />
        </mxCell>
        <mxCell id="upload-response" value="Response:&#xa;{&#xa;  success: true,&#xa;  attachments: [&#xa;    { attachmentIdx: 45, originalFileName: &quot;file1.pdf&quot; },&#xa;    { attachmentIdx: 46, originalFileName: &quot;file2.jpg&quot; }&#xa;  ]&#xa;}" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#0050ef;strokeColor=#001DBC;fontSize=10;align=left;fontColor=#ffffff;" parent="1" vertex="1">
          <mxGeometry x="950" y="350" width="200" height="120" as="geometry" />
        </mxCell>
        <mxCell id="step3-header" value="3️⃣ 첨부파일 연결 단계" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1bee7;strokeColor=#9c27b0;fontSize=18;fontStyle=1;fontColor=#1a1a1a;" parent="1" vertex="1">
          <mxGeometry x="50" y="540" width="1070" height="50" as="geometry" />
        </mxCell>
        <mxCell id="client3" value="클라이언트" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#0050ef;strokeColor=#001DBC;fontSize=14;fontColor=#ffffff;" parent="1" vertex="1">
          <mxGeometry x="80" y="640" width="100" height="60" as="geometry" />
        </mxCell>
        <mxCell id="link-request" value="POST /api/boards/link-attachments/123&#xa;{&#xa;  attachmentIdxList: [45, 46]&#xa;}" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#6d8764;strokeColor=#3A5431;fontSize=11;align=left;fontColor=#ffffff;" parent="1" vertex="1">
          <mxGeometry x="220" y="630" width="220" height="80" as="geometry" />
        </mxCell>
        <mxCell id="board-controller2" value="BoardController" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#6a00ff;strokeColor=#3700CC;fontSize=12;fontColor=#ffffff;" parent="1" vertex="1">
          <mxGeometry x="480" y="640" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="board-service2" value="BoardService&#xa;첨부파일 연결 처리" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#6a00ff;strokeColor=#3700CC;fontSize=12;fontColor=#ffffff;" parent="1" vertex="1">
          <mxGeometry x="640" y="640" width="140" height="60" as="geometry" />
        </mxCell>
        <mxCell id="database3" value="Database&#xa;BoardAttachmentTbl&#xa;boardIdx 업데이트" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#60a917;strokeColor=#2D7600;fontSize=11;fontColor=#ffffff;" parent="1" vertex="1">
          <mxGeometry x="820" y="640" width="140" height="60" as="geometry" />
        </mxCell>
        <mxCell id="link-response" value="Response:&#xa;{&#xa;  success: true,&#xa;  message: &quot;첨부파일 연결 완료&quot;&#xa;}" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#0050ef;strokeColor=#001DBC;fontSize=11;align=left;fontColor=#ffffff;" parent="1" vertex="1">
          <mxGeometry x="1000" y="630" width="160" height="80" as="geometry" />
        </mxCell>
        <mxCell id="notes-title" value="⚠️ 중요 사항" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=18;fontStyle=1;fontColor=light-dark(#000000,#000000);" parent="1" vertex="1">
          <mxGeometry x="50" y="710" width="150" height="30" as="geometry" />
        </mxCell>
        <mxCell id="note1" value="🔹 3단계는 반드시 순서대로 실행&#xa;🔹 각 단계의 응답에서 다음 단계의 입력값 추출&#xa;🔹 2단계는 FormData 필수 (JSON 불가)&#xa;🔹 브라우저 콘솔에서는 파일 업로드 테스트 불가" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#6a00ff;strokeColor=#3700CC;fontSize=12;align=left;fontColor=#ffffff;" parent="1" vertex="1">
          <mxGeometry x="50" y="750" width="350" height="80" as="geometry" />
        </mxCell>
        <mxCell id="note2" value="📋 데이터베이스 상태 변화&#xa;1단계: BoardTbl에 게시글 생성&#xa;2단계: BoardAttachmentTbl에 파일 메타데이터 저장&#xa;3단계: BoardAttachmentTbl의 boardIdx 필드 업데이트" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#008a00;strokeColor=#005700;fontSize=12;align=left;fontColor=#ffffff;" parent="1" vertex="1">
          <mxGeometry x="430" y="750" width="350" height="80" as="geometry" />
        </mxCell>
        <mxCell id="note3" value="🔐 보안 고려사항&#xa;• 모든 단계에서 JWT 토큰 검증&#xa;• 파일 크기 및 타입 검증&#xa;• 업로드 경로 보안 설정&#xa;• 사용자별 권한 체크" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#6a00ff;strokeColor=#3700CC;fontSize=12;align=left;fontColor=#ffffff;" parent="1" vertex="1">
          <mxGeometry x="810" y="750" width="250" height="80" as="geometry" />
        </mxCell>
        <mxCell id="arrow1-1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#4caf50;strokeWidth=2;" parent="1" source="client1" target="create-request" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow1-2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#4caf50;strokeWidth=2;" parent="1" source="create-request" target="board-controller" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow1-3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#4caf50;strokeWidth=2;" parent="1" source="board-controller" target="board-service" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow1-4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#4caf50;strokeWidth=2;" parent="1" source="board-service" target="database1" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow1-5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#4caf50;strokeWidth=2;" parent="1" source="database1" target="board-response" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow2-1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#e57373;strokeWidth=2;" parent="1" source="client2" target="upload-request" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow2-2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#e57373;strokeWidth=2;" parent="1" source="upload-request" target="attachment-controller" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow2-3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#e57373;strokeWidth=2;" parent="1" source="attachment-controller" target="attachment-service" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow2-4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#e57373;strokeWidth=2;" parent="1" source="attachment-service" target="file-storage" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow2-5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#e57373;strokeWidth=2;" parent="1" source="attachment-service" target="database2" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow2-6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#e57373;strokeWidth=2;" parent="1" source="database2" target="upload-response" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow3-1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#9c27b0;strokeWidth=2;" parent="1" source="client3" target="link-request" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow3-2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#9c27b0;strokeWidth=2;" parent="1" source="link-request" target="board-controller2" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow3-3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#9c27b0;strokeWidth=2;" parent="1" source="board-controller2" target="board-service2" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow3-4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#9c27b0;strokeWidth=2;" parent="1" source="board-service2" target="database3" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow3-5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#9c27b0;strokeWidth=2;" parent="1" source="database3" target="link-response" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="step-transition1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=light-dark(#424242,#00CC00);strokeWidth=3;dashed=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="board-response" target="client2" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1020" y="240" />
              <mxPoint x="1140" y="240" />
              <mxPoint x="1140" y="330" />
              <mxPoint x="130" y="330" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="step-transition2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=light-dark(#424242,#00CC00);strokeWidth=3;dashed=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" target="client3" edge="1" source="upload-response">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1050" y="510" />
              <mxPoint x="1140" y="510" />
              <mxPoint x="1140" y="610" />
              <mxPoint x="130" y="610" />
            </Array>
            <mxPoint x="1050" y="490" as="sourcePoint" />
          </mxGeometry>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>

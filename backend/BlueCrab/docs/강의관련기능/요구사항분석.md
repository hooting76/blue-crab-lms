# 강의 관련 기능 요구사항 분석 및 개선 제안

> **작성일**: 2025-10-10
> **버전**: 2.1 (명명 규칙 통일 버전)
> **분석 대상**: `## 강의 관련 기능(연동된 관련 기능 포함).txt`
> **코멘트 반영**: 2025-10-09
> **추가 반영**: 2025-10-09 (수강생 목록, 복수 등록, 필수/교양 처리)
> **최적화**: **신규 테이블 2개**로 모든 기능 구현
> **변경사항**: 모든 테이블/컬럼명을 대문자 + 언더스코어 규칙으로 통일

---

## 🎯 **구현 전략: 최소화 접근**

### **핵심 원칙**
1. **테이블 수 최소화**: 기존 테이블 최대 활용 + 신규 2개만 추가
2. **JSON 데이터 통합**: 복잡한 관계 데이터를 JSON으로 저장
3. **점진적 확장**: 기본 기능 우선, 고급 기능 나중에 추가
4. **유연한 구조**: 필요시 기능별 테이블 분리 가능

### **구현 범위 (Phase 1-5)**
- ✅ **기본 수강관리**: 수강신청, 출결, 성적
- ✅ **과제관리**: 과제 생성, 제출, 채점
- ✅ **강의평가**: 학생 평가 입력 및 조회
- ✅ **게시판**: 강의별 공지사항
- ⏸️ **채팅**: 별도 구현 (우선 제외)
- ⏸️ **고급 기능**: 평가 통계, 대기열 등 (나중 확장)

---

## 📋 현재 요구사항 요약

## 📋 현재 요구사항 요약

### A. 관리자 기능
1. **강의 등록**: 강의명, 설명, 인원, 학점, 시간, 대상조건, 강의코드 등
2. **강의 평가 총괄**: 강의별 평가항목 조절 (1~5점)
3. **열람 기능**: 학생별/강의별 출결/성적/과제 조회

### B. 교수 기능
1. **강의 목록**: 본인 강의 관리, 수강신청기간 중 사전작업
2. **강의별 관리**: 출결승인, 성적관리, 과제관리, 휴강설정, 공지사항, 시험결과

### C. 학생 기능
1. **수강신청**: 조건필터링, 실시간 정원체크, 다중신청
2. **학기중**: 출결확인, 과제제출, 공지알림, 채팅, 평가

---

## 🔍 코멘트 반영된 정정/개선사항

### 1. **데이터베이스 설계 관련**

#### ✅ **확인된 사항**
- **강의 시간 표현 방식**: 월~금요일, 하루 8교시까지, 주 4번 수업
- **강의 상태**: 개강/폐강만 DB 상태로 관리, 다른 상태들은 날짜 기반 계산
- **교수-강의 관계**: 한 교수가 여러 강의 담당 가능 (1:N)
- **학기 정보**: YEAR, SEMESTER 외 학기 시작/종료일 필요 (계절학기 없음)

#### 🆕 **새로 추가된 사항**
- **수강생 목록**: 강의 테이블에 수강중인 학생 목록 컬럼 필요
- **필수/교양 처리**: 전공별로 필수/교양 여부가 다를 수 있음

---

### 2. **관리자 기능 관련**

#### ✅ **코멘트 반영**
- **강의 수정/삭제**: 삭제는 "폐강" 상태로 변경, 수정 기능 필요
- **강의 평가 항목 관리**: 관리자가 평가항목 리스트 작성/개시 가능
- **강의 통계**: 프런트엔드 통신용으로 사용하기 쉬운 형태 제공

#### 🆕 **새로 추가된 사항**
- **복수 강의 등록**: 관리자가 한 번에 여러 강의 등록 가능 (수강생 컬럼은 비워둔 채)

---

### 3. **교수 기능 관련**

#### ✅ **코멘트 반영**
- **출결 방식**: 학생 출석 요청 → 교수 재량으로 승인/거부
- **휴강 처리**: 휴강 시 다음 수업으로 자동 연장 (종강일 연장)
- **중간/기말고사**: 학생별 성적 기록 기능
- **공지사항 필터링**: ❌ 필요 없음, 최신순 정렬로 충분
- **학생별 상담 기록**: 1대1 채팅으로 구현, 채팅 저장방식 검토 필요

#### ⚠️ **보완사항**
- **채팅 저장방식**: 별도 채팅 시스템 설계 필요

---

### 4. **학생 기능 관련**

#### ✅ **코멘트 반영**
- **시간표 겹침 체크**: ❌ 필요 없음 (학생 책임)
- **수강신청 우선순위**: ✅ 보결 순위기능 추가 (취소자 발생 시 자동 승계)
- **수강신청 취소**: 개강 전까지만 가능
- **강의평가 타이밍**: 종강일 후 1주일 이내 평가 제출
- **푸시알림 세부**: 공지 등록, 출결 승인 시 알림

#### ⚠️ **시스템 개선**
- **보결 시스템**: 정원초과 시 대기순번 부여 및 자동 승계 로직

---

### 5. **시스템 아키텍처 관련**

#### ✅ **코멘트 기반 추가사항**
- **채팅 시스템**: 교수-학생 1대1 채팅 구현
- **보결 순위 시스템**: 수강신청 대기열 관리
- **알림 시스템**: 공지, 출결 승인 알림

#### ⚠️ **기존 유지사항**
- **트랜잭션 처리**: 수강신청 시 정원체크 + 등록 원자성 보장
- **캐싱 전략**: 실시간 정원정보 캐싱
- **파일 업로드**: 과제 제출 파일 관리
- **권한 체계**: 관리자/교수/학생 권한 세부 정의

---

## 📝 구체적인 개선 제안 (코멘트 반영)

### **1. 강의 시간 데이터 구조**
```json
// 코멘트 반영: 월~금요일, 8교시까지, 주 4번 수업
{
  "schedule": [
    {"dayOfWeek": 1, "period": 1},  // 월요일 1교시
    {"dayOfWeek": 1, "period": 2},  // 월요일 2교시
    {"dayOfWeek": 3, "period": 3},  // 수요일 3교시
    {"dayOfWeek": 3, "period": 4}   // 수요일 4교시
  ],
  "totalHours": 4
}
```

### **2. 강의 상태 (코멘트 반영)**
```sql
-- 개강/폐강만 DB 상태로 관리
IS_ACTIVE TINYINT(1) DEFAULT 1 COMMENT '0:폐강, 1:개강'
-- 다른 상태들은 날짜 기반 계산 (수강신청중/진행중/종강)
```

### **3. 수강생 목록 컬럼 (새로 추가)**
```sql
-- LECTURE_TBL에 수강생 목록 추가
ALTER TABLE LECTURE_TBL ADD COLUMN enrolled_students JSON COMMENT '수강생 목록 [{"studentIdx":123,"enrolledAt":"2025-03-01"},...]';
-- 또는 별도 테이블로 관리 (권장)
CREATE TABLE LECTURE_ENROLLED_STUDENTS (
    lecture_idx INT NOT NULL,
    student_idx INT NOT NULL,
    enrolled_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (lecture_idx, student_idx),
    FOREIGN KEY (lecture_idx) REFERENCES LECTURE_TBL(lecture_idx),
    FOREIGN KEY (student_idx) REFERENCES USER_TBL(user_idx)
);
```

### **4. 필수/교양 여부 처리 방법 (새로 추가)**

#### **문제점**
- 같은 강의가 어떤 전공에서는 필수, 다른 전공에서는 교양일 수 있음
- 기존: 강의 테이블에 IS_REQUIRED (0:교양, 1:필수) 단일 값

#### **해결 방안 1: 전공별 설정 테이블**
```sql
-- 전공별 강의 속성 테이블
CREATE TABLE LECTURE_DEPARTMENT_REQUIREMENT (
    lecture_idx INT NOT NULL,
    department_code VARCHAR(20) NOT NULL,  -- 학과 코드
    is_required TINYINT(1) NOT NULL,       -- 0:교양, 1:필수
    PRIMARY KEY (lecture_idx, department_code),
    FOREIGN KEY (lecture_idx) REFERENCES LECTURE_TBL(lecture_idx)
);

-- 예시 데이터
INSERT INTO LECTURE_DEPARTMENT_REQUIREMENT VALUES
(456, 'CS', 1),    -- 컴퓨터공학과: 필수
(456, 'ME', 0),    -- 기계공학과: 교양
(456, 'ALL', 0);   -- 전체: 교양 (기본값)
```

#### **해결 방안 2: JSON 필드 활용**
```sql
-- LECTURE_TBL에 JSON 필드 추가
ALTER TABLE LECTURE_TBL ADD COLUMN department_requirements JSON COMMENT '{"CS":1, "ME":0, "ALL":0}';
```

#### **추천 방안: 방안 1 (테이블 분리)**
- **장점**: 정규화, 검색 용이, 확장성 좋음
- **단점**: JOIN 필요
- **사용 예시**:
```sql
-- 학생의 학과에 따른 필수/교양 확인
SELECT l.*, COALESCE(ldr.is_required, 0) as is_required_for_student
FROM LECTURE_TBL l
LEFT JOIN LECTURE_DEPARTMENT_REQUIREMENT ldr
    ON l.lecture_idx = ldr.lecture_idx
    AND ldr.department_code IN ('ALL', '학생의학과코드')
WHERE l.lecture_idx = ?;
```

### **5. 복수 강의 등록 API (새로 추가)**
```http
POST /api/admin/lectures/batch
Authorization: Bearer {token}
Content-Type: application/json
```

**Request Body**:
```json
{
  "lectures": [
    {
      "lectureName": "자바 프로그래밍",
      "lectureCode": "CS101-2025-1",
      "professorIdx": 123,
      // ... 다른 필드들 (enrolled_students는 제외)
    },
    {
      "lectureName": "데이터베이스",
      "lectureCode": "CS102-2025-1",
      "professorIdx": 124,
      // ...
    }
  ]
}
```

**Response (200)**:
```json
{
  "success": true,
  "message": "강의 2개가 등록되었습니다.",
  "data": [
    {"lectureIdx": 456, "lectureCode": "CS101-2025-1"},
    {"lectureIdx": 457, "lectureCode": "CS102-2025-1"}
  ]
}
```

### **6. 수강신청 개선 (코멘트 반영)**
- **보결 순위 시스템**: 정원 초과 시 대기순번 부여
- **자동 승계**: 취소자 발생 시 다음 순번 학생 자동 등록
- **취소 제한**: 개강 전까지만 취소 가능

### **7. 휴강 처리 (코멘트 반영)**
- **자동 연장**: 휴강 시 원래 스케줄에 따라 다음 수업 추가
- **종강일 연장**: 휴강 횟수만큼 종강일 자동 연장

### **8. 채팅 시스템 설계**
```sql
-- 교수-학생 1대1 채팅 테이블 제안
CREATE TABLE CHAT_ROOM (
    room_idx BIGINT AUTO_INCREMENT PRIMARY KEY,
    professor_idx INT NOT NULL,
    student_idx INT NOT NULL,
    lecture_idx INT,  -- 선택사항
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    UNIQUE KEY uk_chat_room (professor_idx, student_idx, lecture_idx)
);

CREATE TABLE CHAT_MESSAGE (
    message_idx BIGINT AUTO_INCREMENT PRIMARY KEY,
    room_idx BIGINT NOT NULL,
    sender_idx INT NOT NULL,
    message_type ENUM('TEXT', 'FILE', 'IMAGE'),
    content TEXT,
    sent_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    is_read TINYINT(1) DEFAULT 0
);
```

---

## 🎯 우선순위별 개선사항 (코멘트 반영)

### **Phase 1 (필수)**
1. 강의 시간 데이터 구조 표준화 (월~금, 8교시, 주4회)
2. 강의 상태 단순화 (개강/폐강만 DB 관리)
3. **수강생 목록 컬럼 추가** ⭐
4. **필수/교양 전공별 처리** ⭐
5. 수강신청 트랜잭션 보장
6. 출결 승인 프로세스 구현
7. 보결 순위 시스템 구현

### **Phase 2 (권장)**
1. **복수 강의 등록 기능** ⭐
2. 휴강 자동 연장 로직
3. 채팅 시스템 구현
4. 푸시알림 시스템 (공지, 출결 승인)
5. 파일 업로드 관리
6. 평가 통계 대시보드

### **Phase 3 (향후)**
1. 채팅 고급 기능 (파일 전송, 읽음 확인)
2. 알림 확장 (과제 마감 등)
3. 모바일 앱 연동
4. 외부 시스템 연동 (학사정보시스템 등)

---

## 📋 다음 단계

이 최종 분석 결과를 바탕으로 [플로우 문서](./03-비즈니스로직.md)를 작성하겠습니다.
모든 개선사항들은 사용자의 피드백을 우선으로 반영했습니다.
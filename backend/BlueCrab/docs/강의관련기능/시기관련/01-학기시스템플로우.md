# 학기 시스템 및 수강신청 기간 관리 플로우

> **작성일**: 2025-10-16  
> **버전**: 1.0  
> **목적**: 서버 시간 기반 시기별 기능 활성화 시스템  

---

## 📋 **시스템 개요**

### 🎯 **핵심 목표**
- 서버 시간을 기준으로 **방학/수강신청/학기중** 자동 판별
- 시기별 맞춤 기능 활성화
- 수강신청 자격 검증 및 필터링
- 테스트 편의를 위한 유연한 기간 설정

### ⏰ **시기 분류**
1. **방학 기간** - 휴식 및 메시지 출력
2. **수강신청 기간** - 수강신청 기능 활성화 (2주)
3. **학기 중** - 수강중인 강의 관리

---

## 🔄 **메인 플로우**

### 1단계: 시기 판별
```
서버 현재 시간 확인
     ↓
시기 판별 로직 실행
     ↓
┌─────────┬─────────────┬─────────┐
│ 방학기간 │ 수강신청기간  │ 학기중  │
└─────────┴─────────────┴─────────┘
```

### 2단계: 기능 활성화
```
방학 → 방학 메시지 출력
수강신청 → 수강신청 기능 + 자격 검증
학기중 → 수강중인 강의 목록 + 상세정보
```

---

## 🏫 **방학 기간 플로우**

### 기능
- 프론트엔드에서 적절한 휴식 메시지 출력
- 대부분의 학사 기능 비활성화

### 메시지 예시
```
"방학 잘 보내세요 😊"
"다음 학기 수강신청은 X월 X일부터 시작됩니다"
```

---

## 📝 **수강신청 기간 플로우**

### **A. 기간 설정 규칙**
```
수강신청 기간: 2주 (14일)
학기 시작일: 수강신청 최종일 + 1일
수강신청 시작일: 테스트용 별도 설정
```

### **B. 수강신청 자격 검증**
```
1. 사용자 로그인 확인
     ↓
2. 학생 자격 확인 (USER_STUDENT = 0)
     ↓
3. 강의별 수강 자격 검증
   ├─ 학부 코드 일치 ✅
   ├─ 학과 코드 일치 ✅
   ├─ 최소 학년 이상 ✅
   ├─ 대상학년 (지침, 강제X) ⚠️
   └─ 정원 초과 여부 ❌
     ↓
4. 필터링된 강의 목록 출력
```

### **C. 수강신청 기능**
```
수강 가능 강의 조회
     ↓
수강신청 처리
     ↓
수강신청 취소
     ↓
수강신청 현황 확인
```

### **D. 필터링 로직**
```sql
SELECT * FROM LEC_TBL 
WHERE 
  -- 기본 조건
  LEC_CURRENT < LEC_MANY  -- 정원 미달
  
  -- 학생 자격 조건 (0값은 제한 없음을 의미)
  AND (FACULTY_CODE = 0 OR FACULTY_CODE = student.FACULTY_CODE)     -- 학부 일치 또는 제한없음
  AND (DEPARTMENT_CODE = 0 OR DEPARTMENT_CODE = student.DEPT_CODE)  -- 학과 일치 또는 제한없음
  AND (MIN_GRADE = 0 OR MIN_GRADE <= student.CURRENT_GRADE)         -- 최소 학년 또는 제한없음
  
  -- 대상학년은 권장사항 (필터링하지 않음)
  -- LEC_YEAR는 지침용
```

### **⚠️ 중요: 0값 제한 없음 규칙**

**강의 설정에서 0값의 의미:**
- `FACULTY_CODE = 0`: 모든 학부 학생 수강 가능
- `DEPARTMENT_CODE = 0`: 모든 학과 학생 수강 가능  
- `MIN_GRADE = 0`: 모든 학년 학생 수강 가능

**예시:**
```
강의 A: 학부=01, 학과=0, 최소학년=2
→ 01학부 소속이면서 2학년 이상인 모든 학과 학생 수강 가능

강의 B: 학부=0, 학과=0, 최소학년=0  
→ 전체 학생 수강 가능 (완전 개방 강의)

강의 C: 학부=01, 학과=03, 최소학년=3
→ 01학부 03학과 3학년 이상만 수강 가능
```

---

## 📚 **학기 중 플로우**

### **A. 수강중인 강의 목록**
```
1. 사용자 로그인 확인
     ↓
2. 수강 신청한 강의 조회
   (ENROLLMENT_EXTENDED_TBL 기준)
     ↓
3. 강의 기본 정보 출력
   ├─ 강의명 (LEC_TIT)
   ├─ 교수명 (LEC_PROF)  
   ├─ 시간 (LEC_TIME)
   └─ 강의실 정보
```

### **B. 강의 상세정보 조회**
```
강의 목록에서 선택
     ↓
상세정보 API 호출
     ↓
모든 컬럼 정보 출력
├─ 기본 정보 (제목, 교수, 시간)
├─ 수강 정보 (정원, 현재인원)
├─ 학사 정보 (학년, 학기, 학점)
├─ 과제 정보 (과제 목록)
└─ 수강생 정보 (출석, 성적)
```

---

## 🛠 **기술적 구현**

### **A. 시기 판별 API - 🆕 새로 구현 필요**
```javascript
// 완전히 새로 구현 필요 (SemesterController 생성)
GET /api/semester/current-period

Response:
{
  "currentPeriod": "ENROLLMENT" | "SEMESTER" | "VACATION",
  "startDate": "2025-02-01",
  "endDate": "2025-02-14",
  "nextPeriod": "SEMESTER",
  "nextStartDate": "2025-02-15"
}
```

**📝 구현 상태**: 
- 🆕 **새로 구현**: 시기 관리 시스템이 전혀 없음
- 🆕 **SemesterController**: 새로운 컨트롤러 생성 필요
- 🆕 **시기 로직**: 서버 시간 기반 3단계 시기 판별 로직 구현

### **B. 수강신청 자격 검증 API - 🔄 기존 확장 필요**
```javascript
// 새로 구현 필요 (기존 LectureController 확장)
GET /api/enrollment/eligible-lectures/{studentId}

Response:
{
  "eligibleLectures": [
    {
      "lecIdx": 1,
      "lecTit": "데이터베이스",
      "lecProf": "김교수",
      "lecCurrent": 25,
      "lecMany": 30,
      "isEligible": true,
      "eligibilityReason": "모든 조건 충족"
    }
  ],
  "totalCount": 15,
  "eligibleCount": 12
}
```

**📝 구현 상태**: 
- 🔄 **확장 필요**: 기존 `LectureController`에 0값 제한없음 로직 추가
- ✅ **기반 있음**: 학년/학기/전공 필터링 기능 이미 존재
- 🆕 **추가 로직**: 학생별 자격 검증 및 0값 규칙 구현 필요

### **C. 수강중인 강의 조회 API - ✅ 기존 구현됨**
```javascript
// 기존 API 사용 (이미 구현됨)
GET /api/enrollments?enrolled=true&studentIdx={studentId}

Response:
{
  "enrolledLectures": [
    {
      "enrollmentIdx": 1,
      "lecIdx": 1,
      "lecTit": "데이터베이스",
      "lecProf": "김교수", 
      "lecSerial": "CS101",
      "lecPoint": 3,
      "lecTime": "월1,2",
      "enrollmentDate": "2025-02-10",
      "currentGrade": null,
      "attendanceCount": 8
    }
  ]
}
```

**📝 구현 상태**: 
- ✅ **완료됨**: `EnrollmentController.java`에 이미 구현
- ✅ **DTO 변환**: Entity → DTO 안전 변환 지원
- ✅ **강의 정보 포함**: 수강신청과 함께 강의 상세정보 제공

---

## 📅 **예시 타임라인**

### **연간 학사일정**
```
🔴 겨울방학: 2024-12-20 ~ 2025-01-31
🔵 1학기 수강신청: 2025-02-01 ~ 2025-02-14 (2주)
🟢 1학기: 2025-02-15 ~ 2025-06-30

🔴 여름방학: 2025-07-01 ~ 2025-07-31  
🔵 2학기 수강신청: 2025-08-01 ~ 2025-08-14 (2주)
🟢 2학기: 2025-08-15 ~ 2025-12-19
```

### **테스트용 설정**
```
수강신청 시작일: 관리자가 별도 설정
수강신청 종료일: 시작일 + 14일
학기 시작일: 종료일 + 1일
```

---

## 🎯 **구현 우선순위**

### **Phase 1: 시기 판별 시스템 - 🆕 새로 구현**
1. ✅ 시기 관리 설정 테이블 설계 (관리자가 기간 설정)
2. ✅ SemesterController 및 SemesterService 생성
3. ✅ 서버 시간 기반 시기 판별 로직 구현

### **Phase 2: 수강신청 자격 검증 - 🔄 기존 확장**
1. ✅ 기존 LectureController에 자격 검증 엔드포인트 추가
2. ✅ 0값 제한없음 규칙 로직 구현 (학부/학과/학년)
3. ✅ 학생별 수강 가능 강의 필터링 기능

### **Phase 3: 통합 및 테스트 - ✅ 기존 활용**
1. ✅ 수강중인 강의 조회 (이미 완료됨)
2. ✅ 브라우저 콘솔 테스트 페이지 업데이트
3. ✅ 시기별 기능 전환 테스트

### **Phase 4: 고도화 - 🔮 향후 계획**
1. 📋 수강신청 대기열 시스템
2. 📋 실시간 정원 확인
3. 📋 수강신청 통계 및 분석

---

## ⚠️ **주의사항**

### **테스트 고려사항**
- 수강신청 시작일은 테스트를 위해 유연하게 설정
- 시기 변경 시 즉시 기능 전환 확인
- 자격 검증 로직의 정확성 검증

### **보안 고려사항**
- 수강신청 기간 외 접근 차단
- 자격 미달 학생의 수강신청 방지
- 정원 초과 방지 로직

### **성능 고려사항**
- 수강신청 집중 시간대 서버 부하 대비
- 강의 목록 캐싱 전략
- 실시간 정원 확인 최적화

### **📌 DB 제약 조건 정책**
- **DB 레벨**: 최소한의 제약 조건만 설정 (PK, FK, NOT NULL 등)
- **애플리케이션 레벨**: 프론트엔드 + 백엔드에서 비즈니스 로직 검증 처리
- **장점**: 유연한 규칙 변경, 사용자 친화적 에러 메시지, 성능 최적화
- **구현**: 0값 제한 없음 규칙 등 복잡한 로직을 코드로 구현

---

**작성자**: AI Assistant  
**검토 필요**: 수강신청 시작일 설정 방식, 자격 검증 세부 규칙
# 04. 관리자 플로우

## 관리자 기능 플로우

---

## 📋 목차

1. [강의 등록 플로우](#1-강의-등록-플로우)
2. [강의 관리 플로우](#2-강의-관리-플로우)
3. [강의 평가 관리 플로우](#3-강의-평가-관리-플로우)
4. [통계 및 모니터링 플로우](#4-통계-및-모니터링-플로우)

---

## 1. 강의 등록 플로우

### **1.1 단일 강의 등록**

```mermaid
sequenceDiagram
    participant Admin as 관리자
    participant UI as 관리자 UI
    participant API as 강의 API
    participant DB as 데이터베이스

    Admin->>UI: 강의 등록 메뉴 선택
    UI->>UI: 강의 등록 폼 표시

    Admin->>UI: 강의 정보 입력
    Note over UI: 강의명, 설명, 교수, 인원,<br/>시간(예: 월1월2수3수4), 대상조건 등

    UI->>API: POST /api/admin/lectures
    API->>API: 입력값 검증
    API->>DB: 강의 정보 저장
    DB-->>API: 저장 완료

    API-->>UI: 등록 성공 응답
    UI-->>Admin: 등록 완료 메시지
```

### **1.2 복수 강의 등록 (배치)**

```mermaid
sequenceDiagram
    participant Admin as 관리자
    participant UI as 관리자 UI
    participant API as 강의 API
    participant DB as 데이터베이스

    Admin->>UI: 복수 강의 등록 선택
    UI->>UI: 엑셀 업로드 또는<br/>다중 입력 폼 표시

    Admin->>UI: 강의 목록 업로드/입력
    UI->>UI: 데이터 검증 및 포맷팅

    UI->>API: POST /api/admin/lectures/batch
    API->>API: 각 강의별 검증
    loop 각 강의
        API->>DB: 강의 정보 저장
    end

    DB-->>API: 배치 저장 완료
    API-->>UI: 등록 결과 응답
    Note over UI: 성공/실패 강의별 결과 표시

    UI-->>Admin: 배치 등록 완료
```

### **1.3 강의 등록 상세 프로세스**

#### **입력 검증 단계**
1. **필수값 체크**: 강의명, 코드, 교수, 최대인원 등
2. **중복 체크**: 강의코드, 시간 겹침 등
3. **참조 검증**: 교수 존재 여부, 학과 코드 유효성
4. **비즈니스 규칙**: 최소인원 ≤ 최대인원, 시간 형식(월1월2수3수4) 등
5. **시간 형식 검증**: 
   - 형식: `월1월2수3수4` (요일명+교시 반복)
   - 요일: 월, 화, 수, 목, 금 중 하나
   - 교시: 1~9 사이의 숫자
   - 예시: `월1`, `월1화2`, `월1월2수3수4`
   - 사용자 입력 지원: `월1,2 수3,4` 형태도 자동 변환 가능

#### **데이터 저장 단계**
1. **LECTURE_TBL**: 기본 강의 정보 저장
2. **LECTURE_SCHEDULE**: 시간표 정보 저장
3. **LECTURE_DEPARTMENT_REQUIREMENT**: 전공별 필수/교양 설정 저장

#### **강의 시간 형식 가이드**

##### **기본 형식**
- **저장 형식**: `월1월2수3수4` (요일명+교시 연속)
- **요일 표기**: 월, 화, 수, 목, 금
- **교시 범위**: 1~9
- **DB 필드**: `LEC_TIME` VARCHAR(100)

##### **입력 방식**
관리자는 두 가지 형식으로 강의 시간을 입력할 수 있으며, 시스템이 자동으로 표준 형식으로 변환합니다:

1. **표준 형식** (직접 입력):
   ```
   월1월2수3수4
   ```

2. **편의 형식** (콤마/공백 사용):
   ```
   월1,2 수3,4
   화2,3,4
   월1 화2 수3 목4 금5
   ```

##### **형식 변환 예시**

| 사용자 입력 | 저장 형식 | 설명 |
|------------|----------|------|
| `월1,2 수3,4` | `월1월2수3수4` | 월요일 1,2교시 + 수요일 3,4교시 |
| `화2,3,4` | `화2화3화4` | 화요일 2,3,4교시 |
| `월1` | `월1` | 월요일 1교시만 |
| `월1 화2 수3` | `월1화2수3` | 월/화/수 각 1개 교시 |

##### **변환 로직**
시스템은 다음 JavaScript 함수로 자동 변환합니다:

```javascript
function convertLectureTimeFormat(input) {
    if (!input || input.trim() === '') {
        return '';
    }
    
    // 정규식: (요일)(숫자들) 패턴 찾기
    const regex = /([월화수목금])([0-9,\s]+)/g;
    let result = '';
    let match;
    
    while ((match = regex.exec(input)) !== null) {
        const day = match[1];  // 요일
        const periods = match[2]
            .replace(/\s+/g, '')  // 공백 제거
            .split(',')           // 콤마로 분리
            .filter(p => p);      // 빈 문자열 제거
        
        // 각 교시를 요일과 결합
        periods.forEach(period => {
            result += day + period;
        });
    }
    
    return result;
}
```

##### **사용 예시 (브라우저 콘솔 테스트)**
```javascript
// 테스트 파일에서 사용
const userInput = prompt('강의 시간 (예: 월1,2 수3,4):');
const dbFormat = convertLectureTimeFormat(userInput);
console.log('입력:', userInput);
console.log('저장:', dbFormat);
```

##### **유효성 검증**
- 요일은 반드시 월/화/수/목/금 중 하나
- 교시는 1~9 범위의 숫자
- 빈 값 허용 (선택 입력)
- 중복 시간 체크 (다른 강의와 겹침 방지)

---

## 2. 강의 관리 플로우

### **2.1 강의 수정 플로우**

```mermaid
sequenceDiagram
    participant Admin as 관리자
    participant UI as 관리자 UI
    participant API as 강의 API
    participant DB as 데이터베이스

    Admin->>UI: 강의 목록 조회
    UI->>API: POST /lectures (Body: {page, size, filters})
    API->>DB: 강의 목록 조회
    DB-->>API: 강의 데이터
    API-->>UI: 강의 목록 표시

    Admin->>UI: 수정할 강의 선택
    UI->>API: POST /lectures/detail (Body: {lecSerial})
    API->>DB: 강의 상세 조회
    DB-->>API: 강의 상세 데이터
    API-->>UI: 수정 폼 표시

    Admin->>UI: 정보 수정
    UI->>API: POST /lectures/update (Body: {lecSerial, ...})
    API->>API: 수정 검증

    API->>DB: 강의 정보 업데이트
    DB-->>API: 업데이트 완료
    API-->>UI: 수정 성공
    UI-->>Admin: 수정 완료 메시지
```

### **2.2 강의 폐강 플로우**

```mermaid
sequenceDiagram
    participant Admin as 관리자
    participant UI as 관리자 UI
    participant API as 강의 API
    participant DB as 데이터베이스
    participant Student as 학생 시스템

    Admin->>UI: 강의 폐강 선택
    UI->>API: POST /lectures/delete (Body: {lecSerial})
    API->>API: 폐강 가능 여부 검증

    API->>DB: 강의 상태를 폐강으로 변경
    DB-->>API: 상태 변경 완료

    API->>Student: 수강생들에게 폐강 알림
    Student-->>API: 알림 발송 확인

    API-->>UI: 폐강 완료
    UI-->>Admin: 폐강 처리 완료 메시지
```

---

## 3. 강의 평가 관리 플로우

### **3.1 평가 항목 설정** (미구현)

```mermaid
sequenceDiagram
    participant Admin as 관리자
    participant UI as 관리자 UI
    participant API as 평가 API
    participant DB as 데이터베이스

    Admin->>UI: 평가 항목 관리 선택
    UI->>API: POST /api/admin/evaluation-items/list
    API->>DB: 평가 항목 템플릿 조회
    DB-->>API: 템플릿 데이터
    API-->>UI: 평가 항목 목록 표시

    Admin->>UI: 새 항목 추가 또는 수정
    UI->>API: POST /api/admin/evaluation-items
    API->>API: 항목 검증
    API->>DB: 평가 항목 저장
    DB-->>API: 저장 완료

    API-->>UI: 설정 완료
    UI-->>Admin: 평가 항목 설정 완료
```

### **3.2 평가 결과 조회** (미구현)

```mermaid
sequenceDiagram
    participant Admin as 관리자
    participant UI as 관리자 UI
    participant API as 평가 API
    participant DB as 데이터베이스

    Admin->>UI: 평가 결과 조회 선택
    UI->>API: POST /api/admin/evaluations/list (Body: {year, semester})
    API->>DB: 평가 결과 집계
    DB-->>API: 평가 통계 데이터
    API-->>UI: 평가 결과 표시
    UI-->>Admin: 평가 결과 확인

    Admin->>UI: 상세 결과 엑셀 다운로드
    UI->>API: POST /api/admin/evaluations/export (Body: {year, semester})
    API->>API: 엑셀 파일 생성
    API-->>UI: 엑셀 파일 다운로드
```

---

## 4. 통계 및 모니터링 플로우

### **4.1 수강률 통계 조회** (미구현)

```mermaid
sequenceDiagram
    participant Admin as 관리자
    participant UI as 관리자 UI
    participant API as 통계 API
    participant DB as 데이터베이스

    Admin->>UI: 수강률 통계 선택
    UI->>API: POST /api/admin/statistics/enrollment
    API->>DB: 수강 데이터 집계
    DB-->>API: 통계 데이터
    API-->>UI: 차트 및 표로 표시
    UI-->>Admin: 수강률 통계 확인

    Admin->>UI: 필터 적용 (학과, 학년 등)
    UI->>API: POST /api/admin/statistics/enrollment/filtered (Body: {filters})
    API->>DB: 필터링된 데이터 조회
    DB-->>API: 필터링된 통계
    API-->>UI: 업데이트된 통계 표시
```

### **4.2 출결 및 성적 모니터링** (미구현)

```mermaid
sequenceDiagram
    participant Admin as 관리자
    participant UI as 관리자 UI
    participant API as 모니터링 API
    participant DB as 데이터베이스

    Admin->>UI: 출결/성적 모니터링 선택
    UI->>API: POST /api/admin/monitoring/attendance-grades
    API->>DB: 출결 및 성적 데이터 조회
    DB-->>API: 모니터링 데이터
    API-->>UI: 대시보드 표시
    UI-->>Admin: 모니터링 결과 확인

    Admin->>UI: 이상치 강의 선택
    UI->>API: POST /lectures/detail (Body: {lecSerial})
    API->>DB: 강의 상세 정보 조회
    DB-->>API: 상세 데이터
    API-->>UI: 강의 상세 정보 표시
```

---

## 관리자 주요 업무

### 학기 준비
1. 강의 계획 수립 및 교수별 강의 배정
2. 강의 정보 등록
3. 평가 항목 설정 (미구현)
4. 수강신청 기간 설정

### 학기 운영
1. 강의 모니터링 (수강률, 출결률)
2. 이슈 대응 (정원 조정, 시간 변경)
3. 통계 분석 (미구현)

### 학기 종료
1. 평가 결과 분석 (미구현)
2. 성적 모니터링 (미구현)
3. 다음 학기 준비
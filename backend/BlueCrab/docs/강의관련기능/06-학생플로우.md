# 06. 학생 플로우

> **작성일**: 2025-10-10  
> **최종 수정**: 2025-10-14  
> **버전**: 2.3 (교수 이름 조회 기능 추가)  
> **변경사항**: 
> - 모든 필드명을 대문자 + 언더스코어 규칙으로 통일
> - EnrollmentController DTO 패턴 적용 반영
> - HTTP 400 에러 해결 완료 (PageImpl 적용)
> - 교수 이름 조회 기능 추가 (lecProf + lecProfName)

---

## 👨‍🎓 학생 기능 플로우

학생의 강의 관리 시스템 사용 시나리오를 단계별로 정의합니다.

---

## 📋 목차

1. [수강신청 플로우](#1-수강신청-플로우)
2. [학기 중 활동 플로우](#2-학기-중-활동-플로우)
3. [출결 관리 플로우](#3-출결-관리-플로우)
4. [과제 관리 플로우](#4-과제-관리-플로우)
5. [강의 평가 플로우](#5-강의-평가-플로우)

---

## 1. 수강신청 플로우

### **1.1 수강 가능 강의 조회**

```mermaid
sequenceDiagram
    participant Student as 학생
    participant UI as 학생 UI
    participant API as 수강신청 API
    participant DB as 데이터베이스

    Student->>UI: 수강신청 메뉴 선택
    UI->>API: GET /api/student/lectures/available?year=2025&semester=1
    API->>API: 학생 정보 기반 필터링
    Note over API: 학과, 학년, 필수/교양 조건 적용

    API->>DB: 수강 가능 강의 조회
    Note over DB: 정원, 대상 조건, 시간표 등 검증

    DB-->>API: 필터링된 강의 목록
    API-->>UI: 수강 가능 강의 표시
    UI-->>Student: 강의 목록 확인
```

### **1.2 수강신청 처리**

```mermaid
sequenceDiagram
    participant Student as 학생
    participant UI as 학생 UI
    participant API as 수강신청 API
    participant DB as 데이터베이스

    Student->>UI: 강의 선택 및 신청
    UI->>API: POST /api/student/enrollments
    API->>API: 신청 가능 여부 검증
    Note over API: 정원 체크, 중복 신청,<br/>조건 충족 여부

    alt 정원 초과
        API->>DB: 보결 순위 등록
        DB-->>API: 보결 등록 완료
        API-->>UI: 보결 대기 안내
    else 정원 내
        API->>DB: 수강신청 처리
        Note over DB: 트랜잭션으로 정원 증가
        DB-->>API: 신청 완료
        API-->>UI: 수강신청 성공
    end

    UI-->>Student: 신청 결과 안내
```

### **1.3 다중 강의 신청**

```mermaid
sequenceDiagram
    participant Student as 학생
    participant UI as 학생 UI
    participant API as 수강신청 API
    participant DB as 데이터베이스

    Student->>UI: 여러 강의 선택
    UI->>UI: 신청 목록 검증
    Note over UI: 시간 겹침은 학생 책임

    UI->>API: POST /api/student/enrollments/batch
    API->>API: 각 강의별 검증
    loop 각 강의
        API->>DB: 개별 신청 처리
        Note over DB: 성공/실패 분리 처리
    end

    DB-->>API: 배치 처리 결과
    API-->>UI: 개별 결과 표시
    Note over UI: 성공 강의 수, 실패 강의 목록

    UI-->>Student: 배치 신청 완료
```

### **1.4 수강신청 취소**

```mermaid
sequenceDiagram
    participant Student as 학생
    participant UI as 학생 UI
    participant API as 수강신청 API
    participant DB as 데이터베이스

    Student->>UI: 수강신청 취소 선택
    UI->>API: DELETE /api/student/enrollments/{id}
    API->>API: 취소 가능 기간 검증
    Note over API: 개강 전까지만 취소 가능

    API->>DB: 수강신청 취소 처리
    Note over DB: 정원 감소, 보결 승계

    DB-->>API: 취소 완료
    API-->>UI: 취소 성공
    UI-->>Student: 취소 완료 메시지
```

---

## 2. 학기 중 활동 플로우

### **2.1 내 수강 목록 조회**

```mermaid
sequenceDiagram
    participant Student as 학생
    participant UI as 학생 UI
    participant API as 수강 API (DTO)
    participant Controller as EnrollmentController
    participant Service as EnrollmentService
    participant DB as 데이터베이스

    Student->>UI: 내 강의 메뉴 선택
    UI->>API: GET /api/enrollments?studentIdx=6&page=0&size=10
    Note over UI: JWT 토큰에서 studentIdx 자동 추출

    API->>Controller: getEnrollments(studentIdx, lecIdx, page, size)
    Controller->>Service: 수강 데이터 조회
    Service->>DB: ENROLLMENT_EXTENDED_TBL 조회
    Note over DB: Lazy Loading: LecTbl, UserTbl JOIN

    DB-->>Service: EnrollmentExtendedTbl 엔티티
    Service-->>Controller: Page<EnrollmentExtendedTbl>
    
    Controller->>Controller: convertToDto()
    Note over Controller: Entity → EnrollmentDto 변환<br/>Lazy Loading 안전 처리<br/>교수 이름 조회 (USER_TBL)
    
    Controller->>DB: findByUserCode(lecProf)
    Note over DB: LEC_PROF(USER_CODE) → USER_NAME
    DB-->>Controller: 교수 정보 (UserTbl)
    
    Controller-->>API: Page<EnrollmentDto>
    API-->>UI: JSON 응답 (DTO 구조)
    Note over UI: lecTit, lecSerial, lecProf,<br/>lecProfName, studentName 등 포함

    UI-->>Student: 수강 강의 목록 표시
```

### **DTO 응답 구조**

```json
{
  "content": [
    {
      "enrollmentIdx": 1,
      "lecIdx": 101,
      "lecSerial": "CS101",
      "lecTit": "자바 프로그래밍",
      "lecProf": "PROF001",
      "lecProfName": "김교수",
      "lecPoint": 3,
      "lecTime": "월수 10:00-11:30",
      "studentIdx": 6,
      "studentCode": "2024001",
      "studentName": "홍길동",
      "enrollmentStatus": "ENROLLED",
      "enrollmentDate": "2024-09-01"
    }
  ],
  "totalElements": 5,
  "totalPages": 1,
  "size": 10,
  "number": 0
}
```

**주요 필드 설명**:
- `lecProf`: 교수 코드 (USER_CODE) - 예: "PROF001", "11"
- `lecProfName`: 교수 이름 (USER_NAME) - 예: "김교수", "굴림체"
- `studentCode`: 학번 (USER_CODE)
- `studentName`: 학생 이름 (USER_NAME)

### **2.2 강의 공지사항 확인**

```mermaid
sequenceDiagram
    participant Student as 학생
    participant UI as 학생 UI
    participant API as 공지 API
    participant DB as 데이터베이스

    Student->>UI: 공지사항 메뉴 선택
    UI->>API: GET /api/student/lectures/{id}/notices
    API->>DB: 강의 공지사항 조회
    Note over DB: 최신순 정렬, 중요 공지 우선

    DB-->>API: 공지사항 데이터
    API-->>UI: 공지사항 목록 표시

    Student->>UI: 공지사항 읽음
    UI->>API: PUT /api/student/notices/{id}/read
    API->>DB: 조회수 증가
    DB-->>API: 업데이트 완료

    Note over UI: 푸시 알림 수신 시 자동 표시
```

### **2.3 교수 채팅**

```mermaid
sequenceDiagram
    participant Student as 학생
    participant UI as 학생 UI
    participant Chat as 채팅 시스템
    participant DB as 데이터베이스

    Student->>UI: 교수 채팅 선택
    UI->>Chat: 채팅방 조회/생성
    Chat->>DB: 채팅방 확인
    DB-->>Chat: 채팅방 데이터

    Student->>UI: 메시지 입력
    UI->>Chat: 메시지 전송
    Chat->>DB: 메시지 저장
    DB-->>Chat: 저장 완료

    Chat->>UI: 메시지 전송 성공
    UI-->>Student: 메시지 전송 완료

    Note over Chat: 실시간 알림 발송
```

---

## 3. 출결 관리 플로우

### **3.1 출석 요청**

```mermaid
sequenceDiagram
    participant Student as 학생
    participant UI as 학생 UI
    participant API as 출결 API
    participant DB as 데이터베이스
    participant Professor as 교수 시스템

    Student->>UI: 출석 메뉴 선택
    UI->>UI: 출석 요청 폼 표시

    Student->>UI: 출석 요청
    UI->>API: POST /api/student/attendance/request
    API->>API: 요청 검증
    Note over API: 시간대 확인, 중복 요청 체크

    API->>DB: 출석 요청 저장
    DB-->>API: 저장 완료

    API->>Professor: 출석 요청 알림
    Professor-->>API: 알림 확인

    API-->>UI: 출석 요청 성공
    UI-->>Student: 요청 완료 메시지
```

### **3.2 출석 현황 조회**

```mermaid
sequenceDiagram
    participant Student as 학생
    participant UI as 학생 UI
    participant API as 출결 API
    participant DB as 데이터베이스

    Student->>UI: 출석 현황 조회
    UI->>API: GET /api/student/enrollments/{id}/attendance
    API->>DB: 출석 기록 조회
    Note over DB: 날짜별 출석 상태,<br/>출석률 계산

    DB-->>API: 출석 데이터
    API-->>UI: 출석 현황 표시
    Note over UI: 출석/지각/결석/공결 구분,<br/>누적 출석률 표시

    UI-->>Student: 출석 현황 확인
```

---

## 4. 과제 관리 플로우

### **4.1 과제 목록 조회**

```mermaid
sequenceDiagram
    participant Student as 학생
    participant UI as 학생 UI
    participant API as 과제 API
    participant DB as 데이터베이스

    Student->>UI: 과제 메뉴 선택
    UI->>API: GET /api/student/lectures/{id}/assignments
    API->>DB: 과제 목록 조회
    Note over DB: 마감일, 제출 상태, 점수 등

    DB-->>API: 과제 데이터
    API-->>UI: 과제 목록 표시
    UI-->>Student: 과제 목록 확인
```

### **4.2 과제 제출**

```mermaid
sequenceDiagram
    participant Student as 학생
    participant UI as 학생 UI
    participant API as 과제 API
    participant DB as 데이터베이스

    Student->>UI: 과제 제출 선택
    UI->>UI: 제출 폼 표시

    Student->>UI: 과제 내용 및 파일 첨부
    UI->>API: POST /api/student/assignments/{id}/submit
    API->>API: 제출 검증
    Note over API: 마감일 확인, 파일 크기 등

    API->>DB: 제출물 저장
    DB-->>API: 저장 완료

    API-->>UI: 제출 성공
    UI-->>Student: 과제 제출 완료
```

### **4.3 과제 결과 확인**

```mermaid
sequenceDiagram
    participant Student as 학생
    participant UI as 학생 UI
    participant API as 과제 API
    participant DB as 데이터베이스

    Student->>UI: 채점 결과 조회
    UI->>API: GET /api/student/submissions/{id}
    API->>DB: 채점 결과 조회
    Note over DB: 점수, 피드백, 채점일

    DB-->>API: 채점 데이터
    API-->>UI: 채점 결과 표시
    UI-->>Student: 과제 결과 확인
```

---

## 5. 강의 평가 플로우

### **5.1 평가 가능 강의 조회**

```mermaid
sequenceDiagram
    participant Student as 학생
    participant UI as 학생 UI
    participant API as 평가 API
    participant DB as 데이터베이스

    Student->>UI: 강의 평가 메뉴 선택
    UI->>API: GET /api/student/evaluations/available
    API->>DB: 평가 가능 강의 조회
    Note over DB: 종강 후 1주일 이내,<br/>미평가 강의만

    DB-->>API: 평가 가능 강의
    API-->>UI: 평가 가능 강의 목록 표시
    UI-->>Student: 평가 대상 강의 확인
```

### **5.2 강의 평가 제출**

```mermaid
sequenceDiagram
    participant Student as 학생
    participant UI as 학생 UI
    participant API as 평가 API
    participant DB as 데이터베이스

    Student->>UI: 강의 평가 선택
    UI->>API: GET /api/student/lectures/{id}/evaluation-form
    API->>DB: 평가 항목 조회
    DB-->>API: 평가 양식 데이터
    API-->>UI: 평가 폼 표시

    Student->>UI: 평가 점수 및 의견 입력
    Note over UI: 1~5점 선택, 의견 작성

    UI->>API: POST /api/student/lectures/{id}/evaluations
    API->>API: 평가 검증
    API->>DB: 평가 저장
    DB-->>API: 저장 완료

    API-->>UI: 평가 제출 성공
    UI-->>Student: 평가 완료 메시지
```

---

## 📋 학생 주요 업무 프로세스

### **수강신청 기간**
1. **강의 탐색**: 관심 강의 검색 및 상세 정보 확인
2. **신청 계획**: 시간표 고려하여 우선순위 결정
3. **신청 실행**: 개별 또는 다중 신청 처리
4. **결과 확인**: 성공/실패 및 보결 순위 확인

### **학기 중 활동**
1. **출석 관리**: 
   - 매 강의시간 출석 요청
   - 강의 시간표: `월1월2수3수4` 형식 (예: 월요일 1,2교시, 수요일 3,4교시)
2. **공지 확인**: 교수 공지사항 및 중요 알림 확인
3. **과제 수행**: 과제 제출 및 결과 확인
4. **상담 활용**: 필요시 교수와 채팅 상담

### **학기 말 정리**
1. **강의 평가**: 수강한 모든 강의 평가 제출
2. **성적 확인**: 최종 성적 및 학점 확인
3. **피드백 활용**: 다음 학기 수강 계획 수립

---

## 🎯 다음 단계

학생 플로우를 정의했으니 [구현 순서](./07-구현순서.md)에서 개발 단계별 구현 계획을 수립합니다.
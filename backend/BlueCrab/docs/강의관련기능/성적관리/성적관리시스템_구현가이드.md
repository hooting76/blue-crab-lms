# ğŸ“Š Blue Crab LMS ì„±ì  ê´€ë¦¬ ì‹œìŠ¤í…œ êµ¬í˜„ ê°€ì´ë“œ

> **ì‘ì„±ì¼**: 2025-10-18  
> **ëª©ì **: JSON ê¸°ë°˜ ì„±ì  ê´€ë¦¬ ì‹œìŠ¤í…œ êµ¬í˜„ ë° ê°œë°œ ê°€ì´ë“œ  
> **ëŒ€ìƒ**: ë°±ì—”ë“œ ê°œë°œì

---

## ğŸ“‹ ê°œìš”

Blue Crab LMSì˜ ì„±ì  ê´€ë¦¬ ì‹œìŠ¤í…œì€ **ENROLLMENT_EXTENDED_TBLì˜ ENROLLMENT_DATA (JSON ì»¬ëŸ¼)**ì„ í™œìš©í•˜ì—¬ ìœ ì—°í•˜ê³  í™•ì¥ ê°€ëŠ¥í•œ ì„±ì  ê´€ë¦¬ë¥¼ ì œê³µí•©ë‹ˆë‹¤.

### ğŸ¯ ì„¤ê³„ ì›ì¹™
1. **JSON ê¸°ë°˜ ì €ì¥**: ìœ ì—°í•œ ë°ì´í„° êµ¬ì¡°ë¡œ í™•ì¥ì„± í™•ë³´
2. **ì‹¤ì‹œê°„ ìë™ ê³„ì‚°**: ì¶œì„, ê³¼ì œ ì ìˆ˜ ìë™ ì§‘ê³„
3. **POST ë°©ì‹ í†µì¼**: ê¸°ì¡´ ì‹œìŠ¤í…œê³¼ì˜ ì¼ê´€ì„± ìœ ì§€
4. **ë°±ë¶„ìœ„ ë“±ê¸‰ ë°°ì •**: ìƒëŒ€í‰ê°€ ê¸°ì¤€ ë“±ê¸‰ ì‚°ì¶œ

---

## ğŸ—ƒï¸ ë°ì´í„° êµ¬ì¡°

### ENROLLMENT_DATA JSON ìŠ¤í‚¤ë§ˆ

```json
{
  "grade": {
    "attendance": {
      "maxScore": 20,
      "currentScore": 18.5,
      "rate": 92.5
    },
    "assignments": [
      {
        "name": "ê³¼ì œ1",
        "score": 9,
        "maxScore": 10
      },
      {
        "name": "ì¤‘ê°„ê³ ì‚¬",
        "score": 85,
        "maxScore": 100
      },
      {
        "name": "ê¸°ë§ê³ ì‚¬",
        "score": 92,
        "maxScore": 100
      }
    ],
    "total": {
      "score": 204.5,
      "maxScore": 230,
      "percentage": 88.9
    },
    "letterGrade": "A"
  }
}
```

### ë°ì´í„° êµ¬ì„± ìš”ì†Œ

| êµ¬ë¶„ | ì„¤ëª… | ê³„ì‚° ë°©ì‹ |
|------|------|-----------|
| **ì¶œì„ ì ìˆ˜** | ì¶œì„ìœ¨ ê¸°ë°˜ ìë™ ê³„ì‚° | `ì¶œì„ìœ¨ Ã— ì§€ì • ë§Œì ` |
| **ê³¼ì œ ì ìˆ˜** | ê°œë³„ ê³¼ì œë³„ ì ìˆ˜ ê´€ë¦¬ | `ASSIGNMENT_TBL`ì—ì„œ ì§‘ê³„ |
| **ì¤‘ê°„/ê¸°ë§ê³ ì‚¬** | ê³¼ì œì˜ íŠ¹ìˆ˜ í˜•íƒœ | ê³¼ì œëª…ìœ¼ë¡œ êµ¬ë¶„ |
| **í•©ê³„ ì ìˆ˜** | ì „ì²´ ì ìˆ˜ ì´í•© | ì‹¤ì‹œê°„ ìë™ ê³„ì‚° |
| **ë“±ê¸‰** | ë°±ë¶„ìœ„ ê¸°ì¤€ ë“±ê¸‰ | A, B, C, D, F |

---

## ğŸ”§ API ì„¤ê³„

### 1. ì„±ì  êµ¬ì„± ì„¤ì •

**ì—”ë“œí¬ì¸íŠ¸**: `POST /api/enrollments/grade-config`

```javascript
// ìš”ì²­ ì˜ˆì‹œ
{
  "lecIdx": 1,
  "attendanceMaxScore": 20,
  "assignmentTotalScore": 50,
  "examTotalScore": 30,
  "gradeDistribution": {
    "A": 30,  // ìƒìœ„ 30%
    "B": 40,  // 30~70%
    "C": 20,  // 70~90%
    "D": 10   // ë‚˜ë¨¸ì§€
  },
  "action": "set-config"
}

// ì‘ë‹µ ì˜ˆì‹œ
{
  "success": true,
  "message": "ì„±ì  êµ¬ì„±ì´ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.",
  "data": {
    "lecIdx": 1,
    "gradeConfig": { ... }
  }
}
```

### 2. ê°œë³„ ì„±ì  ì¡°íšŒ

**ì—”ë“œí¬ì¸íŠ¸**: `POST /api/enrollments/grade-info`

```javascript
// ìš”ì²­ ì˜ˆì‹œ (í•™ìƒ ë³¸ì¸ ì¡°íšŒ)
{
  "lecIdx": 1,
  "studentIdx": 100,
  "action": "get-grade"
}

// ìš”ì²­ ì˜ˆì‹œ (êµìˆ˜ìš© ì¡°íšŒ)
{
  "lecIdx": 1,
  "studentIdx": 100,
  "professorIdx": 22,
  "action": "professor-view"
}

// ì‘ë‹µ ì˜ˆì‹œ
{
  "success": true,
  "data": {
    "studentInfo": {
      "studentIdx": 100,
      "studentName": "í™ê¸¸ë™",
      "studentId": "STU001"
    },
    "grade": {
      "attendance": {
        "maxScore": 20,
        "currentScore": 18.5,
        "rate": 92.5
      },
      "assignments": [ ... ],
      "total": {
        "score": 204.5,
        "maxScore": 230,
        "percentage": 88.9
      },
      "letterGrade": "A",
      "rank": 3,
      "totalStudents": 45
    }
  }
}
```

### 3. ì „ì²´ ìˆ˜ê°•ìƒ ì„±ì  ëª©ë¡

**ì—”ë“œí¬ì¸íŠ¸**: `POST /api/enrollments/grade-list`

```javascript
// ìš”ì²­ ì˜ˆì‹œ
{
  "lecIdx": 1,
  "page": 0,
  "size": 20,
  "sortBy": "percentage",  // percentage, name, studentId
  "sortOrder": "desc",     // asc, desc
  "action": "list-all"
}

// ì‘ë‹µ ì˜ˆì‹œ
{
  "success": true,
  "data": {
    "content": [
      {
        "studentIdx": 100,
        "studentName": "í™ê¸¸ë™",
        "studentId": "STU001",
        "attendance": { ... },
        "assignments": [ ... ],
        "total": { ... },
        "letterGrade": "A",
        "rank": 1
      }
    ],
    "totalElements": 45,
    "totalPages": 3,
    "currentPage": 0
  }
}
```

### 4. ìµœì¢… ë“±ê¸‰ ë°°ì •

**ì—”ë“œí¬ì¸íŠ¸**: `POST /api/enrollments/grade-finalize`

```javascript
// ìš”ì²­ ì˜ˆì‹œ
{
  "lecIdx": 1,
  "gradeDistribution": {
    "A": 30,
    "B": 40,
    "C": 20,
    "D": 10
  },
  "action": "finalize"
}

// ì‘ë‹µ ì˜ˆì‹œ
{
  "success": true,
  "message": "ìµœì¢… ë“±ê¸‰ì´ ë°°ì •ë˜ì—ˆìŠµë‹ˆë‹¤.",
  "data": {
    "gradeStats": {
      "A": 14,  // 14ëª…
      "B": 18,  // 18ëª…
      "C": 9,   // 9ëª…
      "D": 4,   // 4ëª…
      "F": 0    // 0ëª…
    },
    "totalStudents": 45
  }
}
```

---

## ğŸ—ï¸ ë°±ì—”ë“œ êµ¬í˜„

### EnrollmentController í™•ì¥

```java
@RestController
@RequestMapping("/api/enrollments")
public class EnrollmentController {

    @Autowired
    private EnrollmentService enrollmentService;

    @PostMapping("/grade-config")
    public ResponseEntity<?> setGradeConfig(@RequestBody Map<String, Object> request) {
        try {
            String action = (String) request.get("action");
            
            if ("set-config".equals(action)) {
                return handleGradeConfig(request);
            }
            
            return ResponseEntity.badRequest()
                .body(createErrorResponse("ì§€ì›í•˜ì§€ ì•ŠëŠ” ì•¡ì…˜ì…ë‹ˆë‹¤."));
                
        } catch (Exception e) {
            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR)
                .body(createErrorResponse("ì„±ì  êµ¬ì„± ì„¤ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."));
        }
    }

    @PostMapping("/grade-info")
    public ResponseEntity<?> getGradeInfo(@RequestBody Map<String, Object> request) {
        try {
            String action = (String) request.get("action");
            
            switch (action) {
                case "get-grade":
                    return handleStudentGradeInfo(request);
                case "professor-view":
                    return handleProfessorGradeView(request);
                default:
                    return ResponseEntity.badRequest()
                        .body(createErrorResponse("ì§€ì›í•˜ì§€ ì•ŠëŠ” ì•¡ì…˜ì…ë‹ˆë‹¤."));
            }
            
        } catch (Exception e) {
            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR)
                .body(createErrorResponse("ì„±ì  ì¡°íšŒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."));
        }
    }

    @PostMapping("/grade-list")
    public ResponseEntity<?> getGradeList(@RequestBody Map<String, Object> request) {
        try {
            String action = (String) request.get("action");
            
            if ("list-all".equals(action)) {
                return handleGradeList(request);
            }
            
            return ResponseEntity.badRequest()
                .body(createErrorResponse("ì§€ì›í•˜ì§€ ì•ŠëŠ” ì•¡ì…˜ì…ë‹ˆë‹¤."));
                
        } catch (Exception e) {
            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR)
                .body(createErrorResponse("ì„±ì  ëª©ë¡ ì¡°íšŒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."));
        }
    }

    @PostMapping("/grade-finalize")
    public ResponseEntity<?> finalizeGrades(@RequestBody Map<String, Object> request) {
        try {
            String action = (String) request.get("action");
            
            if ("finalize".equals(action)) {
                return handleGradeFinalize(request);
            }
            
            return ResponseEntity.badRequest()
                .body(createErrorResponse("ì§€ì›í•˜ì§€ ì•ŠëŠ” ì•¡ì…˜ì…ë‹ˆë‹¤."));
                
        } catch (Exception e) {
            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR)
                .body(createErrorResponse("ë“±ê¸‰ ë°°ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."));
        }
    }
}
```

### EnrollmentService êµ¬í˜„

```java
@Service
@Transactional
public class EnrollmentService {

    @Autowired
    private EnrollmentExtendedRepository enrollmentExtendedRepository;
    
    @Autowired
    private AttendanceRepository attendanceRepository;
    
    @Autowired
    private AssignmentRepository assignmentRepository;

    /**
     * ì„±ì  êµ¬ì„± ì„¤ì •
     */
    public ResponseEntity<?> setGradeConfig(Map<String, Object> request) {
        Integer lecIdx = (Integer) request.get("lecIdx");
        
        // ê°•ì˜ë³„ ì„±ì  êµ¬ì„± ì„¤ì • ë¡œì§
        // ENROLLMENT_DATA JSON ì—…ë°ì´íŠ¸
        
        return ResponseEntity.ok(createSuccessResponse("ì„±ì  êµ¬ì„±ì´ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤."));
    }

    /**
     * ê°œë³„ í•™ìƒ ì„±ì  ê³„ì‚° ë° ì¡°íšŒ
     */
    public ResponseEntity<?> getStudentGradeInfo(Map<String, Object> request) {
        Integer lecIdx = (Integer) request.get("lecIdx");
        Integer studentIdx = (Integer) request.get("studentIdx");
        
        // 1. ì¶œì„ ì ìˆ˜ ê³„ì‚°
        Double attendanceScore = calculateAttendanceScore(lecIdx, studentIdx);
        
        // 2. ê³¼ì œ ì ìˆ˜ ì§‘ê³„
        List<AssignmentScore> assignmentScores = calculateAssignmentScores(lecIdx, studentIdx);
        
        // 3. ì´ì  ê³„ì‚°
        GradeInfo gradeInfo = calculateTotalScore(attendanceScore, assignmentScores);
        
        // 4. ENROLLMENT_DATA ì—…ë°ì´íŠ¸
        updateEnrollmentGradeData(lecIdx, studentIdx, gradeInfo);
        
        return ResponseEntity.ok(createSuccessResponse(gradeInfo));
    }

    /**
     * ì¶œì„ ì ìˆ˜ ê³„ì‚°
     */
    private Double calculateAttendanceScore(Integer lecIdx, Integer studentIdx) {
        // ATTENDANCE_TBLì—ì„œ ì¶œì„ìœ¨ ê³„ì‚°
        // ì¶œì„ìœ¨ Ã— ì§€ì • ë§Œì  = ì¶œì„ ì ìˆ˜
        return attendanceRepository.calculateAttendanceScore(lecIdx, studentIdx);
    }

    /**
     * ê³¼ì œ ì ìˆ˜ ì§‘ê³„
     */
    private List<AssignmentScore> calculateAssignmentScores(Integer lecIdx, Integer studentIdx) {
        // ASSIGNMENT_TBLì—ì„œ í•´ë‹¹ ê°•ì˜ì˜ ëª¨ë“  ê³¼ì œ ì ìˆ˜ ì¡°íšŒ
        return assignmentRepository.getStudentAssignmentScores(lecIdx, studentIdx);
    }

    /**
     * ìµœì¢… ë“±ê¸‰ ë°°ì • (ë°±ë¶„ìœ„ ê¸°ë°˜)
     */
    public ResponseEntity<?> finalizeGrades(Map<String, Object> request) {
        Integer lecIdx = (Integer) request.get("lecIdx");
        Map<String, Integer> gradeDistribution = (Map<String, Integer>) request.get("gradeDistribution");
        
        // 1. ì „ì²´ ìˆ˜ê°•ìƒ ì„±ì  ì¡°íšŒ
        List<StudentGrade> allGrades = getAllStudentGrades(lecIdx);
        
        // 2. ì„±ì ìˆœ ì •ë ¬
        allGrades.sort((a, b) -> Double.compare(b.getPercentage(), a.getPercentage()));
        
        // 3. ë°±ë¶„ìœ„ ê¸°ì¤€ ë“±ê¸‰ ë°°ì •
        assignLetterGrades(allGrades, gradeDistribution);
        
        // 4. ENROLLMENT_DATA ì—…ë°ì´íŠ¸
        updateFinalGrades(allGrades);
        
        return ResponseEntity.ok(createSuccessResponse("ë“±ê¸‰ ë°°ì •ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤."));
    }
}
```

---

## ğŸ“ ì„±ì  ê´€ë¦¬ í”„ë¡œì„¸ìŠ¤

### 1ï¸âƒ£ ì„±ì  êµ¬ì„± ì„¤ì •
- êµìˆ˜ê°€ ê°•ì˜ë³„ ì„±ì  ë¹„ìœ¨ ì„¤ì •
- ì¶œì„, ê³¼ì œ, ì‹œí—˜ ë°°ì  ê²°ì •
- ë“±ê¸‰ ë¶„í¬ ê¸°ì¤€ ì„¤ì •

### 2ï¸âƒ£ ì¶œì„/ê³¼ì œ ì ìˆ˜ ì…ë ¥
- ì¶œì„ ì ìˆ˜: ATTENDANCE_TBLì—ì„œ ìë™ ê³„ì‚°
- ê³¼ì œ ì ìˆ˜: ASSIGNMENT_TBLì—ì„œ ìë™ ì§‘ê³„
- ì‹¤ì‹œê°„ ë°˜ì˜ ë° ì—…ë°ì´íŠ¸

### 3ï¸âƒ£ ì‹¤ì‹œê°„ í•©ê³„ ê³„ì‚°
- JSON ë°ì´í„° ìë™ ì—…ë°ì´íŠ¸
- ë°±ë¶„ìœ¨ ê³„ì‚°
- ìˆœìœ„ ì‚°ì •

### 4ï¸âƒ£ ìµœì¢… ë“±ê¸‰ ë°°ì •
- ë°±ë¶„ìœ„ ê¸°ì¤€ ë“±ê¸‰ ë°°ì •
- A, B, C, D, F ë“±ê¸‰ ë¶€ì—¬
- ìµœì¢… ì„±ì  í™•ì •

---

## âœ¨ ì£¼ìš” íŠ¹ì§•

### ğŸ”„ ì‹¤ì‹œê°„ ìë™ ê³„ì‚°
- ì¶œì„, ê³¼ì œ ì…ë ¥ ì‹œ ì¦‰ì‹œ ë°˜ì˜
- JSON ê¸°ë°˜ íš¨ìœ¨ì  ì—…ë°ì´íŠ¸
- ì„±ëŠ¥ ìµœì í™”ëœ ê³„ì‚° ë¡œì§

### ğŸ“Š JSON ê¸°ë°˜ ìœ ì—°ì„±
- í™•ì¥ ê°€ëŠ¥í•œ ë°ì´í„° êµ¬ì¡°
- ë™ì  ì„±ì  êµ¬ì„± ì§€ì›
- ë³µì¡í•œ ê³„ì‚° ë¡œì§ ë‹¨ìˆœí™”

### ğŸ¯ ë°±ë¶„ìœ„ ë“±ê¸‰ ë°°ì •
- ìƒëŒ€í‰ê°€ ê¸°ì¤€ ë“±ê¸‰ ì‚°ì¶œ
- ìœ ì—°í•œ ë“±ê¸‰ ë¶„í¬ ì„¤ì •
- ê³µì •í•œ ì„±ì  í‰ê°€ ë³´ì¥

### ğŸ‘¨â€ğŸ« êµìˆ˜ ì „ìš© ê´€ë¦¬
- êµìˆ˜ë³„ ê¶Œí•œ ê´€ë¦¬
- ê°•ì˜ë³„ ë…ë¦½ì  ì„±ì  ê´€ë¦¬
- ì§ê´€ì ì¸ ì¸í„°í˜ì´ìŠ¤ ì œê³µ

---

## ğŸ”§ ê°œë°œ ìš°ì„ ìˆœìœ„

### 1ë‹¨ê³„: í•µì‹¬ ì„±ì  ê´€ë¦¬ (2ì£¼)
- âœ… EnrollmentController í™•ì¥
- âœ… ì„±ì  êµ¬ì„± ì„¤ì • API
- âœ… ê°œë³„ ì„±ì  ì¡°íšŒ API
- âœ… ìë™ ê³„ì‚° ë¡œì§ êµ¬í˜„

### 2ë‹¨ê³„: ê³ ê¸‰ ê¸°ëŠ¥ (1ì£¼)
- âœ… ì „ì²´ ì„±ì  ëª©ë¡ API
- âœ… ìµœì¢… ë“±ê¸‰ ë°°ì • API
- âœ… ë°±ë¶„ìœ„ ê³„ì‚° ë¡œì§

### 3ë‹¨ê³„: ìµœì í™” (1ì£¼)
- âœ… ì„±ëŠ¥ ìµœì í™”
- âœ… ì˜¤ë¥˜ ì²˜ë¦¬ ê°•í™”
- âœ… í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„±

---

## ğŸ“‹ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ë°±ì—”ë“œ êµ¬í˜„
- [ ] EnrollmentController í™•ì¥
- [ ] EnrollmentService êµ¬í˜„  
- [ ] JSON ë°ì´í„° ì²˜ë¦¬ ë¡œì§
- [ ] ì„±ì  ê³„ì‚° ì•Œê³ ë¦¬ì¦˜
- [ ] ë°±ë¶„ìœ„ ë“±ê¸‰ ë°°ì • ë¡œì§
- [ ] ì˜¤ë¥˜ ì²˜ë¦¬ ë° ê²€ì¦

### ë°ì´í„°ë² ì´ìŠ¤
- [ ] ENROLLMENT_EXTENDED_TBL í™œìš©
- [ ] JSON ìŠ¤í‚¤ë§ˆ ì •ì˜
- [ ] ì¸ë±ìŠ¤ ìµœì í™”
- [ ] ì„±ëŠ¥ íŠœë‹

### í…ŒìŠ¤íŠ¸
- [ ] ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‘ì„±
- [ ] í†µí•© í…ŒìŠ¤íŠ¸ ì‘ì„±  
- [ ] ë¸Œë¼ìš°ì € ì½˜ì†” í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸
- [ ] ì„±ëŠ¥ í…ŒìŠ¤íŠ¸

---

## ğŸ¯ ê²°ë¡ 

JSON ê¸°ë°˜ ì„±ì  ê´€ë¦¬ ì‹œìŠ¤í…œì„ í†µí•´:

âœ… **ìœ ì—°ì„±**: ë™ì  ì„±ì  êµ¬ì„± ë° í™•ì¥ ê°€ëŠ¥  
âœ… **íš¨ìœ¨ì„±**: ì‹¤ì‹œê°„ ìë™ ê³„ì‚°ìœ¼ë¡œ ê´€ë¦¬ ë¶€ë‹´ ê°ì†Œ  
âœ… **ê³µì •ì„±**: ë°±ë¶„ìœ„ ê¸°ì¤€ ê°ê´€ì  ë“±ê¸‰ ë°°ì •  
âœ… **ì¼ê´€ì„±**: ê¸°ì¡´ POST ë°©ì‹ê³¼ í†µí•©ëœ ì„¤ê³„  

**ë‹¤ìŒ ë‹¨ê³„**: EnrollmentController í™•ì¥ ê°œë°œ ì‹œì‘

---

> **ì°¸ê³  ë¬¸ì„œ**  
> - [ì„±ì ê´€ë¦¬ì‹œìŠ¤í…œ_ì„¤ê³„ì•ˆ_ìˆ˜ì •.drawio](./ì„±ì ê´€ë¦¬ì‹œìŠ¤í…œ_ì„¤ê³„ì•ˆ_ìˆ˜ì •.drawio)  
> - [ë¯¸êµ¬í˜„ê¸°ëŠ¥_POSTë°©ì‹_í†µì¼ê°€ì´ë“œ.md](../ë¯¸êµ¬í˜„ê¸°ëŠ¥_POSTë°©ì‹_í†µì¼ê°€ì´ë“œ.md)
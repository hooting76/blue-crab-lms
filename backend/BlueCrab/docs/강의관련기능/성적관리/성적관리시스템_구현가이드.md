# ğŸ“Š Blue Crab LMS ì„±ì  ê´€ë¦¬ ì‹œìŠ¤í…œ êµ¬í˜„ ê°€ì´ë“œ

> **ì‘ì„±ì¼**: 2025-10-18  
> **ëª©ì **: JSON ê¸°ë°˜ ì„±ì  ê´€ë¦¬ ì‹œìŠ¤í…œ êµ¬í˜„ ë° ê°œë°œ ê°€ì´ë“œ  
> **ëŒ€ìƒ**: ë°±ì—”ë“œ ê°œë°œì

---

## ğŸ“‹ ê°œìš”

Blue Crab LMSì˜ ì„±ì  ê´€ë¦¬ ì‹œìŠ¤í…œì€ **ENROLLMENT_EXTENDED_TBLì˜ ENROLLMENT_DATA (JSON ì»¬ëŸ¼)**ì„ í™œìš©í•˜ì—¬ ìœ ì—°í•˜ê³  í™•ì¥ ê°€ëŠ¥í•œ ì„±ì  ê´€ë¦¬ë¥¼ ì œê³µí•©ë‹ˆë‹¤.

### ğŸ¯ ì„¤ê³„ ì›ì¹™
1. **JSON ê¸°ë°˜ ì €ì¥**: ìœ ì—°í•œ ë°ì´í„° êµ¬ì¡°ë¡œ í™•ì¥ì„± í™•ë³´
2. **ì´ë²¤íŠ¸ ê¸°ë°˜ ìë™ ê³„ì‚°**: ì¶œì„, ê³¼ì œ ì ìˆ˜ ë³€ê²½ ì‹œ ìë™ ì§‘ê³„
3. **POST ë°©ì‹ í†µì¼**: ê¸°ì¡´ ì‹œìŠ¤í…œê³¼ì˜ ì¼ê´€ì„± ìœ ì§€
4. **ë°±ë¶„ìœ„ ë“±ê¸‰ ë°°ì •**: ìƒëŒ€í‰ê°€ ê¸°ì¤€ ë“±ê¸‰ ì‚°ì¶œ

---

## ğŸ—ƒï¸ ë°ì´í„° êµ¬ì¡°

### ENROLLMENT_DATA JSON ìŠ¤í‚¤ë§ˆ

```json
{
  "grade": {
    "attendance": {
      "maxScore": 20,
      "currentScore": 18.5,
      "rate": 92.5
    },
    "assignments": [
      {
        "name": "ê³¼ì œ1",
        "score": 9,
        "maxScore": 10
      },
      {
        "name": "ì¤‘ê°„ê³ ì‚¬",
        "score": 85,
        "maxScore": 100
      },
      {
        "name": "ê¸°ë§ê³ ì‚¬",
        "score": 92,
        "maxScore": 100
      }
    ],
    "total": {
      "score": 204.5,
      "maxScore": 230,
      "percentage": 88.9
    },
    "letterGrade": "A"
  }
}
```

### ë°ì´í„° êµ¬ì„± ìš”ì†Œ

| êµ¬ë¶„ | ì„¤ëª… | ê³„ì‚° ë°©ì‹ |
|------|------|-----------|
| **ì¶œì„ ì ìˆ˜** | ì¶œì„ìœ¨ ê¸°ë°˜ ìë™ ê³„ì‚° | `ì¶œì„ìœ¨ Ã— ì§€ì • ë§Œì ` |
| **ê³¼ì œ ì ìˆ˜** | ê°œë³„ ê³¼ì œë³„ ì ìˆ˜ ê´€ë¦¬ | `ASSIGNMENT_TBL`ì—ì„œ ì§‘ê³„ |
| **ì¤‘ê°„/ê¸°ë§ê³ ì‚¬** | ê³¼ì œì˜ íŠ¹ìˆ˜ í˜•íƒœ | ê³¼ì œëª…ìœ¼ë¡œ êµ¬ë¶„ |
| **í•©ê³„ ì ìˆ˜** | ì „ì²´ ì ìˆ˜ ì´í•© | ì´ë²¤íŠ¸ ê¸°ë°˜ ìë™ ê³„ì‚° |
| **ë“±ê¸‰** | ë°±ë¶„ìœ„ ê¸°ì¤€ ë“±ê¸‰ | A, B, C, D, F |

---

## ğŸ”§ API ì„¤ê³„

### 1. ì„±ì  êµ¬ì„± ì„¤ì •

**ì—”ë“œí¬ì¸íŠ¸**: `POST /api/enrollments/grade-config`

```javascript
// ìš”ì²­ ì˜ˆì‹œ
{
  "lecIdx": 1,
  "attendanceMaxScore": 20,
  "assignmentTotalScore": 50,
  "examTotalScore": 30,
  "gradeDistribution": {
    "A": 30,  // ìƒìœ„ 30%
    "B": 40,  // 30~70%
    "C": 20,  // 70~90%
    "D": 10   // ë‚˜ë¨¸ì§€
  },
  "action": "set-config"
}

// ì‘ë‹µ ì˜ˆì‹œ
{
  "success": true,
  "message": "ì„±ì  êµ¬ì„±ì´ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.",
  "data": {
    "lecIdx": 1,
    "gradeConfig": { ... }
  }
}
```

### 2. ê°œë³„ ì„±ì  ì¡°íšŒ

**ì—”ë“œí¬ì¸íŠ¸**: `POST /api/enrollments/grade-info`

```javascript
// ìš”ì²­ ì˜ˆì‹œ (í•™ìƒ ë³¸ì¸ ì¡°íšŒ)
{
  "lecIdx": 1,
  "studentIdx": 100,
  "action": "get-grade"
}

// ìš”ì²­ ì˜ˆì‹œ (êµìˆ˜ìš© ì¡°íšŒ)
{
  "lecIdx": 1,
  "studentIdx": 100,
  "professorIdx": 22,
  "action": "professor-view"
}

// ì‘ë‹µ ì˜ˆì‹œ
{
  "success": true,
  "data": {
    "studentInfo": {
      "studentIdx": 100,
      "studentName": "í™ê¸¸ë™",
      "studentId": "STU001"
    },
    "grade": {
      "attendance": {
        "maxScore": 20,
        "currentScore": 18.5,
        "rate": 92.5
      },
      "assignments": [ ... ],
      "total": {
        "score": 204.5,
        "maxScore": 230,
        "percentage": 88.9
      },
      "letterGrade": "A",
      "rank": 3,
      "totalStudents": 45
    }
  }
}
```

### 3. ì „ì²´ ìˆ˜ê°•ìƒ ì„±ì  ëª©ë¡

**ì—”ë“œí¬ì¸íŠ¸**: `POST /api/enrollments/grade-list`

```javascript
// ìš”ì²­ ì˜ˆì‹œ
{
  "lecIdx": 1,
  "page": 0,
  "size": 20,
  "sortBy": "percentage",  // percentage, name, studentId
  "sortOrder": "desc",     // asc, desc
  "action": "list-all"
}

// ì‘ë‹µ ì˜ˆì‹œ
{
  "success": true,
  "data": {
    "content": [
      {
        "studentIdx": 100,
        "studentName": "í™ê¸¸ë™",
        "studentId": "STU001",
        "attendance": { ... },
        "assignments": [ ... ],
        "total": { ... },
        "letterGrade": "A",
        "rank": 1
      }
    ],
    "totalElements": 45,
    "totalPages": 3,
    "currentPage": 0
  }
}
```

### 4. ìµœì¢… ë“±ê¸‰ ë°°ì •

**ì—”ë“œí¬ì¸íŠ¸**: `POST /api/enrollments/grade-finalize`

```javascript
// ìš”ì²­ ì˜ˆì‹œ
{
  "lecIdx": 1,
  "passingThreshold": 60,  // í•©ê²© ê¸°ì¤€ (60%)
  "gradeDistribution": {
    "A": 30,  // í•©ê²©ì ì¤‘ ìƒìœ„ 30%
    "B": 40,  // í•©ê²©ì ì¤‘ 30~70%
    "C": 20,  // í•©ê²©ì ì¤‘ 70~90%
    "D": 10   // í•©ê²©ì ì¤‘ ë‚˜ë¨¸ì§€ 10%
  },
  "action": "finalize"
}

// ì‘ë‹µ ì˜ˆì‹œ
{
  "success": true,
  "message": "ìµœì¢… ë“±ê¸‰ì´ ë°°ì •ë˜ì—ˆìŠµë‹ˆë‹¤.",
  "data": {
    "gradeStats": {
      "A": 2,   // 2ëª… (í•©ê²©ì ì¤‘ ìƒìœ„)
      "B": 0,   // 0ëª…
      "C": 0,   // 0ëª…  
      "D": 0,   // 0ëª…
      "F": 18   // 18ëª… (60% ë¯¸ë§Œ + ì¤‘ë„í¬ê¸°)
    },
    "totalStudents": 20,
    "passingStudents": 2,    // í•©ê²©ì ìˆ˜
    "failingStudents": 18,   // ë‚™ì œì ìˆ˜
    "averageScore": 45.2     // ì „ì²´ í‰ê· 
  }
}
```

---

## ğŸ—ï¸ ë°±ì—”ë“œ êµ¬í˜„

### EnrollmentController í™•ì¥

```java
@RestController
@RequestMapping("/api/enrollments")
public class EnrollmentController {

    @Autowired
    private EnrollmentService enrollmentService;

    @PostMapping("/grade-config")
    public ResponseEntity<?> setGradeConfig(@RequestBody Map<String, Object> request) {
        try {
            String action = (String) request.get("action");
            
            if ("set-config".equals(action)) {
                return handleGradeConfig(request);
            }
            
            return ResponseEntity.badRequest()
                .body(createErrorResponse("ì§€ì›í•˜ì§€ ì•ŠëŠ” ì•¡ì…˜ì…ë‹ˆë‹¤."));
                
        } catch (Exception e) {
            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR)
                .body(createErrorResponse("ì„±ì  êµ¬ì„± ì„¤ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."));
        }
    }

    @PostMapping("/grade-info")
    public ResponseEntity<?> getGradeInfo(@RequestBody Map<String, Object> request) {
        try {
            String action = (String) request.get("action");
            
            switch (action) {
                case "get-grade":
                    return handleStudentGradeInfo(request);
                case "professor-view":
                    return handleProfessorGradeView(request);
                default:
                    return ResponseEntity.badRequest()
                        .body(createErrorResponse("ì§€ì›í•˜ì§€ ì•ŠëŠ” ì•¡ì…˜ì…ë‹ˆë‹¤."));
            }
            
        } catch (Exception e) {
            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR)
                .body(createErrorResponse("ì„±ì  ì¡°íšŒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."));
        }
    }

    @PostMapping("/grade-list")
    public ResponseEntity<?> getGradeList(@RequestBody Map<String, Object> request) {
        try {
            String action = (String) request.get("action");
            
            if ("list-all".equals(action)) {
                return handleGradeList(request);
            }
            
            return ResponseEntity.badRequest()
                .body(createErrorResponse("ì§€ì›í•˜ì§€ ì•ŠëŠ” ì•¡ì…˜ì…ë‹ˆë‹¤."));
                
        } catch (Exception e) {
            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR)
                .body(createErrorResponse("ì„±ì  ëª©ë¡ ì¡°íšŒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."));
        }
    }

    @PostMapping("/grade-finalize")
    public ResponseEntity<?> finalizeGrades(@RequestBody Map<String, Object> request) {
        try {
            String action = (String) request.get("action");
            
            if ("finalize".equals(action)) {
                return handleGradeFinalize(request);
            }
            
            return ResponseEntity.badRequest()
                .body(createErrorResponse("ì§€ì›í•˜ì§€ ì•ŠëŠ” ì•¡ì…˜ì…ë‹ˆë‹¤."));
                
        } catch (Exception e) {
            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR)
                .body(createErrorResponse("ë“±ê¸‰ ë°°ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."));
        }
    }
}
```

### EnrollmentService êµ¬í˜„

```java
@Service
@Transactional
public class EnrollmentService {

    @Autowired
    private EnrollmentExtendedRepository enrollmentExtendedRepository;
    
    @Autowired
    private AttendanceRepository attendanceRepository;
    
    @Autowired
    private AssignmentRepository assignmentRepository;

    /**
     * ì„±ì  êµ¬ì„± ì„¤ì •
     */
    public ResponseEntity<?> setGradeConfig(Map<String, Object> request) {
        Integer lecIdx = (Integer) request.get("lecIdx");
        
        // ê°•ì˜ë³„ ì„±ì  êµ¬ì„± ì„¤ì • ë¡œì§
        // ENROLLMENT_DATA JSON ì—…ë°ì´íŠ¸
        
        return ResponseEntity.ok(createSuccessResponse("ì„±ì  êµ¬ì„±ì´ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤."));
    }

    /**
     * ê°œë³„ í•™ìƒ ì„±ì  ê³„ì‚° ë° ì¡°íšŒ
     */
    public ResponseEntity<?> getStudentGradeInfo(Map<String, Object> request) {
        Integer lecIdx = (Integer) request.get("lecIdx");
        Integer studentIdx = (Integer) request.get("studentIdx");
        
        // 1. ì¶œì„ ì ìˆ˜ ê³„ì‚°
        Double attendanceScore = calculateAttendanceScore(lecIdx, studentIdx);
        
        // 2. ê³¼ì œ ì ìˆ˜ ì§‘ê³„
        List<AssignmentScore> assignmentScores = calculateAssignmentScores(lecIdx, studentIdx);
        
        // 3. ì´ì  ê³„ì‚°
        GradeInfo gradeInfo = calculateTotalScore(attendanceScore, assignmentScores);
        
        // 4. ENROLLMENT_DATA ì—…ë°ì´íŠ¸
        updateEnrollmentGradeData(lecIdx, studentIdx, gradeInfo);
        
        return ResponseEntity.ok(createSuccessResponse(gradeInfo));
    }

    /**
     * ì¶œì„ ì ìˆ˜ ê³„ì‚°
     */
    private Double calculateAttendanceScore(Integer lecIdx, Integer studentIdx) {
        // ATTENDANCE_TBLì—ì„œ ì¶œì„ìœ¨ ê³„ì‚°
        // ì¶œì„ìœ¨ Ã— ì§€ì • ë§Œì  = ì¶œì„ ì ìˆ˜
        return attendanceRepository.calculateAttendanceScore(lecIdx, studentIdx);
    }

    /**
     * ê³¼ì œ ì ìˆ˜ ì§‘ê³„
     */
    private List<AssignmentScore> calculateAssignmentScores(Integer lecIdx, Integer studentIdx) {
        // ASSIGNMENT_TBLì—ì„œ í•´ë‹¹ ê°•ì˜ì˜ ëª¨ë“  ê³¼ì œ ì ìˆ˜ ì¡°íšŒ
        return assignmentRepository.getStudentAssignmentScores(lecIdx, studentIdx);
    }

    /**
     * ìµœì¢… ë“±ê¸‰ ë°°ì • (60% ê¸°ì¤€ + ìƒëŒ€í‰ê°€)
     */
    public ResponseEntity<?> finalizeGrades(Map<String, Object> request) {
        Integer lecIdx = (Integer) request.get("lecIdx");
        Double passingThreshold = (Double) request.get("passingThreshold"); // ê¸°ë³¸ê°’: 60.0
        Map<String, Integer> gradeDistribution = (Map<String, Integer>) request.get("gradeDistribution");
        
        // 1. ì „ì²´ ìˆ˜ê°•ìƒ ì„±ì  ì¡°íšŒ
        List<StudentGrade> allGrades = getAllStudentGrades(lecIdx);
        
        // 2. í•©ê²©/ë¶ˆí•©ê²© ë¶„ë¥˜ (60% ê¸°ì¤€)
        List<StudentGrade> passingStudents = new ArrayList<>();
        List<StudentGrade> failingStudents = new ArrayList<>();
        
        for (StudentGrade grade : allGrades) {
            if (grade.getPercentage() >= passingThreshold) {
                passingStudents.add(grade);
            } else {
                failingStudents.add(grade);
                grade.setLetterGrade("F"); // 60% ë¯¸ë§Œì€ ë¬´ì¡°ê±´ F
            }
        }
        
        // 3. í•©ê²©ìë“¤ë§Œ ì„±ì ìˆœ ì •ë ¬ í›„ ìƒëŒ€í‰ê°€
        if (!passingStudents.isEmpty()) {
            passingStudents.sort((a, b) -> Double.compare(b.getPercentage(), a.getPercentage()));
            assignRelativeGrades(passingStudents, gradeDistribution);
        }
        
        // 4. ENROLLMENT_DATA ì—…ë°ì´íŠ¸
        updateFinalGrades(allGrades);
        
        // 5. í†µê³„ ìƒì„±
        GradeStatistics stats = generateGradeStatistics(allGrades);
        
        return ResponseEntity.ok(createSuccessResponse("ë“±ê¸‰ ë°°ì •ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.", stats));
    }

    /**
     * 60ì  ë¯¸ë§Œìê°€ í•˜ìœ„ ë“±ê¸‰ì„ ì°¨ì§€í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ë“±ê¸‰ ë°°ì •
     */
    private void assignRelativeGrades(List<StudentGrade> allGrades, Map<String, Integer> distribution, 
                                     List<StudentGrade> passingStudents, int totalStudents) {
        
        int passingCount = passingStudents.size();
        int failingCount = totalStudents - passingCount;
        
        // ê¸°ë³¸ ë¹„ìœ¨ ê³„ì‚° (ì „ì²´ í•™ìƒ ìˆ˜ ê¸°ì¤€)
        int originalA = (int) Math.ceil(totalStudents * distribution.get("A") / 100.0);
        int originalB = (int) Math.ceil(totalStudents * distribution.get("B") / 100.0);
        int originalC = (int) Math.ceil(totalStudents * distribution.get("C") / 100.0);
        int originalD = (int) Math.ceil(totalStudents * distribution.get("D") / 100.0);
        
        // 60ì  ë¯¸ë§Œìê°€ í•˜ìœ„ ë“±ê¸‰ë¶€í„° ì°¨ì§€
        int actualA = originalA;
        int actualB = originalB;
        int actualC = originalC;
        int actualD = originalD;
        
        // Fë“±ê¸‰ìê°€ D, C, B ìˆœì„œë¡œ ìë¦¬ ì°¨ì§€
        if (failingCount > 0) {
            if (failingCount >= originalD) {
                actualD = 0;
                failingCount -= originalD;
                
                if (failingCount >= originalC) {
                    actualC = 0;
                    failingCount -= originalC;
                    
                    if (failingCount >= originalB) {
                        actualB = 0;
                        failingCount -= originalB;
                        
                        // Aë“±ê¸‰ë„ ì¹¨ë²”í•˜ëŠ” ê²½ìš°
                        if (failingCount > 0) {
                            actualA = Math.max(0, originalA - failingCount);
                        }
                    } else {
                        actualB = originalB - failingCount;
                    }
                } else {
                    actualC = originalC - failingCount;
                }
            } else {
                actualD = originalD - failingCount;
            }
        }
        
        // í•©ê²©ìë“¤ì„ ì„±ì ìˆœìœ¼ë¡œ ì •ë ¬í•˜ì—¬ ë“±ê¸‰ ë°°ì •
        passingStudents.sort((a, b) -> Double.compare(b.getPercentage(), a.getPercentage()));
        
        int currentIndex = 0;
        
        // Aë“±ê¸‰ ë°°ì •
        for (int i = 0; i < actualA && currentIndex < passingCount; i++) {
            passingStudents.get(currentIndex++).setLetterGrade("A");
        }
        
        // Bë“±ê¸‰ ë°°ì •
        for (int i = 0; i < actualB && currentIndex < passingCount; i++) {
            passingStudents.get(currentIndex++).setLetterGrade("B");
        }
        
        // Cë“±ê¸‰ ë°°ì •
        for (int i = 0; i < actualC && currentIndex < passingCount; i++) {
            passingStudents.get(currentIndex++).setLetterGrade("C");
        }
        
        // Dë“±ê¸‰ ë°°ì •
        for (int i = 0; i < actualD && currentIndex < passingCount; i++) {
            passingStudents.get(currentIndex++).setLetterGrade("D");
        }
        
        // ë‚™ì œìê°€ í•˜ìœ„ë“±ê¸‰ì„ ë‹¤ ì°¨ì§€í•œ ê²½ìš°: ë‚¨ì€ í•©ê²©ìë“¤ì€ ìì—°ìŠ¤ëŸ½ê²Œ ìƒìœ„ë“±ê¸‰ì— ë°°ì¹˜
        while (currentIndex < passingCount) {
            passingStudents.get(currentIndex++).setLetterGrade("A");
        }
    }
}
```

---

## ğŸ“ ì„±ì  ê´€ë¦¬ í”„ë¡œì„¸ìŠ¤

### 1ï¸âƒ£ ì„±ì  êµ¬ì„± ì„¤ì •
- êµìˆ˜ê°€ ê°•ì˜ë³„ ì„±ì  ë¹„ìœ¨ ì„¤ì •
- ì¶œì„, ê³¼ì œ, ì‹œí—˜ ë°°ì  ê²°ì •
- ë“±ê¸‰ ë¶„í¬ ê¸°ì¤€ ì„¤ì •

### 2ï¸âƒ£ ì¶œì„/ê³¼ì œ ì ìˆ˜ ì…ë ¥
- ì¶œì„ ì ìˆ˜: ATTENDANCE_TBLì—ì„œ ìë™ ê³„ì‚°
- ê³¼ì œ ì ìˆ˜: ASSIGNMENT_TBLì—ì„œ ìë™ ì§‘ê³„
- ì´ë²¤íŠ¸ ê¸°ë°˜ ìë™ ë°˜ì˜ ë° ì—…ë°ì´íŠ¸

### 3ï¸âƒ£ ì´ë²¤íŠ¸ ê¸°ë°˜ í•©ê³„ ê³„ì‚°
- JSON ë°ì´í„° ì„ ë³„ì  ìë™ ì—…ë°ì´íŠ¸
- ë°±ë¶„ìœ¨ ê³„ì‚°
- ìˆœìœ„ ì‚°ì •

### 4ï¸âƒ£ ìµœì¢… ë“±ê¸‰ ë°°ì • (êµìˆ˜ ìˆ˜ë™ ì‹¤í–‰)
- **60% ê¸°ì¤€ ë¶„ë¥˜**: ì ìˆ˜/ë§Œì  ë¹„ìœ¨ 60% ë¯¸ë§Œì€ ë¬´ì¡°ê±´ F
- **ìƒëŒ€í‰ê°€**: 60% ì´ìƒ í•©ê²©ìë“¤ë§Œ A, B, C, Dë¡œ ë°°ì •
- **í•˜ìœ„ ì¹¨ë²” ë°©ì‹**: ë‚™ì œìê°€ Dâ†’Câ†’Bâ†’A ìˆœì„œë¡œ í•˜ìœ„ë“±ê¸‰ ìë¦¬ ì°¨ì§€
- **ìì—°ìŠ¤ëŸ¬ìš´ ê²°ê³¼**: ë‚™ì œìê°€ ë§ìœ¼ë©´ í•©ê²©ìë“¤ì´ ìƒëŒ€ì ìœ¼ë¡œ ìƒìœ„ë“±ê¸‰ì— ë°°ì¹˜ë¨

## ğŸ¯ ìµœì¢… ë“±ê¸‰ ë°°ì • íŠ¹ë³„ ë¡œì§

### ë“±ê¸‰ ë°°ì • ì•Œê³ ë¦¬ì¦˜

#### 1ë‹¨ê³„: í•©ê²©/ë¶ˆí•©ê²© ë¶„ë¥˜
```
60% ì´ìƒ â†’ í•©ê²© (ìƒëŒ€í‰ê°€ ëŒ€ìƒ)
60% ë¯¸ë§Œ â†’ Fë“±ê¸‰ í™•ì •
```

#### 2ë‹¨ê³„: ë“±ê¸‰ ë°°ì • ì•Œê³ ë¦¬ì¦˜
```
ê¸°ë³¸ ë¹„ìœ¨: A(30%), B(40%), C(20%), D(10%)
60ì  ë¯¸ë§Œìê°€ í•˜ìœ„ ë“±ê¸‰ë¶€í„° ëŒ€ì²´í•˜ëŠ” ë°©ì‹
```

#### 3ë‹¨ê³„: ì‹¤ì œ ë“±ê¸‰ ë°°ì • ì‚¬ë¡€
```java
// ì˜ˆì‹œ 1: 100ëª… ìˆ˜ê°•, ëª¨ë‘ 60ì  ì´ìƒ
ì´ ìˆ˜ê°•ìƒ: 100ëª…
- Aë“±ê¸‰: 30ëª… (ìƒìœ„ 30%)
- Bë“±ê¸‰: 40ëª… (30~70%)
- Cë“±ê¸‰: 20ëª… (70~90%)
- Dë“±ê¸‰: 10ëª… (90~100%)
- Fë“±ê¸‰: 0ëª…

// ì˜ˆì‹œ 2: 100ëª… ìˆ˜ê°•, 15ëª…ì´ 60ì  ë¯¸ë§Œ
ì´ ìˆ˜ê°•ìƒ: 100ëª…
- Aë“±ê¸‰: 30ëª… (ìƒìœ„ 30%)
- Bë“±ê¸‰: 40ëª… (30~70%)
- Cë“±ê¸‰: 15ëª… (70~85%) â† D 10ëª… + C ì¼ë¶€ê°€ Cë¡œ
- Dë“±ê¸‰: 0ëª… â† 60ì  ë¯¸ë§Œìê°€ D ìë¦¬ ì°¨ì§€
- Fë“±ê¸‰: 15ëª… (60ì  ë¯¸ë§Œ)

// ì˜ˆì‹œ 3: 100ëª… ìˆ˜ê°•, 75ëª…ì´ 60ì  ë¯¸ë§Œ
ì´ ìˆ˜ê°•ìƒ: 100ëª…
- Aë“±ê¸‰: 25ëª… (ìƒìœ„ 25%) â† í•©ê²©ì ì¤‘ ìƒìœ„ë§Œ
- Bë“±ê¸‰: 0ëª… â† 60ì  ë¯¸ë§Œìê°€ B, C, D ìë¦¬ ëª¨ë‘ ì°¨ì§€
- Cë“±ê¸‰: 0ëª…
- Dë“±ê¸‰: 0ëª…
- Fë“±ê¸‰: 75ëª… (60ì  ë¯¸ë§Œ)

// ì˜ˆì‹œ 4: 20ëª… ìˆ˜ê°•, 18ëª…ì´ 60ì  ë¯¸ë§Œ
ì´ ìˆ˜ê°•ìƒ: 20ëª…
- Aë“±ê¸‰: 2ëª… (í•©ê²©ì ì „ë¶€) â† ë‚™ì œìê°€ í•˜ìœ„ë“±ê¸‰ ë‹¤ ì°¨ì§€í•´ì„œ ìì—°ìŠ¤ëŸ½ê²Œ ìƒìœ„ë“±ê¸‰ë§Œ ë‚¨ìŒ
- Bë“±ê¸‰: 0ëª…
- Cë“±ê¸‰: 0ëª…  
- Dë“±ê¸‰: 0ëª…
- Fë“±ê¸‰: 18ëª… (60ì  ë¯¸ë§Œ)
```

### JSON ë°ì´í„° êµ¬ì¡° (ë“±ê¸‰ ë°°ì • ì „í›„)

#### ë“±ê¸‰ ë°°ì • ì „
```json
{
  "grade": {
    "total": {
      "score": 204.5,
      "maxScore": 230,
      "percentage": 88.9
    },
    "letterGrade": null,  // â† ê³µë€ ìƒíƒœ
    "finalized": false
  }
}
```

#### ë“±ê¸‰ ë°°ì • í›„
```json
{
  "grade": {
    "total": {
      "score": 204.5,
      "maxScore": 230,
      "percentage": 88.9
    },
    "letterGrade": "A",   // â† ë“±ê¸‰ í™•ì •
    "finalized": true,
    "finalizedDate": "2025-10-18T15:30:00Z",
    "rank": 1,
    "totalStudents": 20,
    "passingStudents": 2
  }
}
```

---

## ğŸ¯ ì´ë²¤íŠ¸ ê¸°ë°˜ ìë™ ê³„ì‚° ì‹œìŠ¤í…œ

### ì´ë²¤íŠ¸ íŠ¸ë¦¬ê±° í¬ì¸íŠ¸

#### 1ï¸âƒ£ ì¶œì„ ì´ë²¤íŠ¸
```java
// AttendanceControllerì—ì„œ ì¶œì„ ì²´í¬ ì‹œ
@PostMapping("/mark")
public ResponseEntity<?> markAttendance(@RequestBody AttendanceRequest request) {
    // 1. ì¶œì„ ë°ì´í„° ì €ì¥
    attendanceService.markAttendance(request);
    
    // 2. ğŸ”¥ ì„±ì  ì¬ê³„ì‚° ì´ë²¤íŠ¸ ë°œìƒ
    applicationEventPublisher.publishEvent(
        new GradeUpdateEvent(request.getLecIdx(), request.getStudentIdx(), "ATTENDANCE")
    );
    
    return ResponseEntity.ok("ì¶œì„ ì²˜ë¦¬ ì™„ë£Œ");
}
```

#### 2ï¸âƒ£ ê³¼ì œ ì±„ì  ì´ë²¤íŠ¸
```java
// AssignmentControllerì—ì„œ ê³¼ì œ ì±„ì  ì‹œ
@PutMapping("/{assignmentIdx}/grade")
public ResponseEntity<?> gradeAssignment(@RequestBody GradeRequest request) {
    // 1. ê³¼ì œ ì ìˆ˜ ì €ì¥
    assignmentService.gradeAssignment(request);
    
    // 2. ğŸ”¥ ì„±ì  ì¬ê³„ì‚° ì´ë²¤íŠ¸ ë°œìƒ
    applicationEventPublisher.publishEvent(
        new GradeUpdateEvent(request.getLecIdx(), request.getStudentIdx(), "ASSIGNMENT")
    );
    
    return ResponseEntity.ok("ì±„ì  ì™„ë£Œ");
}
```

### ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ êµ¬í˜„

```java
@Component
public class GradeUpdateEventListener {
    
    @Autowired
    private EnrollmentService enrollmentService;
    
    @EventListener
    @Async
    public void handleGradeUpdate(GradeUpdateEvent event) {
        try {
            // í•´ë‹¹ í•™ìƒì˜ ì„±ì ë§Œ ì„ ë³„ì ìœ¼ë¡œ ì¬ê³„ì‚°
            enrollmentService.recalculateStudentGrade(
                event.getLecIdx(), 
                event.getStudentIdx(),
                event.getUpdateType()
            );
            
            log.info("ì„±ì  ì—…ë°ì´íŠ¸ ì™„ë£Œ: ê°•ì˜={}, í•™ìƒ={}, íƒ€ì…={}", 
                event.getLecIdx(), event.getStudentIdx(), event.getUpdateType());
                
        } catch (Exception e) {
            log.error("ì„±ì  ì—…ë°ì´íŠ¸ ì‹¤íŒ¨", e);
        }
    }
}
```

### ì„ ë³„ì  ì¬ê³„ì‚° ë¡œì§

```java
/**
 * íŠ¹ì • í•™ìƒì˜ ì„±ì ë§Œ ì¬ê³„ì‚° (ì „ì²´ê°€ ì•„ë‹Œ ë³€ê²½ ë¶€ë¶„ë§Œ)
 */
public void recalculateStudentGrade(Integer lecIdx, Integer studentIdx, String updateType) {
    // 1. ê¸°ì¡´ JSON ë°ì´í„° ì¡°íšŒ
    EnrollmentExtended enrollment = findEnrollment(lecIdx, studentIdx);
    JSONObject gradeData = getGradeData(enrollment);
    
    // 2. ì—…ë°ì´íŠ¸ íƒ€ì…ì— ë”°ë¥¸ ì„ ë³„ì  ê³„ì‚°
    switch (updateType) {
        case "ATTENDANCE":
            updateAttendanceScore(gradeData, lecIdx, studentIdx); // ì¶œì„ ì ìˆ˜ë§Œ
            break;
        case "ASSIGNMENT":
            updateAssignmentScores(gradeData, lecIdx, studentIdx); // ê³¼ì œ ì ìˆ˜ë§Œ
            break;
    }
    
    // 3. ì´ì  ì¬ê³„ì‚° ë° JSON ì—…ë°ì´íŠ¸
    updateTotalScore(gradeData);
    saveEnrollmentData(enrollment, gradeData);
}
```

### ì„±ëŠ¥ ìµœì í™” íŠ¹ì§•

- **ì„ ë³„ì  ì—…ë°ì´íŠ¸**: ì „ì²´ ì¬ê³„ì‚°ì´ ì•„ë‹Œ ë³€ê²½ëœ ë¶€ë¶„ë§Œ ì²˜ë¦¬
- **ë¹„ë™ê¸° ì²˜ë¦¬**: ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì²˜ë¦¬í•˜ì—¬ ì‚¬ìš©ì ì‘ë‹µ ì†ë„ì— ì˜í–¥ ì—†ìŒ
- **ì¤‘ë³µ ë°©ì§€**: ê°™ì€ í•™ìƒì˜ ì—°ì† ì´ë²¤íŠ¸ ì‹œ ë§ˆì§€ë§‰ ê²ƒë§Œ ì²˜ë¦¬
- **íˆ¬ëª…í•œ ì²˜ë¦¬**: ì‚¬ìš©ìëŠ” ë³„ë„ ìƒˆë¡œê³ ì¹¨ ì•¡ì…˜ ë¶ˆí•„ìš”

---

## âœ¨ ì£¼ìš” íŠ¹ì§•

### ğŸ”„ ì´ë²¤íŠ¸ ê¸°ë°˜ ìë™ ê³„ì‚°
- **ìë™ íŠ¸ë¦¬ê±°**: ì¶œì„ ì²´í¬, ê³¼ì œ ì±„ì  ì‹œ ì¦‰ì‹œ ì¬ê³„ì‚°
- **ì„ ë³„ì  ì—…ë°ì´íŠ¸**: í•´ë‹¹ í•™ìƒì˜ ì„±ì ë§Œ ì—…ë°ì´íŠ¸
- **íˆ¬ëª…í•œ ì²˜ë¦¬**: ì‚¬ìš©ìëŠ” ë³„ë„ ì•¡ì…˜ ë¶ˆí•„ìš”
- **ì„±ëŠ¥ ìµœì í™”**: ë³€ê²½ëœ ë°ì´í„°ë§Œ ì²˜ë¦¬

### ğŸ“Š JSON ê¸°ë°˜ ìœ ì—°ì„±
- í™•ì¥ ê°€ëŠ¥í•œ ë°ì´í„° êµ¬ì¡°
- ë™ì  ì„±ì  êµ¬ì„± ì§€ì›
- ë³µì¡í•œ ê³„ì‚° ë¡œì§ ë‹¨ìˆœí™”

### ğŸ¯ ë°±ë¶„ìœ„ ë“±ê¸‰ ë°°ì •
- ìƒëŒ€í‰ê°€ ê¸°ì¤€ ë“±ê¸‰ ì‚°ì¶œ
- ìœ ì—°í•œ ë“±ê¸‰ ë¶„í¬ ì„¤ì •
- ê³µì •í•œ ì„±ì  í‰ê°€ ë³´ì¥

### ğŸ‘¨â€ğŸ« êµìˆ˜ ì „ìš© ê´€ë¦¬
- êµìˆ˜ë³„ ê¶Œí•œ ê´€ë¦¬
- ê°•ì˜ë³„ ë…ë¦½ì  ì„±ì  ê´€ë¦¬
- ì§ê´€ì ì¸ ì¸í„°í˜ì´ìŠ¤ ì œê³µ

---

## ğŸ”§ ê°œë°œ ìš°ì„ ìˆœìœ„

### 1ë‹¨ê³„: í•µì‹¬ ì„±ì  ê´€ë¦¬ (2ì£¼)
- âœ… EnrollmentController í™•ì¥
- âœ… ì„±ì  êµ¬ì„± ì„¤ì • API
- âœ… ê°œë³„ ì„±ì  ì¡°íšŒ API
- âœ… **ì´ë²¤íŠ¸ ê¸°ë°˜ ìë™ ê³„ì‚° ë¡œì§ êµ¬í˜„**
- âœ… AttendanceControllerì— ì´ë²¤íŠ¸ ì—°ë™
- âœ… AssignmentControllerì— ì´ë²¤íŠ¸ ì—°ë™

### 2ë‹¨ê³„: ê³ ê¸‰ ê¸°ëŠ¥ (1ì£¼)
- âœ… ì „ì²´ ì„±ì  ëª©ë¡ API
- âœ… ìµœì¢… ë“±ê¸‰ ë°°ì • API
- âœ… ë°±ë¶„ìœ„ ê³„ì‚° ë¡œì§

### 3ë‹¨ê³„: ìµœì í™” (1ì£¼)
- âœ… ì„±ëŠ¥ ìµœì í™”
- âœ… ì˜¤ë¥˜ ì²˜ë¦¬ ê°•í™”
- âœ… í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„±

---

## ğŸ“‹ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ë°±ì—”ë“œ êµ¬í˜„
- [ ] **EnrollmentController í™•ì¥**
- [ ] **EnrollmentService êµ¬í˜„**  
- [ ] **ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ êµ¬í˜„** (GradeUpdateEventListener)
- [ ] **AttendanceControllerì— ì´ë²¤íŠ¸ ë°œìƒ ë¡œì§ ì¶”ê°€**
- [ ] **AssignmentControllerì— ì´ë²¤íŠ¸ ë°œìƒ ë¡œì§ ì¶”ê°€**
- [ ] **JSON ë°ì´í„° ì²˜ë¦¬ ë¡œì§**
- [ ] **ì„±ì  ê³„ì‚° ì•Œê³ ë¦¬ì¦˜** (ì„ ë³„ì  ì—…ë°ì´íŠ¸)
- [ ] **ë°±ë¶„ìœ„ ë“±ê¸‰ ë°°ì • ë¡œì§**
- [ ] **ì˜¤ë¥˜ ì²˜ë¦¬ ë° ê²€ì¦**

### ë°ì´í„°ë² ì´ìŠ¤
- [ ] ENROLLMENT_EXTENDED_TBL í™œìš©
- [ ] JSON ìŠ¤í‚¤ë§ˆ ì •ì˜
- [ ] ì¸ë±ìŠ¤ ìµœì í™”
- [ ] ì„±ëŠ¥ íŠœë‹

### í…ŒìŠ¤íŠ¸
- [ ] ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‘ì„±
- [ ] í†µí•© í…ŒìŠ¤íŠ¸ ì‘ì„±  
- [ ] ë¸Œë¼ìš°ì € ì½˜ì†” í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸
- [ ] ì„±ëŠ¥ í…ŒìŠ¤íŠ¸

---

## ğŸ¯ ê²°ë¡ 

JSON ê¸°ë°˜ ì„±ì  ê´€ë¦¬ ì‹œìŠ¤í…œì„ í†µí•´:

âœ… **ìœ ì—°ì„±**: ë™ì  ì„±ì  êµ¬ì„± ë° í™•ì¥ ê°€ëŠ¥  
âœ… **íš¨ìœ¨ì„±**: ì‹¤ì‹œê°„ ìë™ ê³„ì‚°ìœ¼ë¡œ ê´€ë¦¬ ë¶€ë‹´ ê°ì†Œ  
âœ… **ê³µì •ì„±**: ë°±ë¶„ìœ„ ê¸°ì¤€ ê°ê´€ì  ë“±ê¸‰ ë°°ì •  
âœ… **ì¼ê´€ì„±**: ê¸°ì¡´ POST ë°©ì‹ê³¼ í†µí•©ëœ ì„¤ê³„  

**ë‹¤ìŒ ë‹¨ê³„**: EnrollmentController í™•ì¥ ê°œë°œ ì‹œì‘

---

> **ì°¸ê³  ë¬¸ì„œ**  
> - [ì„±ì ê´€ë¦¬ì‹œìŠ¤í…œ_ì„¤ê³„ì•ˆ_ìˆ˜ì •.drawio](./ì„±ì ê´€ë¦¬ì‹œìŠ¤í…œ_ì„¤ê³„ì•ˆ_ìˆ˜ì •.drawio)  
> - [ë¯¸êµ¬í˜„ê¸°ëŠ¥_POSTë°©ì‹_í†µì¼ê°€ì´ë“œ.md](../ë¯¸êµ¬í˜„ê¸°ëŠ¥_POSTë°©ì‹_í†µì¼ê°€ì´ë“œ.md)
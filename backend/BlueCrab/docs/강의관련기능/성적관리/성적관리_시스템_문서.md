# Blue Crab LMS ì„±ì  ê´€ë¦¬ ì‹œìŠ¤í…œ ë¬¸ì„œ

## ğŸ“‹ ì‹œìŠ¤í…œ ê°œìš”

Blue Crab LMSì˜ ì„±ì  ê´€ë¦¬ ì‹œìŠ¤í…œì€ ê°•ì˜ë³„ ì„±ì  í‰ê°€ë¥¼ ìœ„í•œ ì¢…í•©ì ì¸ ì†”ë£¨ì…˜ì…ë‹ˆë‹¤. lecSerial + studentIdx í†µí•© êµ¬ì¡°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•˜ë©°, enrollmentIdx ìë™ ì¡°íšŒ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.

### ğŸ¯ ì£¼ìš” íŠ¹ì§•

- **ì´ë²¤íŠ¸ ê¸°ë°˜ ìë™ ê³„ì‚°**: ì¶œì„, ê³¼ì œ, ì‹œí—˜ ì ìˆ˜ ë³€ê²½ ì‹œ ìë™ìœ¼ë¡œ ì´ì  ì¬ê³„ì‚°
- **JSON ê¸°ë°˜ ìœ ì—°ì„±**: ENROLLMENT_DATA í•„ë“œì— êµ¬ì¡°í™”ëœ JSON ë°ì´í„° ì €ì¥
- **60% ê¸°ì¤€ ìƒëŒ€í‰ê°€**: í•©ê²©/ë¶ˆí•©ê²© ë¶„ë¥˜ í›„ í•˜ìœ„ ì¹¨ë²” ë°©ì‹ ë“±ê¸‰ ë°°ì •
- **êµìˆ˜ ì „ìš© ê´€ë¦¬**: êµìˆ˜ ê³„ì •ë§Œ ì„±ì  ì…ë ¥ ë° ê´€ë¦¬ ê°€ëŠ¥

### ğŸ“Š ì‹œìŠ¤í…œ êµ¬ì„± ìš”ì†Œ

1. **ì¶œì„ ì ìˆ˜**: ì¶œì„ìœ¨ Ã— ì§€ì • ë§Œì  (ê¸°ë³¸ 20ì )
2. **ê³¼ì œ ì ìˆ˜**: ê°œë³„ ê³¼ì œë³„ ì ìˆ˜ ëˆ„ì 
3. **ì‹œí—˜ ì ìˆ˜**: ì¤‘ê°„ê³ ì‚¬/ê¸°ë§ê³ ì‚¬ ì ìˆ˜
4. **ì´ì  ê³„ì‚°**: ì´ë²¤íŠ¸ ê¸°ë°˜ ìë™ í•©ê³„ ë° ë°±ë¶„ìœ¨ ê³„ì‚°

## ğŸ”§ API ì—”ë“œí¬ì¸íŠ¸

### âœ… êµ¬í˜„ ì™„ë£Œëœ API

| ì—”ë“œí¬ì¸íŠ¸ | ë©”ì„œë“œ | ì„¤ëª… | ìƒíƒœ |
|-----------|--------|------|------|
| `/enrollments/grade-config` | POST | ì„±ì  êµ¬ì„± ì„¤ì • (êµìˆ˜) | âœ… ì™„ë£Œ |
| `/enrollments/grade-info` | POST | í•™ìƒ/êµìˆ˜ ì„±ì  ì¡°íšŒ | âœ… ì™„ë£Œ |
| `/enrollments/grade-list` | POST | ì „ì²´ ì„±ì  ëª©ë¡ ì¡°íšŒ | âœ… ì™„ë£Œ |
| `/enrollments/grade-finalize` | POST | ìµœì¢… ë“±ê¸‰ ë°°ì • | âœ… ì™„ë£Œ |
| `/enrollments/{enrollmentIdx}/attendance` | PUT | ì¶œì„ ì—…ë°ì´íŠ¸ + ì´ë²¤íŠ¸ | âœ… ì™„ë£Œ |
| `/assignments/{assignmentIdx}/grade` | PUT | ê³¼ì œ ì±„ì  + ì´ë²¤íŠ¸ | âœ… ì™„ë£Œ |

### ğŸ“ API ìƒì„¸ ì„¤ëª…

#### 1. ì„±ì  êµ¬ì„± ì„¤ì • (POST /enrollments/grade-config)

êµìˆ˜ê°€ ê°•ì˜ë³„ ì„±ì  ë¹„ìœ¨ì„ ì„¤ì •í•©ë‹ˆë‹¤.

**ìš”ì²­ ì˜ˆì‹œ:**

```json
{
  "action": "set-config",
  "lecSerial": "ETH201",
  "attendanceMaxScore": 80,
  "latePenaltyPerSession": 0.5,
  "gradeDistribution": {
    "A": 30,
    "B": 40,
    "C": 20,
    "D": 10
  }
}
```

**ì‘ë‹µ ì˜ˆì‹œ:**

```json
{
  "success": true,
  "message": "ì„±ì  êµ¬ì„±ì´ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.",
  "data": {
    "lecIdx": 1,
    "gradeConfig": {
      "attendanceMaxScore": 20,
      "assignmentTotalScore": 50,
      "examTotalScore": 30,
      "latePenaltyPerSession": 0.5,
      "gradeDistribution": {"A": 30, "B": 40, "C": 20, "D": 10},
      "totalMaxScore": 100,
      "configuredAt": "2025-10-22T10:00:00"
    }
  }
}
```

#### 2. ì„±ì  ì¡°íšŒ (POST /enrollments/grade-info)

í•™ìƒê³¼ êµìˆ˜ê°€ ì„±ì  ì •ë³´ë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤.

**ìš”ì²­ ì˜ˆì‹œ (í•™ìƒ):**

```json
{
  "action": "get-grade",
  "lecSerial": "CS101",
  "studentIdx": 100
}
```

**ìš”ì²­ ì˜ˆì‹œ (êµìˆ˜):**

```json
{
  "action": "professor-view",
  "lecSerial": "CS101"
}
```

#### 3. ìµœì¢… ë“±ê¸‰ ë°°ì • (POST /enrollments/grade-finalize)

í•™ê¸° ì¢…ë£Œ ì‹œ ìµœì¢… ë“±ê¸‰ì„ ë°°ì •í•©ë‹ˆë‹¤.

**í‰ê°€ ë°©ì‹:**

- 60% ë¯¸ë§Œ: ë¬´ì¡°ê±´ Fë“±ê¸‰
- 60% ì´ìƒ: A,B,C,D ìƒëŒ€í‰ê°€
- ë‚™ì œìê°€ Dâ†’Câ†’B ìˆœì„œë¡œ í•˜ìœ„ë“±ê¸‰ ì¹¨ë²”
- ë™ì ì: ëª¨ë‘ ìƒìœ„ë“±ê¸‰ì— ë°°ì •
- í•©ê²©ì: ë‚¨ì€ ë“±ê¸‰ì— ì„±ì ìˆœ ë°°ì •

## ğŸ—ï¸ ì£¼ìš” ì»´í¬ë„ŒíŠ¸

### ì„œë¹„ìŠ¤ í´ë˜ìŠ¤

#### GradeManagementService

ì„±ì  ê´€ë¦¬ì˜ í•µì‹¬ ì„œë¹„ìŠ¤ í´ë˜ìŠ¤ì…ë‹ˆë‹¤.

```java
@Service
@Transactional(readOnly = true)
public class GradeManagementService {
    // ì„±ì  êµ¬ì„± ì„¤ì •
    @Transactional
    public Map<String, Object> configureGrade(Map<String, Object> request) {
        // ì„±ì  ë¹„ìœ¨ ì„¤ì • ë¡œì§
    }

    // êµìˆ˜ìš© ì„±ì  ì¡°íšŒ
    public Map<String, Object> getProfessorGradeView(Integer lecIdx) {
        // êµìˆ˜ìš© ì„±ì  ëª©ë¡ ì¡°íšŒ
    }

    // ìµœì¢… ë“±ê¸‰ ë°°ì •
    @Transactional
    public Map<String, Object> finalizeGrades(Integer lecIdx) {
        // ë“±ê¸‰ ë°°ì • ì‹¤í–‰
    }
}
```

#### GradeCalculationService

ì„±ì  ê³„ì‚° ë¡œì§ì„ ë‹´ë‹¹í•©ë‹ˆë‹¤.

```java
@Service
@Transactional(readOnly = true)
public class GradeCalculationService {
    // í•™ìƒ ì„±ì  ê³„ì‚°
    @Transactional
    public Map<String, Object> calculateStudentGrade(Integer lecIdx, Integer studentIdx) {
        // ì¶œì„ ì ìˆ˜ ê³„ì‚°
        Map<String, Object> attendanceData = calculateAttendanceScore(lecIdx, studentIdx);

        // ê³¼ì œ ì ìˆ˜ ì§‘ê³„
        List<Map<String, Object>> assignmentScores = calculateAssignmentScores(lecIdx, studentIdx);

        // ì´ì  ê³„ì‚°
        Map<String, Object> totalData = calculateTotalScore(attendanceData, assignmentScores);

        return totalData;
    }
}
```

#### GradeFinalizer

ìµœì¢… ë“±ê¸‰ ë°°ì • ì•Œê³ ë¦¬ì¦˜ì„ êµ¬í˜„í•©ë‹ˆë‹¤.

```java
public class GradeFinalizer {
    public Map<String, Object> execute() {
        // 1. í•©ê²©/ë¶ˆí•©ê²© ë¶„ë¥˜ (60% ê¸°ì¤€)
        // 2. ë“±ê¸‰ ë°°ì • (í•˜ìœ„ ì¹¨ë²” ë°©ì‹)
        // 3. ë™ì ì ì²˜ë¦¬
        // 4. ë°ì´í„° ì—…ë°ì´íŠ¸
    }
}
```

### ì´ë²¤íŠ¸ ì‹œìŠ¤í…œ

#### GradeUpdateEvent

ì„±ì  ë³€ê²½ ì‹œ ìë™ ê³„ì‚°ì„ ìœ„í•œ ì´ë²¤íŠ¸ì…ë‹ˆë‹¤.

```java
public class GradeUpdateEvent extends ApplicationEvent {
    private final Integer lecIdx;
    private final Integer studentIdx;
    private final String updateType; // "ATTENDANCE", "ASSIGNMENT", "EXAM"

    public GradeUpdateEvent(Object source, Integer lecIdx, Integer studentIdx, String updateType) {
        super(source);
        this.lecIdx = lecIdx;
        this.studentIdx = studentIdx;
        this.updateType = updateType;
    }
}
```

## ğŸ“‹ ì„±ì  ê´€ë¦¬ í”„ë¡œì„¸ìŠ¤

### 1ë‹¨ê³„: ì„±ì  êµ¬ì„± ì„¤ì •

- êµìˆ˜: ì¶œì„/ê³¼ì œ/ì‹œí—˜ ë¹„ìœ¨ ì„¤ì •
- ì§€ê° ê°ì  ì •ì±… ì„¤ì •
- ë“±ê¸‰ ë¶„í¬ ê¸°ì¤€ ì„¤ì •

### 2ë‹¨ê³„: ì ìˆ˜ ì…ë ¥

- ì¶œì„: ìë™ ë°˜ì˜ (ì¶œê²° ì •ë³´)
- ê³¼ì œ: êµìˆ˜ ì±„ì  ì…ë ¥
- ì‹œí—˜: ì¤‘ê°„/ê¸°ë§ê³ ì‚¬ ì ìˆ˜

### 3ë‹¨ê³„: ìë™ ê³„ì‚°

- ì´ë²¤íŠ¸ ê¸°ë°˜ ì´ì  ì¬ê³„ì‚°
- ë°±ë¶„ìœ¨ ë° ë“±ê¸‰ ê³„ì‚°
- ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸

### 4ë‹¨ê³„: ìµœì¢… ë°°ì •

- 60% ê¸°ì¤€ í•©ê²©/ë¶ˆí•©ê²© ë¶„ë¥˜
- ìƒëŒ€í‰ê°€ ë“±ê¸‰ ë°°ì •
- í•™ê¸° ì¢…ë£Œ ì²˜ë¦¬

## ğŸ’¾ ë°ì´í„° êµ¬ì¡°

### ENROLLMENT_DATA JSON êµ¬ì¡°

```json
{
  "gradeConfig": {
    "attendanceMaxScore": 20,
    "assignmentTotalScore": 50,
    "examTotalScore": 30,
    "latePenaltyPerSession": 0.5,
    "gradeDistribution": {"A": 30, "B": 40, "C": 20, "D": 10},
    "totalMaxScore": 100,
    "configuredAt": "2025-10-22T10:00:00"
  },
  "grade": {
    "attendance": {
      "maxScore": 20,
      "currentScore": 18.5,
      "rate": 92.5,
      "lateCount": 2,
      "latePenalty": 1.0,
      "percentage": 92.5
    },
    "assignments": [
      {"name": "ê³¼ì œ1", "score": 9, "maxScore": 10},
      {"name": "ì¤‘ê°„ê³ ì‚¬", "score": 85, "maxScore": 100},
      {"name": "ê¸°ë§ê³ ì‚¬", "score": 92, "maxScore": 100}
    ],
    "total": {
      "score": 204.5,
      "maxScore": 230,
      "percentage": 88.9
    },
    "letterGrade": "A"
  }
}
```

### ì—”í‹°í‹° êµ¬ì¡°

#### EnrollmentExtendedTbl

ìˆ˜ê°•ì‹ ì²­ ì •ë³´ë¥¼ í™•ì¥í•˜ì—¬ ì„±ì  ë°ì´í„°ë¥¼ ì €ì¥í•©ë‹ˆë‹¤.

```java
@Entity
@Table(name = "ENROLLMENT_EXTENDED_TBL")
public class EnrollmentExtendedTbl {
    @Id
    @Column(name = "ENROLLMENT_IDX")
    private Integer enrollmentIdx;

    @Column(name = "STUDENT_IDX")
    private Integer studentIdx;

    @Column(name = "LEC_IDX")
    private Integer lecIdx;

    @Column(name = "ENROLLMENT_DATA", columnDefinition = "TEXT")
    private String enrollmentData; // JSON ë°ì´í„° ì €ì¥

    // ê¸°íƒ€ í•„ë“œ...
}
```

## ğŸ¯ êµ¬í˜„ ì„¸ë¶€ ì‚¬í•­

### ì¶œì„ ì ìˆ˜ ê³„ì‚°

- ì¶œì„ìœ¨ = (ì´ìˆ˜ì—…ì¼ - ê²°ì„ì¼) / ì´ìˆ˜ì—…ì¼ Ã— 100
- ì ìˆ˜ = ì¶œì„ìœ¨ Ã— ë§Œì  / 100
- ì§€ê° ê°ì : êµìˆ˜ ì„¤ì •ì— ë”°ë¼ ì§€ê° íšŸìˆ˜ Ã— ê°ì ë¥ 

### ê³¼ì œ ì ìˆ˜ ì§‘ê³„

- ê°œë³„ ê³¼ì œ ì ìˆ˜ í•©ì‚°
- ê³¼ì œ ìƒì„±/ì±„ì  ì‹œ ì´ë²¤íŠ¸ ë°œí–‰
- GradeUpdateEvent("ASSIGNMENT") íŠ¸ë¦¬ê±°

### ì´ì  ê³„ì‚° ê³µì‹

```text
ì´ì  = ì¶œì„ì ìˆ˜ + Î£(ê³¼ì œì ìˆ˜) + Î£(ì‹œí—˜ì ìˆ˜)
ë°±ë¶„ìœ¨ = (ì´ì  / ì´ë§Œì ) Ã— 100
```

### ë“±ê¸‰ ë°°ì • ì•Œê³ ë¦¬ì¦˜

1. 60% ë¯¸ë§Œ â†’ Fë“±ê¸‰
2. 60% ì´ìƒ í•™ìƒë“¤ì„ ì„±ì ìˆœ ì •ë ¬
3. ì„¤ì •ëœ ë“±ê¸‰ ë¶„í¬ì— ë”°ë¼ ë°°ì •
4. ë‚™ì œì ìˆ˜ë§Œí¼ í•˜ìœ„ ë“±ê¸‰ì—ì„œ ìƒìœ„ ë“±ê¸‰ìœ¼ë¡œ ì¹¨ë²”
5. ë™ì ìëŠ” ëª¨ë‘ ìƒìœ„ ë“±ê¸‰ì— ë°°ì •

## ğŸ“ˆ ì§„í–‰ ìƒí™©

- âœ… Phase 1: ì„±ì  êµ¬ì„± ë° ì¡°íšŒ (100%)
- âœ… Phase 2: ì¶œì„/ê³¼ì œ ì ìˆ˜ ì…ë ¥ (100%)
- âœ… Phase 3: ì´ë²¤íŠ¸ ê¸°ë°˜ ê³„ì‚° (100%)
- âœ… Phase 4: ìµœì¢… ë“±ê¸‰ ë°°ì • (100%)
- â³ í”„ë¡ íŠ¸ì—”ë“œ í†µí•© (ëŒ€ê¸° ì¤‘)

### ì „ì²´ ì§„í–‰ë¥ : 93%

## ğŸ”— ê´€ë ¨ ë¬¸ì„œ

- [ë¸Œë¼ìš°ì € ì½˜ì†” í…ŒìŠ¤íŠ¸ ê°€ì´ë“œ](../ë¸Œë¼ìš°ì €ì½˜ì†”í…ŒìŠ¤íŠ¸/04-grade/00-README.md)
- [ê³¼ì œ í‰ê°€ ì‹œìŠ¤í…œ](./ê³¼ì œí‰ê°€/00-README.md)
- [API ëª…ì„¸ì„œ](./ê³¼ì œí‰ê°€/01-API-SPECIFICATION.md)
- [ì‹œìŠ¤í…œ ì„¤ê³„ ë‹¤ì´ì–´ê·¸ë¨](./06-SYSTEM-DESIGN.drawio)
- [ì „ì²´ ê°€ì´ë“œ](../../ì „ì²´ê°€ì´ë“œ/Phase4_Evaluation_Closure.md)

## ğŸ§ª í…ŒìŠ¤íŠ¸ ë° ê²€ì¦

### ë¸Œë¼ìš°ì € ì½˜ì†” í…ŒìŠ¤íŠ¸

ì„±ì  ê´€ë¦¬ ì‹œìŠ¤í…œì€ ì™„ì „ ë…ë¦½ ì‹¤í–‰ ê°€ëŠ¥í•œ ë¸Œë¼ìš°ì € ì½˜ì†” í…ŒìŠ¤íŠ¸ë¥¼ ì œê³µí•©ë‹ˆë‹¤.

#### ğŸ“ í…ŒìŠ¤íŠ¸ íŒŒì¼ êµ¬ì¡°

```text
04-grade/
â”œâ”€â”€ 00-README.md              # ğŸ“– í…ŒìŠ¤íŠ¸ ê°€ì´ë“œ ë° ì‚¬ìš©ë²•
â”œâ”€â”€ 01-grade-phase1-tests.js  # Phase 1: ì„±ì  ê´€ë¦¬ í•µì‹¬ ê¸°ëŠ¥ (5ê°œ API)
â”œâ”€â”€ 02-grade-phase3-tests.js  # Phase 3: ì´ë²¤íŠ¸ ê¸°ë°˜ ì—…ë°ì´íŠ¸ (2ê°œ API)
â””â”€â”€ 11-TEST-FLOW.drawio       # í…ŒìŠ¤íŠ¸ í”Œë¡œìš° ë‹¤ì´ì–´ê·¸ë¨
```

**ğŸ“‹ í…ŒìŠ¤íŠ¸ ê°œìš”:**

- **ì´ 7ê°œ API í…ŒìŠ¤íŠ¸** (Phase 1: 5ê°œ + Phase 3: 2ê°œ)
- **ì™„ì „ ë…ë¦½ ì‹¤í–‰**: ê° íŒŒì¼ì´ ë…ë¦½ì ìœ¼ë¡œ ì‹¤í–‰ ê°€ëŠ¥
- **ì‹¤ì œ ì„œë²„ í…ŒìŠ¤íŠ¸**: `https://bluecrab.chickenkiller.com` í™˜ê²½ ì‚¬ìš©
- **JWT ì¸ì¦**: ì‹¤ì œ ì‚¬ìš©ì í† í°ìœ¼ë¡œ ì¸ì¦
- **lecSerial ê¸°ë°˜**: ê°•ì˜ ì½”ë“œë¡œ ë°ì´í„° ì¡°íšŒ/ê´€ë¦¬
- **enrollmentIdx ìë™ ì¡°íšŒ**: Phase 3ì—ì„œ ìë™ìœ¼ë¡œ enrollmentIdx ì¡°íšŒ â­

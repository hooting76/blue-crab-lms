# 📋 지각 처리 시스템

출석율 계산 vs 성적 감점

---

## 🎯 개요

지각은 **출석율 계산 시에는 출석과 동일하게 취급**되지만, **최종 성적 계산 시에는 교수가 재량껏 감점을 부여**할 수 있도록 설계되었습니다.

---

## 📊 지각 처리 방식

### 1️⃣ **출석 체크 시 (AttendanceService)**

출석 상태는 3가지로 기록됩니다:
- `출` - 출석
- `지` - 지각
- `결` - 결석

```java
// 출석 기록 예시
"1출2출3지4출5결6출...80출"
```

---

### 2️⃣ **출석율 계산 (AttendanceService)**

**출석율 = (출석 수 + 지각 수) / 총 회차**

- ✅ 출석(`출`): 출석으로 인정
- ✅ 지각(`지`): 출석으로 인정 (출석율 계산 시)
- ❌ 결석(`결`): 결석

```java
// 예시: 75회 출석, 3회 지각, 2회 결석
// 출석율 = (75 + 3) / 80 = 78 / 80 = 97.5%
```

**출석율 기반 점수** (20점 만점):
```
점수 = (출석율 / 100) × 20
     = (78 / 80) × 20
     = 19.5점
```

---

### 3️⃣ **성적 구성 설정 (GradeManagementService)**

교수가 강의별로 지각 감점을 설정할 수 있습니다:

**API 요청 예시**:
```json
{
  "lecIdx": 123,
  "attendanceMaxScore": 20,
  "assignmentTotalScore": 50,
  "examTotalScore": 30,
  "latePenaltyPerSession": 0.5,  // 지각 1회당 0.5점 감점
  "gradeDistribution": {
    "A": 30,
    "B": 40,
    "C": 20,
    "D": 10
  }
}
```

**`latePenaltyPerSession` 옵션**:
- `0.0` (기본값) - 감점 없음 (지각을 출석과 동일하게 취급)
- `0.5` - 지각 1회당 0.5점 감점
- `1.0` - 지각 1회당 1.0점 감점
- 교수 재량으로 자유롭게 설정 가능

---

### 4️⃣ **최종 성적 계산 (GradeCalculationService)**

출석율 기반 점수에서 지각 감점을 차감합니다:

**계산 과정**:
```
1. 출석율 기반 점수 계산
   → (출석 + 지각) / 80 × 20 = 19.5점

2. 지각 감점 계산 (교수 설정값 적용)
   → 지각 3회 × 0.5점 = 1.5점

3. 최종 출석 점수
   → 19.5점 - 1.5점 = 18.0점
```

**최종 출석 점수는 0점 이하로 내려가지 않습니다.**

---

## 🔄 처리 흐름도

```
1. 출석 체크 (AttendanceService)
   ↓
   출석 상태 기록: "1출2출3지4출5결..."
   
2. 출석율 계산 (AttendanceService.calculateAttendanceScoreForGrade)
   ↓
   출석 수: 75회
   지각 수: 3회
   결석 수: 2회
   출석율: (75 + 3) / 80 = 97.5%
   출석율 기반 점수: 19.5점
   
3. 성적 구성 설정 확인 (GradeCalculationService)
   ↓
   교수 설정: latePenaltyPerSession = 0.5
   
4. 지각 감점 적용 (GradeCalculationService)
   ↓
   감점: 3회 × 0.5점 = 1.5점
   최종 출석 점수: 19.5 - 1.5 = 18.0점
   
5. 총점 계산
   ↓
   출석(18.0) + 과제(45.0) + 시험(28.0) = 91.0점
   백분율: 91.0 / 100 × 100 = 91.00%
```

---

## 📝 응답 데이터 구조

### **출석 점수 상세 정보**

```json
{
  "attendance": {
    "maxScore": 20.0,
    "currentScore": 18.0,
    "percentage": 90.00,
    "presentCount": 75,        // 출석 수
    "lateCount": 3,            // 지각 수
    "absentCount": 2,          // 결석 수
    "attendanceRate": 78,      // 출석율 (출석+지각)
    "latePenalty": 1.5         // 지각 감점 (교수 설정 시)
  }
}
```

---

## 🎓 교수 사용 시나리오

### **시나리오 1: 지각 감점 없음 (관대한 교수)**

```json
{
  "latePenaltyPerSession": 0.0
}
```

**결과**:
- 지각을 출석과 동일하게 취급
- 출석율만으로 점수 계산
- 출석(75) + 지각(3) = 78회 → 19.5점

---

### **시나리오 2: 지각 1회당 0.5점 감점 (표준)**

```json
{
  "latePenaltyPerSession": 0.5
}
```

**결과**:
- 출석율 기반: 19.5점
- 지각 감점: 3회 × 0.5 = 1.5점
- 최종 점수: 18.0점

---

### **시나리오 3: 지각 1회당 1점 감점 (엄격한 교수)**

```json
{
  "latePenaltyPerSession": 1.0
}
```

**결과**:
- 출석율 기반: 19.5점
- 지각 감점: 3회 × 1.0 = 3.0점
- 최종 점수: 16.5점

---

## 💡 주요 특징

### ✅ **장점**

1. **출석율 보장**: 지각해도 출석율에는 포함되어 학생에게 불이익이 적음
2. **교수 재량권**: 교수가 강의 특성에 맞게 지각 처리 방식 선택
3. **유연한 설정**: 강의별로 다른 기준 적용 가능
4. **투명한 계산**: 출석/지각/결석 수를 모두 기록하여 추적 가능

### 🔒 **안전 장치**

1. **0점 하한선**: 감점으로 인해 음수 점수가 되지 않음
2. **기본값 설정**: latePenaltyPerSession이 없으면 0.0으로 처리
3. **소수점 정밀도**: 모든 점수는 소수점 둘째자리까지 반올림

---

## 📚 관련 파일

- `AttendanceService.java` - 출석 체크 및 출석율 계산
- `GradeCalculationService.java` - 지각 감점 적용
- `GradeManagementService.java` - 성적 구성 설정 (지각 감점 포함)

---

> **Note**: 이 시스템은 교수의 재량권을 존중하면서도 학생에게 공정한 출석율 계산을 보장합니다.

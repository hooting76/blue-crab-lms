# 🧪 브라우저 콘솔 출석 관리 API 테스트 모음집

> **Blue Crab LMS** - 출석 관리 기능 API 테스트 스크립트
>
> **📍 위치**: `docs/강의관련기능/브라우저콘솔테스트/06-attendance/`
>
> **🎯 목적**: 출석 요청/승인/조회 API 기능 검증
>
> **⚡ 특징**: 브라우저 콘솔에서 개별 API를 테스트하는 스크립트들

---

## 📋 목차

1. [포함된 테스트](#포함된-테스트)
2. [공통 사전 준비](#공통-사전-준비)
3. [출석 요청 테스트](#출석-요청-테스트)
4. [출석 승인 테스트](#출석-승인-테스트)
5. [학생 출석 조회 테스트](#학생-출석-조회-테스트)
6. [교수 출석 조회 테스트](#교수-출석-조회-테스트)
7. [실행 방법](#실행-방법)
8. [API 엔드포인트](#api-엔드포인트)
9. [주의사항](#주의사항)

---

## 📦 포함된 테스트

### 1. `01-attendance-request.js`
**학생 출석 요청 API 테스트**

- **목적**: 학생이 결석/지각에 대한 출석 인정을 요청
- **권한**: 학생 권한 필요
- **API**: `POST /api/attendance/request`

### 2. `02-attendance-approve.js`
**교수 출석 승인 API 테스트**

- **목적**: 교수가 학생들의 출석 요청을 승인/반려
- **권한**: 교수 권한 필요
- **API**: `POST /api/attendance/approve`

### 3. `03-student-view.js`
**학생 출석 현황 조회 API 테스트**

- **목적**: 학생이 자신의 출석 통계 및 기록을 조회
- **권한**: 학생 권한 필요
- **API**: `POST /api/attendance/student/view`

### 4. `04-professor-view.js`
**교수 출석 현황 조회 API 테스트**

- **목적**: 교수가 강의에 등록된 모든 학생의 출석 현황을 조회
- **권한**: 교수 권한 필요
- **API**: `POST /api/attendance/professor/view`

---

## 🔧 공통 사전 준비

### 필수 조건
- ✅ **백엔드 실행 중**: `https://bluecrab.chickenkiller.com/BlueCrab-1.0.0`
- ✅ **테스트 데이터 존재**: 강의/학생/교수 계정
- ✅ **브라우저**: Chrome/Firefox (F12 콘솔 지원)
- ✅ **JWT 토큰**: 유효한 액세스 토큰

### 테스트 계정 정보
```javascript
// 학생 계정 (출석 요청/조회용)
이메일: 123joon@naver.com
비밀번호: Bluecrab256@

// 교수 계정 (출석 승인/조회용)
이메일: prof.octopus@univ.edu
비밀번호: Bluecrab256@
```

### 기본 테스트 강의
- **강의 코드**: `ETH201`
- **학생 IDX**: `6` (테스트용)

---

## 📝 출석 요청 테스트

### 파일: `01-attendance-request.js`

#### 🎯 테스트 목적
학생이 특정 회차의 결석/지각에 대한 출석 인정을 요청합니다.

#### 📋 입력 파라미터
- **강의 코드 (lecSerial)**: 기본값 `ETH201`
- **회차 번호 (sessionNumber)**: 1~80 사이
- **요청 사유 (requestReason)**: 선택사항, 기본값 제공

#### 🚀 실행 방법
```javascript
// 브라우저 F12 → Console 탭에 전체 스크립트 복사/붙여넣기
// 자동으로 testAttendanceRequest() 함수 실행
```

#### ✅ 성공 시 출력
```
✅ 출석 요청 성공!
📊 출석 통계:
  - 출석: 12
  - 지각: 1
  - 결석: 3
  - 출석률: 81.25%
⏳ 대기 중인 요청: 1건
```

#### ❌ 실패 시 출력
```
❌ 출석 요청 실패: 400
에러 메시지: { success: false, message: "..." }
```

---

## 📝 출석 승인 테스트

### 파일: `02-attendance-approve.js`

#### 🎯 테스트 목적
교수가 학생들의 출석 요청을 승인하거나 직접 출석을 체크합니다.

#### 📋 입력 파라미터
- **강의 코드 (lecSerial)**: 기본값 `ETH201`
- **회차 번호 (sessionNumber)**: 1~80 사이
- **처리할 학생 수**: 승인할 학생 수 입력
- **각 학생 정보**: USER_IDX, 출석 상태(출/지/결)

#### 🚀 실행 방법
```javascript
// 브라우저 F12 → Console 탭에 전체 스크립트 복사/붙여넣기
// 자동으로 testAttendanceApprove() 함수 실행

// 또는 개별 함수 사용
await viewStudentList("ETH201")  // 학생 목록만 조회
```

#### ✅ 성공 시 출력
```
✅ 출석 승인 성공!
메시지: 출석 승인 처리가 완료되었습니다.
성공 여부: true
```

#### 🔍 추가 기능
- **학생 목록 조회**: 승인 전 전체 학생 목록 확인
- **대기 요청 확인**: 처리 대기 중인 출석 요청 표시
- **테이블 형식 출력**: 학생별 출석 통계 표

---

## 📝 학생 출석 조회 테스트

### 파일: `03-student-view.js`

#### 🎯 테스트 목적
학생이 자신의 출석 통계, 회차별 기록, 대기 중인 요청을 조회합니다.

#### 📋 입력 파라미터
- **강의 코드 (lecSerial)**: 기본값 `ETH201`

#### 🚀 실행 방법
```javascript
// 브라우저 F12 → Console 탭에 전체 스크립트 복사/붙여넣기
// 자동으로 testStudentAttendanceView() 함수 실행
```

#### ✅ 성공 시 출력
```
✅ 학생 출석 조회 성공!
📊 출석 통계:
  - 출석: 12회
  - 지각: 1회
  - 결석: 3회
  - 출석률: 81.25%

📅 회차별 출석 기록:
  ✅ 1회차: 출 (2025-10-01)
  ⏰ 2회차: 지 (2025-10-03)
  ❌ 3회차: 결 (2025-10-05)

⏳ 대기 중인 요청:
  - 3회차: 요청일 2025-10-05, 만료일 2025-10-12
    사유: 교통체증으로 지각
```

---

## 📝 교수 출석 조회 테스트

### 파일: `04-professor-view.js`

#### 🎯 테스트 목적
교수가 강의에 등록된 모든 학생의 출석 현황을 종합적으로 조회합니다.

#### 📋 입력 파라미터
- **강의 코드 (lecSerial)**: 기본값 `ETH201`

#### 🚀 실행 방법
```javascript
// 브라우저 F12 → Console 탭에 전체 스크립트 복사/붙여넣기
// 자동으로 testProfessorAttendanceView() 함수 실행
```

#### ✅ 성공 시 출력
```
✅ 교수 출석 조회 성공!
📚 총 25명의 학생 출석 현황:

👤 1. 김철수 (20241001) - USER_IDX: 6
  📊 출석 통계:
    - 출석: 12회
    - 지각: 1회
    - 결석: 3회
    - 출석률: 81.25%
  📅 최근 출석 기록 (최대 5개):
    ✅ 15회차: 출 (2025-10-20)
    ✅ 16회차: 출 (2025-10-22)
  ⏳ 대기 중인 요청: 1건
    - 3회차: 요청일 2025-10-05, 만료일 2025-10-12

📈 전체 통계:
  - 전체 출석: 300회
  - 전체 지각: 15회
  - 전체 결석: 45회
  - 대기 중인 요청: 3건
```

---

## 🎮 실행 방법

### 기본 실행 절차

1. **브라우저 열기**
   ```bash
   Chrome 또는 Firefox 브라우저 실행
   ```

2. **콘솔 열기**
   ```
   F12 키 → Console 탭 선택
   ```

3. **스크립트 로드**
   - 원하는 `.js` 파일 열기
   - 전체 내용 복사 (Ctrl+A, Ctrl+C)
   - 브라우저 콘솔에 붙여넣기 (Ctrl+V)
   - Enter 키로 실행

4. **토큰 설정** (필요시)
   ```javascript
   // 토큰이 자동으로 검색되지만 수동 설정 가능
   window.authToken = "your-jwt-token-here";
   ```

5. **테스트 실행**
   - 스크립트가 자동으로 실행되거나
   - 프롬프트에 필요한 정보 입력

### 권한별 실행 예시

#### 학생 권한 테스트
```javascript
// 01-attendance-request.js 실행
// 03-student-view.js 실행
```

#### 교수 권한 테스트
```javascript
// 02-attendance-approve.js 실행
// 04-professor-view.js 실행
```

---

## 🔗 API 엔드포인트

| 파일 | 엔드포인트 | 메소드 | 권한 |
|------|------------|--------|------|
| `01-attendance-request.js` | `/api/attendance/request` | POST | 학생 |
| `02-attendance-approve.js` | `/api/attendance/approve` | POST | 교수 |
| `03-student-view.js` | `/api/attendance/student/view` | POST | 학생 |
| `04-professor-view.js` | `/api/attendance/professor/view` | POST | 교수 |

### 공통 헤더
```http
Authorization: Bearer {accessToken}
Content-Type: application/json
```

### 응답 형식
```json
{
  "success": true,
  "message": "작업 완료 메시지",
  "data": { /* 응답 데이터 */ }
}
```

---

## ⚠️ 주의사항

### 권한 및 보안
- **토큰 필수**: 모든 API에 유효한 JWT 토큰 필요
- **권한 검증**: 학생/교수 권한에 따른 API 접근 제한
- **토큰 만료**: 세션이 만료되면 재로그인 필요

### 입력값 검증
- **강의 코드**: 존재하는 강의 코드여야 함
- **회차 번호**: 1~80 사이의 정수
- **출석 상태**: "출", "지", "결" 중 하나
- **학생 IDX**: 유효한 사용자 IDX

### 데이터 처리
- **실시간 반영**: API 호출 즉시 DB에 반영
- **트랜잭션**: `@Transactional`으로 데이터 일관성 보장
- **에러 롤백**: 실패 시 모든 변경사항 롤백

### 성능 고려사항
- **대용량 조회**: 교수 조회 시 많은 학생 데이터 처리
- **네트워크 타임아웃**: 대용량 데이터 조회 시 주의
- **브라우저 메모리**: 대량 데이터 출력 시 메모리 사용량 증가

### 테스트 데이터
- **실제 운영 DB 사용**: 테스트 전 백업 권장
- **데이터 정합성**: 테스트 후 데이터 상태 확인
- **동시 실행 금지**: 여러 브라우저에서 동시에 실행하지 말 것

---

## 🔍 디버깅 및 문제 해결

### 토큰 문제
```javascript
// 토큰 확인
console.log('Current token:', getToken());

// 토큰 수동 설정
window.authToken = 'your-token-here';
localStorage.setItem('accessToken', 'your-token-here');
```

### API 호출 실패
- **400 Bad Request**: 입력 파라미터 확인
- **401 Unauthorized**: 토큰 유효성 확인
- **403 Forbidden**: 권한 부족
- **500 Internal Server Error**: 백엔드 로그 확인

### 데이터 조회 실패
- **강의 코드 확인**: `ETH201`이 실제 존재하는지 확인
- **학생/교수 권한**: 해당 강의의 수강생/담당 교수인지 확인
- **출석 데이터 존재**: 출석 기록이 실제로 있는지 확인

---

## 📊 출석 상태 코드

| 코드 | 의미 | 이모지 |
|------|------|-------|
| 출 | 출석 | ✅ |
| 지 | 지각 | ⏰ |
| 결 | 결석 | ❌ |

---

## 🔗 관련 문서

- [**통합 테스트**](../07-integration-test/): `@Transactional` 검증 테스트
- [**API 모음집**](../통합%20테스트%20도구용%20API%20모음집/): 상세 API 명세
- [**브라우저 콘솔 테스트**](../): 다른 기능별 테스트들

---

**Last Updated:** 2025-10-25  
**Version:** 1.0.0  
**테스트 대상:** 출석 관리 API 기능
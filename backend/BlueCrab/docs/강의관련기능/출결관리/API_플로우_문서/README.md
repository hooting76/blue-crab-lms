# 출석 요청/승인 API 플로우 문서

> 📚 **문서 버전**: 1.0  
> 📅 **최종 업데이트**: 2025-10-23  
> 👥 **작성자**: BlueCrab Development Team

---

## 📖 개요

이 문서는 **출석 요청/승인 기능**의 전체 플로우를 체계적으로 설명합니다. 학생의 출석 요청부터 교수의 승인, 자동 처리까지의 모든 프로세스를 상세히 다룹니다.

---

## 📂 문서 구성

### 🎯 [01. 개요](./01_개요.md)
- 시스템 개요
- 주요 기능
- 구성 요소
- 핵심 개념

### 🌐 [02. API 엔드포인트](./02_API_엔드포인트.md)
- 4개 API 엔드포인트 목록
- 요청/응답 명세
- HTTP 메서드 및 권한
- 공통 헤더

### 👨‍🎓 [03. 학생 출석 요청](./03_학생_출석_요청.md)
- 출석 요청 API 상세
- 요청 조건 및 제약사항
- 요청 파라미터
- 응답 예시
- 에러 케이스

### 👨‍🏫 [04. 교수 출석 승인](./04_교수_출석_승인.md)
- 출석 승인 API 상세
- 승인 옵션 (출/지/결)
- 일괄 승인 처리
- 승인 로직
- 에러 케이스

### 🔐 [05. 교수 권한 검증](./05_교수_권한_검증.md)
- 권한 검증 로직
- Repository 쿼리
- LEC_PROF 필드 구조
- CAST 비교 방식
- JWT 토큰 처리

### ⏰ [06. 자동 승인 메커니즘](./06_자동_승인_메커니즘.md)
- 임시 승인 처리
- 7일 만료 로직 (날짜 기준)
- 스케줄러 구현
- 자동 확정 프로세스
- 날짜 계산 로직

### 💾 [07. 데이터 구조](./07_데이터_구조.md)
- ENROLLMENT_DATA JSON 구조
- attendance 필드 확장
- summary, sessions, pendingRequests
- 출석율 계산 로직
- Pending Requests 관리

### 📊 [08. 시퀀스 다이어그램](./08_시퀀스_다이어그램.md)
- 전체 플로우 시각화
- 학생 요청 플로우
- 교수 승인 플로우
- 자동 처리 플로우
- Mermaid 다이어그램

### ⚠️ [09. 예외 처리 및 확장](./09_예외_처리_및_확장.md)
- 예외 처리 전략
- 에러 코드 정의
- 권한 검증 실패
- 중복 요청 처리
- 향후 확장 계획

### 🔗 [10. 성적 연동 가이드](./10_성적_연동_가이드.md)
- 출결 관리 vs 성적 관리
- 출석율 → 성적 점수 변환
- 성적 구성 설정 방법
- 이벤트 기반 자동 연동
- 시스템 통합 가이드

---

## 🚀 빠른 시작

### 1. 핵심 개념 이해
먼저 **[01. 개요](./01_개요.md)** 를 읽어 전체 시스템을 이해하세요.

### 2. API 명세 확인
**[02. API 엔드포인트](./02_API_엔드포인트.md)** 에서 4개 API의 기본 정보를 확인하세요.

### 3. 역할별 문서
- **학생 개발자**: [03. 학생 출석 요청](./03_학생_출석_요청.md)
- **교수 개발자**: [04. 교수 출석 승인](./04_교수_출석_승인.md), [05. 교수 권한 검증](./05_교수_권한_검증.md)
- **백엔드 개발자**: [06. 자동 승인 메커니즘](./06_자동_승인_메커니즘.md), [07. 데이터 구조](./07_데이터_구조.md)

### 4. 전체 흐름 파악
**[08. 시퀀스 다이어그램](./08_시퀀스_다이어그램.md)** 으로 시각적으로 이해하세요.

---

## 🔗 관련 문서

### 작업 문서
- [작업 순서 전체](../작업%20수순/01_작업_순서_전체.md)
- [Phase 5: 테스트](../작업%20수순/Phase5_테스트.md)

### 기술 문서
- [날짜 기준 만료 처리 명세서](../날짜_기준_만료_처리_명세서.md)
- [출석요청승인 플로우 (원본)](../출석요청승인_플로우.md)

### 테스트 문서
- [브라우저 콘솔 테스트](../../브라우저콘솔테스트/06-attendance/README.md)

---

## 📋 API 엔드포인트 요약

| 엔드포인트 | 메서드 | 설명 | 권한 |
|-----------|--------|------|------|
| `/api/attendance/request` | POST | 학생 출석 요청 | 학생 |
| `/api/attendance/approve` | POST | 교수 출석 승인 | 교수/관리자 |
| `/api/attendance/student/view` | POST | 학생 출석 조회 | 학생 |
| `/api/attendance/professor/view` | POST | 교수 출석 조회 | 교수/관리자 |

---

## 🎯 주요 특징

### ✅ 완료된 기능
- ✅ JWT 토큰 기반 인증
- ✅ 교수 권한 검증 (LEC_PROF = USER_IDX)
- ✅ 날짜 기준 자동 승인 (7일 후)
- ✅ JSON 기반 데이터 구조
- ✅ 출석율 자동 계산
- ✅ 실시간 pendingRequests 관리

### 🔄 처리 흐름
1. 학생이 출석 요청 → `pendingRequests`에 추가
2. 교수가 승인/거부 → `sessions`로 이동
3. 7일 후 미처리 건 → 자동 출석 처리

### 📊 데이터 관리
- **summary**: 출석 통계 (attended, late, absent, attendanceRate)
- **sessions**: 확정된 출석 기록 (회차별)
- **pendingRequests**: 대기 중인 요청 (최대 80개)

---

## 🧪 테스트 현황

### ✅ 완료된 테스트
- ✅ 4개 API 엔드포인트 실제 테스트
- ✅ JWT 토큰 인증 검증
- ✅ 교수 권한 검증 (LEC_PROF 비교)
- ✅ 출석율 계산 정확성
- ✅ pendingRequests ↔ sessions 이동
- ✅ 엔드-투-엔드 시나리오 (요청→승인→조회)

### 📈 테스트 결과
- **성공률**: 100%
- **테스트 계정**: prof.octopus@univ.edu (USER_IDX=25)
- **테스트 강의**: ETH201
- **검증 항목**: 17개 완료

자세한 내용은 [브라우저 콘솔 테스트](../../브라우저콘솔테스트/06-attendance/README.md) 참조

---

## 💡 사용 팁

### 프론트엔드 개발자
1. [02. API 엔드포인트](./02_API_엔드포인트.md)에서 API 명세 확인
2. [03. 학생 출석 요청](./03_학생_출석_요청.md) 또는 [04. 교수 출석 승인](./04_교수_출석_승인.md) 참조
3. JWT 토큰은 window.authToken (우선) > localStorage > sessionStorage 순서로 확인

### 백엔드 개발자
1. [07. 데이터 구조](./07_데이터_구조.md)에서 JSON 구조 이해
2. [05. 교수 권한 검증](./05_교수_권한_검증.md)에서 쿼리 최적화 확인
3. [06. 자동 승인 메커니즘](./06_자동_승인_메커니즘.md)에서 스케줄러 로직 확인

### QA 테스터
1. [09. 예외 처리 및 확장](./09_예외_처리_및_확장.md)에서 에러 케이스 확인
2. [08. 시퀀스 다이어그램](./08_시퀀스_다이어그램.md)으로 전체 흐름 파악
3. 브라우저 콘솔 테스트 스크립트 활용

---

## 📞 문의 및 지원

- **개발팀**: BlueCrab Development Team
- **문서 이슈**: GitHub Issues
- **긴급 지원**: 백엔드 팀 리드

---

## 📝 변경 이력

| 버전 | 날짜 | 변경 내용 | 작성자 |
|------|------|----------|--------|
| 1.0 | 2025-10-23 | 초기 문서 작성 및 구조화 | BlueCrab Team |
| - | - | 교수 권한 검증 로직 추가 | BlueCrab Team |
| - | - | 날짜 기준 만료 처리 명세 | BlueCrab Team |
| - | - | API 테스트 완료 및 검증 | BlueCrab Team |

---

**📚 다음 단계**: [01. 개요](./01_개요.md) 문서부터 시작하세요!

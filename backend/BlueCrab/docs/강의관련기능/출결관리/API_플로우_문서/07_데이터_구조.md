# 07. ë°ì´í„° êµ¬ì¡°

> ğŸ“Š ì¶œê²° ê´€ë¦¬ ì‹œìŠ¤í…œì˜ JSON ë°ì´í„° êµ¬ì¡° ìƒì„¸ ê°€ì´ë“œ

---

## ê°œìš”

### ENROLLMENT_DATA í•„ë“œ

ì¶œê²° ë°ì´í„°ëŠ” `ENROLLMENT_EXTENDED_TBL.ENROLLMENT_DATA` í•„ë“œì— **JSON í˜•ì‹**ìœ¼ë¡œ ì €ì¥ë©ë‹ˆë‹¤.

```sql
-- í…Œì´ë¸” êµ¬ì¡°
CREATE TABLE ENROLLMENT_EXTENDED_TBL (
    ENR_NO INT PRIMARY KEY AUTO_INCREMENT,
    LEC_SERIAL VARCHAR(20),
    USER_IDX INT,
    ENROLLMENT_DATA TEXT, -- JSON ë°ì´í„°
    FOREIGN KEY (LEC_SERIAL) REFERENCES LEC_TBL(LEC_SERIAL),
    FOREIGN KEY (USER_IDX) REFERENCES USER_TBL(USER_IDX)
);
```

### JSON ìµœìƒìœ„ êµ¬ì¡°

```json
{
  "summary": { ... },
  "sessions": [ ... ],
  "pendingRequests": [ ... ]
}
```

---

## ì „ì²´ ë°ì´í„° êµ¬ì¡°

### ì™„ì „í•œ ì˜ˆì‹œ

```json
{
  "summary": {
    "attended": 2,
    "late": 1,
    "absent": 0,
    "totalSessions": 4,
    "attendanceRate": 75.0,
    "updatedAt": "2025-10-23T15:45:00"
  },
  "sessions": [
    {
      "sessionNumber": 1,
      "status": "ì¶œ",
      "requestDate": "2025-10-16T14:30:00",
      "approvedDate": "2025-10-20T10:00:00",
      "approvedBy": 25,
      "tempApproved": false
    },
    {
      "sessionNumber": 2,
      "status": "ì§€",
      "requestDate": "2025-10-18T09:15:00",
      "approvedDate": "2025-10-23T00:00:00",
      "approvedBy": null,
      "tempApproved": true
    }
  ],
  "pendingRequests": [
    {
      "sessionNumber": 3,
      "requestDate": "2025-10-23T14:00:00",
      "expiresAt": "2025-10-30T00:00:00",
      "requestReason": "ë³‘ì› ì§„ë£Œ"
    },
    {
      "sessionNumber": 4,
      "requestDate": "2025-10-23T15:00:00",
      "expiresAt": "2025-10-30T00:00:00",
      "requestReason": null
    }
  ]
}
```

---

## summary (ìš”ì•½ ì •ë³´)

### êµ¬ì¡°

```json
{
  "attended": 2,
  "late": 1,
  "absent": 0,
  "totalSessions": 4,
  "attendanceRate": 75.0,
  "updatedAt": "2025-10-23T15:45:00"
}
```

### í•„ë“œ ìƒì„¸

| í•„ë“œ | íƒ€ì… | ì„¤ëª… | ê³„ì‚° ë°©ì‹ |
|-----|------|------|----------|
| `attended` | Integer | ì¶œì„ íšŸìˆ˜ | sessionsì—ì„œ status="ì¶œ" ì¹´ìš´íŠ¸ |
| `late` | Integer | ì§€ê° íšŸìˆ˜ | sessionsì—ì„œ status="ì§€" ì¹´ìš´íŠ¸ |
| `absent` | Integer | ê²°ì„ íšŸìˆ˜ | sessionsì—ì„œ status="ê²°" ì¹´ìš´íŠ¸ |
| `totalSessions` | Integer | ì „ì²´ íšŒì°¨ ìˆ˜ | sessions.size() + pendingRequests.size() |
| `attendanceRate` | Double | ì¶œì„ìœ¨ (%) | (attended / totalSessions) Ã— 100 |
| `updatedAt` | String | ìµœì¢… ê°±ì‹  ì‹œê° | ISO 8601 í˜•ì‹ |

### ê³„ì‚° ë¡œì§

```java
private void recalculateSummary(AttendanceDataDto attendanceData) {
    // 1. sessions ë°°ì—´ ìˆœíšŒ
    int attended = 0;
    int late = 0;
    int absent = 0;
    
    for (AttendanceSessionDto session : attendanceData.getSessions()) {
        switch (session.getStatus()) {
            case "ì¶œ": attended++; break;
            case "ì§€": late++; break;
            case "ê²°": absent++; break;
        }
    }
    
    // 2. totalSessions ê³„ì‚°
    int totalSessions = attendanceData.getSessions().size() 
                      + attendanceData.getPendingRequests().size();
    
    // 3. ì¶œì„ìœ¨ ê³„ì‚°
    double attendanceRate = totalSessions > 0 
        ? (attended * 100.0) / totalSessions 
        : 0.0;
    
    // 4. summary ì—…ë°ì´íŠ¸
    AttendanceSummaryDto summary = attendanceData.getSummary();
    summary.setAttended(attended);
    summary.setLate(late);
    summary.setAbsent(absent);
    summary.setTotalSessions(totalSessions);
    summary.setAttendanceRate(attendanceRate);
    summary.setUpdatedAt(LocalDateTime.now());
}
```

### ì˜ˆì‹œ

#### ì¼€ì´ìŠ¤ 1: ëª¨ë‘ ì¶œì„

```json
{
  "sessions": [
    { "sessionNumber": 1, "status": "ì¶œ" },
    { "sessionNumber": 2, "status": "ì¶œ" },
    { "sessionNumber": 3, "status": "ì¶œ" }
  ],
  "pendingRequests": [],
  "summary": {
    "attended": 3,
    "late": 0,
    "absent": 0,
    "totalSessions": 3,
    "attendanceRate": 100.0
  }
}
```

#### ì¼€ì´ìŠ¤ 2: í˜¼í•© + ëŒ€ê¸° ì¤‘

```json
{
  "sessions": [
    { "sessionNumber": 1, "status": "ì¶œ" },
    { "sessionNumber": 2, "status": "ì§€" },
    { "sessionNumber": 3, "status": "ê²°" }
  ],
  "pendingRequests": [
    { "sessionNumber": 4 },
    { "sessionNumber": 5 }
  ],
  "summary": {
    "attended": 1,
    "late": 1,
    "absent": 1,
    "totalSessions": 5,
    "attendanceRate": 20.0
  }
}
```

**ê³„ì‚°**:
- `attended`: 1 (íšŒì°¨ 1ë§Œ "ì¶œ")
- `totalSessions`: 3 (sessions) + 2 (pendingRequests) = 5
- `attendanceRate`: (1 / 5) Ã— 100 = 20.0%

---

## sessions (ìŠ¹ì¸ëœ ì¶œì„ ê¸°ë¡)

### êµ¬ì¡°

```json
{
  "sessionNumber": 1,
  "status": "ì¶œ",
  "requestDate": "2025-10-16T14:30:00",
  "approvedDate": "2025-10-20T10:00:00",
  "approvedBy": 25,
  "tempApproved": false
}
```

### í•„ë“œ ìƒì„¸

| í•„ë“œ | íƒ€ì… | í•„ìˆ˜ | ì„¤ëª… | ì˜ˆì‹œ |
|-----|------|------|------|------|
| `sessionNumber` | Integer | âœ… | íšŒì°¨ ë²ˆí˜¸ | 1, 2, 3, ... |
| `status` | String | âœ… | ì¶œì„ ìƒíƒœ | "ì¶œ", "ì§€", "ê²°" |
| `requestDate` | String | âœ… | í•™ìƒ ìš”ì²­ ì¼ì‹œ | "2025-10-16T14:30:00" |
| `approvedDate` | String | âœ… | ìŠ¹ì¸ ì¼ì‹œ | "2025-10-20T10:00:00" |
| `approvedBy` | Integer | âŒ | ìŠ¹ì¸í•œ êµìˆ˜ USER_IDX | 25 (êµìˆ˜), null (ìë™) |
| `tempApproved` | Boolean | âœ… | ìë™ ìŠ¹ì¸ ì—¬ë¶€ | false (êµìˆ˜), true (ìë™) |

### í•„ë“œë³„ ì„¤ëª…

#### 1. sessionNumber (íšŒì°¨ ë²ˆí˜¸)

```json
"sessionNumber": 1
```

- **ë²”ìœ„**: 1 ~ 80
- **ì˜ë¯¸**: ê°•ì˜ì˜ ëª‡ ë²ˆì§¸ íšŒì°¨ì¸ì§€
- **ì œì•½**: ê°™ì€ í•™ìƒì˜ ê°™ì€ íšŒì°¨ëŠ” sessionsì— 1ê°œë§Œ ì¡´ì¬

#### 2. status (ì¶œì„ ìƒíƒœ)

```json
"status": "ì¶œ"
```

- **ê°€ëŠ¥í•œ ê°’**:
  - `"ì¶œ"`: ì¶œì„ (Attended)
  - `"ì§€"`: ì§€ê° (Late)
  - `"ê²°"`: ê²°ì„ (Absent)

**êµìˆ˜ ìŠ¹ì¸ vs ìë™ ìŠ¹ì¸**:
- **êµìˆ˜ ìŠ¹ì¸**: "ì¶œ", "ì§€", "ê²°" ëª¨ë‘ ê°€ëŠ¥
- **ìë™ ìŠ¹ì¸**: "ì¶œ"ë§Œ ê°€ëŠ¥ (ê³ ì •)

#### 3. requestDate (ìš”ì²­ ì¼ì‹œ)

```json
"requestDate": "2025-10-16T14:30:00"
```

- **í˜•ì‹**: ISO 8601 (yyyy-MM-ddTHH:mm:ss)
- **ì˜ë¯¸**: í•™ìƒì´ ì¶œì„ ìš”ì²­ì„ ë³´ë‚¸ ì‹œê°
- **ìš©ë„**: ì¶œì„ ìš”ì²­ ì´ë ¥ ì¶”ì 

#### 4. approvedDate (ìŠ¹ì¸ ì¼ì‹œ)

```json
"approvedDate": "2025-10-20T10:00:00"
```

- **í˜•ì‹**: ISO 8601
- **ì˜ë¯¸**: êµìˆ˜ ë˜ëŠ” ì‹œìŠ¤í…œì´ ìŠ¹ì¸í•œ ì‹œê°
- **ìš©ë„**: ìŠ¹ì¸ ì´ë ¥ ì¶”ì 

#### 5. approvedBy (ìŠ¹ì¸ì)

```json
"approvedBy": 25
```

- **êµìˆ˜ ìŠ¹ì¸**: professorIdx (ì˜ˆ: 25)
- **ìë™ ìŠ¹ì¸**: null

**ì˜ˆì‹œ**:
```json
// êµìˆ˜ ìŠ¹ì¸
{
  "approvedBy": 25,
  "tempApproved": false
}

// ìë™ ìŠ¹ì¸
{
  "approvedBy": null,
  "tempApproved": true
}
```

#### 6. tempApproved (ìë™ ìŠ¹ì¸ ì—¬ë¶€)

```json
"tempApproved": true
```

- **false**: êµìˆ˜ê°€ ìˆ˜ë™ìœ¼ë¡œ ìŠ¹ì¸
- **true**: ì‹œìŠ¤í…œì´ ìë™ìœ¼ë¡œ ìŠ¹ì¸

**íŒë‹¨ ê¸°ì¤€**:
| tempApproved | approvedBy | status | ì˜ë¯¸ |
|--------------|-----------|--------|------|
| false | 25 | "ì¶œ" | êµìˆ˜ 25ê°€ ì¶œì„ ìŠ¹ì¸ |
| false | 25 | "ì§€" | êµìˆ˜ 25ê°€ ì§€ê° ìŠ¹ì¸ |
| false | 25 | "ê²°" | êµìˆ˜ 25ê°€ ê²°ì„ ìŠ¹ì¸ |
| true | null | "ì¶œ" | ì‹œìŠ¤í…œì´ ìë™ ìŠ¹ì¸ |

### ë°°ì—´ ì˜ˆì‹œ

```json
"sessions": [
  {
    "sessionNumber": 1,
    "status": "ì¶œ",
    "requestDate": "2025-10-16T14:30:00",
    "approvedDate": "2025-10-20T10:00:00",
    "approvedBy": 25,
    "tempApproved": false
  },
  {
    "sessionNumber": 2,
    "status": "ì§€",
    "requestDate": "2025-10-18T09:15:00",
    "approvedDate": "2025-10-22T14:30:00",
    "approvedBy": 25,
    "tempApproved": false
  },
  {
    "sessionNumber": 3,
    "status": "ì¶œ",
    "requestDate": "2025-10-20T11:00:00",
    "approvedDate": "2025-10-27T00:00:00",
    "approvedBy": null,
    "tempApproved": true
  }
]
```

---

## pendingRequests (ëŒ€ê¸° ì¤‘ì¸ ìš”ì²­)

### êµ¬ì¡°

```json
{
  "sessionNumber": 3,
  "requestDate": "2025-10-23T14:00:00",
  "expiresAt": "2025-10-30T00:00:00",
  "requestReason": "ë³‘ì› ì§„ë£Œ"
}
```

### í•„ë“œ ìƒì„¸

| í•„ë“œ | íƒ€ì… | í•„ìˆ˜ | ì„¤ëª… | ì˜ˆì‹œ |
|-----|------|------|------|------|
| `sessionNumber` | Integer | âœ… | íšŒì°¨ ë²ˆí˜¸ | 3 |
| `requestDate` | String | âœ… | ìš”ì²­ ì¼ì‹œ | "2025-10-23T14:00:00" |
| `expiresAt` | String | âœ… | ë§Œë£Œ ì¼ì‹œ | "2025-10-30T00:00:00" |
| `requestReason` | String | âŒ | ìš”ì²­ ì‚¬ìœ  | "ë³‘ì› ì§„ë£Œ", null |

### í•„ë“œë³„ ì„¤ëª…

#### 1. sessionNumber (íšŒì°¨ ë²ˆí˜¸)

```json
"sessionNumber": 3
```

- **ë²”ìœ„**: 1 ~ 80
- **ì˜ë¯¸**: ì¶œì„ ìš”ì²­í•œ íšŒì°¨
- **ì œì•½**: ê°™ì€ í•™ìƒì˜ ê°™ì€ íšŒì°¨ëŠ” pendingRequestsì— 1ê°œë§Œ ì¡´ì¬

#### 2. requestDate (ìš”ì²­ ì¼ì‹œ)

```json
"requestDate": "2025-10-23T14:00:00"
```

- **í˜•ì‹**: ISO 8601
- **ì˜ë¯¸**: í•™ìƒì´ ì¶œì„ ìš”ì²­ì„ ë³´ë‚¸ ì‹œê°
- **ê³„ì‚°**: `LocalDateTime.now()`

#### 3. expiresAt (ë§Œë£Œ ì¼ì‹œ)

```json
"expiresAt": "2025-10-30T00:00:00"
```

- **í˜•ì‹**: ISO 8601
- **ì˜ë¯¸**: ìë™ ìŠ¹ì¸ ê¸°ì¤€ ì¼ì‹œ
- **ê³„ì‚°**:
  ```java
  LocalDateTime expiresAt = LocalDateTime.now()
      .plusDays(7)
      .withHour(0)
      .withMinute(0)
      .withSecond(0)
      .withNano(0);
  ```

**ì˜ˆì‹œ**:
| requestDate | expiresAt | ì„¤ëª… |
|------------|-----------|------|
| 2025-10-23T14:30:00 | 2025-10-30T00:00:00 | 7ì¼ í›„ ìì • |
| 2025-10-23T09:00:00 | 2025-10-30T00:00:00 | ë™ì¼ |
| 2025-10-23T23:59:59 | 2025-10-30T00:00:00 | ë™ì¼ |

#### 4. requestReason (ìš”ì²­ ì‚¬ìœ )

```json
"requestReason": "ë³‘ì› ì§„ë£Œ"
```

- **ì„ íƒ í•„ë“œ**: null ê°€ëŠ¥
- **ìµœëŒ€ ê¸¸ì´**: 200ì
- **ìš©ë„**: êµìˆ˜ê°€ ìŠ¹ì¸ ì‹œ ì°¸ê³ 

**ì˜ˆì‹œ**:
```json
// ì‚¬ìœ  ìˆìŒ
{
  "sessionNumber": 3,
  "requestDate": "2025-10-23T14:00:00",
  "expiresAt": "2025-10-30T00:00:00",
  "requestReason": "ë³‘ì› ì§„ë£Œë¡œ ì¸í•œ ê²°ì„"
}

// ì‚¬ìœ  ì—†ìŒ
{
  "sessionNumber": 4,
  "requestDate": "2025-10-23T15:00:00",
  "expiresAt": "2025-10-30T00:00:00",
  "requestReason": null
}
```

### ë°°ì—´ ì˜ˆì‹œ

```json
"pendingRequests": [
  {
    "sessionNumber": 3,
    "requestDate": "2025-10-23T14:00:00",
    "expiresAt": "2025-10-30T00:00:00",
    "requestReason": "ë³‘ì› ì§„ë£Œ"
  },
  {
    "sessionNumber": 4,
    "requestDate": "2025-10-23T15:00:00",
    "expiresAt": "2025-10-30T00:00:00",
    "requestReason": null
  },
  {
    "sessionNumber": 5,
    "requestDate": "2025-10-23T16:00:00",
    "expiresAt": "2025-10-30T00:00:00",
    "requestReason": "ê°€ì¡± í–‰ì‚¬"
  }
]
```

---

## ë°ì´í„° ë¼ì´í”„ì‚¬ì´í´

### 1. ì´ˆê¸° ìƒíƒœ (ìˆ˜ê°• ì‹ ì²­ ì§í›„)

```json
{
  "summary": {
    "attended": 0,
    "late": 0,
    "absent": 0,
    "totalSessions": 0,
    "attendanceRate": 0.0,
    "updatedAt": "2025-09-01T10:00:00"
  },
  "sessions": [],
  "pendingRequests": []
}
```

### 2. í•™ìƒ ì¶œì„ ìš”ì²­ (íšŒì°¨ 1)

```json
{
  "summary": {
    "attended": 0,
    "late": 0,
    "absent": 0,
    "totalSessions": 1,
    "attendanceRate": 0.0,
    "updatedAt": "2025-10-16T14:30:00"
  },
  "sessions": [],
  "pendingRequests": [
    {
      "sessionNumber": 1,
      "requestDate": "2025-10-16T14:30:00",
      "expiresAt": "2025-10-23T00:00:00",
      "requestReason": "ë³‘ì› ì§„ë£Œ"
    }
  ]
}
```

### 3. êµìˆ˜ ìŠ¹ì¸ (íšŒì°¨ 1 â†’ "ì¶œì„")

```json
{
  "summary": {
    "attended": 1,
    "late": 0,
    "absent": 0,
    "totalSessions": 1,
    "attendanceRate": 100.0,
    "updatedAt": "2025-10-20T10:00:00"
  },
  "sessions": [
    {
      "sessionNumber": 1,
      "status": "ì¶œ",
      "requestDate": "2025-10-16T14:30:00",
      "approvedDate": "2025-10-20T10:00:00",
      "approvedBy": 25,
      "tempApproved": false
    }
  ],
  "pendingRequests": []
}
```

### 4. í•™ìƒ ì¶”ê°€ ìš”ì²­ (íšŒì°¨ 2, 3)

```json
{
  "summary": {
    "attended": 1,
    "late": 0,
    "absent": 0,
    "totalSessions": 3,
    "attendanceRate": 33.33,
    "updatedAt": "2025-10-23T15:00:00"
  },
  "sessions": [
    {
      "sessionNumber": 1,
      "status": "ì¶œ",
      "requestDate": "2025-10-16T14:30:00",
      "approvedDate": "2025-10-20T10:00:00",
      "approvedBy": 25,
      "tempApproved": false
    }
  ],
  "pendingRequests": [
    {
      "sessionNumber": 2,
      "requestDate": "2025-10-23T14:00:00",
      "expiresAt": "2025-10-30T00:00:00",
      "requestReason": null
    },
    {
      "sessionNumber": 3,
      "requestDate": "2025-10-23T15:00:00",
      "expiresAt": "2025-10-30T00:00:00",
      "requestReason": "ê°€ì¡± í–‰ì‚¬"
    }
  ]
}
```

### 5. ìë™ ìŠ¹ì¸ (íšŒì°¨ 2 â†’ "ì¶œì„")

```json
{
  "summary": {
    "attended": 2,
    "late": 0,
    "absent": 0,
    "totalSessions": 3,
    "attendanceRate": 66.67,
    "updatedAt": "2025-10-30T00:00:00"
  },
  "sessions": [
    {
      "sessionNumber": 1,
      "status": "ì¶œ",
      "requestDate": "2025-10-16T14:30:00",
      "approvedDate": "2025-10-20T10:00:00",
      "approvedBy": 25,
      "tempApproved": false
    },
    {
      "sessionNumber": 2,
      "status": "ì¶œ",
      "requestDate": "2025-10-23T14:00:00",
      "approvedDate": "2025-10-30T00:00:00",
      "approvedBy": null,
      "tempApproved": true
    }
  ],
  "pendingRequests": [
    {
      "sessionNumber": 3,
      "requestDate": "2025-10-23T15:00:00",
      "expiresAt": "2025-10-30T00:00:00",
      "requestReason": "ê°€ì¡± í–‰ì‚¬"
    }
  ]
}
```

---

## DTO í´ë˜ìŠ¤

### AttendanceDataDto

```java
@Data
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class AttendanceDataDto {
    private AttendanceSummaryDto summary;
    private List<AttendanceSessionDto> sessions;
    private List<AttendancePendingRequestDto> pendingRequests;
}
```

### AttendanceSummaryDto

```java
@Data
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class AttendanceSummaryDto {
    private Integer attended;        // ì¶œì„ íšŸìˆ˜
    private Integer late;            // ì§€ê° íšŸìˆ˜
    private Integer absent;          // ê²°ì„ íšŸìˆ˜
    private Integer totalSessions;   // ì „ì²´ íšŒì°¨
    private Double attendanceRate;   // ì¶œì„ìœ¨
    private LocalDateTime updatedAt; // ê°±ì‹  ì‹œê°
}
```

### AttendanceSessionDto

```java
@Data
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class AttendanceSessionDto {
    private Integer sessionNumber;      // íšŒì°¨ ë²ˆí˜¸
    private String status;              // "ì¶œ", "ì§€", "ê²°"
    private LocalDateTime requestDate;  // ìš”ì²­ ì¼ì‹œ
    private LocalDateTime approvedDate; // ìŠ¹ì¸ ì¼ì‹œ
    private Integer approvedBy;         // ìŠ¹ì¸ì (null=ìë™)
    private Boolean tempApproved;       // ìë™ ìŠ¹ì¸ ì—¬ë¶€
}
```

### AttendancePendingRequestDto

```java
@Data
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class AttendancePendingRequestDto {
    private Integer sessionNumber;      // íšŒì°¨ ë²ˆí˜¸
    private LocalDateTime requestDate;  // ìš”ì²­ ì¼ì‹œ
    private LocalDateTime expiresAt;    // ë§Œë£Œ ì¼ì‹œ
    private String requestReason;       // ìš”ì²­ ì‚¬ìœ  (optional)
}
```

---

## JSON ì§ë ¬í™”/ì—­ì§ë ¬í™”

### ObjectMapper ì„¤ì •

```java
@Configuration
public class JacksonConfig {
    
    @Bean
    public ObjectMapper objectMapper() {
        ObjectMapper mapper = new ObjectMapper();
        
        // Java 8 ë‚ ì§œ/ì‹œê°„ ì§€ì›
        mapper.registerModule(new JavaTimeModule());
        
        // ISO 8601 í˜•ì‹ìœ¼ë¡œ ì§ë ¬í™”
        mapper.disable(SerializationFeature.WRITE_DATES_AS_TIMESTAMPS);
        
        // null í•„ë“œ í¬í•¨
        mapper.setSerializationInclusion(JsonInclude.Include.ALWAYS);
        
        return mapper;
    }
}
```

### ì§ë ¬í™” (Java â†’ JSON)

```java
@Autowired
private ObjectMapper objectMapper;

public void saveAttendanceData(
    EnrollmentExtendedTbl enrollment,
    AttendanceDataDto attendanceData
) throws JsonProcessingException {
    
    // Java ê°ì²´ â†’ JSON ë¬¸ìì—´
    String json = objectMapper.writeValueAsString(attendanceData);
    
    // DB ì €ì¥
    enrollment.setEnrollmentData(json);
    enrollmentRepository.save(enrollment);
}
```

### ì—­ì§ë ¬í™” (JSON â†’ Java)

```java
public AttendanceDataDto parseAttendanceData(String json) 
        throws JsonProcessingException {
    
    if (json == null || json.isEmpty()) {
        // ê¸°ë³¸ êµ¬ì¡° ë°˜í™˜
        return AttendanceDataDto.builder()
            .summary(AttendanceSummaryDto.builder()
                .attended(0)
                .late(0)
                .absent(0)
                .totalSessions(0)
                .attendanceRate(0.0)
                .updatedAt(LocalDateTime.now())
                .build())
            .sessions(new ArrayList<>())
            .pendingRequests(new ArrayList<>())
            .build();
    }
    
    // JSON ë¬¸ìì—´ â†’ Java ê°ì²´
    return objectMapper.readValue(json, AttendanceDataDto.class);
}
```

---

## ì œì•½ ì¡°ê±´

### 1. íšŒì°¨ ì¤‘ë³µ ë°©ì§€

**ê·œì¹™**: ê°™ì€ í•™ìƒì˜ ê°™ì€ íšŒì°¨ëŠ” sessions + pendingRequestsì— ì´ 1ê°œë§Œ ì¡´ì¬

```java
// âŒ ì˜ëª»ëœ ë°ì´í„°
{
  "sessions": [
    { "sessionNumber": 1, "status": "ì¶œ" }
  ],
  "pendingRequests": [
    { "sessionNumber": 1 } // ì¤‘ë³µ!
  ]
}

// âœ… ì˜¬ë°”ë¥¸ ë°ì´í„°
{
  "sessions": [
    { "sessionNumber": 1, "status": "ì¶œ" }
  ],
  "pendingRequests": [
    { "sessionNumber": 2 } // ë‹¤ë¥¸ íšŒì°¨
  ]
}
```

### 2. status ê°’ ì œí•œ

**ê·œì¹™**: "ì¶œ", "ì§€", "ê²°" ì¤‘ í•˜ë‚˜ë§Œ í—ˆìš©

```java
@Pattern(regexp = "^(ì¶œ|ì§€|ê²°)$", message = "ì¶œì„ ìƒíƒœëŠ” 'ì¶œ', 'ì§€', 'ê²°' ì¤‘ í•˜ë‚˜ì—¬ì•¼ í•©ë‹ˆë‹¤.")
private String status;
```

### 3. sessionNumber ë²”ìœ„

**ê·œì¹™**: 1 ~ 80 ì‚¬ì´ì˜ ì •ìˆ˜

```java
@Min(1)
@Max(80)
private Integer sessionNumber;
```

### 4. requestReason ê¸¸ì´

**ê·œì¹™**: ìµœëŒ€ 200ì

```java
@Size(max = 200, message = "ìš”ì²­ ì‚¬ìœ ëŠ” ìµœëŒ€ 200ìê¹Œì§€ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.")
private String requestReason;
```

---

## ë°ì´í„° ê²€ì¦

### Service ë ˆë²¨ ê²€ì¦

```java
private void validateAttendanceData(AttendanceDataDto attendanceData) {
    // 1. íšŒì°¨ ì¤‘ë³µ ê²€ì‚¬
    Set<Integer> allSessionNumbers = new HashSet<>();
    
    for (AttendanceSessionDto session : attendanceData.getSessions()) {
        if (!allSessionNumbers.add(session.getSessionNumber())) {
            throw new IllegalStateException(
                "ì¤‘ë³µëœ íšŒì°¨ ë²ˆí˜¸: " + session.getSessionNumber()
            );
        }
    }
    
    for (AttendancePendingRequestDto request : attendanceData.getPendingRequests()) {
        if (!allSessionNumbers.add(request.getSessionNumber())) {
            throw new IllegalStateException(
                "ì¤‘ë³µëœ íšŒì°¨ ë²ˆí˜¸: " + request.getSessionNumber()
            );
        }
    }
    
    // 2. status ê°’ ê²€ì¦
    for (AttendanceSessionDto session : attendanceData.getSessions()) {
        if (!Arrays.asList("ì¶œ", "ì§€", "ê²°").contains(session.getStatus())) {
            throw new IllegalArgumentException(
                "ì˜ëª»ëœ ì¶œì„ ìƒíƒœ: " + session.getStatus()
            );
        }
    }
    
    // 3. summary ì¼ê´€ì„± ê²€ì¦
    recalculateSummary(attendanceData);
}
```

---

## í”„ë¡ íŠ¸ì—”ë“œ ì²˜ë¦¬

### React ì˜ˆì‹œ

```jsx
function AttendanceDashboard({ attendanceData }) {
    const { summary, sessions, pendingRequests } = attendanceData;
    
    return (
        <div>
            {/* ìš”ì•½ ì •ë³´ */}
            <div className="summary">
                <h3>ì¶œì„ìœ¨: {summary.attendanceRate.toFixed(1)}%</h3>
                <p>ì¶œì„: {summary.attended}íšŒ</p>
                <p>ì§€ê°: {summary.late}íšŒ</p>
                <p>ê²°ì„: {summary.absent}íšŒ</p>
                <p>ì „ì²´: {summary.totalSessions}íšŒ</p>
            </div>
            
            {/* ìŠ¹ì¸ëœ ì¶œì„ ê¸°ë¡ */}
            <div className="sessions">
                <h3>ì¶œì„ ê¸°ë¡</h3>
                <table>
                    <thead>
                        <tr>
                            <th>íšŒì°¨</th>
                            <th>ìƒíƒœ</th>
                            <th>ìš”ì²­ì¼</th>
                            <th>ìŠ¹ì¸ì¼</th>
                            <th>ìŠ¹ì¸ì</th>
                        </tr>
                    </thead>
                    <tbody>
                        {sessions.map(session => (
                            <tr key={session.sessionNumber}>
                                <td>{session.sessionNumber}</td>
                                <td>{session.status}</td>
                                <td>{formatDate(session.requestDate)}</td>
                                <td>{formatDate(session.approvedDate)}</td>
                                <td>
                                    {session.tempApproved 
                                        ? 'ìë™ ìŠ¹ì¸' 
                                        : `êµìˆ˜ ${session.approvedBy}`}
                                </td>
                            </tr>
                        ))}
                    </tbody>
                </table>
            </div>
            
            {/* ëŒ€ê¸° ì¤‘ì¸ ìš”ì²­ */}
            <div className="pending">
                <h3>ëŒ€ê¸° ì¤‘ ({pendingRequests.length})</h3>
                <ul>
                    {pendingRequests.map(request => (
                        <li key={request.sessionNumber}>
                            íšŒì°¨ {request.sessionNumber} - 
                            ë§Œë£Œ: {formatDate(request.expiresAt)}
                            {request.requestReason && ` (${request.requestReason})`}
                        </li>
                    ))}
                </ul>
            </div>
        </div>
    );
}
```

---

## ì£¼ì˜ì‚¬í•­

### ë°±ì—”ë“œ ê°œë°œì

1. **summary ì¬ê³„ì‚° í•„ìˆ˜**
   - sessions ë˜ëŠ” pendingRequests ë³€ê²½ ì‹œ ë°˜ë“œì‹œ ì¬ê³„ì‚°
   - `recalculateSummary()` í˜¸ì¶œ

2. **JSON íŒŒì‹± ì˜ˆì™¸ ì²˜ë¦¬**
   - ì˜ëª»ëœ JSON í˜•ì‹ ëŒ€ë¹„
   - ê¸°ë³¸ êµ¬ì¡° ë°˜í™˜

3. **íŠ¸ëœì­ì…˜ ê´€ë¦¬**
   - JSON ì—…ë°ì´íŠ¸ëŠ” ì›ìì ìœ¼ë¡œ ì²˜ë¦¬
   - ë¡¤ë°± ì‹œ ë°ì´í„° ì¼ê´€ì„± ìœ ì§€

### í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œì

1. **ì¶œì„ìœ¨ ì†Œìˆ˜ì  í‘œì‹œ**
   - `toFixed(1)` ë˜ëŠ” `toFixed(2)` ì‚¬ìš©
   - 0ìœ¼ë¡œ ë‚˜ëˆ„ê¸° ë°©ì§€

2. **ë‚ ì§œ í¬ë§·íŒ…**
   - ISO 8601 â†’ ì‚¬ìš©ì ì¹œí™”ì  í˜•ì‹ ë³€í™˜
   - ë¡œì¼€ì¼ ê³ ë ¤

3. **ëŒ€ê¸° ì¤‘ì¸ ìš”ì²­ í‘œì‹œ**
   - ë§Œë£Œì¼ê¹Œì§€ ë‚¨ì€ ì¼ìˆ˜ ê³„ì‚°
   - ë§Œë£Œ ì„ë°• ì‹œ ê²½ê³  í‘œì‹œ

---

## ë‹¤ìŒ ë‹¨ê³„

- **[03. í•™ìƒ ì¶œì„ ìš”ì²­](./03_í•™ìƒ_ì¶œì„_ìš”ì²­.md)**: JSON ìƒì„± ë° ì—…ë°ì´íŠ¸
- **[04. êµìˆ˜ ì¶œì„ ìŠ¹ì¸](./04_êµìˆ˜_ì¶œì„_ìŠ¹ì¸.md)**: pendingRequests â†’ sessions ì´ë™
- **[06. ìë™ ìŠ¹ì¸ ë©”ì»¤ë‹ˆì¦˜](./06_ìë™_ìŠ¹ì¸_ë©”ì»¤ë‹ˆì¦˜.md)**: sessions ë°°ì—´ ì—…ë°ì´íŠ¸

---

**ğŸ“š [ëª©ì°¨ë¡œ ëŒì•„ê°€ê¸°](./README.md)**

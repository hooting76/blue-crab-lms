# 09. ì˜ˆì™¸ ì²˜ë¦¬ ë° í™•ì¥

> ğŸ›¡ï¸ ì¶œê²° ê´€ë¦¬ ì‹œìŠ¤í…œì˜ ì˜ˆì™¸ ì²˜ë¦¬ ì „ëµê³¼ í–¥í›„ í™•ì¥ ê°€ëŠ¥ì„±

---

## ê°œìš”

ì¶œê²° ê´€ë¦¬ ì‹œìŠ¤í…œì˜ ì•ˆì •ì„±ì„ ë³´ì¥í•˜ê¸° ìœ„í•œ ì˜ˆì™¸ ì²˜ë¦¬ ì „ëµê³¼ í–¥í›„ í™•ì¥ ê³„íšì„ ë‹¤ë£¹ë‹ˆë‹¤.

---

## ì˜ˆì™¸ ì²˜ë¦¬ ì „ëµ

### ì˜ˆì™¸ ê³„ì¸µ êµ¬ì¡°

```
RuntimeException
â”œâ”€â”€ UnauthorizedException (401)
â”œâ”€â”€ ForbiddenException (403)
â”œâ”€â”€ NotFoundException (404)
â”œâ”€â”€ ConflictException (409)
â””â”€â”€ BadRequestException (400)
```

### ì»¤ìŠ¤í…€ ì˜ˆì™¸ í´ë˜ìŠ¤

#### 1. UnauthorizedException (401)

```java
@ResponseStatus(HttpStatus.UNAUTHORIZED)
public class UnauthorizedException extends RuntimeException {
    public UnauthorizedException(String message) {
        super(message);
    }
}
```

**ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤**:
- JWT í† í°ì´ ì—†ìŒ
- JWT í† í°ì´ ë§Œë£Œë¨
- JWT í† í°ì´ ìœ íš¨í•˜ì§€ ì•ŠìŒ

**ì˜ˆì‹œ**:
```java
if (token == null || token.isEmpty()) {
    throw new UnauthorizedException("ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤.");
}
```

#### 2. ForbiddenException (403)

```java
@ResponseStatus(HttpStatus.FORBIDDEN)
public class ForbiddenException extends RuntimeException {
    public ForbiddenException(String message) {
        super(message);
    }
}
```

**ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤**:
- ë‹´ë‹¹ êµìˆ˜ê°€ ì•„ë‹Œ ê²½ìš°
- ê¶Œí•œì´ ì—†ëŠ” ë¦¬ì†ŒìŠ¤ ì ‘ê·¼

**ì˜ˆì‹œ**:
```java
if (!enrollment.isPresent()) {
    throw new ForbiddenException("í•´ë‹¹ ê°•ì˜ì˜ ë‹´ë‹¹ êµìˆ˜ê°€ ì•„ë‹™ë‹ˆë‹¤.");
}
```

#### 3. NotFoundException (404)

```java
@ResponseStatus(HttpStatus.NOT_FOUND)
public class NotFoundException extends RuntimeException {
    public NotFoundException(String message) {
        super(message);
    }
}
```

**ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤**:
- ìˆ˜ê°•ìƒì„ ì°¾ì„ ìˆ˜ ì—†ìŒ
- ê°•ì˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ
- ëŒ€ê¸° ì¤‘ì¸ ìš”ì²­ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ

**ì˜ˆì‹œ**:
```java
EnrollmentExtendedTbl enrollment = enrollmentRepository
    .findByLecSerialAndStudentIdx(lecSerial, studentIdx)
    .orElseThrow(() -> new NotFoundException("ìˆ˜ê°•ìƒì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."));
```

#### 4. ConflictException (409)

```java
@ResponseStatus(HttpStatus.CONFLICT)
public class ConflictException extends RuntimeException {
    public ConflictException(String message) {
        super(message);
    }
}
```

**ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤**:
- ì´ë¯¸ ìŠ¹ì¸ëœ íšŒì°¨ì— ì¤‘ë³µ ìš”ì²­
- ì´ë¯¸ í™•ì •ëœ ì„¸ì…˜ì— ìˆ˜ì • ì‹œë„

**ì˜ˆì‹œ**:
```java
boolean alreadyApproved = sessions.stream()
    .anyMatch(s -> s.getSessionNumber().equals(sessionNumber));

if (alreadyApproved) {
    throw new ConflictException("ì´ë¯¸ ìŠ¹ì¸ëœ íšŒì°¨ì…ë‹ˆë‹¤.");
}
```

#### 5. BadRequestException (400)

```java
@ResponseStatus(HttpStatus.BAD_REQUEST)
public class BadRequestException extends RuntimeException {
    public BadRequestException(String message) {
        super(message);
    }
}
```

**ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤**:
- ì˜ëª»ëœ íŒŒë¼ë¯¸í„° ê°’
- ìœ íš¨í•˜ì§€ ì•Šì€ íšŒì°¨ ë²ˆí˜¸
- ìœ íš¨í•˜ì§€ ì•Šì€ ì¶œì„ ìƒíƒœ

**ì˜ˆì‹œ**:
```java
if (sessionNumber < 1 || sessionNumber > 80) {
    throw new BadRequestException("íšŒì°¨ ë²ˆí˜¸ëŠ” 1ì—ì„œ 80 ì‚¬ì´ì—¬ì•¼ í•©ë‹ˆë‹¤.");
}
```

---

## ê¸€ë¡œë²Œ ì˜ˆì™¸ í•¸ë“¤ëŸ¬

### @RestControllerAdvice êµ¬í˜„

```java
@RestControllerAdvice
@Slf4j
public class GlobalExceptionHandler {

    // 401 Unauthorized
    @ExceptionHandler(UnauthorizedException.class)
    public ResponseEntity<AttendanceResponseDto> handleUnauthorized(
        UnauthorizedException e
    ) {
        log.warn("Unauthorized: {}", e.getMessage());
        return ResponseEntity.status(HttpStatus.UNAUTHORIZED)
            .body(AttendanceResponseDto.error(e.getMessage(), "UNAUTHORIZED"));
    }

    // 403 Forbidden
    @ExceptionHandler(ForbiddenException.class)
    public ResponseEntity<AttendanceResponseDto> handleForbidden(
        ForbiddenException e
    ) {
        log.warn("Forbidden: {}", e.getMessage());
        return ResponseEntity.status(HttpStatus.FORBIDDEN)
            .body(AttendanceResponseDto.error(e.getMessage(), "FORBIDDEN"));
    }

    // 404 Not Found
    @ExceptionHandler(NotFoundException.class)
    public ResponseEntity<AttendanceResponseDto> handleNotFound(
        NotFoundException e
    ) {
        log.warn("Not Found: {}", e.getMessage());
        return ResponseEntity.status(HttpStatus.NOT_FOUND)
            .body(AttendanceResponseDto.error(e.getMessage(), "NOT_FOUND"));
    }

    // 409 Conflict
    @ExceptionHandler(ConflictException.class)
    public ResponseEntity<AttendanceResponseDto> handleConflict(
        ConflictException e
    ) {
        log.warn("Conflict: {}", e.getMessage());
        return ResponseEntity.status(HttpStatus.CONFLICT)
            .body(AttendanceResponseDto.error(e.getMessage(), "CONFLICT"));
    }

    // 400 Bad Request (Validation)
    @ExceptionHandler(MethodArgumentNotValidException.class)
    public ResponseEntity<AttendanceResponseDto> handleValidation(
        MethodArgumentNotValidException e
    ) {
        String message = e.getBindingResult().getAllErrors().stream()
            .map(DefaultMessageSourceResolvable::getDefaultMessage)
            .collect(Collectors.joining(", "));
        
        log.warn("Validation Error: {}", message);
        return ResponseEntity.badRequest()
            .body(AttendanceResponseDto.error(message, "VALIDATION_ERROR"));
    }

    // 500 Internal Server Error
    @ExceptionHandler(Exception.class)
    public ResponseEntity<AttendanceResponseDto> handleGeneral(Exception e) {
        log.error("Internal Server Error", e);
        return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR)
            .body(AttendanceResponseDto.error(
                "ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.",
                "INTERNAL_ERROR"
            ));
    }
}
```

### ì—ëŸ¬ ì‘ë‹µ êµ¬ì¡°

```java
@Data
@Builder
public class AttendanceResponseDto {
    private Boolean success;
    private String message;
    private Object data;
    private String timestamp;
    private String errorCode;

    public static AttendanceResponseDto error(String message, String errorCode) {
        return AttendanceResponseDto.builder()
            .success(false)
            .message(message)
            .data(null)
            .timestamp(LocalDateTime.now().toString())
            .errorCode(errorCode)
            .build();
    }
}
```

---

## ì˜ˆì™¸ ì²˜ë¦¬ ì¼€ì´ìŠ¤ë³„ ê°€ì´ë“œ

### ì¼€ì´ìŠ¤ 1: JWT í† í° ê´€ë ¨

| ìƒí™© | ì˜ˆì™¸ | HTTP | ë©”ì‹œì§€ |
|-----|------|------|--------|
| í† í° ì—†ìŒ | UnauthorizedException | 401 | "ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤." |
| í† í° ë§Œë£Œ | UnauthorizedException | 401 | "í† í°ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤." |
| í† í° ë¬´íš¨ | UnauthorizedException | 401 | "ìœ íš¨í•˜ì§€ ì•Šì€ í† í°ì…ë‹ˆë‹¤." |

**í”„ë¡ íŠ¸ì—”ë“œ ì²˜ë¦¬**:
```javascript
if (response.status === 401) {
    // ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
    localStorage.removeItem('accessToken');
    window.location.href = '/login';
}
```

### ì¼€ì´ìŠ¤ 2: ê¶Œí•œ ê´€ë ¨

| ìƒí™© | ì˜ˆì™¸ | HTTP | ë©”ì‹œì§€ |
|-----|------|------|--------|
| ë‹´ë‹¹ êµìˆ˜ ì•„ë‹˜ | ForbiddenException | 403 | "í•´ë‹¹ ê°•ì˜ì˜ ë‹´ë‹¹ êµìˆ˜ê°€ ì•„ë‹™ë‹ˆë‹¤." |
| ìˆ˜ê°•ìƒ ì•„ë‹˜ | NotFoundException | 404 | "ìˆ˜ê°•ìƒì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤." |

**í”„ë¡ íŠ¸ì—”ë“œ ì²˜ë¦¬**:
```javascript
if (response.status === 403) {
    alert('ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤. ë‹´ë‹¹ ê°•ì˜ ëª©ë¡ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.');
    window.location.href = '/professor/lectures';
}
```

### ì¼€ì´ìŠ¤ 3: ë°ì´í„° ê²€ì¦

| ìƒí™© | ì˜ˆì™¸ | HTTP | ë©”ì‹œì§€ |
|-----|------|------|--------|
| íšŒì°¨ ë²”ìœ„ ì´ˆê³¼ | BadRequestException | 400 | "íšŒì°¨ ë²ˆí˜¸ëŠ” 1ì—ì„œ 80 ì‚¬ì´ì—¬ì•¼ í•©ë‹ˆë‹¤." |
| ì˜ëª»ëœ ìƒíƒœ ê°’ | BadRequestException | 400 | "ì¶œì„ ìƒíƒœëŠ” 'ì¶œ', 'ì§€', 'ê²°' ì¤‘ í•˜ë‚˜ì—¬ì•¼ í•©ë‹ˆë‹¤." |
| ì‚¬ìœ  ê¸¸ì´ ì´ˆê³¼ | BadRequestException | 400 | "ìš”ì²­ ì‚¬ìœ ëŠ” ìµœëŒ€ 200ìê¹Œì§€ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤." |

**í”„ë¡ íŠ¸ì—”ë“œ ì²˜ë¦¬**:
```javascript
if (response.status === 400) {
    // ì…ë ¥ í•„ë“œ í•˜ì´ë¼ì´íŠ¸
    const data = await response.json();
    showValidationError(data.message);
}
```

### ì¼€ì´ìŠ¤ 4: ì¤‘ë³µ ë°ì´í„°

| ìƒí™© | ì˜ˆì™¸ | HTTP | ë©”ì‹œì§€ |
|-----|------|------|--------|
| ì´ë¯¸ ìŠ¹ì¸ë¨ | ConflictException | 409 | "ì´ë¯¸ ìŠ¹ì¸ëœ íšŒì°¨ì…ë‹ˆë‹¤." |
| ì´ë¯¸ ìš”ì²­ë¨ | - | 200 | "ê¸°ì¡´ ìš”ì²­ì„ ì—…ë°ì´íŠ¸í–ˆìŠµë‹ˆë‹¤." |

**ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§**:
```java
// ì´ë¯¸ ìŠ¹ì¸ëœ ê²½ìš°: 409 ì—ëŸ¬
if (isInSessions(sessionNumber)) {
    throw new ConflictException("ì´ë¯¸ ìŠ¹ì¸ëœ íšŒì°¨ì…ë‹ˆë‹¤.");
}

// ì´ë¯¸ ìš”ì²­ ì¤‘ì¸ ê²½ìš°: ì—…ë°ì´íŠ¸ (ì—ëŸ¬ ì•„ë‹˜)
if (isInPendingRequests(sessionNumber)) {
    updateExistingRequest(sessionNumber, newReason);
    return "ê¸°ì¡´ ìš”ì²­ì„ ì—…ë°ì´íŠ¸í–ˆìŠµë‹ˆë‹¤.";
}
```

---

## ë¡œê¹… ì „ëµ

### ë¡œê·¸ ë ˆë²¨ë³„ ì‚¬ìš©

```java
@Slf4j
public class AttendanceService {
    
    public void requestAttendance(...) {
        // INFO: ì •ìƒ ë™ì‘
        log.info("ì¶œì„ ìš”ì²­: lecSerial={}, studentIdx={}, sessionNumber={}", 
                 lecSerial, studentIdx, sessionNumber);
        
        try {
            // ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
        } catch (NotFoundException e) {
            // WARN: ì˜ˆìƒ ê°€ëŠ¥í•œ ì—ëŸ¬
            log.warn("ìˆ˜ê°•ìƒì„ ì°¾ì„ ìˆ˜ ì—†ìŒ: studentIdx={}", studentIdx);
            throw e;
        } catch (Exception e) {
            // ERROR: ì˜ˆìƒ ëª»í•œ ì—ëŸ¬
            log.error("ì¶œì„ ìš”ì²­ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ ë°œìƒ", e);
            throw new RuntimeException("ì¶œì„ ìš”ì²­ ì²˜ë¦¬ ì‹¤íŒ¨", e);
        }
    }
}
```

### ë¡œê·¸ ë ˆë²¨ ê°€ì´ë“œ

| ë ˆë²¨ | ìš©ë„ | ì˜ˆì‹œ |
|-----|------|------|
| **TRACE** | ìƒì„¸ ë””ë²„ê¹… | ë³€ìˆ˜ ê°’, ë©”ì„œë“œ ì§„ì…/ì¢…ë£Œ |
| **DEBUG** | ê°œë°œ ë””ë²„ê¹… | JSON íŒŒì‹± ê²°ê³¼, ì¿¼ë¦¬ íŒŒë¼ë¯¸í„° |
| **INFO** | ì •ìƒ ë™ì‘ | API í˜¸ì¶œ, ìŠ¹ì¸ ì™„ë£Œ |
| **WARN** | ì˜ˆìƒ ê°€ëŠ¥í•œ ì—ëŸ¬ | ê¶Œí•œ ì—†ìŒ, ë°ì´í„° ì—†ìŒ |
| **ERROR** | ì‹¬ê°í•œ ì—ëŸ¬ | ì˜ˆì™¸ ë°œìƒ, DB ì˜¤ë¥˜ |

### ë¡œê·¸ ì„¤ì •

```properties
# application.properties
logging.level.com.bluecrab.attendance=INFO
logging.level.com.bluecrab.attendance.scheduler=DEBUG

# íŒŒì¼ ì¶œë ¥
logging.file.name=logs/attendance.log
logging.pattern.file=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n
```

---

## íŠ¸ëœì­ì…˜ ê´€ë¦¬

### @Transactional ì ìš©

```java
@Service
@Transactional(readOnly = true)
public class AttendanceService {
    
    // ì½ê¸° ì „ìš© (ê¸°ë³¸)
    public AttendanceDataDto getStudentAttendance(...) {
        // readOnly = true (ì„±ëŠ¥ ìµœì í™”)
    }
    
    // ì“°ê¸° íŠ¸ëœì­ì…˜
    @Transactional
    public void requestAttendance(...) {
        // readOnly = false (ë°ì´í„° ë³€ê²½)
    }
    
    // íŠ¸ëœì­ì…˜ ì „íŒŒ
    @Transactional(propagation = Propagation.REQUIRES_NEW)
    public void logAttendanceChange(...) {
        // ë…ë¦½ì ì¸ íŠ¸ëœì­ì…˜ (ë¶€ëª¨ ë¡¤ë°±í•´ë„ ì»¤ë°‹)
    }
}
```

### ë¡¤ë°± ì „ëµ

```java
@Transactional(rollbackFor = Exception.class)
public void approveAttendance(...) {
    try {
        // 1. ë°ì´í„° ê²€ì¦
        validateData();
        
        // 2. ì¶œì„ ìŠ¹ì¸ ì²˜ë¦¬
        processApproval();
        
        // 3. ì•Œë¦¼ ì „ì†¡ (ì‹¤íŒ¨í•´ë„ ë¡¤ë°± ì•ˆ í•¨)
        sendNotification(); // @Transactional(propagation = REQUIRES_NEW)
        
    } catch (Exception e) {
        log.error("ìŠ¹ì¸ ì²˜ë¦¬ ì‹¤íŒ¨: ë¡¤ë°± ìˆ˜í–‰", e);
        throw e; // ë¡¤ë°± íŠ¸ë¦¬ê±°
    }
}
```

---

## ë™ì‹œì„± ì œì–´

### ë‚™ê´€ì  ì ê¸ˆ (Optimistic Locking)

```java
@Entity
@Table(name = "ENROLLMENT_EXTENDED_TBL")
public class EnrollmentExtendedTbl {
    
    @Version
    @Column(name = "VERSION")
    private Long version; // JPAê°€ ìë™ìœ¼ë¡œ ì¦ê°€
    
    // ê¸°íƒ€ í•„ë“œ...
}
```

**ë™ì‘ ì›ë¦¬**:
```sql
-- ì½ê¸°
SELECT * FROM ENROLLMENT_EXTENDED_TBL WHERE ENR_NO = 1 AND VERSION = 5;

-- ì“°ê¸° (ë²„ì „ í™•ì¸)
UPDATE ENROLLMENT_EXTENDED_TBL 
SET ENROLLMENT_DATA = ?, VERSION = 6
WHERE ENR_NO = 1 AND VERSION = 5;

-- ë²„ì „ì´ ë‹¤ë¥´ë©´ OptimisticLockException ë°œìƒ
```

**ì²˜ë¦¬ ë°©ë²•**:
```java
@Transactional
public void requestAttendance(...) {
    try {
        EnrollmentExtendedTbl enrollment = 
            enrollmentRepository.findById(enrNo).orElseThrow();
        
        // ë°ì´í„° ìˆ˜ì •
        enrollment.setEnrollmentData(updatedJson);
        enrollmentRepository.save(enrollment);
        
    } catch (OptimisticLockException e) {
        log.warn("ë™ì‹œì„± ì¶©ëŒ: ì¬ì‹œë„ í•„ìš”");
        throw new ConflictException("ë‹¤ë¥¸ ì‚¬ìš©ìê°€ ìˆ˜ì • ì¤‘ì…ë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
    }
}
```

### ë¹„ê´€ì  ì ê¸ˆ (Pessimistic Locking)

```java
@Lock(LockModeType.PESSIMISTIC_WRITE)
@Query("SELECT e FROM EnrollmentExtendedTbl e WHERE e.enrNo = :enrNo")
Optional<EnrollmentExtendedTbl> findByIdWithLock(@Param("enrNo") Integer enrNo);
```

**ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤**:
- ì¶©ëŒì´ ë¹ˆë²ˆí•œ ê²½ìš°
- ë°ì´í„° ì •í•©ì„±ì´ ë§¤ìš° ì¤‘ìš”í•œ ê²½ìš°

---

## ì„±ëŠ¥ ìµœì í™”

### 1. ì¸ë±ìŠ¤ ì¶”ê°€

```sql
-- ê°•ì˜ ì½”ë“œ + í•™ìƒ ì¡°íšŒ ìµœì í™”
CREATE INDEX idx_enrollment_lec_student 
ON ENROLLMENT_EXTENDED_TBL(LEC_SERIAL, USER_IDX);

-- ê°•ì˜ ì½”ë“œ + êµìˆ˜ ì¡°íšŒ ìµœì í™” (ì¡°ì¸)
CREATE INDEX idx_lec_serial_prof 
ON LEC_TBL(LEC_SERIAL, LEC_PROF);
```

### 2. ì¿¼ë¦¬ ìµœì í™”

```java
// âŒ N+1 ë¬¸ì œ
List<EnrollmentExtendedTbl> enrollments = 
    enrollmentRepository.findAllByLecSerial(lecSerial);

for (EnrollmentExtendedTbl enrollment : enrollments) {
    UserTbl user = enrollment.getUserTbl(); // ì¶”ê°€ ì¿¼ë¦¬ ë°œìƒ
}

// âœ… Fetch Join ì‚¬ìš©
@Query("SELECT e FROM EnrollmentExtendedTbl e " +
       "JOIN FETCH e.userTbl " +
       "WHERE e.lecTbl.lecSerial = :lecSerial")
List<EnrollmentExtendedTbl> findAllByLecSerialWithUser(
    @Param("lecSerial") String lecSerial
);
```

### 3. ìºì‹±

```java
@Cacheable(value = "attendance", key = "#lecSerial + ':' + #studentIdx")
public AttendanceDataDto getStudentAttendance(
    String lecSerial, 
    Integer studentIdx
) {
    // ìºì‹œì—ì„œ ë¨¼ì € í™•ì¸, ì—†ìœ¼ë©´ DB ì¡°íšŒ
}

@CacheEvict(value = "attendance", key = "#lecSerial + ':' + #studentIdx")
public void requestAttendance(...) {
    // ìºì‹œ ë¬´íš¨í™”
}
```

---

## í–¥í›„ í™•ì¥ ê°€ëŠ¥ì„±

### 1. ì‹¤ì‹œê°„ ì•Œë¦¼ ì‹œìŠ¤í…œ

**WebSocket ì—°ë™**:
```java
@Service
public class AttendanceNotificationService {
    
    @Autowired
    private SimpMessagingTemplate messagingTemplate;
    
    public void notifyApproval(Integer studentIdx, Integer sessionNumber) {
        messagingTemplate.convertAndSendToUser(
            studentIdx.toString(),
            "/queue/attendance",
            "íšŒì°¨ " + sessionNumber + " ì¶œì„ì´ ìŠ¹ì¸ë˜ì—ˆìŠµë‹ˆë‹¤."
        );
    }
}
```

### 2. ì¶œì„ íŒ¨í„´ ë¶„ì„

**ë¨¸ì‹ ëŸ¬ë‹ ì—°ë™**:
```java
@Service
public class AttendanceAnalyticsService {
    
    public Map<String, Object> analyzeAttendancePattern(
        String lecSerial, 
        Integer studentIdx
    ) {
        // ì¶œì„ìœ¨ ì¶”ì´ ë¶„ì„
        // ì§€ê° íŒ¨í„´ ë¶„ì„
        // ì˜ˆì¸¡ ëª¨ë¸ ì ìš©
        return analysis;
    }
}
```

### 3. QR ì½”ë“œ ì¶œì„ ì²´í¬

**ëª¨ë°”ì¼ ì•± ì—°ë™**:
```java
@PostMapping("/attendance/qr-checkin")
public ResponseEntity<?> qrCheckIn(@RequestBody QrCheckInRequest request) {
    // QR ì½”ë“œ ê²€ì¦
    // ìœ„ì¹˜ ê¸°ë°˜ ê²€ì¦ (GPS)
    // ì‹œê°„ ê¸°ë°˜ ê²€ì¦ (ìˆ˜ì—… ì‹œê°„)
    // ìë™ ì¶œì„ ì²˜ë¦¬
}
```

### 4. ë¶€ëª¨/ë³´í˜¸ì ì•Œë¦¼

**SMS/ì´ë©”ì¼ ì—°ë™**:
```java
@Service
public class ParentNotificationService {
    
    @Async
    public void notifyParent(Integer studentIdx, String message) {
        // í•™ìƒì˜ ë³´í˜¸ì ì •ë³´ ì¡°íšŒ
        // SMS ë˜ëŠ” ì´ë©”ì¼ ì „ì†¡
        // ì•Œë¦¼ ì´ë ¥ ì €ì¥
    }
}
```

### 5. ì¶œì„ ë°ì´í„° export

**ì—‘ì…€/CSV ë‹¤ìš´ë¡œë“œ**:
```java
@GetMapping("/attendance/export")
public ResponseEntity<byte[]> exportAttendance(
    @RequestParam String lecSerial
) {
    // ì¶œì„ ë°ì´í„° ì¡°íšŒ
    // Excel íŒŒì¼ ìƒì„± (Apache POI)
    // ë‹¤ìš´ë¡œë“œ ì‘ë‹µ
}
```

### 6. í†µê³„ ëŒ€ì‹œë³´ë“œ

**ì§‘ê³„ ì¿¼ë¦¬**:
```java
@Query("SELECT " +
       "l.lecSerial, " +
       "AVG(CAST(JSON_EXTRACT(e.enrollmentData, '$.attendance.summary.attendanceRate') AS DOUBLE)) as avgRate " +
       "FROM EnrollmentExtendedTbl e " +
       "JOIN e.lecTbl l " +
       "GROUP BY l.lecSerial")
List<Object[]> getAttendanceStatistics();
```

---

## ë³´ì•ˆ ê°•í™”

### 1. Rate Limiting

```java
@Component
public class RateLimitInterceptor implements HandlerInterceptor {
    
    private final Map<String, AtomicInteger> requestCounts = new ConcurrentHashMap<>();
    
    @Override
    public boolean preHandle(
        HttpServletRequest request, 
        HttpServletResponse response, 
        Object handler
    ) {
        String clientId = extractClientId(request);
        AtomicInteger count = requestCounts.computeIfAbsent(
            clientId, 
            k -> new AtomicInteger(0)
        );
        
        if (count.incrementAndGet() > 100) { // ë¶„ë‹¹ 100íšŒ ì œí•œ
            response.setStatus(429); // Too Many Requests
            return false;
        }
        
        return true;
    }
}
```

### 2. IP í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸

```java
@Component
public class IpWhitelistFilter implements Filter {
    
    private final Set<String> whitelist = Set.of(
        "192.168.1.0/24",
        "10.0.0.0/8"
    );
    
    @Override
    public void doFilter(
        ServletRequest request, 
        ServletResponse response, 
        FilterChain chain
    ) throws IOException, ServletException {
        String clientIp = request.getRemoteAddr();
        
        if (!isWhitelisted(clientIp)) {
            ((HttpServletResponse) response).setStatus(403);
            return;
        }
        
        chain.doFilter(request, response);
    }
}
```

### 3. ê°ì‚¬ ë¡œê·¸ (Audit Log)

```java
@Aspect
@Component
@Slf4j
public class AuditLogAspect {
    
    @Around("@annotation(com.bluecrab.annotation.Auditable)")
    public Object logAudit(ProceedingJoinPoint joinPoint) throws Throwable {
        String method = joinPoint.getSignature().getName();
        Object[] args = joinPoint.getArgs();
        
        log.info("ê°ì‚¬ ë¡œê·¸: method={}, args={}, timestamp={}", 
                 method, args, LocalDateTime.now());
        
        Object result = joinPoint.proceed();
        
        log.info("ê°ì‚¬ ë¡œê·¸: method={}, result={}", method, result);
        
        return result;
    }
}
```

---

## í…ŒìŠ¤íŠ¸ ì „ëµ

### ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ (Unit Test)

```java
@SpringBootTest
@Transactional
public class AttendanceServiceTest {
    
    @Autowired
    private AttendanceService attendanceService;
    
    @Test
    public void testRequestAttendance_Success() {
        // Given
        String lecSerial = "ETH201";
        Integer studentIdx = 6;
        Integer sessionNumber = 1;
        
        // When
        attendanceService.requestAttendance(lecSerial, studentIdx, sessionNumber, null);
        
        // Then
        AttendanceDataDto data = attendanceService.getStudentAttendance(lecSerial, studentIdx);
        assertEquals(1, data.getPendingRequests().size());
    }
    
    @Test
    public void testRequestAttendance_AlreadyApproved() {
        // Given: ì´ë¯¸ ìŠ¹ì¸ëœ íšŒì°¨
        
        // When & Then
        assertThrows(ConflictException.class, () -> {
            attendanceService.requestAttendance(lecSerial, studentIdx, sessionNumber, null);
        });
    }
}
```

### í†µí•© í…ŒìŠ¤íŠ¸ (Integration Test)

```java
@SpringBootTest
@AutoConfigureMockMvc
public class AttendanceControllerTest {
    
    @Autowired
    private MockMvc mockMvc;
    
    @Test
    public void testApproveAttendance_Success() throws Exception {
        String token = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...";
        
        mockMvc.perform(post("/api/attendance/approve")
                .header("Authorization", "Bearer " + token)
                .contentType(MediaType.APPLICATION_JSON)
                .content("{\"lecSerial\":\"ETH201\",\"sessionNumber\":1,\"attendanceRecords\":[{\"studentIdx\":6,\"status\":\"ì¶œ\"}]}"))
                .andExpect(status().isOk())
                .andExpect(jsonPath("$.success").value(true));
    }
}
```

---

## ëª¨ë‹ˆí„°ë§

### 1. í—¬ìŠ¤ ì²´í¬

```java
@RestController
public class HealthController {
    
    @GetMapping("/health")
    public Map<String, Object> health() {
        return Map.of(
            "status", "UP",
            "timestamp", LocalDateTime.now()
        );
    }
}
```

### 2. ë©”íŠ¸ë¦­ ìˆ˜ì§‘

```java
@Component
public class AttendanceMetrics {
    
    private final Counter requestCounter = 
        Counter.builder("attendance.requests")
               .description("ì¶œì„ ìš”ì²­ ìˆ˜")
               .register(meterRegistry);
    
    public void incrementRequestCount() {
        requestCounter.increment();
    }
}
```

---

## ë‹¤ìŒ ë‹¨ê³„

- **[10. ì„±ì  ê´€ë¦¬ ì‹œìŠ¤í…œ ì—°ë™](./10_ì„±ì _ì—°ë™_ê°€ì´ë“œ.md)**: ì¶œì„ìœ¨ì„ ì„±ì  ì ìˆ˜ë¡œ ë³€í™˜
- **[README.md](./README.md)**: ì „ì²´ ë¬¸ì„œ ëª©ì°¨
- **[02. API ì—”ë“œí¬ì¸íŠ¸](./02_API_ì—”ë“œí¬ì¸íŠ¸.md)**: API ëª…ì„¸ ì°¸ê³ 

---

**ğŸ“š [ëª©ì°¨ë¡œ ëŒì•„ê°€ê¸°](./README.md)**

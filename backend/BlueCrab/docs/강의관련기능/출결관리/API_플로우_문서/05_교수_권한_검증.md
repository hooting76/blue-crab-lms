# 05. êµìˆ˜ ê¶Œí•œ ê²€ì¦

> ğŸ”’ êµìˆ˜ê°€ ë‹´ë‹¹ ê°•ì˜ì˜ ì¶œì„ ìŠ¹ì¸ ê¶Œí•œì„ ê°€ì§€ëŠ”ì§€ ê²€ì¦í•˜ëŠ” ë©”ì»¤ë‹ˆì¦˜

---

## ê°œìš”

### ëª©ì 

êµìˆ˜ ì¶œì„ ìŠ¹ì¸ ì‹œ, **í•´ë‹¹ êµìˆ˜ê°€ ì‹¤ì œë¡œ ê·¸ ê°•ì˜ì˜ ë‹´ë‹¹ êµìˆ˜ì¸ì§€** í™•ì¸í•˜ëŠ” ë³´ì•ˆ ë©”ì»¤ë‹ˆì¦˜ì…ë‹ˆë‹¤.

### í•µì‹¬ ê²€ì¦ ì¡°ê±´

```
LEC_PROF (LEC_TBL) = professorIdx (JWT í† í°)
```

- **LEC_PROF**: `LEC_TBL.LEC_PROF` í•„ë“œ (ë¬¸ìì—´ íƒ€ì…)
- **professorIdx**: JWT í† í°ì—ì„œ ì¶”ì¶œí•œ êµìˆ˜ USER_IDX (ì •ìˆ˜ íƒ€ì…)

---

## ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ

### LEC_TBL (ê°•ì˜ í…Œì´ë¸”)

| ì»¬ëŸ¼ëª… | íƒ€ì… | ì„¤ëª… | ì˜ˆì‹œ |
|--------|------|------|------|
| `LEC_SERIAL` | VARCHAR(20) | ê°•ì˜ ì½”ë“œ (PK) | `'ETH201'` |
| `LEC_PROF` | VARCHAR(10) | ë‹´ë‹¹ êµìˆ˜ USER_IDX (ë¬¸ìì—´) | `'25'` |
| `LEC_NAME` | VARCHAR(100) | ê°•ì˜ëª… | `'ìœ¤ë¦¬í•™ê°œë¡ '` |
| `LEC_YEAR` | INT | ê°œì„¤ ì—°ë„ | `2025` |
| `LEC_SEMESTER` | VARCHAR(10) | í•™ê¸° | `'2í•™ê¸°'` |

### ì¤‘ìš” í¬ì¸íŠ¸

#### LEC_PROFëŠ” ë¬¸ìì—´ íƒ€ì…

```sql
LEC_PROF VARCHAR(10)
```

- DB ìŠ¤í‚¤ë§ˆ ìƒ ë¬¸ìì—´ë¡œ ì €ì¥
- ì‹¤ì œ ê°’: `'25'`, `'42'`, `'7'` (ë¬¸ìì—´)

#### USER_IDXëŠ” ì •ìˆ˜ íƒ€ì…

```java
Integer professorIdx = extractUserIdFromToken(userDetails);
// professorIdx = 25 (ì •ìˆ˜)
```

- JWT í† í°ì—ì„œ ì¶”ì¶œí•œ ê°’ì€ ì •ìˆ˜
- ì‹¤ì œ ê°’: `25`, `42`, `7` (ì •ìˆ˜)

#### íƒ€ì… ë¶ˆì¼ì¹˜ í•´ê²°

**ë¬¸ì œ**:
```java
// âŒ íƒ€ì… ë¶ˆì¼ì¹˜ë¡œ ë¹„êµ ì‹¤íŒ¨
WHERE e.lecTbl.lecProf = :professorIdx
// '25' (ë¬¸ìì—´) â‰  25 (ì •ìˆ˜)
```

**í•´ê²°ì±…**:
```java
// âœ… CASTë¥¼ ì‚¬ìš©í•˜ì—¬ íƒ€ì… ì¼ì¹˜
WHERE e.lecTbl.lecProf = CAST(:professorIdx AS string)
// '25' (ë¬¸ìì—´) = '25' (ë¬¸ìì—´)
```

---

## Repository ì¿¼ë¦¬

### findByLecSerialAndProfessorIdx

```java
@Query("SELECT e FROM EnrollmentExtendedTbl e " +
       "WHERE e.lecTbl.lecSerial = :lecSerial " +
       "AND e.lecTbl.lecProf = CAST(:professorIdx AS string)")
Optional<EnrollmentExtendedTbl> findByLecSerialAndProfessorIdx(
    @Param("lecSerial") String lecSerial, 
    @Param("professorIdx") Integer professorIdx
);
```

### ì¿¼ë¦¬ êµ¬ì¡° ë¶„ì„

#### 1. í…Œì´ë¸” ì¡°ì¸

```java
FROM EnrollmentExtendedTbl e
```

- `ENROLLMENT_EXTENDED_TBL` í…Œì´ë¸” ì‚¬ìš©
- `e.lecTbl`: `LEC_TBL`ê³¼ì˜ ì—°ê´€ê´€ê³„ (ManyToOne)

#### 2. ê°•ì˜ ì½”ë“œ ì¡°ê±´

```java
WHERE e.lecTbl.lecSerial = :lecSerial
```

- íŒŒë¼ë¯¸í„°: `lecSerial` (ì˜ˆ: `'ETH201'`)
- ì¡°ê±´: í•´ë‹¹ ê°•ì˜ ì½”ë“œì˜ ìˆ˜ê°•ìƒ ì°¾ê¸°

#### 3. êµìˆ˜ ê¶Œí•œ ì¡°ê±´ (í•µì‹¬)

```java
AND e.lecTbl.lecProf = CAST(:professorIdx AS string)
```

- íŒŒë¼ë¯¸í„°: `professorIdx` (ì˜ˆ: `25`)
- CAST: ì •ìˆ˜ `25`ë¥¼ ë¬¸ìì—´ `'25'`ë¡œ ë³€í™˜
- ì¡°ê±´: LEC_PROF í•„ë“œì™€ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸

#### 4. ë°˜í™˜ íƒ€ì…

```java
Optional<EnrollmentExtendedTbl>
```

- ì¡°ê±´ì— ë§ëŠ” ìˆ˜ê°•ìƒ 1ëª…ì´ë¼ë„ ìˆìœ¼ë©´: `Optional.of(enrollment)`
- ì¡°ê±´ì— ë§ëŠ” ìˆ˜ê°•ìƒì´ ì—†ìœ¼ë©´: `Optional.empty()`

### ê²€ì¦ ë¡œì§

```java
Optional<EnrollmentExtendedTbl> enrollment = 
    enrollmentRepository.findByLecSerialAndProfessorIdx(
        "ETH201", 
        25
    );

if (!enrollment.isPresent()) {
    // ë‹´ë‹¹ êµìˆ˜ê°€ ì•„ë‹ˆê±°ë‚˜, ìˆ˜ê°•ìƒì´ ì—†ìŒ
    throw new ForbiddenException("í•´ë‹¹ ê°•ì˜ì˜ ë‹´ë‹¹ êµìˆ˜ê°€ ì•„ë‹™ë‹ˆë‹¤.");
}

// ê²€ì¦ í†µê³¼: êµìˆ˜ê°€ í•´ë‹¹ ê°•ì˜ë¥¼ ë‹´ë‹¹í•˜ê³  ìˆìŒ
```

---

## ì‹¤í–‰ ì˜ˆì‹œ

### ì„±ê³µ ì¼€ì´ìŠ¤

#### ì‹œë‚˜ë¦¬ì˜¤

- **ê°•ì˜**: ETH201
- **LEC_PROF**: `'25'` (ë¬¸ìì—´)
- **JWT í† í°**: `professorIdx = 25` (ì •ìˆ˜)

#### SQL ì‹¤í–‰

```sql
SELECT e.* 
FROM ENROLLMENT_EXTENDED_TBL e
INNER JOIN LEC_TBL l ON e.LEC_SERIAL = l.LEC_SERIAL
WHERE l.LEC_SERIAL = 'ETH201'
  AND l.LEC_PROF = '25'  -- CAST(25 AS string) = '25'
LIMIT 1;
```

#### ê²°ê³¼

```
+--------+------------+-----------+------------------+
| ENR_NO | LEC_SERIAL | USER_IDX  | ENROLLMENT_DATA  |
+--------+------------+-----------+------------------+
| 1      | ETH201     | 6         | {"summary":...}  |
+--------+------------+-----------+------------------+
```

- **í•´ì„**: ETH201 ê°•ì˜ì— ìˆ˜ê°•ìƒ(USER_IDX=6)ì´ ì¡´ì¬
- **ê²°ë¡ **: êµìˆ˜ 25ëŠ” ETH201ì˜ ë‹´ë‹¹ êµìˆ˜ âœ…

### ì‹¤íŒ¨ ì¼€ì´ìŠ¤ 1: íƒ€ êµìˆ˜

#### ì‹œë‚˜ë¦¬ì˜¤

- **ê°•ì˜**: ETH201
- **LEC_PROF**: `'25'` (ë¬¸ìì—´)
- **JWT í† í°**: `professorIdx = 42` (ì •ìˆ˜) âŒ

#### SQL ì‹¤í–‰

```sql
SELECT e.* 
FROM ENROLLMENT_EXTENDED_TBL e
INNER JOIN LEC_TBL l ON e.LEC_SERIAL = l.LEC_SERIAL
WHERE l.LEC_SERIAL = 'ETH201'
  AND l.LEC_PROF = '42'  -- CAST(42 AS string) = '42'
LIMIT 1;
```

#### ê²°ê³¼

```
Empty set (0 rows)
```

- **í•´ì„**: LEC_PROF='25'ì´ë¯€ë¡œ ì¡°ê±´ ë¶ˆì¼ì¹˜
- **ê²°ë¡ **: êµìˆ˜ 42ëŠ” ETH201ì˜ ë‹´ë‹¹ êµìˆ˜ê°€ ì•„ë‹˜ âŒ
- **ì‘ë‹µ**: 403 Forbidden

### ì‹¤íŒ¨ ì¼€ì´ìŠ¤ 2: ìˆ˜ê°•ìƒ ì—†ìŒ

#### ì‹œë‚˜ë¦¬ì˜¤

- **ê°•ì˜**: ETH999 (ì¡´ì¬í•˜ì§€ë§Œ ìˆ˜ê°•ìƒ 0ëª…)
- **LEC_PROF**: `'25'` (ë¬¸ìì—´)
- **JWT í† í°**: `professorIdx = 25` (ì •ìˆ˜)

#### SQL ì‹¤í–‰

```sql
SELECT e.* 
FROM ENROLLMENT_EXTENDED_TBL e
INNER JOIN LEC_TBL l ON e.LEC_SERIAL = l.LEC_SERIAL
WHERE l.LEC_SERIAL = 'ETH999'
  AND l.LEC_PROF = '25'
LIMIT 1;
```

#### ê²°ê³¼

```
Empty set (0 rows)
```

- **í•´ì„**: ê°•ì˜ëŠ” ì¡´ì¬í•˜ì§€ë§Œ ìˆ˜ê°•ìƒì´ ì—†ìŒ
- **ê²°ë¡ **: ìˆ˜ê°•ìƒì´ ì—†ëŠ” ê°•ì˜ëŠ” ì¶œì„ ê´€ë¦¬ ë¶ˆí•„ìš”
- **ì‘ë‹µ**: 403 Forbidden (ë˜ëŠ” 404 Not Found)

---

## Service êµ¬í˜„

### approveAttendance ë©”ì„œë“œ

```java
@Transactional
public int approveAttendance(
    Integer professorIdx,
    String lecSerial,
    Integer sessionNumber,
    List<AttendanceApprovalRecordDto> attendanceRecords
) {
    // 1. êµìˆ˜ ê¶Œí•œ ê²€ì¦
    Optional<EnrollmentExtendedTbl> enrollment = 
        enrollmentRepository.findByLecSerialAndProfessorIdx(
            lecSerial, 
            professorIdx
        );
    
    if (!enrollment.isPresent()) {
        throw new ForbiddenException(
            "í•´ë‹¹ ê°•ì˜ì˜ ë‹´ë‹¹ êµìˆ˜ê°€ ì•„ë‹™ë‹ˆë‹¤."
        );
    }
    
    // 2. ê¶Œí•œ ê²€ì¦ í†µê³¼ â†’ ìŠ¹ì¸ ì²˜ë¦¬
    int successCount = 0;
    
    for (AttendanceApprovalRecordDto record : attendanceRecords) {
        try {
            // ê° í•™ìƒë³„ ìŠ¹ì¸ ì²˜ë¦¬
            approveForStudent(
                lecSerial, 
                sessionNumber, 
                record.getStudentIdx(), 
                record.getStatus(),
                professorIdx
            );
            successCount++;
        } catch (Exception e) {
            log.error("ìŠ¹ì¸ ì‹¤íŒ¨: studentIdx={}", 
                      record.getStudentIdx(), e);
        }
    }
    
    return successCount;
}
```

### ê²€ì¦ ì‹œì 

```
API í˜¸ì¶œ â†’ JWT í† í° íŒŒì‹± â†’ Service í˜¸ì¶œ â†’ êµìˆ˜ ê¶Œí•œ ê²€ì¦ â†’ ìŠ¹ì¸ ì²˜ë¦¬
                                              â†‘
                                         ì´ ë‹¨ê³„ì—ì„œ ê²€ì¦
```

- **ìœ„ì¹˜**: Service ë©”ì„œë“œ ìµœìƒë‹¨
- **ì‹œì **: ìŠ¹ì¸ ì²˜ë¦¬ ì „ì— ë°˜ë“œì‹œ ê²€ì¦
- **ì‹¤íŒ¨ ì‹œ**: 403 Forbidden ì˜ˆì™¸ ë°œìƒ

---

## Controller êµ¬í˜„

### approveAttendance ì—”ë“œí¬ì¸íŠ¸

```java
@PostMapping("/approve")
public ResponseEntity<?> approveAttendance(
    @Valid @RequestBody AttendanceApproveRequestDto request,
    @AuthenticationPrincipal UserDetails userDetails
) {
    // 1. JWTì—ì„œ professorIdx ì¶”ì¶œ
    Integer professorIdx = extractUserIdFromToken(userDetails);
    
    // 2. Service í˜¸ì¶œ (ë‚´ë¶€ì—ì„œ ê¶Œí•œ ê²€ì¦)
    try {
        int successCount = attendanceService.approveAttendance(
            professorIdx,  // â† ì´ ê°’ì´ LEC_PROFì™€ ë¹„êµë¨
            request.getLecSerial(),
            request.getSessionNumber(),
            request.getAttendanceRecords()
        );
        
        int totalCount = request.getAttendanceRecords().size();
        String message = String.format(
            "ì¶œì„ ìŠ¹ì¸ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. (%d/%d)", 
            successCount, 
            totalCount
        );
        
        return ResponseEntity.ok(
            AttendanceResponseDto.success(message, null)
        );
        
    } catch (ForbiddenException e) {
        return ResponseEntity.status(HttpStatus.FORBIDDEN)
            .body(AttendanceResponseDto.error(e.getMessage(), "FORBIDDEN"));
    }
}
```

### JWT í† í° ì¶”ì¶œ

```java
private Integer extractUserIdFromToken(UserDetails userDetails) {
    if (userDetails == null) {
        throw new UnauthorizedException("ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤.");
    }
    
    // UserDetailsì—ì„œ username ì¶”ì¶œ (ì‹¤ì œë¡œëŠ” USER_IDX)
    String username = userDetails.getUsername();
    
    // ë¬¸ìì—´ â†’ ì •ìˆ˜ ë³€í™˜
    try {
        return Integer.parseInt(username);
    } catch (NumberFormatException e) {
        throw new UnauthorizedException("ìœ íš¨í•˜ì§€ ì•Šì€ í† í°ì…ë‹ˆë‹¤.");
    }
}
```

---

## ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

### 1. JWT í† í° ê²€ì¦

```java
@Component
public class JwtAuthenticationFilter extends OncePerRequestFilter {
    
    @Override
    protected void doFilterInternal(
        HttpServletRequest request,
        HttpServletResponse response,
        FilterChain filterChain
    ) throws ServletException, IOException {
        
        // Authorization í—¤ë” ì¶”ì¶œ
        String header = request.getHeader("Authorization");
        
        if (header != null && header.startsWith("Bearer ")) {
            String token = header.substring(7);
            
            // í† í° ìœ íš¨ì„± ê²€ì¦
            if (jwtTokenProvider.validateToken(token)) {
                // UserDetails ìƒì„±
                Authentication auth = 
                    jwtTokenProvider.getAuthentication(token);
                SecurityContextHolder.getContext()
                    .setAuthentication(auth);
            }
        }
        
        filterChain.doFilter(request, response);
    }
}
```

### 2. í† í° ìœ„ì¡° ë°©ì§€

- **ì„œëª… ê²€ì¦**: HS256 ì•Œê³ ë¦¬ì¦˜ìœ¼ë¡œ í† í° ì„œëª…
- **ë§Œë£Œ ì‹œê°„**: ì•¡ì„¸ìŠ¤ í† í° 30ë¶„, ë¦¬í”„ë ˆì‹œ í† í° 7ì¼
- **ë¹„ë°€ í‚¤**: í™˜ê²½ë³€ìˆ˜ë¡œ ê´€ë¦¬ (ë…¸ì¶œ ê¸ˆì§€)

```properties
# application.properties
jwt.secret=${JWT_SECRET}
jwt.access-token-validity=1800000   # 30ë¶„
jwt.refresh-token-validity=604800000 # 7ì¼
```

### 3. SQL ì¸ì ì…˜ ë°©ì§€

```java
// âœ… JPQL íŒŒë¼ë¯¸í„° ë°”ì¸ë”© ì‚¬ìš©
@Query("... WHERE e.lecTbl.lecSerial = :lecSerial ...")
// Spring Data JPAê°€ ìë™ìœ¼ë¡œ ì´ìŠ¤ì¼€ì´í”„ ì²˜ë¦¬

// âŒ ë¬¸ìì—´ ì—°ê²° (ì ˆëŒ€ ê¸ˆì§€)
@Query("... WHERE e.lecTbl.lecSerial = '" + lecSerial + "' ...")
```

### 4. ê¶Œí•œ ê³„ì¸µ

```
1. JWT ì¸ì¦: ìœ íš¨í•œ ì‚¬ìš©ìì¸ê°€?
2. ì—­í•  í™•ì¸: ROLE_PROFESSOR ë˜ëŠ” ROLE_ADMIN?
3. ë‹´ë‹¹ í™•ì¸: LEC_PROF = professorIdx?
```

- **3ë‹¨ê³„ ê²€ì¦**ì„ ëª¨ë‘ í†µê³¼í•´ì•¼ ìŠ¹ì¸ ê°€ëŠ¥

---

## ì—ëŸ¬ ì²˜ë¦¬

### ForbiddenException

```java
@ResponseStatus(HttpStatus.FORBIDDEN)
public class ForbiddenException extends RuntimeException {
    public ForbiddenException(String message) {
        super(message);
    }
}
```

### ì—ëŸ¬ ì‘ë‹µ

```json
{
  "success": false,
  "message": "í•´ë‹¹ ê°•ì˜ì˜ ë‹´ë‹¹ êµìˆ˜ê°€ ì•„ë‹™ë‹ˆë‹¤.",
  "errorCode": "FORBIDDEN",
  "timestamp": "2025-10-23T15:45:00.123456789Z"
}
```

### í”„ë¡ íŠ¸ì—”ë“œ ì²˜ë¦¬

```javascript
async function approveAttendance(lecSerial, sessionNumber, records) {
    try {
        const response = await fetch('/api/attendance/approve', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${getToken()}`
            },
            body: JSON.stringify({
                lecSerial,
                sessionNumber,
                attendanceRecords: records
            })
        });
        
        const data = await response.json();
        
        if (response.status === 403) {
            alert('ê¶Œí•œ ì˜¤ë¥˜: ' + data.message);
            // ë‹´ë‹¹ ê°•ì˜ ëª©ë¡ í˜ì´ì§€ë¡œ ì´ë™
            window.location.href = '/professor/lectures';
        } else if (data.success) {
            alert('ìŠ¹ì¸ ì™„ë£Œ: ' + data.message);
        }
        
    } catch (error) {
        console.error('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜:', error);
    }
}
```

---

## í…ŒìŠ¤íŠ¸ ì˜ˆì‹œ

### ë¸Œë¼ìš°ì € ì½˜ì†” í…ŒìŠ¤íŠ¸

#### 1. ì •ìƒ ì¼€ì´ìŠ¤ (ë‹´ë‹¹ êµìˆ˜)

```javascript
// prof.octopus@univ.edu (USER_IDX=25, ETH201 ë‹´ë‹¹)
const token = window.authToken;

const response = await fetch(
    'https://bluecrab.chickenkiller.com/BlueCrab-1.0.0/api/attendance/approve',
    {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
        },
        body: JSON.stringify({
            lecSerial: 'ETH201',
            sessionNumber: 1,
            attendanceRecords: [
                { studentIdx: 6, status: 'ì¶œ' }
            ]
        })
    }
);

const data = await response.json();
console.log(data);
// âœ… { success: true, message: "ì¶œì„ ìŠ¹ì¸ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. (1/1)" }
```

#### 2. ê¶Œí•œ ì˜¤ë¥˜ ì¼€ì´ìŠ¤ (íƒ€ êµìˆ˜)

```javascript
// ë‹¤ë¥¸ êµìˆ˜ë¡œ ë¡œê·¸ì¸í•œ í›„
const token = window.authToken; // professorIdx = 42

const response = await fetch(
    'https://bluecrab.chickenkiller.com/BlueCrab-1.0.0/api/attendance/approve',
    {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
        },
        body: JSON.stringify({
            lecSerial: 'ETH201', // prof.octopus(25)ì˜ ê°•ì˜
            sessionNumber: 1,
            attendanceRecords: [
                { studentIdx: 6, status: 'ì¶œ' }
            ]
        })
    }
);

const data = await response.json();
console.log(data);
// âŒ { success: false, message: "í•´ë‹¹ ê°•ì˜ì˜ ë‹´ë‹¹ êµìˆ˜ê°€ ì•„ë‹™ë‹ˆë‹¤.", errorCode: "FORBIDDEN" }
```

---

## ì„±ëŠ¥ ìµœì í™”

### 1. ì¸ë±ìŠ¤ ì¶”ê°€

```sql
-- LEC_PROF ì»¬ëŸ¼ì— ì¸ë±ìŠ¤ (ë¹ ë¥¸ ê²€ìƒ‰)
CREATE INDEX idx_lec_prof ON LEC_TBL(LEC_PROF);

-- ë³µí•© ì¸ë±ìŠ¤ (ë” ë¹ ë¥¸ ê²€ìƒ‰)
CREATE INDEX idx_lec_serial_prof 
ON LEC_TBL(LEC_SERIAL, LEC_PROF);
```

### 2. ì¿¼ë¦¬ ìºì‹±

```java
@Cacheable(value = "professorLectures", key = "#professorIdx")
public List<String> getProfessorLectures(Integer professorIdx) {
    return lecTblRepository.findByLecProf(
        String.valueOf(professorIdx)
    ).stream()
     .map(LecTbl::getLecSerial)
     .collect(Collectors.toList());
}
```

### 3. ê²€ì¦ ê²°ê³¼ ìºì‹±

```java
// ìš”ì²­ë‹¹ 1íšŒë§Œ ê²€ì¦ (ì¤‘ë³µ í˜¸ì¶œ ë°©ì§€)
private final Map<String, Boolean> verificationCache = new HashMap<>();

private boolean isAuthorized(Integer professorIdx, String lecSerial) {
    String cacheKey = professorIdx + ":" + lecSerial;
    
    return verificationCache.computeIfAbsent(cacheKey, k -> {
        return enrollmentRepository
            .findByLecSerialAndProfessorIdx(lecSerial, professorIdx)
            .isPresent();
    });
}
```

---

## í™•ì¥ ê°€ëŠ¥ì„±

### 1. ë¶€êµìˆ˜ ì¶”ê°€

í˜„ì¬ëŠ” 1ê°œì˜ `LEC_PROF` í•„ë“œë§Œ ì§€ì›í•˜ì§€ë§Œ, ë¶€êµìˆ˜ë¥¼ ì¶”ê°€í•˜ë ¤ë©´:

```sql
-- ìƒˆ í…Œì´ë¸” ìƒì„±
CREATE TABLE LEC_PROFESSORS (
    LEC_SERIAL VARCHAR(20),
    PROF_IDX INT,
    ROLE VARCHAR(20), -- 'main', 'assistant'
    PRIMARY KEY (LEC_SERIAL, PROF_IDX)
);
```

```java
// ì¿¼ë¦¬ ìˆ˜ì •
@Query("SELECT e FROM EnrollmentExtendedTbl e " +
       "WHERE e.lecTbl.lecSerial = :lecSerial " +
       "AND EXISTS (" +
       "  SELECT lp FROM LecProfessors lp " +
       "  WHERE lp.lecSerial = :lecSerial " +
       "  AND lp.profIdx = :professorIdx" +
       ")")
```

### 2. ì—­í•  ê¸°ë°˜ ê¶Œí•œ

```java
public enum ProfessorRole {
    MAIN,      // ì£¼ë‹´ë‹¹ êµìˆ˜ (ëª¨ë“  ê¶Œí•œ)
    ASSISTANT, // ë¶€ë‹´ë‹¹ êµìˆ˜ (ì¡°íšŒ + ìŠ¹ì¸)
    OBSERVER   // ì°¸ê´€ êµìˆ˜ (ì¡°íšŒë§Œ)
}
```

---

## ì£¼ì˜ì‚¬í•­

### ë°±ì—”ë“œ ê°œë°œì

1. **CAST í•„ìˆ˜**
   - `LEC_PROF`ëŠ” ë¬¸ìì—´, `professorIdx`ëŠ” ì •ìˆ˜
   - ë°˜ë“œì‹œ `CAST(:professorIdx AS string)` ì‚¬ìš©

2. **ê²€ì¦ ì‹œì **
   - Service ë©”ì„œë“œ ìµœìƒë‹¨ì—ì„œ ê²€ì¦
   - ìŠ¹ì¸ ì²˜ë¦¬ ì „ì— ë°˜ë“œì‹œ ê²€ì¦ ì™„ë£Œ

3. **ì˜ˆì™¸ ì²˜ë¦¬**
   - `ForbiddenException` ëª…í™•íˆ êµ¬ë¶„
   - 404(Not Found)ì™€ 403(Forbidden) êµ¬ë¶„

### í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œì

1. **403 ì—ëŸ¬ ì²˜ë¦¬**
   - ê¶Œí•œ ì—†ìŒ ë©”ì‹œì§€ í‘œì‹œ
   - ë‹´ë‹¹ ê°•ì˜ ëª©ë¡ìœ¼ë¡œ ìë™ ì´ë™

2. **ì‚¬ì „ ê²€ì¦**
   - ë‹´ë‹¹ ê°•ì˜ ëª©ë¡ë§Œ í‘œì‹œ
   - íƒ€ êµìˆ˜ ê°•ì˜ëŠ” UIì—ì„œ ìˆ¨ê¹€

---

## ë‹¤ìŒ ë‹¨ê³„

- **[04. êµìˆ˜ ì¶œì„ ìŠ¹ì¸](./04_êµìˆ˜_ì¶œì„_ìŠ¹ì¸.md)**: ìŠ¹ì¸ API ì „ì²´ íë¦„
- **[06. ìë™ ìŠ¹ì¸ ë©”ì»¤ë‹ˆì¦˜](./06_ìë™_ìŠ¹ì¸_ë©”ì»¤ë‹ˆì¦˜.md)**: 7ì¼ ê²½ê³¼ ì‹œ ìë™ ìŠ¹ì¸
- **[09. ì˜ˆì™¸ ì²˜ë¦¬ ë° í™•ì¥](./09_ì˜ˆì™¸_ì²˜ë¦¬_ë°_í™•ì¥.md)**: ì „ì²´ ì˜ˆì™¸ ì²˜ë¦¬ ì „ëµ

---

**ğŸ“š [ëª©ì°¨ë¡œ ëŒì•„ê°€ê¸°](./README.md)**

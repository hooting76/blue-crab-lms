# 04. êµìˆ˜ ì¶œì„ ìŠ¹ì¸

> ğŸ‘¨â€ğŸ« êµìˆ˜ê°€ í•™ìƒì˜ ì¶œì„ ìš”ì²­ì„ ìŠ¹ì¸í•˜ëŠ” API ìƒì„¸ ê°€ì´ë“œ

---

## API ê°œìš”

### ê¸°ë³¸ ì •ë³´
- **ì—”ë“œí¬ì¸íŠ¸**: `POST /api/attendance/approve`
- **ê¶Œí•œ**: êµìˆ˜, ê´€ë¦¬ì
- **ì„¤ëª…**: êµìˆ˜ê°€ ë‹´ë‹¹ ê°•ì˜ì˜ í•™ìƒ ì¶œì„ ìš”ì²­ì„ ìŠ¹ì¸/ì§€ê°/ê²°ì„ìœ¼ë¡œ ì²˜ë¦¬í•˜ëŠ” API

### ì£¼ìš” ê¸°ëŠ¥
- âœ… í•™ìƒ ì¶œì„ ìš”ì²­ì„ ìŠ¹ì¸/ì§€ê°/ê²°ì„ ì²˜ë¦¬
- âœ… ì¼ê´„ ìŠ¹ì¸ (ì—¬ëŸ¬ í•™ìƒ ë™ì‹œ ì²˜ë¦¬ ê°€ëŠ¥)
- âœ… êµìˆ˜ ê¶Œí•œ ìë™ ê²€ì¦ (LEC_PROF = professorIdx)
- âœ… pendingRequests â†’ sessions ìë™ ì´ë™
- âœ… ì¶œì„ìœ¨ ìë™ ì¬ê³„ì‚°

---

## ìš”ì²­ ì¡°ê±´

### í•„ìˆ˜ ì¡°ê±´

1. **ì¸ì¦ í† í° í•„ìˆ˜**
   - JWT Bearer í† í° í•„ìš”
   - `professorIdx`ëŠ” í† í°ì—ì„œ ìë™ ì¶”ì¶œ

2. **ë‹´ë‹¹ ê°•ì˜ë§Œ ê°€ëŠ¥**
   - í•´ë‹¹ êµìˆ˜ê°€ ë‹´ë‹¹í•˜ëŠ” ê°•ì˜ë§Œ ìŠ¹ì¸ ê°€ëŠ¥
   - `LEC_PROF = professorIdx` ê²€ì¦

3. **ìœ íš¨í•œ íšŒì°¨ ë° í•™ìƒ**
   - sessionNumber: 1~80 ë²”ìœ„
   - studentIdx: ì‹¤ì œ ìˆ˜ê°•ìƒì´ì–´ì•¼ í•¨

### ì œì•½ ì‚¬í•­

1. **ê¶Œí•œ ê²€ì¦**
   - íƒ€ êµìˆ˜ì˜ ê°•ì˜ëŠ” ìŠ¹ì¸ ë¶ˆê°€
   - 403 Forbidden ì‘ë‹µ

2. **ì¤‘ë³µ ìŠ¹ì¸**
   - ì´ë¯¸ `sessions`ì— ì¡´ì¬í•˜ëŠ” íšŒì°¨ëŠ” ì¬ìŠ¹ì¸ ë¶ˆê°€
   - 409 Conflict ì‘ë‹µ (í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ì‚¬ì „ í•„í„°ë§ ê¶Œì¥)

3. **ìµœì†Œ 1ëª… ì´ìƒ**
   - `attendanceRecords` ë°°ì—´ì— ìµœì†Œ 1ê°œ ì´ìƒì˜ ë ˆì½”ë“œ í•„ìš”

---

## ìš”ì²­ ëª…ì„¸

### HTTP ìš”ì²­

```http
POST /api/attendance/approve HTTP/1.1
Host: bluecrab.chickenkiller.com
Content-Type: application/json
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

{
  "lecSerial": "ETH201",
  "sessionNumber": 1,
  "attendanceRecords": [
    {
      "studentIdx": 6,
      "status": "ì¶œ"
    },
    {
      "studentIdx": 7,
      "status": "ì§€"
    },
    {
      "studentIdx": 8,
      "status": "ê²°"
    }
  ]
}
```

### ìš”ì²­ íŒŒë¼ë¯¸í„°

| í•„ë“œ | íƒ€ì… | í•„ìˆ˜ | ì„¤ëª… | ì œì•½ ì¡°ê±´ |
|-----|------|------|------|----------|
| `lecSerial` | String | âœ… í•„ìˆ˜ | ê°•ì˜ ì½”ë“œ | ì˜ë¬¸/ìˆ«ì, ìµœëŒ€ 20ì |
| `sessionNumber` | Integer | âœ… í•„ìˆ˜ | íšŒì°¨ ë²ˆí˜¸ | 1~80 ë²”ìœ„ |
| `attendanceRecords` | Array | âœ… í•„ìˆ˜ | ìŠ¹ì¸ ë ˆì½”ë“œ ë°°ì—´ | ìµœì†Œ 1ê°œ ì´ìƒ |
| `attendanceRecords[].studentIdx` | Integer | âœ… í•„ìˆ˜ | í•™ìƒ USER_IDX | ì–‘ìˆ˜ |
| `attendanceRecords[].status` | String | âœ… í•„ìˆ˜ | ì¶œì„ ìƒíƒœ | "ì¶œ", "ì§€", "ê²°" |

### íŒŒë¼ë¯¸í„° ìƒì„¸

#### 1. lecSerial (ê°•ì˜ ì½”ë“œ)
```json
"lecSerial": "ETH201"
```
- **í˜•ì‹**: ê°•ì˜ ì½”ë“œ ë¬¸ìì—´
- **ê²€ì¦**:
  - ì„œë²„ì—ì„œ `LEC_TBL` ì¡´ì¬ ì—¬ë¶€ í™•ì¸
  - êµìˆ˜ì˜ ë‹´ë‹¹ ì—¬ë¶€ í™•ì¸ (`LEC_PROF = professorIdx`)

#### 2. sessionNumber (íšŒì°¨ ë²ˆí˜¸)
```json
"sessionNumber": 1
```
- **í˜•ì‹**: 1~80 ì‚¬ì´ì˜ ì •ìˆ˜
- **ì˜ë¯¸**: ìŠ¹ì¸í•  íšŒì°¨
- **ê²€ì¦**: `@Min(1)`, `@Max(80)` ì–´ë…¸í…Œì´ì…˜

#### 3. attendanceRecords (ìŠ¹ì¸ ë ˆì½”ë“œ ë°°ì—´)
```json
"attendanceRecords": [
  {
    "studentIdx": 6,
    "status": "ì¶œ"
  }
]
```
- **í˜•ì‹**: ê°ì²´ ë°°ì—´
- **ì œì•½**: ìµœì†Œ 1ê°œ ì´ìƒ í•„ìš”
- **ì¼ê´„ ì²˜ë¦¬**: ì—¬ëŸ¬ í•™ìƒì„ í•œ ë²ˆì— ìŠ¹ì¸ ê°€ëŠ¥

#### 4. studentIdx (í•™ìƒ USER_IDX)
```json
"studentIdx": 6
```
- **í˜•ì‹**: ì–‘ì˜ ì •ìˆ˜
- **ì˜ë¯¸**: ìŠ¹ì¸í•  í•™ìƒì˜ USER_IDX
- **ê²€ì¦**:
  - í•´ë‹¹ ê°•ì˜ì˜ ìˆ˜ê°•ìƒì¸ì§€ í™•ì¸
  - `ENROLLMENT_EXTENDED_TBL` ì¡°íšŒ

#### 5. status (ì¶œì„ ìƒíƒœ)
```json
"status": "ì¶œ"
```
- **í˜•ì‹**: "ì¶œ", "ì§€", "ê²°" ì¤‘ í•˜ë‚˜
- **ì˜ë¯¸**:
  - **"ì¶œ"**: ì¶œì„ (Attended)
  - **"ì§€"**: ì§€ê° (Late)
  - **"ê²°"**: ê²°ì„ (Absent)
- **ê²€ì¦**: `@Pattern` ì–´ë…¸í…Œì´ì…˜ìœ¼ë¡œ ê°’ ì œí•œ

---

## ì‘ë‹µ ëª…ì„¸

### ì„±ê³µ ì‘ë‹µ (200 OK)

```json
{
  "success": true,
  "message": "ì¶œì„ ìŠ¹ì¸ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. (3/3)",
  "data": null,
  "timestamp": "2025-10-23T15:45:00.123456789Z",
  "errorCode": null
}
```

### ì‘ë‹µ í•„ë“œ

| í•„ë“œ | íƒ€ì… | ì„¤ëª… |
|-----|------|------|
| `success` | Boolean | ì„±ê³µ ì—¬ë¶€ (í•­ìƒ `true`) |
| `message` | String | ì„±ê³µ ë©”ì‹œì§€ (ì²˜ë¦¬ëœ ê±´ìˆ˜ í¬í•¨) |
| `data` | null | ìŠ¹ì¸ APIëŠ” ë°ì´í„° ë°˜í™˜ ì—†ìŒ |
| `timestamp` | String | ì‘ë‹µ ì‹œê° (ISO 8601) |
| `errorCode` | null | ì—ëŸ¬ ì½”ë“œ (ì„±ê³µ ì‹œ null) |

### ë©”ì‹œì§€ í˜•ì‹

```
ì¶œì„ ìŠ¹ì¸ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ({ì„±ê³µ ê±´ìˆ˜}/{ì „ì²´ ê±´ìˆ˜})
```

**ì˜ˆì‹œ**:
- `"ì¶œì„ ìŠ¹ì¸ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. (3/3)"` - 3ëª… ëª¨ë‘ ì„±ê³µ
- `"ì¶œì„ ìŠ¹ì¸ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. (2/3)"` - 3ëª… ì¤‘ 2ëª… ì„±ê³µ (1ëª… ì‹¤íŒ¨)

**ë¶€ë¶„ ì„±ê³µ ì²˜ë¦¬**:
- ì¼ë¶€ í•™ìƒë§Œ ì„±ê³µí•´ë„ 200 OK ì‘ë‹µ
- ì‹¤íŒ¨í•œ í•™ìƒì€ ë¡œê·¸ì— ê¸°ë¡ (í”„ë¡ íŠ¸ì—”ë“œì—ëŠ” ì „ë‹¬ ì•ˆ í•¨)
- ì „ì²´ ì‹¤íŒ¨ ì‹œì—ë§Œ ì—ëŸ¬ ì‘ë‹µ

---

## ì²˜ë¦¬ íë¦„

### 1. ìš”ì²­ ìˆ˜ì‹  ë° ê²€ì¦

```java
@PostMapping("/approve")
public ResponseEntity<?> approveAttendance(
    @Valid @RequestBody AttendanceApproveRequestDto request,
    @AuthenticationPrincipal UserDetails userDetails
) {
    // 1. JWTì—ì„œ professorIdx ì¶”ì¶œ
    Integer professorIdx = extractUserIdFromToken(userDetails);
    
    // 2. ìš”ì²­ ë°ì´í„° ê²€ì¦
    // - lecSerial ì¡´ì¬ ì—¬ë¶€
    // - sessionNumber ë²”ìœ„ (1~80)
    // - attendanceRecords ìµœì†Œ 1ê°œ ì´ìƒ
    // - status ê°’ ("ì¶œ", "ì§€", "ê²°")
    
    // 3. Service í˜¸ì¶œ
    int successCount = attendanceService.approveAttendance(
        professorIdx,
        request.getLecSerial(),
        request.getSessionNumber(),
        request.getAttendanceRecords()
    );
    
    int totalCount = request.getAttendanceRecords().size();
    String message = String.format(
        "ì¶œì„ ìŠ¹ì¸ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. (%d/%d)", 
        successCount, 
        totalCount
    );
    
    return ResponseEntity.ok(
        AttendanceResponseDto.success(message, null)
    );
}
```

### 2. êµìˆ˜ ê¶Œí•œ ê²€ì¦

```java
// Repository ì¿¼ë¦¬ (LEC_PROF = professorIdx)
Optional<EnrollmentExtendedTbl> enrollment = 
    enrollmentRepository.findByLecSerialAndProfessorIdx(
        lecSerial, 
        professorIdx
    );

if (!enrollment.isPresent()) {
    throw new ForbiddenException("í•´ë‹¹ ê°•ì˜ì˜ ë‹´ë‹¹ êµìˆ˜ê°€ ì•„ë‹™ë‹ˆë‹¤.");
}
```

**Repository ì¿¼ë¦¬**:
```java
@Query("SELECT e FROM EnrollmentExtendedTbl e " +
       "WHERE e.lecTbl.lecSerial = :lecSerial " +
       "AND e.lecTbl.lecProf = CAST(:professorIdx AS string)")
Optional<EnrollmentExtendedTbl> findByLecSerialAndProfessorIdx(
    @Param("lecSerial") String lecSerial, 
    @Param("professorIdx") Integer professorIdx
);
```

**ê²€ì¦ íë¦„**:
1. JWT í† í°ì—ì„œ `professorIdx` ì¶”ì¶œ (ì˜ˆ: `25`)
2. `LEC_TBL`ì—ì„œ `lecSerial` ì¡°íšŒ
3. `LEC_PROF` í•„ë“œì™€ `CAST(professorIdx AS string)` ë¹„êµ
   - `LEC_PROF = '25'` (ë¬¸ìì—´)
   - `CAST(25 AS string) = '25'` âœ…
4. ì¼ì¹˜í•˜ë©´ ê¶Œí•œ í™•ì¸ ì™„ë£Œ, ë¶ˆì¼ì¹˜í•˜ë©´ 403 Forbidden

### 3. ê° í•™ìƒë³„ ì²˜ë¦¬ (ë°˜ë³µ)

```java
int successCount = 0;

for (AttendanceApprovalRecordDto record : attendanceRecords) {
    try {
        // 1. í•´ë‹¹ í•™ìƒì˜ ENROLLMENT_DATA ì¡°íšŒ
        EnrollmentExtendedTbl studentEnrollment = 
            enrollmentRepository.findByLecSerialAndStudentIdx(
                lecSerial, 
                record.getStudentIdx()
            ).orElseThrow(() -> 
                new NotFoundException("ìˆ˜ê°•ìƒì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
            );
        
        // 2. JSON íŒŒì‹±
        AttendanceDataDto attendanceData = 
            parseAttendanceData(studentEnrollment.getEnrollmentData());
        
        // 3. pendingRequestsì—ì„œ í•´ë‹¹ íšŒì°¨ ì°¾ê¸°
        Optional<AttendancePendingRequestDto> pendingRequest = 
            attendanceData.getPendingRequests().stream()
                .filter(r -> r.getSessionNumber() == sessionNumber)
                .findFirst();
        
        if (!pendingRequest.isPresent()) {
            log.warn("ëŒ€ê¸° ì¤‘ì¸ ìš”ì²­ì´ ì—†ìŠµë‹ˆë‹¤: studentIdx={}, session={}", 
                     record.getStudentIdx(), sessionNumber);
            continue; // ë‹¤ìŒ í•™ìƒìœ¼ë¡œ
        }
        
        // 4. sessionsë¡œ ì´ë™
        AttendanceSessionDto session = AttendanceSessionDto.builder()
            .sessionNumber(sessionNumber)
            .status(record.getStatus()) // "ì¶œ", "ì§€", "ê²°"
            .requestDate(pendingRequest.get().getRequestDate())
            .approvedDate(LocalDateTime.now())
            .approvedBy(professorIdx)
            .tempApproved(false) // êµìˆ˜ê°€ ìˆ˜ë™ ìŠ¹ì¸
            .build();
        
        attendanceData.getSessions().add(session);
        
        // 5. pendingRequestsì—ì„œ ì œê±°
        attendanceData.getPendingRequests().remove(pendingRequest.get());
        
        // 6. summary ì¬ê³„ì‚°
        recalculateSummary(attendanceData);
        
        // 7. JSON ì§ë ¬í™” ë° ì €ì¥
        String updatedJson = objectMapper.writeValueAsString(attendanceData);
        studentEnrollment.setEnrollmentData(updatedJson);
        enrollmentRepository.save(studentEnrollment);
        
        successCount++;
        
    } catch (Exception e) {
        log.error("ì¶œì„ ìŠ¹ì¸ ì‹¤íŒ¨: studentIdx={}", 
                  record.getStudentIdx(), e);
        // ê³„ì† ì§„í–‰ (ë¶€ë¶„ ì„±ê³µ í—ˆìš©)
    }
}

return successCount;
```

### 4. summary ì¬ê³„ì‚°

```java
private void recalculateSummary(AttendanceDataDto attendanceData) {
    int attended = 0;
    int late = 0;
    int absent = 0;
    
    // sessions ë°°ì—´ ìˆœíšŒí•˜ë©° ì¹´ìš´íŠ¸
    for (AttendanceSessionDto session : attendanceData.getSessions()) {
        switch (session.getStatus()) {
            case "ì¶œ": attended++; break;
            case "ì§€": late++; break;
            case "ê²°": absent++; break;
        }
    }
    
    // totalSessions = sessions + pendingRequests
    int totalSessions = attendanceData.getSessions().size() 
                      + attendanceData.getPendingRequests().size();
    
    // ì¶œì„ìœ¨ ê³„ì‚°
    double attendanceRate = totalSessions > 0 
        ? (attended * 100.0) / totalSessions 
        : 0.0;
    
    // summary ì—…ë°ì´íŠ¸
    AttendanceSummaryDto summary = attendanceData.getSummary();
    summary.setAttended(attended);
    summary.setLate(late);
    summary.setAbsent(absent);
    summary.setTotalSessions(totalSessions);
    summary.setAttendanceRate(attendanceRate);
    summary.setUpdatedAt(LocalDateTime.now());
}
```

---

## ì—ëŸ¬ ì¼€ì´ìŠ¤

### 1. ì¸ì¦ ì‹¤íŒ¨ (401)

**ì›ì¸**: JWT í† í° ì—†ìŒ ë˜ëŠ” ë§Œë£Œ

```json
{
  "success": false,
  "message": "ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤.",
  "errorCode": "UNAUTHORIZED"
}
```

### 2. ë‹´ë‹¹ êµìˆ˜ ì•„ë‹˜ (403)

**ì›ì¸**: êµìˆ˜ê°€ í•´ë‹¹ ê°•ì˜ì˜ ë‹´ë‹¹ êµìˆ˜ê°€ ì•„ë‹˜

```json
{
  "success": false,
  "message": "í•´ë‹¹ ê°•ì˜ì˜ ë‹´ë‹¹ êµìˆ˜ê°€ ì•„ë‹™ë‹ˆë‹¤.",
  "errorCode": "FORBIDDEN"
}
```

### 3. ìœ íš¨í•˜ì§€ ì•Šì€ íšŒì°¨ (400)

**ì›ì¸**: sessionNumberê°€ 1~80 ë²”ìœ„ë¥¼ ë²—ì–´ë‚¨

```json
{
  "success": false,
  "message": "íšŒì°¨ ë²ˆí˜¸ëŠ” 1ì—ì„œ 80 ì‚¬ì´ì—¬ì•¼ í•©ë‹ˆë‹¤.",
  "errorCode": "VALIDATION_ERROR"
}
```

### 4. ìœ íš¨í•˜ì§€ ì•Šì€ ìƒíƒœ (400)

**ì›ì¸**: statusê°€ "ì¶œ", "ì§€", "ê²°"ì´ ì•„ë‹˜

```json
{
  "success": false,
  "message": "ì¶œì„ ìƒíƒœëŠ” 'ì¶œ', 'ì§€', 'ê²°' ì¤‘ í•˜ë‚˜ì—¬ì•¼ í•©ë‹ˆë‹¤.",
  "errorCode": "VALIDATION_ERROR"
}
```

### 5. ìˆ˜ê°•ìƒì„ ì°¾ì„ ìˆ˜ ì—†ìŒ (404)

**ì›ì¸**: studentIdxì— í•´ë‹¹í•˜ëŠ” ìˆ˜ê°•ìƒì´ ì—†ìŒ

```json
{
  "success": false,
  "message": "ìˆ˜ê°•ìƒì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.",
  "errorCode": "NOT_FOUND"
}
```

### 6. ê°•ì˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ (404)

**ì›ì¸**: lecSerialì´ DBì— ì¡´ì¬í•˜ì§€ ì•ŠìŒ

```json
{
  "success": false,
  "message": "í•´ë‹¹ ê°•ì˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.",
  "errorCode": "NOT_FOUND"
}
```

### 7. ë¹ˆ ìŠ¹ì¸ ë ˆì½”ë“œ (400)

**ì›ì¸**: attendanceRecords ë°°ì—´ì´ ë¹„ì–´ìˆìŒ

```json
{
  "success": false,
  "message": "ìµœì†Œ 1ëª… ì´ìƒì˜ í•™ìƒì„ ì„ íƒí•´ì•¼ í•©ë‹ˆë‹¤.",
  "errorCode": "VALIDATION_ERROR"
}
```

---

## ì‚¬ìš© ì˜ˆì‹œ

### JavaScript (ë¸Œë¼ìš°ì €)

```javascript
async function approveAttendance(lecSerial, sessionNumber, students) {
    const token = window.authToken || 
                  localStorage.getItem('accessToken');
    
    // students: [{ studentIdx: 6, status: "ì¶œ" }, ...]
    const response = await fetch(
        'https://bluecrab.chickenkiller.com/BlueCrab-1.0.0/api/attendance/approve',
        {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify({
                lecSerial: lecSerial,
                sessionNumber: sessionNumber,
                attendanceRecords: students
            })
        }
    );
    
    const data = await response.json();
    
    if (data.success) {
        console.log('âœ… ì¶œì„ ìŠ¹ì¸ ì™„ë£Œ:', data.message);
    } else {
        console.error('âŒ ì¶œì„ ìŠ¹ì¸ ì‹¤íŒ¨:', data.message);
    }
    
    return data;
}

// ì‚¬ìš© ì˜ˆ
approveAttendance('ETH201', 1, [
    { studentIdx: 6, status: 'ì¶œ' },
    { studentIdx: 7, status: 'ì§€' },
    { studentIdx: 8, status: 'ê²°' }
]);
```

### React ì˜ˆì‹œ

```jsx
import { useState, useEffect } from 'react';

function AttendanceApprovalPage({ lecSerial, sessionNumber }) {
    const [students, setStudents] = useState([]);
    const [selectedStudents, setSelectedStudents] = useState([]);
    const [loading, setLoading] = useState(false);
    
    // ëŒ€ê¸° ì¤‘ì¸ í•™ìƒ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
    useEffect(() => {
        fetchPendingStudents();
    }, [lecSerial, sessionNumber]);
    
    const fetchPendingStudents = async () => {
        // êµìˆ˜ ì¶œì„ ì¡°íšŒ API í˜¸ì¶œ
        const response = await fetch('/api/attendance/professor/view', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${getToken()}`
            },
            body: JSON.stringify({ lecSerial })
        });
        
        const data = await response.json();
        
        if (data.success) {
            // sessionNumberì— ëŒ€ê¸° ì¤‘ì¸ ìš”ì²­ì´ ìˆëŠ” í•™ìƒë§Œ í•„í„°ë§
            const pending = data.data.filter(student => 
                student.attendanceData.pendingRequests.some(
                    req => req.sessionNumber === sessionNumber
                )
            );
            setStudents(pending);
        }
    };
    
    const handleApprove = async () => {
        if (selectedStudents.length === 0) {
            alert('ìµœì†Œ 1ëª… ì´ìƒ ì„ íƒí•´ì•¼ í•©ë‹ˆë‹¤.');
            return;
        }
        
        setLoading(true);
        
        try {
            const response = await fetch('/api/attendance/approve', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${getToken()}`
                },
                body: JSON.stringify({
                    lecSerial,
                    sessionNumber,
                    attendanceRecords: selectedStudents
                })
            });
            
            const data = await response.json();
            
            if (data.success) {
                alert(data.message);
                fetchPendingStudents(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                setSelectedStudents([]);
            } else {
                alert('ì˜¤ë¥˜: ' + data.message);
            }
        } catch (error) {
            alert('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ' + error.message);
        } finally {
            setLoading(false);
        }
    };
    
    const handleStatusChange = (studentIdx, status) => {
        setSelectedStudents(prev => {
            const exists = prev.find(s => s.studentIdx === studentIdx);
            if (exists) {
                return prev.map(s => 
                    s.studentIdx === studentIdx 
                        ? { ...s, status } 
                        : s
                );
            } else {
                return [...prev, { studentIdx, status }];
            }
        });
    };
    
    return (
        <div>
            <h2>{lecSerial} - {sessionNumber}íšŒì°¨ ì¶œì„ ìŠ¹ì¸</h2>
            
            <table>
                <thead>
                    <tr>
                        <th>í•™ë²ˆ</th>
                        <th>ì´ë¦„</th>
                        <th>ìš”ì²­ì¼</th>
                        <th>ì‚¬ìœ </th>
                        <th>ìŠ¹ì¸</th>
                    </tr>
                </thead>
                <tbody>
                    {students.map(student => {
                        const request = student.attendanceData.pendingRequests
                            .find(r => r.sessionNumber === sessionNumber);
                        
                        return (
                            <tr key={student.studentIdx}>
                                <td>{student.studentCode}</td>
                                <td>{student.studentName}</td>
                                <td>{request.requestDate}</td>
                                <td>{request.requestReason || '-'}</td>
                                <td>
                                    <select
                                        onChange={(e) => handleStatusChange(
                                            student.studentIdx, 
                                            e.target.value
                                        )}
                                        defaultValue=""
                                    >
                                        <option value="" disabled>ì„ íƒ</option>
                                        <option value="ì¶œ">ì¶œì„</option>
                                        <option value="ì§€">ì§€ê°</option>
                                        <option value="ê²°">ê²°ì„</option>
                                    </select>
                                </td>
                            </tr>
                        );
                    })}
                </tbody>
            </table>
            
            <button 
                onClick={handleApprove} 
                disabled={loading || selectedStudents.length === 0}
            >
                {loading ? 'ìŠ¹ì¸ ì¤‘...' : `ìŠ¹ì¸ (${selectedStudents.length}ëª…)`}
            </button>
        </div>
    );
}
```

---

## ì£¼ì˜ì‚¬í•­

### í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œì

1. **ëŒ€ê¸° ì¤‘ì¸ ìš”ì²­ë§Œ í‘œì‹œ**
   - êµìˆ˜ ì¶œì„ ì¡°íšŒ APIë¡œ `pendingRequests`ê°€ ìˆëŠ” í•™ìƒë§Œ í•„í„°ë§
   - ì´ë¯¸ `sessions`ì— ìˆëŠ” íšŒì°¨ëŠ” ì¬ìŠ¹ì¸ ë¶ˆê°€

2. **ì¼ê´„ ìŠ¹ì¸ UX**
   - ì²´í¬ë°•ìŠ¤ë¡œ ì—¬ëŸ¬ í•™ìƒ ì„ íƒ
   - "ì „ì²´ ì¶œì„", "ì „ì²´ ì§€ê°", "ì „ì²´ ê²°ì„" ë²„íŠ¼ ì œê³µ

3. **ë¶€ë¶„ ì„±ê³µ ì²˜ë¦¬**
   - ì‘ë‹µ ë©”ì‹œì§€ì—ì„œ "(2/3)" í˜•ì‹ íŒŒì‹±
   - ì¼ë¶€ ì‹¤íŒ¨ ì‹œ ê²½ê³  ë©”ì‹œì§€ í‘œì‹œ

### ë°±ì—”ë“œ ê°œë°œì

1. **íŠ¸ëœì­ì…˜ ë²”ìœ„**
   - ê° í•™ìƒë³„ë¡œ ë…ë¦½ì ì¸ íŠ¸ëœì­ì…˜ ì²˜ë¦¬
   - í•œ í•™ìƒ ì‹¤íŒ¨ ì‹œ ë‹¤ë¥¸ í•™ìƒì€ ê³„ì† ì²˜ë¦¬

2. **ì˜ˆì™¸ ì²˜ë¦¬**
   - ë¶€ë¶„ ì‹¤íŒ¨ëŠ” ë¡œê·¸ë§Œ ë‚¨ê¸°ê³  ê³„ì† ì§„í–‰
   - ì „ì²´ ì‹¤íŒ¨ ì‹œì—ë§Œ ì—ëŸ¬ ì‘ë‹µ

3. **ì„±ëŠ¥ ìµœì í™”**
   - Batch ì²˜ë¦¬ ê³ ë ¤ (ëŒ€ëŸ‰ ìŠ¹ì¸ ì‹œ)
   - JSON íŒŒì‹± ìºì‹±

---

## ë‹¤ìŒ ë‹¨ê³„

- **[05. êµìˆ˜ ê¶Œí•œ ê²€ì¦](./05_êµìˆ˜_ê¶Œí•œ_ê²€ì¦.md)**: LEC_PROF ê²€ì¦ ë¡œì§ ìƒì„¸
- **[07. ë°ì´í„° êµ¬ì¡°](./07_ë°ì´í„°_êµ¬ì¡°.md)**: sessions, pendingRequests êµ¬ì¡°
- **[08. ì‹œí€€ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨](./08_ì‹œí€€ìŠ¤_ë‹¤ì´ì–´ê·¸ë¨.md)**: ì „ì²´ íë¦„ ì‹œê°í™”

---

**ğŸ“š [ëª©ì°¨ë¡œ ëŒì•„ê°€ê¸°](./README.md)**

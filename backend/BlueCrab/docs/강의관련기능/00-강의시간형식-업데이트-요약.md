# 강의 시간 형식 업데이트 요약

> **업데이트 일자**: 2025-10-15
> **버전**: v3.0 (엄격한 검증 적용)
> **변경 사유**: 데이터 검증 강화 및 형식 엄격화

---

## 📋 변경 개요

### **변경 전 (v1.0)**
- 형식: 숫자 코드 (예: `11121314`)
- 구조: 요일코드(2자리) + 교시(2자리) 반복
- 예시: `11121314` = 월요일 1,2교시 + 수요일 3,4교시

### **변경 후 (v2.0 → v3.0)**
- 형식: 한글 요일 + 숫자 (예: `월1월2수3수4`)
- 구조: 요일명 + 교시 반복
- **v3.0 추가**: 엄격한 형식 검증 적용
- 예시: `월1월2수3수4` = 월요일 1,2교시 + 수요일 3,4교시

---

## 🎯 주요 개선 사항

### **1. 가독성 향상**
```
Before: 11121314 (해석 필요)
After:  월1월2수3수4 (직관적)
```

### **2. 엄격한 형식 검증 (v3.0)**
- **정규식 패턴 적용**: `^([월화수목금][1-8])+$`
- **유효하지 않은 형식 거부**: 콤마, 공백, 잘못된 요일/교시
- **서버 측 검증**: LectureService에서 강제 검증
- **데이터베이스 무결성**: 잘못된 형식 저장 방지

### **3. 사용자 입력 제한**
**v2.0**: 자유로운 입력 후 자동 변환
- `월1,2 수3,4` (콤마 구분) ✅
- `월1 월2 수3 수4` (공백 구분) ✅
- `월1월2수3수4` (연속 입력) ✅

**v3.0**: 엄격한 형식만 허용
- `월1월2수3수4` (연속 입력) ✅
- `월1,2 수3,4` (콤마 구분) ❌
- `월1 월2 수3 수4` (공백 구분) ❌

### **4. 백엔드 검증 강화**
```java
// LectureService.java
private static final Pattern LECTURE_TIME_PATTERN = 
    Pattern.compile("^([월화수목금][1-8])+$");

public void validateLectureTime(String lecTime) {
    if (!LECTURE_TIME_PATTERN.matcher(lecTime).matches()) {
        throw new IllegalArgumentException("강의 시간 형식이 올바르지 않습니다");
    }
}
```

---

## 📁 업데이트된 파일 목록

### **1. Entity & Database**
- ✅ `backend/BlueCrab/src/.../entity/LecTbl.java`
  - `lecTime` 필드 주석 업데이트
  - `@Column(length = 50)` → `@Column(length = 100)`
  
- ✅ `backend/BlueCrab/docs/강의관련기능/01-데이터베이스설계.md`
  - 시간 형식 섹션 완전 재작성
  - 파싱 로직 예시 추가 (JavaScript, Java)
  - 마이그레이션 가이드 추가

### **2. API 문서**
- ✅ `backend/BlueCrab/docs/강의관련기능/02-API명세서.md`
  - 모든 요청/응답 예시 업데이트
  - `lectureTime` 필드 예시 변경

### **3. 플로우 문서**
- ✅ `backend/BlueCrab/docs/강의관련기능/04-관리자플로우.md`
  - 강의 등록 프로세스에 형식 가이드 추가
  - 입력 검증 단계에 시간 형식 검증 추가
  - 변환 로직 코드 예시 포함
  
- ✅ `backend/BlueCrab/docs/강의관련기능/06-학생플로우.md`
  - 학기 중 활동 섹션에 시간표 형식 명시

### **4. 테스트 파일**
- ✅ `backend/BlueCrab/브라우저콘솔테스트/lecture-test-1-admin-create.js`
  - `convertLectureTimeFormat()` 함수 추가
  - 테스트 케이스에 새 형식 적용
  
- ✅ `backend/BlueCrab/브라우저콘솔테스트/README.md`
  - 강의 시간 형식 섹션 추가
  - 형식 규칙 및 예시 문서화
  - 변환 테이블 추가

---

## 🔧 기술 구현

### **데이터베이스 변경**
```sql
-- LEC_TBL 테이블
ALTER TABLE LEC_TBL 
MODIFY COLUMN LEC_TIME VARCHAR(100);

-- 데이터 마이그레이션 (필요시)
-- 기존 데이터가 있다면 변환 스크립트 실행
```

### **형식 변환 함수**
```javascript
/**
 * 강의 시간 형식 변환 함수
 * @param {string} input - 사용자 입력 (예: "월1,2 수3,4")
 * @returns {string} 표준 형식 (예: "월1월2수3수4")
 */
function convertLectureTimeFormat(input) {
    if (!input || input.trim() === '') {
        return '';
    }
    
    const regex = /([월화수목금])([0-9,\s]+)/g;
    let result = '';
    let match;
    
    while ((match = regex.exec(input)) !== null) {
        const day = match[1];
        const periods = match[2]
            .replace(/\s+/g, '')
            .split(',')
            .filter(p => p);
        
        periods.forEach(period => {
            result += day + period;
        });
    }
    
    return result;
}
```

### **유효성 검증**
```javascript
/**
 * 강의 시간 형식 검증
 * @param {string} lectureTime - 검증할 시간 문자열
 * @returns {boolean} 유효성 여부
 */
function validateLectureTime(lectureTime) {
    if (!lectureTime || lectureTime.trim() === '') {
        return true; // 빈 값 허용
    }
    
    // 형식: (요일+숫자) 반복
    const pattern = /^([월화수목금][1-9])+$/;
    return pattern.test(lectureTime);
}
```

---

## 📊 형식 변환 매핑 테이블

| 구 형식 (v1.0) | 신 형식 (v2.0) | 의미 |
|---------------|---------------|------|
| `1112` | `월1월2` | 월요일 1,2교시 |
| `11121314` | `월1월2수3수4` | 월요일 1,2교시 + 수요일 3,4교시 |
| `2122` | `화1화2` | 화요일 1,2교시 |
| `31324151` | `수1수2목1금1` | 수요일 1,2교시 + 목요일 1교시 + 금요일 1교시 |

---

## 🔍 호환성 및 마이그레이션

### **기존 데이터 처리**
- 새로운 시스템은 **신규 등록부터** 새 형식 사용
- 기존 데이터가 있다면 **마이그레이션 스크립트** 필요
- 마이그레이션 예시:
  ```sql
  UPDATE LEC_TBL
  SET LEC_TIME = 
    CASE 
      WHEN LEC_TIME = '1112' THEN '월1월2'
      WHEN LEC_TIME = '11121314' THEN '월1월2수3수4'
      -- 추가 변환 규칙...
    END
  WHERE LEC_TIME REGEXP '^[0-9]+$';
  ```

### **API 호환성**
- API는 **새 형식만** 지원
- 클라이언트는 `convertLectureTimeFormat()` 사용 권장
- 입력 시 자동 변환 처리

---

## ✅ 업데이트 체크리스트

- [x] Entity 클래스 업데이트 (`LecTbl.java`)
- [x] 데이터베이스 설계 문서 업데이트
- [x] API 명세서 예시 업데이트
- [x] 관리자 플로우 문서 업데이트
- [x] 학생 플로우 문서 업데이트
- [x] 테스트 파일에 변환 함수 추가
- [x] README 문서 업데이트
- [x] 형식 변환 로직 구현
- [x] 유효성 검증 로직 추가
- [ ] 백엔드 Service/Controller 레이어 업데이트 (필요시)
- [ ] 프론트엔드 UI 컴포넌트 업데이트 (필요시)
- [ ] 기존 데이터 마이그레이션 (데이터 존재 시)

---

## 🎓 사용 가이드

### **관리자용 (강의 등록 시)**
1. 강의 시간 입력 필드에 편한 형식으로 입력:
   - `월1,2 수3,4` ← 추천
   - `월1 월2 수3 수4` ← 가능
   - `월1월2수3수4` ← 가능

2. 시스템이 자동으로 `월1월2수3수4` 형식으로 변환

3. 검증 통과 후 데이터베이스 저장

### **개발자용 (테스트 시)**
```javascript
// 브라우저 콘솔 테스트 파일 사용
// 1. lecture-test-1-admin-create.js 로드
// 2. help() 명령으로 사용법 확인
// 3. createLecture() 실행
//    - 시간 입력: "월1,2 수3,4" 입력
//    - 자동 변환되어 저장됨
```

---

## 📞 참고 문서

- [01-데이터베이스설계.md](./01-데이터베이스설계.md) - 시간 형식 파싱 로직
- [02-API명세서.md](./02-API명세서.md) - API 요청/응답 예시
- [04-관리자플로우.md](./04-관리자플로우.md) - 강의 등록 프로세스
- [브라우저콘솔테스트/README.md](../브라우저콘솔테스트/README.md) - 테스트 가이드

---

## 🚀 다음 단계

1. **백엔드 코드 업데이트**: Service/Controller에서 새 형식 처리
2. **프론트엔드 UI 개선**: 입력 필드에 형식 안내 추가
3. **데이터 마이그레이션**: 기존 데이터 변환 (필요시)
4. **통합 테스트**: 전체 플로우 검증
5. **사용자 교육**: 새 형식 사용법 공지

---

> **Note**: 이 문서는 강의 시간 형식 변경에 대한 전체 개요를 제공합니다.  
> 각 섹션별 상세 내용은 해당 문서를 참조하세요.

<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì²¨ë¶€íŒŒì¼ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .section h3 {
            margin-top: 0;
            color: #333;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .log-area {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            padding: 15px;
            margin-top: 15px;
            border-radius: 4px;
            height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        .auth-status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .auth-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .auth-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ BlueCrab LMS ì²¨ë¶€íŒŒì¼ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸</h1>
        
        <!-- ì¸ì¦ ìƒíƒœ -->
        <div class="section">
            <h3>ğŸ” 1. ì¸ì¦ ìƒíƒœ</h3>
            <div id="authStatus" class="auth-status auth-error">
                ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.
            </div>
            <button onclick="checkAuthStatus()">ì¸ì¦ ìƒíƒœ í™•ì¸</button>
            <button onclick="showLoginModal()">ë¡œê·¸ì¸</button>
            <button onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
        </div>

        <!-- ë¡œê·¸ì¸ ëª¨ë‹¬ -->
        <div id="loginModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;">
            <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 8px; width: 400px;">
                <h3>ğŸ” ë¡œê·¸ì¸</h3>
                
                <!-- ë¡œê·¸ì¸ íƒ€ì… ì„ íƒ -->
                <div style="margin: 15px 0;">
                    <label>
                        <input type="radio" name="loginType" value="user" checked> ì¼ë°˜ ì‚¬ìš©ì ë¡œê·¸ì¸
                    </label>
                    <br>
                    <label>
                        <input type="radio" name="loginType" value="admin"> ê´€ë¦¬ì ë¡œê·¸ì¸
                    </label>
                </div>
                
                <!-- ì¼ë°˜ ì‚¬ìš©ì ë¡œê·¸ì¸ í¼ -->
                <div id="userLoginForm">
                    <div style="margin: 10px 0;">
                        <label>ì´ë©”ì¼:</label>
                        <input type="email" id="userEmail" placeholder="professor@example.com" style="width: 100%; padding: 8px; margin-top: 5px;">
                    </div>
                    <div style="margin: 10px 0;">
                        <label>ë¹„ë°€ë²ˆí˜¸:</label>
                        <input type="password" id="userPassword" style="width: 100%; padding: 8px; margin-top: 5px;">
                    </div>
                    <button onclick="performUserLogin()" style="width: 100%; margin: 10px 0;">ì¼ë°˜ ì‚¬ìš©ì ë¡œê·¸ì¸</button>
                </div>
                
                <!-- ê´€ë¦¬ì ë¡œê·¸ì¸ í¼ -->
                <div id="adminLoginForm" style="display: none;">
                    <div style="margin: 10px 0;">
                        <label>ê´€ë¦¬ì ID:</label>
                        <input type="text" id="adminId" placeholder="admin" style="width: 100%; padding: 8px; margin-top: 5px;">
                    </div>
                    <div id="adminStep1" style="display: block;">
                        <button onclick="performAdminStep1()" style="width: 100%; margin: 10px 0;">1ë‹¨ê³„: ê´€ë¦¬ì í™•ì¸</button>
                    </div>
                    <div id="adminStep2" style="display: none;">
                        <button onclick="performAdminStep2()" style="width: 100%; margin: 10px 0;">2ë‹¨ê³„: ì¸ì¦ ì½”ë“œ ìš”ì²­</button>
                    </div>
                    <div id="adminStep3" style="display: none;">
                        <div style="margin: 10px 0;">
                            <label>ì¸ì¦ ì½”ë“œ:</label>
                            <input type="text" id="verificationCode" placeholder="6ìë¦¬ ìˆ«ì" style="width: 100%; padding: 8px; margin-top: 5px;">
                        </div>
                        <button onclick="performAdminStep3()" style="width: 100%; margin: 10px 0;">3ë‹¨ê³„: ë¡œê·¸ì¸ ì™„ë£Œ</button>
                    </div>
                </div>
                
                <button onclick="closeLoginModal()" style="width: 100%; background: #6c757d;">ì·¨ì†Œ</button>
            </div>
        </div>

        <!-- ê²Œì‹œê¸€ ìƒì„± -->
        <div class="section">
            <h3>ğŸ“ 2. ê²Œì‹œê¸€ ìƒì„±</h3>
            <button onclick="createBasicBoard()" id="createBasicBtn">ê¸°ë³¸ ê²Œì‹œê¸€ ìƒì„±</button>
            <button onclick="createBoardWithAttachments()" id="createWithAttBtn" disabled>ì²¨ë¶€íŒŒì¼ í¬í•¨ ê²Œì‹œê¸€ ìƒì„±</button>
            <button onclick="createQuickBoardWithAttachments()" id="createQuickAttBtn" disabled>ë¹ ë¥¸ ì²¨ë¶€íŒŒì¼ ê²Œì‹œê¸€ ìƒì„±</button>
        </div>

        <!-- íŒŒì¼ ì—…ë¡œë“œ í…ŒìŠ¤íŠ¸ -->
        <div class="section">
            <h3>ğŸ“ 3. íŒŒì¼ ì—…ë¡œë“œ í…ŒìŠ¤íŠ¸</h3>
            <input type="file" id="fileInput" multiple accept="*/*" style="margin: 10px 0;">
            <br>
            <button onclick="testFileUpload()" id="uploadBtn" disabled>ì„ íƒëœ íŒŒì¼ ì—…ë¡œë“œ í…ŒìŠ¤íŠ¸</button>
            <button onclick="testAttachmentLink()" id="linkBtn" disabled>ì²¨ë¶€íŒŒì¼ ì—°ê²° í…ŒìŠ¤íŠ¸</button>
        </div>

        <!-- ë¡œê·¸ ì˜ì—­ -->
        <div class="section">
            <h3>ğŸ“‹ 4. ì‹¤í–‰ ë¡œê·¸</h3>
            <button onclick="clearLog()">ë¡œê·¸ ì§€ìš°ê¸°</button>
            <div id="logArea" class="log-area"></div>
        </div>
    </div>

    <script>
        // ========== ì„¤ì • ==========
        const API_BASE_URL = 'https://bluecrab.chickenkiller.com/BlueCrab-1.0.0';
        let lastCreatedBoard = null;
        let lastUploadedAttachments = [];

        // ========== ë¡œê·¸ í•¨ìˆ˜ ==========
        function log(message, type = 'info') {
            const logArea = document.getElementById('logArea');
            const timestamp = new Date().toLocaleTimeString();
            const colors = {
                info: '#333',
                success: '#28a745',
                error: '#dc3545',
                warning: '#ffc107'
            };
            
            logArea.innerHTML += `<div style="color: ${colors[type]}; margin: 2px 0;">
                [${timestamp}] ${message}
            </div>`;
            logArea.scrollTop = logArea.scrollHeight;
        }

        function clearLog() {
            document.getElementById('logArea').innerHTML = '';
        }

        // ========== ì¸ì¦ ê´€ë ¨ ==========
        function checkAuthStatus() {
            const adminToken = window.adminJwtToken || localStorage.getItem('adminJwtToken');
            const userToken = window.authToken;
            const statusDiv = document.getElementById('authStatus');
            
            if (adminToken || userToken) {
                statusDiv.className = 'auth-status auth-success';
                statusDiv.textContent = 'âœ… ë¡œê·¸ì¸ë¨ - ì²¨ë¶€íŒŒì¼ ê¸°ëŠ¥ ì‚¬ìš© ê°€ëŠ¥';
                
                // ë²„íŠ¼ë“¤ í™œì„±í™”
                document.getElementById('createWithAttBtn').disabled = false;
                document.getElementById('createQuickAttBtn').disabled = false;
                document.getElementById('uploadBtn').disabled = false;
                document.getElementById('linkBtn').disabled = false;
                
                log('âœ… ì¸ì¦ ìƒíƒœ: ë¡œê·¸ì¸ë¨', 'success');
                if (adminToken) log('ğŸ”‘ ê´€ë¦¬ì í† í° ì‚¬ìš©', 'info');
                if (userToken) log('ğŸ”‘ ì‚¬ìš©ì í† í° ì‚¬ìš©', 'info');
            } else {
                statusDiv.className = 'auth-status auth-error';
                statusDiv.textContent = 'âŒ ë¡œê·¸ì¸ í•„ìš” - ë¨¼ì € ë¡œê·¸ì¸í•˜ì„¸ìš”';
                
                // ë²„íŠ¼ë“¤ ë¹„í™œì„±í™”
                document.getElementById('createWithAttBtn').disabled = true;
                document.getElementById('createQuickAttBtn').disabled = true;
                document.getElementById('uploadBtn').disabled = true;
                document.getElementById('linkBtn').disabled = true;
                
                log('âŒ ì¸ì¦ ìƒíƒœ: ë¡œê·¸ì¸ í•„ìš”', 'error');
            }
        }

        function showLoginInstructions() {
            log('ğŸ’¡ ë¡œê·¸ì¸ ë°©ë²•:', 'info');
            log('1. "ë¡œê·¸ì¸" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”', 'info');
            log('2. ì¼ë°˜ ì‚¬ìš©ì ë˜ëŠ” ê´€ë¦¬ìë¥¼ ì„ íƒí•˜ì„¸ìš”', 'info');
            log('3. ë¡œê·¸ì¸ ì •ë³´ë¥¼ ì…ë ¥í•˜ê³  ë¡œê·¸ì¸í•˜ì„¸ìš”', 'info');
        }

        // ========== ë¡œê·¸ì¸ ëª¨ë‹¬ ê´€ë ¨ ==========
        function showLoginModal() {
            document.getElementById('loginModal').style.display = 'block';
            resetAdminLoginSteps();
        }

        function closeLoginModal() {
            document.getElementById('loginModal').style.display = 'none';
            resetAdminLoginSteps();
        }

        function resetAdminLoginSteps() {
            document.getElementById('adminStep1').style.display = 'block';
            document.getElementById('adminStep2').style.display = 'none';
            document.getElementById('adminStep3').style.display = 'none';
            document.getElementById('verificationCode').value = '';
        }

        // ë¡œê·¸ì¸ íƒ€ì… ë³€ê²½ ì´ë²¤íŠ¸
        document.addEventListener('DOMContentLoaded', function() {
            log('ğŸ”§ ì²¨ë¶€íŒŒì¼ í…ŒìŠ¤íŠ¸ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ', 'success');
            log('ğŸ’¡ ì‚¬ìš©ë²•:', 'info');
            log('1. ë¨¼ì € "ì¸ì¦ ìƒíƒœ í™•ì¸" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”', 'info');
            log('2. ë¡œê·¸ì¸ì´ í•„ìš”í•˜ë©´ "ë¡œê·¸ì¸" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”', 'info');
            log('3. íŒŒì¼ì„ ì„ íƒí•˜ê³  í…ŒìŠ¤íŠ¸ ë²„íŠ¼ë“¤ì„ ì‚¬ìš©í•˜ì„¸ìš”', 'info');
            
            checkAuthStatus();
            
            // íŒŒì¼ ì„ íƒ ì‹œ ë¡œê·¸ ì¶œë ¥
            document.getElementById('fileInput').addEventListener('change', function(e) {
                const files = Array.from(e.target.files);
                if (files.length > 0) {
                    log(`ğŸ“ ${files.length}ê°œ íŒŒì¼ ì„ íƒë¨:`, 'info');
                    files.forEach((file, index) => {
                        log(`   ${index + 1}. ${file.name} (${formatFileSize(file.size)})`, 'info');
                    });
                } else {
                    log('ğŸ“ íŒŒì¼ ì„ íƒì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.', 'warning');
                }
            });
            
            // ë¡œê·¸ì¸ íƒ€ì… ë³€ê²½ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
            const loginTypeRadios = document.querySelectorAll('input[name="loginType"]');
            loginTypeRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    const userForm = document.getElementById('userLoginForm');
                    const adminForm = document.getElementById('adminLoginForm');
                    
                    if (this.value === 'user') {
                        userForm.style.display = 'block';
                        adminForm.style.display = 'none';
                        log('ğŸ”„ ì¼ë°˜ ì‚¬ìš©ì ë¡œê·¸ì¸ ëª¨ë“œë¡œ ë³€ê²½', 'info');
                    } else {
                        userForm.style.display = 'none';
                        adminForm.style.display = 'block';
                        log('ğŸ”„ ê´€ë¦¬ì ë¡œê·¸ì¸ ëª¨ë“œë¡œ ë³€ê²½', 'info');
                    }
                    resetAdminLoginSteps();
                });
            });
            
            // Enter í‚¤ ì´ë²¤íŠ¸ ì¶”ê°€
            document.getElementById('userEmail').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    document.getElementById('userPassword').focus();
                }
            });
            
            document.getElementById('userPassword').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    performUserLogin();
                }
            });
            
            document.getElementById('verificationCode').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    performAdminStep3();
                }
            });
        });

        // ========== ì¼ë°˜ ì‚¬ìš©ì ë¡œê·¸ì¸ ==========
        async function performUserLogin() {
            const email = document.getElementById('userEmail').value.trim();
            const password = document.getElementById('userPassword').value.trim();
            
            if (!email || !password) {
                log('âŒ ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }
            
            log('ğŸ” ì¼ë°˜ ì‚¬ìš©ì ë¡œê·¸ì¸ ì‹œë„...', 'info');
            log(`ğŸ“§ ì´ë©”ì¼: ${email}`, 'info');
            
            const loginData = { username: email, password: password };
            
            try {
                log('ğŸ“¡ ë¡œê·¸ì¸ API í˜¸ì¶œ ì¤‘...', 'info');
                
                const response = await fetch('https://bluecrab.chickenkiller.com/BlueCrab-1.0.0/api/auth/login', {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    mode: 'cors',
                    credentials: 'include',
                    body: JSON.stringify(loginData)
                });
                
                log(`ğŸ“¡ ì‘ë‹µ ìƒíƒœ: ${response.status}`, response.ok ? 'success' : 'error');
                
                const result = await response.json();
                log(`ğŸ“¡ ì‘ë‹µ ë°ì´í„°: ${JSON.stringify(result)}`, 'info');
                
                if (response.ok && result.data && result.data.accessToken) {
                    window.authToken = result.data.accessToken;
                    window.refreshToken = result.data.refreshToken;
                    window.currentUser = result.data.user;
                    
                    log('âœ… ì¼ë°˜ ì‚¬ìš©ì ë¡œê·¸ì¸ ì„±ê³µ!', 'success');
                    log(`ğŸ‘¤ ì‚¬ìš©ì: ${result.data.user.userName}`, 'success');
                    log(`ğŸ“‹ ìœ í˜•: ${result.data.user.userStudent === 1 ? 'êµìˆ˜' : 'í•™ìƒ'}`, 'success');
                    log(`ğŸ¯ í† í° ì €ì¥ ì™„ë£Œ`, 'success');
                    
                    closeLoginModal();
                    checkAuthStatus();
                } else {
                    const errorMsg = result.message || result.error || 'ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤';
                    log('âŒ ë¡œê·¸ì¸ ì‹¤íŒ¨: ' + errorMsg, 'error');
                    
                    if (response.status === 401) {
                        log('ğŸ’¡ ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”', 'warning');
                    } else if (response.status >= 500) {
                        log('ğŸ’¡ ì„œë²„ ì˜¤ë¥˜ì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”', 'warning');
                    }
                }
            } catch (error) {
                log('âŒ ë¡œê·¸ì¸ ìš”ì²­ ì˜¤ë¥˜: ' + error.message, 'error');
                log('ğŸ’¡ ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”', 'warning');
            }
        }

        // ========== ê´€ë¦¬ì ë¡œê·¸ì¸ (3ë‹¨ê³„) ==========
        async function performAdminStep1() {
            const adminId = document.getElementById('adminId').value.trim();
            
            if (!adminId) {
                log('âŒ ê´€ë¦¬ì IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }
            
            log('ğŸ” ê´€ë¦¬ì ë¡œê·¸ì¸ 1ë‹¨ê³„ ì‹œë„...', 'info');
            log(`ğŸ‘¤ ê´€ë¦¬ì ID: ${adminId}`, 'info');
            
            try {
                log('ğŸ“¡ 1ë‹¨ê³„ API í˜¸ì¶œ ì¤‘...', 'info');
                
                const response = await fetch('https://bluecrab.chickenkiller.com/BlueCrab-1.0.0/api/admin/auth/login', {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    mode: 'cors',
                    credentials: 'include',
                    body: JSON.stringify({ adminId: adminId })
                });
                
                log(`ğŸ“¡ 1ë‹¨ê³„ ì‘ë‹µ ìƒíƒœ: ${response.status}`, response.ok ? 'success' : 'error');
                
                const result = await response.json();
                log(`ğŸ“¡ 1ë‹¨ê³„ ì‘ë‹µ ë°ì´í„°: ${JSON.stringify(result)}`, 'info');
                
                if (response.ok) {
                    window.adminId = adminId;
                    
                    log('âœ… 1ë‹¨ê³„ ì™„ë£Œ: ê´€ë¦¬ì í™•ì¸ë¨', 'success');
                    log('ğŸ’¡ 2ë‹¨ê³„ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ì¸ì¦ ì½”ë“œë¥¼ ìš”ì²­í•˜ì„¸ìš”.', 'info');
                    
                    document.getElementById('adminStep1').style.display = 'none';
                    document.getElementById('adminStep2').style.display = 'block';
                } else {
                    const errorMsg = result.message || result.error || 'ê´€ë¦¬ì IDë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”';
                    log('âŒ 1ë‹¨ê³„ ì‹¤íŒ¨: ' + errorMsg, 'error');
                    
                    if (response.status === 404) {
                        log('ğŸ’¡ ê´€ë¦¬ì IDê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤', 'warning');
                    }
                }
            } catch (error) {
                log('âŒ 1ë‹¨ê³„ ìš”ì²­ ì˜¤ë¥˜: ' + error.message, 'error');
                log('ğŸ’¡ ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”', 'warning');
            }
        }

        async function performAdminStep2() {
            if (!window.adminId) {
                log('âŒ 1ë‹¨ê³„ë¥¼ ë¨¼ì € ì™„ë£Œí•´ì£¼ì„¸ìš”.', 'error');
                return;
            }
            
            log('ğŸ” ê´€ë¦¬ì ë¡œê·¸ì¸ 2ë‹¨ê³„: ì¸ì¦ ì½”ë“œ ìš”ì²­...', 'info');
            log(`ğŸ‘¤ ê´€ë¦¬ì ID: ${window.adminId}`, 'info');
            
            try {
                log('ğŸ“¡ 2ë‹¨ê³„ API í˜¸ì¶œ ì¤‘...', 'info');
                
                const response = await fetch('https://bluecrab.chickenkiller.com/BlueCrab-1.0.0/api/admin/auth/send-code', {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    mode: 'cors',
                    credentials: 'include',
                    body: JSON.stringify({ adminId: window.adminId })
                });
                
                log(`ğŸ“¡ 2ë‹¨ê³„ ì‘ë‹µ ìƒíƒœ: ${response.status}`, response.ok ? 'success' : 'error');
                
                const result = await response.json();
                log(`ğŸ“¡ 2ë‹¨ê³„ ì‘ë‹µ ë°ì´í„°: ${JSON.stringify(result)}`, 'info');
                
                if (response.ok) {
                    log('âœ… 2ë‹¨ê³„ ì™„ë£Œ: ì¸ì¦ ì½”ë“œ ë°œì†¡ë¨', 'success');
                    log('ï¿½ ì´ë©”ì¼ì„ í™•ì¸í•˜ê³  6ìë¦¬ ì¸ì¦ ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”.', 'info');
                    
                    document.getElementById('adminStep2').style.display = 'none';
                    document.getElementById('adminStep3').style.display = 'block';
                    
                    // ì¸ì¦ ì½”ë“œ ì…ë ¥ í•„ë“œì— í¬ì»¤ìŠ¤
                    setTimeout(() => {
                        document.getElementById('verificationCode').focus();
                    }, 100);
                } else {
                    const errorMsg = result.message || result.error || 'ì¸ì¦ ì½”ë“œ ë°œì†¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤';
                    log('âŒ 2ë‹¨ê³„ ì‹¤íŒ¨: ' + errorMsg, 'error');
                    
                    if (response.status === 429) {
                        log('ğŸ’¡ ë„ˆë¬´ ë§ì€ ìš”ì²­ì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”', 'warning');
                    }
                }
            } catch (error) {
                log('âŒ 2ë‹¨ê³„ ìš”ì²­ ì˜¤ë¥˜: ' + error.message, 'error');
                log('ğŸ’¡ ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”', 'warning');
            }
        }

        async function performAdminStep3() {
            const code = document.getElementById('verificationCode').value;
            
            if (!code) {
                log('âŒ ì¸ì¦ ì½”ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }
            
            log('ğŸ” ê´€ë¦¬ì ë¡œê·¸ì¸ 3ë‹¨ê³„: ì¸ì¦ ì½”ë“œ í™•ì¸...', 'info');
            
            try {
                const response = await fetch('https://bluecrab.chickenkiller.com/BlueCrab-1.0.0/api/admin/auth/verify-code', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        adminId: window.adminId,
                        verificationCode: code 
                    })
                });
                
                const result = await response.json();
                
                if (response.ok && result.data) {
                    window.adminJwtToken = result.data.jwtToken;
                    localStorage.setItem('adminJwtToken', result.data.jwtToken);
                    localStorage.setItem('adminInfo', JSON.stringify({
                        adminId: window.adminId,
                        name: result.data.adminName
                    }));
                    
                    log('âœ… ê´€ë¦¬ì ë¡œê·¸ì¸ ì™„ë£Œ!', 'success');
                    log(`ê´€ë¦¬ìëª…: ${result.data.adminName}`, 'success');
                    
                    closeLoginModal();
                    checkAuthStatus();
                } else {
                    log('âŒ 3ë‹¨ê³„ ì‹¤íŒ¨: ' + (result.message || 'ì¸ì¦ ì½”ë“œê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤'), 'error');
                }
            } catch (error) {
                log('âŒ 3ë‹¨ê³„ ì˜¤ë¥˜: ' + error.message, 'error');
            }
        }

        // ========== ë¡œê·¸ì•„ì›ƒ ==========
        async function logout() {
            log('ğŸšª ë¡œê·¸ì•„ì›ƒ ì¤‘...', 'info');
            
            // í† í° ì •ë¦¬
            window.authToken = null;
            window.refreshToken = null;
            window.currentUser = null;
            window.adminJwtToken = null;
            window.adminId = null;
            
            localStorage.removeItem('adminJwtToken');
            localStorage.removeItem('adminInfo');
            
            log('âœ… ë¡œê·¸ì•„ì›ƒ ì™„ë£Œ', 'success');
            checkAuthStatus();
        }

        // ========== HTTP ìš”ì²­ í•¨ìˆ˜ ==========
        async function apiRequest(url, method = 'GET', data = null, requireAuth = false, isFormData = false) {
            const options = {
                method: method,
                headers: {},
                mode: 'cors',
                credentials: 'include'
            };

            // FormDataê°€ ì•„ë‹Œ ê²½ìš°ì—ë§Œ Content-Type ì„¤ì •
            if (!isFormData) {
                options.headers['Content-Type'] = 'application/json';
                options.headers['Accept'] = 'application/json';
            } else {
                options.headers['Accept'] = 'application/json';
            }

            // ì¸ì¦ í† í° ì¶”ê°€
            if (requireAuth) {
                const adminToken = window.adminJwtToken || localStorage.getItem('adminJwtToken');
                const userToken = window.authToken;
                const token = adminToken || userToken;
                
                if (token) {
                    options.headers['Authorization'] = `Bearer ${token}`;
                }
            }

            if (data) {
                if (isFormData) {
                    options.body = data; // FormDataëŠ” ê·¸ëŒ€ë¡œ ì „ë‹¬
                } else {
                    options.body = JSON.stringify(data);
                }
            }

            try {
                log(`${method} ${url}`, 'info');
                if (data && !isFormData) log(`Data: ${JSON.stringify(data)}`, 'info');
                
                const response = await fetch(url, options);
                const result = await response.json();
                
                log(`Status: ${response.status}`, response.ok ? 'success' : 'error');
                log(`Response: ${JSON.stringify(result)}`, response.ok ? 'success' : 'error');
                
                return { success: response.ok, status: response.status, data: result };
            } catch (error) {
                log(`Request failed: ${error.message}`, 'error');
                return { success: false, error: error.message };
            }
        }

        // ========== ê²Œì‹œê¸€ ìƒì„± í•¨ìˆ˜ ==========
        async function createBasicBoard() {
            log('ğŸ“ ê¸°ë³¸ ê²Œì‹œê¸€ ìƒì„± ì‹œì‘...', 'info');
            
            const boardData = {
                boardTitle: `í…ŒìŠ¤íŠ¸ ê²Œì‹œê¸€ ${new Date().toLocaleTimeString()}`,
                boardContent: `HTML í˜ì´ì§€ì—ì„œ ìƒì„±ëœ í…ŒìŠ¤íŠ¸ ê²Œì‹œê¸€ì…ë‹ˆë‹¤.\nìƒì„± ì‹œê°„: ${new Date().toISOString()}`,
                boardCode: 3
            };

            const result = await apiRequest(`${API_BASE_URL}/api/boards/create`, 'POST', boardData, true);
            
            if (result.success) {
                lastCreatedBoard = result.data;
                log(`âœ… ê²Œì‹œê¸€ ìƒì„± ì„±ê³µ! ë²ˆí˜¸: ${result.data.boardIdx}`, 'success');
                log(`ì œëª©: ${result.data.boardTitle}`, 'success');
                log(`ì‘ì„±ì: ${result.data.boardWriter}`, 'success');
            } else {
                log('âŒ ê²Œì‹œê¸€ ìƒì„± ì‹¤íŒ¨', 'error');
            }
        }

        async function createBoardWithAttachments() {
            log('ğŸ“ ì²¨ë¶€íŒŒì¼ í¬í•¨ ê²Œì‹œê¸€ ìƒì„± ì‹œì‘...', 'info');
            
            try {
                // 1ë‹¨ê³„: ê²Œì‹œê¸€ ìƒì„±
                log('=== 1ë‹¨ê³„: ê²Œì‹œê¸€ ìƒì„± ===', 'info');
                await createBasicBoard();
                
                if (!lastCreatedBoard) {
                    log('âŒ ê²Œì‹œê¸€ ìƒì„± ì‹¤íŒ¨ë¡œ ì¤‘ë‹¨', 'error');
                    return;
                }
                
                // 2ë‹¨ê³„: íŒŒì¼ ì„ íƒ ë° ì—…ë¡œë“œ
                log('=== 2ë‹¨ê³„: íŒŒì¼ ì—…ë¡œë“œ ===', 'info');
                const fileInput = document.getElementById('fileInput');
                const files = fileInput.files;
                
                if (files.length === 0) {
                    log('âŒ íŒŒì¼ì´ ì„ íƒë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ë¨¼ì € íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.', 'warning');
                    return;
                }
                
                const attachmentIds = await uploadFiles(Array.from(files));
                
                if (attachmentIds.length === 0) {
                    log('âŒ íŒŒì¼ ì—…ë¡œë“œ ì‹¤íŒ¨', 'error');
                    return;
                }
                
                // 3ë‹¨ê³„: ì²¨ë¶€íŒŒì¼ ì—°ê²°
                log('=== 3ë‹¨ê³„: ì²¨ë¶€íŒŒì¼ ì—°ê²° ===', 'info');
                const linkResult = await linkAttachments(lastCreatedBoard.boardIdx, attachmentIds);
                
                if (linkResult.success) {
                    log('ğŸ‰ ì²¨ë¶€íŒŒì¼ í¬í•¨ ê²Œì‹œê¸€ ìƒì„± ì™„ë£Œ!', 'success');
                    log(`ğŸ“‹ ê²Œì‹œê¸€: ${lastCreatedBoard.boardIdx}ë²ˆ`, 'success');
                    log(`ğŸ“ ì²¨ë¶€íŒŒì¼: ${attachmentIds.length}ê°œ`, 'success');
                }
                
            } catch (error) {
                log(`âŒ ì˜¤ë¥˜ ë°œìƒ: ${error.message}`, 'error');
            }
        }

        async function createQuickBoardWithAttachments() {
            log('âš¡ğŸ“ ë¹ ë¥¸ ì²¨ë¶€íŒŒì¼ í¬í•¨ ê²Œì‹œê¸€ ìƒì„±...', 'info');
            
            const fileInput = document.getElementById('fileInput');
            const files = fileInput.files;
            
            if (files.length === 0) {
                log('âŒ íŒŒì¼ì´ ì„ íƒë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ë¨¼ì € íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.', 'warning');
                return;
            }
            
            await createBoardWithAttachments();
        }

        // ========== íŒŒì¼ ì—…ë¡œë“œ í•¨ìˆ˜ ==========
        async function uploadFiles(files) {
            if (!files || files.length === 0) {
                log('ğŸ“ ì„ íƒëœ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.', 'warning');
                return [];
            }
            
            if (files.length > 5) {
                log('âŒ ìµœëŒ€ 5ê°œ íŒŒì¼ê¹Œì§€ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.', 'error');
                return [];
            }
            
            log(`ğŸ“¤ ${files.length}ê°œ íŒŒì¼ ì—…ë¡œë“œ ì‹œì‘...`, 'info');
            const results = [];
            
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                log(`[${i + 1}/${files.length}] ${file.name} ì—…ë¡œë“œ ì¤‘... (${formatFileSize(file.size)})`, 'info');
                
                const formData = new FormData();
                formData.append('file', file);
                
                const result = await apiRequest(`${API_BASE_URL}/api/attachments/upload`, 'POST', formData, true, true);
                
                if (result.success) {
                    results.push(result.data.attachmentIdx);
                    log(`âœ… ${file.name} ì—…ë¡œë“œ ì„±ê³µ! (ID: ${result.data.attachmentIdx})`, 'success');
                } else {
                    log(`âŒ ${file.name} ì—…ë¡œë“œ ì‹¤íŒ¨`, 'error');
                    return [];
                }
            }
            
            log(`âœ… ëª¨ë“  íŒŒì¼ ì—…ë¡œë“œ ì™„ë£Œ! ID ëª©ë¡: [${results.join(', ')}]`, 'success');
            lastUploadedAttachments = results;
            return results;
        }

        async function testFileUpload() {
            const fileInput = document.getElementById('fileInput');
            const files = Array.from(fileInput.files);
            
            if (files.length === 0) {
                log('âŒ íŒŒì¼ì´ ì„ íƒë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.', 'warning');
                return;
            }
            
            await uploadFiles(files);
        }

        async function linkAttachments(boardIdx, attachmentIds) {
            if (!attachmentIds || attachmentIds.length === 0) {
                log('ğŸ“ ì—°ê²°í•  ì²¨ë¶€íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.', 'warning');
                return { success: true };
            }
            
            log(`ğŸ”— ê²Œì‹œê¸€ ${boardIdx}ë²ˆì— ì²¨ë¶€íŒŒì¼ ì—°ê²° ì¤‘...`, 'info');
            log(`ì²¨ë¶€íŒŒì¼ ID ëª©ë¡: [${attachmentIds.join(', ')}]`, 'info');
            
            const linkData = {
                attachmentIds: attachmentIds
            };
            
            const result = await apiRequest(`${API_BASE_URL}/api/boards/link-attachments/${boardIdx}`, 'POST', linkData, true);
            
            if (result.success) {
                log('âœ… ì²¨ë¶€íŒŒì¼ ì—°ê²° ì„±ê³µ!', 'success');
                log(`ì—°ê²°ëœ íŒŒì¼ ìˆ˜: ${attachmentIds.length}ê°œ`, 'success');
            } else {
                log('âŒ ì²¨ë¶€íŒŒì¼ ì—°ê²° ì‹¤íŒ¨', 'error');
            }
            
            return result;
        }

        async function testAttachmentLink() {
            if (!lastCreatedBoard) {
                log('âŒ ì—°ê²°í•  ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ê²Œì‹œê¸€ì„ ìƒì„±í•˜ì„¸ìš”.', 'warning');
                return;
            }
            
            if (lastUploadedAttachments.length === 0) {
                log('âŒ ì—°ê²°í•  ì²¨ë¶€íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì„¸ìš”.', 'warning');
                return;
            }
            
            await linkAttachments(lastCreatedBoard.boardIdx, lastUploadedAttachments);
        }

        // ========== ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ==========
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // ========== ì´ˆê¸°í™” ==========
        document.addEventListener('DOMContentLoaded', function() {
            log('ğŸ”§ ì²¨ë¶€íŒŒì¼ í…ŒìŠ¤íŠ¸ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ', 'success');
            log('ğŸ’¡ ì‚¬ìš©ë²•:', 'info');
            log('1. ë¨¼ì € "ì¸ì¦ ìƒíƒœ í™•ì¸" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”', 'info');
            log('2. ë¡œê·¸ì¸ì´ í•„ìš”í•˜ë©´ ì½˜ì†”ì—ì„œ ë¡œê·¸ì¸í•˜ì„¸ìš”', 'info');
            log('3. íŒŒì¼ì„ ì„ íƒí•˜ê³  í…ŒìŠ¤íŠ¸ ë²„íŠ¼ë“¤ì„ ì‚¬ìš©í•˜ì„¸ìš”', 'info');
            
            checkAuthStatus();
            
            // íŒŒì¼ ì„ íƒ ì‹œ ë¡œê·¸ ì¶œë ¥
            document.getElementById('fileInput').addEventListener('change', function(e) {
                const files = Array.from(e.target.files);
                if (files.length > 0) {
                    log(`ğŸ“ ${files.length}ê°œ íŒŒì¼ ì„ íƒë¨:`, 'info');
                    files.forEach((file, index) => {
                        log(`   ${index + 1}. ${file.name} (${formatFileSize(file.size)})`, 'info');
                    });
                } else {
                    log('ğŸ“ íŒŒì¼ ì„ íƒì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.', 'warning');
                }
            });
        });
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registry API í…ŒìŠ¤íŠ¸ - BlueCrab LMS</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
        }

        .content {
            padding: 30px;
        }

        .section {
            margin-bottom: 40px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .section h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group textarea {
            font-family: 'Courier New', monospace;
            min-height: 100px;
            resize: vertical;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-right: 10px;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.4);
        }

        .response {
            margin-top: 20px;
            padding: 20px;
            background: #1e1e1e;
            color: #d4d4d4;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            overflow-x: auto;
            white-space: pre-wrap;
            word-break: break-all;
        }

        .response.success {
            border-left: 4px solid #28a745;
        }

        .response.error {
            border-left: 4px solid #dc3545;
        }

        .json-key {
            color: #9cdcfe;
        }

        .json-string {
            color: #ce9178;
        }

        .json-number {
            color: #b5cea8;
        }

        .json-boolean {
            color: #569cd6;
        }

        .json-null {
            color: #569cd6;
        }

        .info-box {
            background: #e7f3ff;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
        }

        .info-box strong {
            color: #1976D2;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
            }

            .content {
                padding: 15px;
            }

            .button-group {
                flex-direction: column;
            }

            .btn {
                width: 100%;
                margin-right: 0;
                margin-bottom: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¦€ BlueCrab LMS - Registry API í…ŒìŠ¤íŠ¸</h1>
            <p>í•™ì  ì¡°íšŒ ë° ì¦ëª…ì„œ ë°œê¸‰ API í…ŒìŠ¤íŠ¸ ë„êµ¬</p>
        </div>

        <div class="content">
            <!-- JWT í† í° ì„¤ì • -->
            <div class="section">
                <h2>ğŸ” 1. JWT í† í° ì„¤ì •</h2>
                <div class="info-box">
                    <strong>ğŸ“Œ ì•ˆë‚´:</strong> ë¨¼ì € ë¡œê·¸ì¸ APIë¥¼ í†µí•´ JWT í† í°ì„ ë°œê¸‰ë°›ì•„ ì•„ë˜ì— ì…ë ¥í•˜ì„¸ìš”.
                </div>
                <div class="form-group">
                    <label for="jwtToken">JWT í† í° (Bearer í† í°)</label>
                    <input type="text" id="jwtToken" placeholder="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...">
                </div>
                <div class="form-group">
                    <label for="baseUrl">API Base URL</label>
                    <input type="text" id="baseUrl" value="http://localhost:8080/BlueCrab-1.0.0">
                </div>
            </div>

            <!-- í•™ì  ì¡°íšŒ API -->
            <div class="section">
                <h2>ğŸ“‹ 2. í•™ì  ì¡°íšŒ API (POST /api/registry/me)</h2>
                <div class="info-box">
                    <strong>ê¸°ëŠ¥:</strong> JWT í† í°ì—ì„œ ì‚¬ìš©ì ì •ë³´ë¥¼ ì¶”ì¶œí•˜ì—¬ ìµœì‹  í•™ì  ì •ë³´ë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤.
                </div>

                <div class="form-group">
                    <label for="asOfDate">ìŠ¤ëƒ…ìƒ· ê¸°ì¤€ì¼ (ì„ íƒ, í˜•ì‹: YYYY-MM-DD)</label>
                    <input type="date" id="asOfDate" placeholder="2025-03-01">
                </div>

                <div class="button-group">
                    <button class="btn btn-primary" onclick="testRegistryMe()">
                        ğŸ” í•™ì  ì¡°íšŒ (í˜„ì¬ ì‹œì )
                    </button>
                    <button class="btn btn-primary" onclick="testRegistryMeAsOf()">
                        ğŸ“… í•™ì  ì¡°íšŒ (ì‹œì  ê¸°ì¤€)
                    </button>
                    <button class="btn btn-success" onclick="testRegistryExists()">
                        âœ… í•™ì  ì¡´ì¬ í™•ì¸
                    </button>
                </div>

                <div id="registryResponse" class="response" style="display: none;"></div>
            </div>

            <!-- ì¦ëª…ì„œ ë°œê¸‰ API -->
            <div class="section">
                <h2>ğŸ“„ 3. ì¦ëª…ì„œ ë°œê¸‰ ì´ë ¥ API (POST /api/registry/cert/issue)</h2>
                <div class="info-box">
                    <strong>ê¸°ëŠ¥:</strong> ì¦ëª…ì„œ ë°œê¸‰ ì´ë ¥ì„ JSON ìŠ¤ëƒ…ìƒ·ê³¼ í•¨ê»˜ ì €ì¥í•©ë‹ˆë‹¤.
                    <br><strong>ë‚¨ë°œ ë°©ì§€:</strong> ë™ì¼ ì¦ëª…ì„œëŠ” 5ë¶„ ì´ë‚´ ì¬ë°œê¸‰ ë¶ˆê°€
                </div>

                <div class="form-group">
                    <label for="certType">ì¦ëª…ì„œ ìœ í˜•</label>
                    <select id="certType">
                        <option value="enrollment">ì¬í•™ì¦ëª…ì„œ (enrollment)</option>
                        <option value="graduation_expected">ì¡¸ì—…ì˜ˆì •ì¦ëª…ì„œ (graduation_expected)</option>
                        <option value="graduation">ì¡¸ì—…ì¦ëª…ì„œ (graduation)</option>
                        <option value="transcript">ì„±ì ì¦ëª…ì„œ (transcript)</option>
                        <option value="certificate">ìˆ˜ë£Œì¦ëª…ì„œ (certificate)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="certAsOfDate">ìŠ¤ëƒ…ìƒ· ê¸°ì¤€ì¼ (ì„ íƒ, í˜•ì‹: YYYY-MM-DD)</label>
                    <input type="date" id="certAsOfDate">
                </div>

                <div class="form-group">
                    <label for="certFormat">ë°œê¸‰ í˜•ì‹</label>
                    <select id="certFormat">
                        <option value="html">HTML</option>
                        <option value="pdf">PDF</option>
                        <option value="image">ì´ë¯¸ì§€</option>
                    </select>
                </div>

                <div class="button-group">
                    <button class="btn btn-primary" onclick="testCertIssue()">
                        ğŸ“„ ì¦ëª…ì„œ ë°œê¸‰
                    </button>
                </div>

                <div id="certResponse" class="response" style="display: none;"></div>
            </div>

            <!-- ì¢…í•© í…ŒìŠ¤íŠ¸ -->
            <div class="section">
                <h2>ğŸš€ 4. ì¢…í•© í…ŒìŠ¤íŠ¸ (ì „ì²´ ì‹œë‚˜ë¦¬ì˜¤)</h2>
                <div class="info-box">
                    <strong>í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤:</strong>
                    <ol style="margin-left: 20px; margin-top: 10px;">
                        <li>í•™ì  ì¡´ì¬ ì—¬ë¶€ í™•ì¸</li>
                        <li>í•™ì  ì¡°íšŒ (í˜„ì¬ ì‹œì )</li>
                        <li>í•™ì  ì¡°íšŒ (ì‹œì  ê¸°ì¤€)</li>
                        <li>ì¬í•™ì¦ëª…ì„œ ë°œê¸‰</li>
                        <li>ì¡¸ì—…ì˜ˆì •ì¦ëª…ì„œ ë°œê¸‰</li>
                    </ol>
                </div>

                <button class="btn btn-success" onclick="runFullTest()" style="width: 100%;">
                    ğŸ¯ ì „ì²´ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
                </button>

                <div id="fullTestResponse" class="response" style="display: none;"></div>
            </div>
        </div>
    </div>

    <script>
        // JWT í† í° ê°€ì ¸ì˜¤ê¸°
        function getToken() {
            const token = document.getElementById('jwtToken').value.trim();
            if (!token) {
                alert('JWT í† í°ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return null;
            }
            return token;
        }

        // Base URL ê°€ì ¸ì˜¤ê¸°
        function getBaseUrl() {
            return document.getElementById('baseUrl').value.trim();
        }

        // ì‘ë‹µ í‘œì‹œ
        function showResponse(elementId, data, isSuccess = true) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.className = `response ${isSuccess ? 'success' : 'error'}`;
            element.textContent = JSON.stringify(data, null, 2);
        }

        // 1. í•™ì  ì¡°íšŒ (í˜„ì¬ ì‹œì )
        async function testRegistryMe() {
            const token = getToken();
            if (!token) return;

            try {
                const response = await fetch(`${getBaseUrl()}/api/registry/me`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({})
                });

                const data = await response.json();
                showResponse('registryResponse', data, response.ok);
            } catch (error) {
                showResponse('registryResponse', { error: error.message }, false);
            }
        }

        // 2. í•™ì  ì¡°íšŒ (ì‹œì  ê¸°ì¤€)
        async function testRegistryMeAsOf() {
            const token = getToken();
            if (!token) return;

            const asOfDate = document.getElementById('asOfDate').value;
            if (!asOfDate) {
                alert('ìŠ¤ëƒ…ìƒ· ê¸°ì¤€ì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            try {
                const response = await fetch(`${getBaseUrl()}/api/registry/me`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ asOf: asOfDate })
                });

                const data = await response.json();
                showResponse('registryResponse', data, response.ok);
            } catch (error) {
                showResponse('registryResponse', { error: error.message }, false);
            }
        }

        // 3. í•™ì  ì¡´ì¬ í™•ì¸
        async function testRegistryExists() {
            const token = getToken();
            if (!token) return;

            try {
                const response = await fetch(`${getBaseUrl()}/api/registry/me/exists`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                const data = await response.json();
                showResponse('registryResponse', data, response.ok);
            } catch (error) {
                showResponse('registryResponse', { error: error.message }, false);
            }
        }

        // 4. ì¦ëª…ì„œ ë°œê¸‰
        async function testCertIssue() {
            const token = getToken();
            if (!token) return;

            const certType = document.getElementById('certType').value;
            const certFormat = document.getElementById('certFormat').value;
            const certAsOfDate = document.getElementById('certAsOfDate').value || null;

            const requestBody = {
                type: certType,
                format: certFormat
            };

            if (certAsOfDate) {
                requestBody.asOf = certAsOfDate;
            }

            try {
                const response = await fetch(`${getBaseUrl()}/api/registry/cert/issue`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestBody)
                });

                const data = await response.json();
                showResponse('certResponse', data, response.ok);
            } catch (error) {
                showResponse('certResponse', { error: error.message }, false);
            }
        }

        // 5. ì „ì²´ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸
        async function runFullTest() {
            const token = getToken();
            if (!token) return;

            const results = [];
            const baseUrl = getBaseUrl();

            // 1. í•™ì  ì¡´ì¬ í™•ì¸
            results.push('=== 1. í•™ì  ì¡´ì¬ í™•ì¸ ===');
            try {
                const res1 = await fetch(`${baseUrl}/api/registry/me/exists`, {
                    method: 'GET',
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const data1 = await res1.json();
                results.push(JSON.stringify(data1, null, 2));
            } catch (e) {
                results.push(`ERROR: ${e.message}`);
            }

            // 2. í•™ì  ì¡°íšŒ (í˜„ì¬)
            results.push('\n=== 2. í•™ì  ì¡°íšŒ (í˜„ì¬ ì‹œì ) ===');
            try {
                const res2 = await fetch(`${baseUrl}/api/registry/me`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({})
                });
                const data2 = await res2.json();
                results.push(JSON.stringify(data2, null, 2));
            } catch (e) {
                results.push(`ERROR: ${e.message}`);
            }

            // 3. í•™ì  ì¡°íšŒ (ì‹œì  ê¸°ì¤€)
            const asOfDate = new Date();
            asOfDate.setMonth(asOfDate.getMonth() - 1);
            const asOfStr = asOfDate.toISOString().split('T')[0];

            results.push(`\n=== 3. í•™ì  ì¡°íšŒ (ì‹œì  ê¸°ì¤€: ${asOfStr}) ===`);
            try {
                const res3 = await fetch(`${baseUrl}/api/registry/me`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ asOf: asOfStr })
                });
                const data3 = await res3.json();
                results.push(JSON.stringify(data3, null, 2));
            } catch (e) {
                results.push(`ERROR: ${e.message}`);
            }

            // 4. ì¬í•™ì¦ëª…ì„œ ë°œê¸‰
            results.push('\n=== 4. ì¬í•™ì¦ëª…ì„œ ë°œê¸‰ ===');
            try {
                const res4 = await fetch(`${baseUrl}/api/registry/cert/issue`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        type: 'enrollment',
                        format: 'html'
                    })
                });
                const data4 = await res4.json();
                results.push(JSON.stringify(data4, null, 2));
            } catch (e) {
                results.push(`ERROR: ${e.message}`);
            }

            // ëŒ€ê¸° (ë‚¨ë°œ ë°©ì§€ í…ŒìŠ¤íŠ¸)
            results.push('\nâ³ 5ì´ˆ ëŒ€ê¸° ì¤‘...');
            showResponse('fullTestResponse', results.join('\n'), true);
            await new Promise(resolve => setTimeout(resolve, 5000));

            // 5. ì¬í•™ì¦ëª…ì„œ ì¬ë°œê¸‰ ì‹œë„ (ì‹¤íŒ¨ ì˜ˆìƒ)
            results.push('\n=== 5. ì¬í•™ì¦ëª…ì„œ ì¬ë°œê¸‰ ì‹œë„ (5ë¶„ ë¯¸ë§Œ - ì‹¤íŒ¨ ì˜ˆìƒ) ===');
            try {
                const res5 = await fetch(`${baseUrl}/api/registry/cert/issue`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        type: 'enrollment',
                        format: 'html'
                    })
                });
                const data5 = await res5.json();
                results.push(JSON.stringify(data5, null, 2));
            } catch (e) {
                results.push(`ERROR: ${e.message}`);
            }

            results.push('\nâœ… ì „ì²´ í…ŒìŠ¤íŠ¸ ì™„ë£Œ!');
            showResponse('fullTestResponse', results.join('\n'), true);
        }
    </script>
</body>
</html>

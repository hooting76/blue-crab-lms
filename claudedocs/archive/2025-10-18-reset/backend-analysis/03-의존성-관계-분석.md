# BlueCrab ë°±ì—”ë“œ ì˜ì¡´ì„± ê´€ê³„ ì™„ì „ ë¶„ì„

> **ë¶„ì„ ì¼ì**: 2025-09-28  
> **ë¶„ì„ ë²”ìœ„**: Controller, Service, Repository, Util ë ˆì´ì–´ê°„ ì˜ì¡´ì„±  
> **ë¶„ì„ ë°©ë²•**: @Autowired, ìƒì„±ì ì£¼ì…, ì§ì ‘ í˜¸ì¶œ ê´€ê³„ ì¶”ì 

## ğŸ—ï¸ ì „ì²´ ì•„í‚¤í…ì²˜ ì˜ì¡´ì„± ë‹¤ì´ì–´ê·¸ë¨

```mermaid
graph TD
    %% Controller Layer
    AC[AuthController] --> AS[AuthService]
    AC --> RU[RequestUtils]
    
    AdminC[AdminController] --> AdminS[AdminService]
    AdminC --> RU
    
    AEAC[AdminEmailAuthController] --> ES[EmailService]
    AEAC --> ATV[AdminTokenValidator]
    AEAC --> ACG[AuthCodeGenerator]
    AEAC --> ACV[AuthCodeValidator]
    AEAC --> ATR[AdminTblRepository]
    
    BC[BoardController] --> BS[BoardService]
    
    UC[UserController] --> UTS[UserTblService]
    
    PC[ProfileController] --> PS[ProfileService]
    
    PRC[PasswordResetController] --> PRS[PasswordResetService]
    
    %% Service Layer Dependencies
    AS --> UTR[UserTblRepository]
    AS --> JU[JwtUtil]
    AS --> AppConfig
    
    AdminS --> ATR
    AdminS --> EVS[EmailVerificationService]
    AdminS --> RS[RedisService]
    AdminS --> JU
    
    BS --> BR[BoardRepository]
    BS --> ATR
    BS --> UTR
    
    UTS --> UTR
    
    PS --> PVR[ProfileViewRepository]
    PS --> ICS[ImageCacheService]
    PS --> MIS[MinIOService]
    
    PRS --> ES
    PRS --> RS
    
    %% Util Dependencies
    ATV --> EVS
    UNE[UserNameExtractor] --> UTR
    UNE --> ATR
    
    %% Security Layer
    CUDS[CustomUserDetailsService] --> UTR
    CUDS --> ATR
    
    %% External Dependencies
    ES --> JavaMailSender
    RS --> RedisTemplate
    MIS --> MinIOClient
```

## ğŸ“Š ë ˆì´ì–´ë³„ ì˜ì¡´ì„± ìƒì„¸ ë¶„ì„

### ğŸ¯ **1. Controller ë ˆì´ì–´ (14ê°œ í´ë˜ìŠ¤)**

#### **AuthController** â†’ **ì˜ì¡´ì„± 2ê°œ**
| ì˜ì¡´ì„± í´ë˜ìŠ¤ | íƒ€ì… | ìš©ë„ | ìœ„í—˜ë„
|-------------|------|------|--------|
| `AuthService` | Service | ì¸ì¦ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ | ğŸŸ¢ ë‚®ìŒ |
| `RequestUtils` | Util | IP ì£¼ì†Œ ì¶”ì¶œ | ğŸŸ¢ ë‚®ìŒ |

#### **AdminController** â†’ **ì˜ì¡´ì„± 2ê°œ**
| ì˜ì¡´ì„± í´ë˜ìŠ¤ | íƒ€ì… | ìš©ë„ | ìœ„í—˜ë„
|-------------|------|------|--------|
| `AdminService` | Service | ê´€ë¦¬ì ì¸ì¦ ë¡œì§ | ğŸŸ¢ ë‚®ìŒ |
| `RequestUtils` | Util | IP ì£¼ì†Œ ì¶”ì¶œ | ğŸŸ¢ ë‚®ìŒ |

#### **AdminEmailAuthController** â†’ **ì˜ì¡´ì„± 5ê°œ** âš ï¸
| ì˜ì¡´ì„± í´ë˜ìŠ¤ | íƒ€ì… | ìš©ë„ | ìœ„í—˜ë„
|-------------|------|------|--------|
| `AdminTblRepository` | Repository | **ì§ì ‘ DB ì ‘ê·¼** | ğŸ”´ ë†’ìŒ |
| `EmailService` | Service | ì´ë©”ì¼ ë°œì†¡ | ğŸŸ¡ ì¤‘ê°„ |
| `AdminTokenValidator` | Util | í† í° ê²€ì¦ | ğŸŸ¡ ì¤‘ê°„ |
| `AuthCodeGenerator` | Util | ì¸ì¦ ì½”ë“œ ìƒì„± | ğŸŸ¡ ì¤‘ê°„ |
| `AuthCodeValidator` | Util | ì¸ì¦ ì½”ë“œ ê²€ì¦ | ğŸŸ¡ ì¤‘ê°„ |

#### **BoardController** â†’ **ì˜ì¡´ì„± 1ê°œ**
| ì˜ì¡´ì„± í´ë˜ìŠ¤ | íƒ€ì… | ìš©ë„ | ìœ„í—˜ë„
|-------------|------|------|--------|
| `BoardService` | Service | ê²Œì‹œíŒ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ | ğŸŸ¢ ë‚®ìŒ |

#### **UserController** â†’ **ì˜ì¡´ì„± 1ê°œ**
| ì˜ì¡´ì„± í´ë˜ìŠ¤ | íƒ€ì… | ìš©ë„ | ìœ„í—˜ë„
|-------------|------|------|--------|
| `UserTblService` | Service | ì‚¬ìš©ì ê´€ë¦¬ ë¡œì§ | ğŸŸ¢ ë‚®ìŒ |

#### **ProfileController** â†’ **ì˜ì¡´ì„± 1ê°œ**
| ì˜ì¡´ì„± í´ë˜ìŠ¤ | íƒ€ì… | ìš©ë„ | ìœ„í—˜ë„
|-------------|------|------|--------|
| `ProfileService` | Service | í”„ë¡œí•„ ê´€ë¦¬ ë¡œì§ | ğŸŸ¢ ë‚®ìŒ |

#### **PasswordResetController** â†’ **ì˜ì¡´ì„± 1ê°œ**
| ì˜ì¡´ì„± í´ë˜ìŠ¤ | íƒ€ì… | ìš©ë„ | ìœ„í—˜ë„
|-------------|------|------|--------|
| `PasswordResetService` | Service | ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ë¡œì§ | ğŸŸ¢ ë‚®ìŒ |

### ğŸ”§ **2. Service ë ˆì´ì–´ (13ê°œ í´ë˜ìŠ¤)**

#### **AuthService** â†’ **ì˜ì¡´ì„± 4ê°œ**
| ì˜ì¡´ì„± í´ë˜ìŠ¤ | íƒ€ì… | ìš©ë„ | ìœ„í—˜ë„
|-------------|------|------|--------|
| `UserTblRepository` | Repository | ì‚¬ìš©ì DB ì¡°íšŒ | ğŸŸ¢ ë‚®ìŒ |
| `JwtUtil` | Util | JWT í† í° ì²˜ë¦¬ | ğŸŸ¢ ë‚®ìŒ |
| `AppConfig` | Config | ì„¤ì • ì •ë³´ | ğŸŸ¢ ë‚®ìŒ |
| `PasswordEncoder` | Spring | ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™” | ğŸŸ¢ ë‚®ìŒ |

#### **AdminService** â†’ **ì˜ì¡´ì„± 4ê°œ**
| ì˜ì¡´ì„± í´ë˜ìŠ¤ | íƒ€ì… | ìš©ë„ | ìœ„í—˜ë„
|-------------|------|------|--------|
| `AdminTblRepository` | Repository | ê´€ë¦¬ì DB ì¡°íšŒ | ğŸŸ¢ ë‚®ìŒ |
| `EmailVerificationService` | Service | ì´ë©”ì¼ ì¸ì¦ | ğŸŸ¡ ì¤‘ê°„ |
| `RedisService` | Service | ìºì‹œ ê´€ë¦¬ | ğŸŸ¡ ì¤‘ê°„ |
| `JwtUtil` | Util | JWT í† í° ì²˜ë¦¬ | ğŸŸ¢ ë‚®ìŒ |

#### **BoardService** â†’ **ì˜ì¡´ì„± 3ê°œ**
| ì˜ì¡´ì„± í´ë˜ìŠ¤ | íƒ€ì… | ìš©ë„ | ìœ„í—˜ë„
|-------------|------|------|--------|
| `BoardRepository` | Repository | ê²Œì‹œíŒ DB ì¡°íšŒ | ğŸŸ¢ ë‚®ìŒ |
| `AdminTblRepository` | Repository | ê´€ë¦¬ì ì •ë³´ í™•ì¸ | ğŸŸ¡ ì¤‘ê°„ |
| `UserTblRepository` | Repository | ì‚¬ìš©ì ì •ë³´ í™•ì¸ | ğŸŸ¡ ì¤‘ê°„ |

#### **UserTblService** â†’ **ì˜ì¡´ì„± 1ê°œ**
| ì˜ì¡´ì„± í´ë˜ìŠ¤ | íƒ€ì… | ìš©ë„ | ìœ„í—˜ë„
|-------------|------|------|--------|
| `UserTblRepository` | Repository | ì‚¬ìš©ì DB ì¡°íšŒ | ğŸŸ¢ ë‚®ìŒ |

#### **ProfileService** â†’ **ì˜ì¡´ì„± 3ê°œ**
| ì˜ì¡´ì„± í´ë˜ìŠ¤ | íƒ€ì… | ìš©ë„ | ìœ„í—˜ë„
|-------------|------|------|--------|
| `ProfileViewRepository` | Repository | í”„ë¡œí•„ ë·° ì¡°íšŒ | ğŸŸ¢ ë‚®ìŒ |
| `ImageCacheService` | Service | ì´ë¯¸ì§€ ìºì‹œ ê´€ë¦¬ | ğŸŸ¡ ì¤‘ê°„ |
| `MinIOService` | Service | íŒŒì¼ ìŠ¤í† ë¦¬ì§€ | ğŸŸ¡ ì¤‘ê°„ |

#### **EmailService** â†’ **ì˜ì¡´ì„± 1ê°œ**
| ì˜ì¡´ì„± í´ë˜ìŠ¤ | íƒ€ì… | ìš©ë„ | ìœ„í—˜ë„
|-------------|------|------|--------|
| `JavaMailSender` | Spring | ì´ë©”ì¼ ë°œì†¡ | ğŸŸ¢ ë‚®ìŒ |

### ğŸ› ï¸ **3. Repository ë ˆì´ì–´ (4ê°œ í´ë˜ìŠ¤)**

#### **Repository ëª©ë¡**
| Repository | Entity | ì£¼ìš” ì˜ì¡´ Service |
|-----------|--------|------------------|
| `UserTblRepository` | UserTbl | AuthService, UserTblService, BoardService |
| `AdminTblRepository` | AdminTbl | AdminService, BoardService |
| `BoardRepository` | BoardTbl | BoardService |
| `ProfileViewRepository` | ProfileView | ProfileService |

### ğŸ”§ **4. Util ë ˆì´ì–´ ì˜ì¡´ì„± ë¶„ì„**

#### **ì¸ì¦/ë³´ì•ˆ ê´€ë ¨ Util (7ê°œ)**
| Util í´ë˜ìŠ¤ | ì˜ì¡´ì„± | ê¸°ëŠ¥ ì¤‘ë³µë„ |
|------------|--------|-----------|
| `JwtUtil` | ì—†ìŒ (ë…ë¦½ì ) | ğŸŸ¢ ë‚®ìŒ |
| `AdminJwtTokenBuilder` | ì—†ìŒ | ğŸ”´ ë†’ìŒ (JwtUtilê³¼ ì¤‘ë³µ) |
| `AdminTokenValidator` | EmailVerificationService | ğŸ”´ ë†’ìŒ |
| `AuthCodeGenerator` | ì—†ìŒ | ğŸŸ¡ ì¤‘ê°„ |
| `AuthCodeValidator` | ì—†ìŒ | ğŸŸ¡ ì¤‘ê°„ |
| `SHA256Util` | ì—†ìŒ | ğŸŸ¡ ì¤‘ê°„ (PasswordEncoderì™€ ì¤‘ë³µ) |
| `UserVerificationUtils` | ì—†ìŒ | ğŸŸ¡ ì¤‘ê°„ |

#### **Rate Limiting ê´€ë ¨ Util (3ê°œ)**
| Util í´ë˜ìŠ¤ | ì˜ì¡´ì„± | ê¸°ëŠ¥ ì¤‘ë³µë„ |
|------------|--------|-----------|
| `MailAuthRateLimitUtils` | ì—†ìŒ | ğŸ”´ ë†’ìŒ |
| `PasswordResetRateLimiter` | ì—†ìŒ | ğŸ”´ ë†’ìŒ |
| `AccountRecoveryRateLimiter` | ì—†ìŒ | ğŸ”´ ë†’ìŒ |

#### **ì‚¬ìš©ì ì •ë³´ ì¶”ì¶œ Util**
| Util í´ë˜ìŠ¤ | ì˜ì¡´ì„± | ìš©ë„ |
|------------|--------|-----|
| `UserNameExtractor` | UserTblRepository, AdminTblRepository | ì‚¬ìš©ìëª… ì¶”ì¶œ |

## ğŸš¨ **ì‹¬ê°í•œ ì˜ì¡´ì„± ë¬¸ì œ ë¶„ì„**

### âš ï¸ **1. Controller â†’ Repository ì§ì ‘ ì˜ì¡´ (ì•ˆí‹°íŒ¨í„´)**

```java
// âŒ ë¬¸ì œ: AdminEmailAuthController â†’ AdminTblRepository ì§ì ‘ ì ‘ê·¼
@RestController
public class AdminEmailAuthController {
    @Autowired
    private AdminTblRepository adminTblRepository; // ìœ„ë°˜!
    
    // Controllerê°€ ì§ì ‘ Repositoryì— ì ‘ê·¼í•˜ë©´ ì•ˆë¨
}
```

**í•´ê²°ë°©ì•ˆ:**
```java
// âœ… ì˜¬ë°”ë¥¸ ë°©ì‹: Controller â†’ Service â†’ Repository
@RestController  
public class AdminEmailAuthController {
    @Autowired
    private AdminService adminService; // Serviceë¥¼ í†µí•œ ì ‘ê·¼
}
```

### âš ï¸ **2. ìˆœí™˜ ì˜ì¡´ì„± ìœ„í—˜**

```mermaid
graph TD
    AdminTokenValidator --> EmailVerificationService
    EmailVerificationService --> AdminService
    AdminService --> RedisService
    RedisService --> ?[ê¸°íƒ€ Serviceë“¤]
    
    style AdminTokenValidator fill:#ffcccc
    style EmailVerificationService fill:#ffcccc
```

### âš ï¸ **3. ì¤‘ë³µ ê¸°ëŠ¥ìœ¼ë¡œ ì¸í•œ ì˜ì¡´ì„± ë³µì¡í™”**

#### **JWT ì²˜ë¦¬ ì¤‘ë³µ**
- `JwtUtil` (ì¼ë°˜ ì‚¬ìš©ììš©)
- `AdminJwtTokenBuilder` (ê´€ë¦¬ììš©) 
- `AdminTokenValidator` (ê´€ë¦¬ì ê²€ì¦ìš©)

#### **Rate Limiting ì¤‘ë³µ**
- `MailAuthRateLimitUtils`
- `PasswordResetRateLimiter` 
- `AccountRecoveryRateLimiter`

#### **ì•”í˜¸í™” ì¤‘ë³µ**
- `SHA256Util` (ê´€ë¦¬ììš©)
- `PasswordEncoder` (ì¼ë°˜ ì‚¬ìš©ììš©)

## ğŸ’¡ **ë¦¬íŒ©í† ë§ ìš°ì„ ìˆœìœ„**

### ğŸ”´ **ìµœìš°ì„  (Critical)**

#### 1. **Controller â†’ Repository ì§ì ‘ ì ‘ê·¼ ì œê±°**
```java
// í˜„ì¬ ë¬¸ì œ ìƒí™©
AdminEmailAuthController â†’ AdminTblRepository âŒ

// í•´ê²° ë°©ì•ˆ
AdminEmailAuthController â†’ AdminService â†’ AdminTblRepository âœ…
```

#### 2. **ì¤‘ë³µ JWT í´ë˜ìŠ¤ í†µí•©**
```java
// í†µí•© ì „ (3ê°œ í´ë˜ìŠ¤)
JwtUtil + AdminJwtTokenBuilder + AdminTokenValidator

// í†µí•© í›„ (1ê°œ í´ë˜ìŠ¤)
UnifiedJwtUtil {
    // ì¼ë°˜/ê´€ë¦¬ì ê³µí†µ ì²˜ë¦¬
    generateToken(user, role)
    validateToken(token, role)
}
```

### ğŸŸ¡ **ë†’ì€ ìš°ì„ ìˆœìœ„**

#### 1. **Rate Limiter í´ë˜ìŠ¤ í†µí•©**
```java
// í†µí•© ì „ (3ê°œ í´ë˜ìŠ¤)
MailAuthRateLimitUtils
PasswordResetRateLimiter  
AccountRecoveryRateLimiter

// í†µí•© í›„ (1ê°œ í´ë˜ìŠ¤)
RateLimitManager {
    checkLimit(type, identifier)
    incrementAttempt(type, identifier)
}
```

#### 2. **Service ê°„ ì˜ì¡´ì„± ë‹¨ìˆœí™”**
- AdminService â† EmailVerificationService ì˜ì¡´ì„± ì œê±°
- ProfileService ë‚´ë¶€ Service ì˜ì¡´ì„± ìµœì í™”

### ğŸŸ¢ **ì¤‘ê°„ ìš°ì„ ìˆœìœ„**

#### 1. **Util í´ë˜ìŠ¤ ì—­í•  ëª…í™•í™”**
- ë‹¨ì¼ ì±…ì„ ì›ì¹™ ì ìš©
- ê³µí†µ ê¸°ëŠ¥ ì¶”ìƒí™”

#### 2. **Repository ì ‘ê·¼ íŒ¨í„´ í‘œì¤€í™”**
- ëª¨ë“  Serviceì—ì„œ ë™ì¼í•œ Repository ì ‘ê·¼ ë°©ì‹ ì ìš©

## ğŸ“ˆ **ì˜ì¡´ì„± ë©”íŠ¸ë¦­ ë¶„ì„**

### **ë³µì¡ë„ ì§€ìˆ˜**
| ë ˆì´ì–´ | í‰ê·  ì˜ì¡´ì„± ìˆ˜ | ìµœëŒ€ ì˜ì¡´ì„± | ë¬¸ì œ í´ë˜ìŠ¤ |
|--------|---------------|-------------|------------|
| Controller | 1.8ê°œ | 5ê°œ | AdminEmailAuthController |
| Service | 2.3ê°œ | 4ê°œ | AdminService, ProfileService |
| Util | 0.4ê°œ | 2ê°œ | UserNameExtractor |

### **ìˆœí™˜ ì˜ì¡´ì„± ìœ„í—˜ë„**
- **ë†’ìŒ**: Admin ê´€ë ¨ í´ë˜ìŠ¤ë“¤
- **ì¤‘ê°„**: Email/Auth ê´€ë ¨ í´ë˜ìŠ¤ë“¤  
- **ë‚®ìŒ**: Board, User ê´€ë ¨ í´ë˜ìŠ¤ë“¤

### **ë¦¬íŒ©í† ë§ ì˜í–¥ë„**
- **AdminEmailAuthController ìˆ˜ì •**: ë†’ìŒ (5ê°œ ì˜ì¡´ì„±)
- **JWT í´ë˜ìŠ¤ í†µí•©**: ì¤‘ê°„ (3ê°œ í´ë˜ìŠ¤ ì˜í–¥)
- **Rate Limiter í†µí•©**: ë‚®ìŒ (ë…ë¦½ì  í´ë˜ìŠ¤ë“¤)

---

## ğŸ“‹ **ë‹¤ìŒ ë‹¨ê³„ (Phase 2)**

1. **Controller â†’ Repository ì§ì ‘ ì ‘ê·¼ ìˆ˜ì •**
2. **ì¤‘ë³µ ê¸°ëŠ¥ í´ë˜ìŠ¤ í†µí•© ê³„íš**
3. **ìˆœí™˜ ì˜ì¡´ì„± í•´ê²° ë°©ì•ˆ**
4. **ì„±ëŠ¥ ì˜í–¥ë„ ë¶„ì„**

*ì´ ë¬¸ì„œëŠ” ì˜ì¡´ì„± ê´€ê³„ ì™„ì „ ë¶„ì„ ê²°ê³¼ì´ë©°, ì•„í‚¤í…ì²˜ ê°œì„ ì„ ìœ„í•œ êµ¬ì²´ì  ì‹¤í–‰ ê³„íšì„ í¬í•¨í•©ë‹ˆë‹¤.*
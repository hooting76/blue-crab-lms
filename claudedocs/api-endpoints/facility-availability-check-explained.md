# ğŸ“‹ ì‹œì„¤ ê°€ìš©ì„± í™•ì¸ API ì„¤ëª…

## ğŸ¯ API ê°œìš”

**ì—”ë“œí¬ì¸íŠ¸**: `POST /api/facilities/{facilityIdx}/availability`

**ëª©ì **: íŠ¹ì • ì‹œì„¤ì´ ì›í•˜ëŠ” ì‹œê°„ëŒ€ì— ì˜ˆì•½ ê°€ëŠ¥í•œì§€ í™•ì¸

---

## ğŸ“ ë¬´ì—‡ì„ í™•ì¸í•˜ë‚˜?

ì´ APIëŠ” ë‹¤ìŒ 3ê°€ì§€ë¥¼ ì²´í¬í•©ë‹ˆë‹¤:

### 1ï¸âƒ£ ì‹œì„¤ ì°¨ë‹¨ ì—¬ë¶€ í™•ì¸
```
ê´€ë¦¬ìê°€ ì„¤ì •í•œ ì°¨ë‹¨ ê¸°ê°„ì¸ê°€?
â””â”€ facility_block_tbl í…Œì´ë¸” í™•ì¸
   â””â”€ ì˜ˆ: ì‹œì„¤ ê³µì‚¬, ì ê²€ ë“±ìœ¼ë¡œ ì‚¬ìš© ë¶ˆê°€ ê¸°ê°„
```

### 2ï¸âƒ£ ê¸°ì¡´ ì˜ˆì•½ê³¼ì˜ ì¶©ëŒ í™•ì¸
```
í•´ë‹¹ ì‹œê°„ëŒ€ì— ì´ë¯¸ ì˜ˆì•½ì´ ìˆë‚˜?
â””â”€ facility_reservation_tbl í…Œì´ë¸” í™•ì¸
   â””â”€ ìƒíƒœ: PENDING(ìŠ¹ì¸ ëŒ€ê¸°) ë˜ëŠ” APPROVED(ìŠ¹ì¸ë¨)
```

### 3ï¸âƒ£ ê°€ìš©ì„± íŒë‹¨
```
ì°¨ë‹¨ ì—†ìŒ + ì˜ˆì•½ ì¶©ëŒ ì—†ìŒ = ì˜ˆì•½ ê°€ëŠ¥! âœ…
ì°¨ë‹¨ ìˆìŒ OR ì˜ˆì•½ ì¶©ëŒ ìˆìŒ = ì˜ˆì•½ ë¶ˆê°€! âŒ
```

---

## ğŸ” ë™ì‘ ê³¼ì •

```
ì‚¬ìš©ì ìš”ì²­
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ì‹œì„¤ ì¡´ì¬ ì—¬ë¶€ í™•ì¸           â”‚
â”‚    - facilityIdxë¡œ ì‹œì„¤ ì¡°íšŒ     â”‚
â”‚    - ì—†ìœ¼ë©´ 404 ì—ëŸ¬            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. ì‹œì„¤ ì°¨ë‹¨ ì—¬ë¶€ í™•ì¸           â”‚
â”‚    - facility_block_tbl ì¡°íšŒ    â”‚
â”‚    - ì°¨ë‹¨ ê¸°ê°„ê³¼ ê²¹ì¹˜ëŠ”ê°€?       â”‚
â”‚    - ìˆìœ¼ë©´ ì—ëŸ¬ ë°œìƒ âŒ         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. ì˜ˆì•½ ì¶©ëŒ í™•ì¸                â”‚
â”‚    - facility_reservation_tbl   â”‚
â”‚    - PENDING/APPROVED ìƒíƒœë§Œ     â”‚
â”‚    - ì‹œê°„ ê²¹ì¹¨ í™•ì¸              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. ê²°ê³¼ ë°˜í™˜                     â”‚
â”‚    - isAvailable: true/false    â”‚
â”‚    - conflictingReservations    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¥ ìš”ì²­ ì˜ˆì‹œ

### íŒŒë¼ë¯¸í„°
- **facilityIdx** (Path): ì‹œì„¤ ID (ì˜ˆ: 1)
- **startTime** (Query): ì‹œì‘ ì‹œê°„ (ISO 8601 í˜•ì‹)
- **endTime** (Query): ì¢…ë£Œ ì‹œê°„ (ISO 8601 í˜•ì‹)

### API í˜¸ì¶œ ì˜ˆì‹œ
```http
POST /api/facilities/1/availability?startTime=2025-01-01T10:00:00&endTime=2025-01-01T12:00:00
Authorization: Bearer {token}
```

### ì´ë¯¸ì§€ì—ì„œ ë³¸ ì˜ˆì‹œ
```
facilityIdx: 1
startTime: 2025-01-01T10:00:00
endTime: 2025-01-01T12:00:00
```

---

## ğŸ“¤ ì‘ë‹µ ì˜ˆì‹œ

### âœ… ì˜ˆì•½ ê°€ëŠ¥í•œ ê²½ìš°
```json
{
  "status": "success",
  "message": "ê°€ìš©ì„±ì„ í™•ì¸í–ˆìŠµë‹ˆë‹¤.",
  "data": {
    "facilityIdx": 1,
    "facilityName": "ì„¸ë¯¸ë‚˜ì‹¤ A",
    "isAvailable": true,
    "conflictingReservations": []
  }
}
```

### âŒ ì˜ˆì•½ ë¶ˆê°€ëŠ¥í•œ ê²½ìš° (ê¸°ì¡´ ì˜ˆì•½ê³¼ ì¶©ëŒ)
```json
{
  "status": "success",
  "message": "ê°€ìš©ì„±ì„ í™•ì¸í–ˆìŠµë‹ˆë‹¤.",
  "data": {
    "facilityIdx": 1,
    "facilityName": "ì„¸ë¯¸ë‚˜ì‹¤ A",
    "isAvailable": false,
    "conflictingReservations": [
      {
        "startTime": "2025-01-01T10:30:00",
        "endTime": "2025-01-01T11:30:00"
      }
    ]
  }
}
```

### âŒ ì‹œì„¤ ì°¨ë‹¨ëœ ê²½ìš° (ì—ëŸ¬)
```json
{
  "status": "error",
  "message": "í•´ë‹¹ ì‹œì„¤ì€ 2025-01-01T00:00:00ë¶€í„° 2025-01-03T23:59:59ê¹Œì§€ ì˜ˆì•½ì´ ë¶ˆê°€í•©ë‹ˆë‹¤. ì‚¬ìœ : ì‹œì„¤ ë³´ìˆ˜ ê³µì‚¬"
}
```

---

## ğŸ¯ ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤

### ì‹œë‚˜ë¦¬ì˜¤ 1: ì˜ˆì•½ ì „ ê°€ìš©ì„± í™•ì¸
```
í•™ìƒì´ ì„¸ë¯¸ë‚˜ì‹¤ ì˜ˆì•½ í˜ì´ì§€ ì ‘ì†
    â†“
ì›í•˜ëŠ” ë‚ ì§œì™€ ì‹œê°„ ì„ íƒ
    â†“
"ì˜ˆì•½ ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸" ë²„íŠ¼ í´ë¦­
    â†“
ì´ API í˜¸ì¶œ â†’ ê²°ê³¼ í‘œì‹œ
    â†“
ê°€ëŠ¥í•˜ë©´ "ì˜ˆì•½í•˜ê¸°" ë²„íŠ¼ í™œì„±í™”
```

### ì‹œë‚˜ë¦¬ì˜¤ 2: ì‹¤ì‹œê°„ ê°€ìš©ì„± í‘œì‹œ
```
ì‹œì„¤ ì˜ˆì•½ ë‹¬ë ¥ í™”ë©´
    â†“
ê° ì‹œê°„ëŒ€ë§ˆë‹¤ ì´ API í˜¸ì¶œ
    â†“
ì˜ˆì•½ ê°€ëŠ¥: ì´ˆë¡ìƒ‰ í‘œì‹œ âœ…
ì˜ˆì•½ ë¶ˆê°€: ë¹¨ê°„ìƒ‰ í‘œì‹œ âŒ
```

### ì‹œë‚˜ë¦¬ì˜¤ 3: ì˜ˆì•½ ìˆ˜ì • ì‹œ
```
ê¸°ì¡´ ì˜ˆì•½ì„ ë‹¤ë¥¸ ì‹œê°„ìœ¼ë¡œ ë³€ê²½
    â†“
ìƒˆ ì‹œê°„ëŒ€ì˜ ê°€ìš©ì„± í™•ì¸
    â†“
excludeReservationIdx ì‚¬ìš© (ìê¸° ì˜ˆì•½ ì œì™¸)
    â†“
ê°€ëŠ¥í•˜ë©´ ìˆ˜ì • í—ˆìš©
```

---

## ğŸ”‘ í•µì‹¬ ë¡œì§

### ì‹œê°„ ì¶©ëŒ ì²´í¬
```sql
-- Repositoryì—ì„œ ì‹¤í–‰ë˜ëŠ” ì¿¼ë¦¬
SELECT * FROM facility_reservation_tbl
WHERE facility_idx = :facilityIdx
  AND status IN ('PENDING', 'APPROVED')
  AND NOT (end_time <= :startTime OR start_time >= :endTime)
  -- ì˜ˆì•½ ì‹œê°„ì´ ê²¹ì¹˜ëŠ” ê²½ìš°ë¥¼ ì°¾ìŒ
```

### ì°¨ë‹¨ ì²´í¬
```sql
-- facility_block_tbl í™•ì¸
SELECT * FROM facility_block_tbl
WHERE facility_idx = :facilityIdx
  AND NOT (block_end <= :startTime OR block_start >= :endTime)
  -- ì°¨ë‹¨ ê¸°ê°„ê³¼ ê²¹ì¹˜ëŠ”ì§€ í™•ì¸
```

---

## ğŸ’¡ ì£¼ì˜ì‚¬í•­

### âš ï¸ ê°€ìš©ì„± í™•ì¸ì€ "ìˆœê°„"ì˜ ì •ë³´
- ë‹¤ë¥¸ ì‚¬ìš©ìê°€ ë™ì‹œì— ì˜ˆì•½í•  ìˆ˜ ìˆìŒ
- ê°€ìš©ì„± í™•ì¸ í›„ ì¦‰ì‹œ ì˜ˆì•½ ê¶Œì¥
- ì˜ˆì•½ ìƒì„± APIì—ì„œ ì¬ê²€ì¦ í•„ìˆ˜

### âš ï¸ ì‹œê°„ í˜•ì‹
- ISO 8601 í˜•ì‹ ì‚¬ìš©: `yyyy-MM-dd'T'HH:mm:ss`
- ì˜ˆ: `2025-01-01T10:00:00`
- íƒ€ì„ì¡´: ì„œë²„ ê¸°ë³¸ íƒ€ì„ì¡´ ì‚¬ìš© (Asia/Seoul)

### âš ï¸ ì°¨ë‹¨ vs ì˜ˆì•½ ì¶©ëŒ
- **ì°¨ë‹¨**: ì—ëŸ¬ ë°œìƒ (ì˜ˆì•½ ì‹œë„ ë¶ˆê°€)
- **ì˜ˆì•½ ì¶©ëŒ**: ì •ìƒ ì‘ë‹µ + isAvailable=false

---

## ğŸ“Š ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”

### facility_block_tbl (ì‹œì„¤ ì°¨ë‹¨ ì •ë³´)
```
facility_idx    ì‹œì„¤ ID
block_start     ì°¨ë‹¨ ì‹œì‘ ì‹œê°„
block_end       ì°¨ë‹¨ ì¢…ë£Œ ì‹œê°„
block_reason    ì°¨ë‹¨ ì‚¬ìœ 
```

### facility_reservation_tbl (ì˜ˆì•½ ì •ë³´)
```
reservation_idx ì˜ˆì•½ ID
facility_idx    ì‹œì„¤ ID
start_time      ì˜ˆì•½ ì‹œì‘ ì‹œê°„
end_time        ì˜ˆì•½ ì¢…ë£Œ ì‹œê°„
status          ì˜ˆì•½ ìƒíƒœ (PENDING/APPROVED/REJECTED/CANCELLED)
user_code       ì˜ˆì•½ì
```

---

## ğŸ”— ê´€ë ¨ API

- `POST /api/facilities/{facilityIdx}/reservations` - ì˜ˆì•½ ìƒì„± (ê°€ìš©ì„± ì¬í™•ì¸ í¬í•¨)
- `GET /api/facilities/{facilityIdx}` - ì‹œì„¤ ì •ë³´ ì¡°íšŒ
- `GET /api/facilities/{facilityIdx}/reservations` - ì‹œì„¤ì˜ ì˜ˆì•½ ëª©ë¡

---

## ğŸ“– ì°¸ê³  ë¬¸ì„œ

- [facility-reservation-api-complete.md](../claudedocs/api-endpoints/facility-reservation-api-complete.md)
- [consecutive-time-only-policy.md](../claudedocs/feature-docs/facility-reservation/consecutive-time-only-policy.md)

---

**ì‘ì„±ì**: GitHub Copilot  
**ì‘ì„±ì¼**: 2025-10-12  
**ì¹´í…Œê³ ë¦¬**: API ì„¤ëª…ì„œ
